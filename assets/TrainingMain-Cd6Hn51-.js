import{R as De,r as g,A as d,t as Te,l as ke,f as Pe,H as I,ax as Ie,j as t,C as r,s as z,ay as B,_ as ze,i as E,k as O,Y as _}from"./index-CDo8TDjo.js";import{d as Me,a as Re,b as Ae}from"./TrainingLogHelper-D0lYT5hD.js";import{b as $e}from"./index-CHsf2JjA.js";import{F as q,a as J}from"./index-C2MvERjj.js";const h=e=>{const l=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${l}-${o}-${x}`},Fe=e=>(e.getDay()+6)%7;h(new Date);const H=new Audio("Audio/Click.wav"),We=()=>{const[e,l]=De.useState("dark"),[o,x]=g.useState(d.prefs[0]),[i,w]=g.useState(new Date),[c,ee]=g.useState(i),W=g.useRef(c),[te,ne]=g.useState(0),[m,se]=g.useState(d.prefs[4]),[oe,M]=g.useState(!1),[ie,R]=g.useState(!1),[re,A]=g.useState(!1),[b,K]=g.useState(d.getLastProgramId()),[$,U]=g.useState(d.getLastTrainingDayIndex()),[S,v]=g.useState(16*36e5),[C,D]=g.useState(17*36e5),[G,le]=g.useState({date:"",key:0}),f=600*1e3,u=24*36e5;g.useEffect(()=>{const n=Te.subscribe(l),a=ke.subscribe(y=>{x(y==="ru"?0:1)}),p=Pe.subscribe(y=>{se(y)});return()=>{n.unsubscribe(),a.unsubscribe(),p.unsubscribe()}},[]);const ae=new Date(i.getFullYear(),i.getMonth(),1),ce=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),de=(ae.getDay()+6)%7,xe=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],ge=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],ue=I(()=>v(n=>(n-f+u)%u)),pe=I(()=>v(n=>(n+f)%u)),he=I(()=>D(n=>{const a=(n-f+u)%u;return a>=S?a:n})),fe=I(()=>D(n=>(n+f)%u)),T=[],V=[];for(let n=0;n<de;n++)T.push(null);for(let n=1;n<=ce;n++)T.push(n);for(let n=0;n<T.length;n+=7)V.push(T.slice(n,n+7));const me=()=>{w(new Date(i.getFullYear(),i.getMonth()-1)),N(H)},ye=()=>{w(new Date(i.getFullYear(),i.getMonth()+1)),N(H)};g.useEffect(()=>{W.current=c},[c]),g.useEffect(()=>{const n=Ie.subscribe(()=>{const a=new Date,p=W.current;if(p>a)return;const y=h(p),j=h(a);y===j?M(!0):R(!0)});return()=>n.unsubscribe()},[]);const be=()=>{Re(new Date,b,$),M(!1),setTimeout(()=>{const a=h(new Date),p=d.trainingLog[a].length-1;B({mode:"new",dayKey:a,dInd:p}),z("TrainingCurrent")},100)},Se=()=>{if(C<=S){_(o===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Ae(c,b,$,S,C),R(!1);const n=h(c),a=d.trainingLog[n].length-1;B({mode:"redact",dayKey:n,dInd:a}),z("TrainingCurrent")},je=(n,a)=>{le({date:n,key:a})},we=()=>{Me(G.date,G.key),A(!1),_(o===0?"Тренировка удалена":"Session deleted",2e3,!0)};return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).panel,children:[t.jsxs("div",{style:s(e).calendarHead,children:[t.jsx("h1",{style:s(e).header,children:i.getFullYear()+"/"+(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)}),t.jsx("div",{onClick:me,children:t.jsx("h1",{style:s(e).header,children:"<"})}),t.jsx("div",{onClick:ye,children:t.jsx("h1",{style:s(e).header,children:">"})})]}),t.jsxs("table",{style:s(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:xe[o].map(n=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:n==="Вс"||n==="Sun"?"#873535ff":r.get("subText",e)},children:n})},n))})}),t.jsx("tbody",{children:V.map((n,a)=>t.jsx("tr",{children:n.map((p,y)=>{const j=i.getMonth(),F=i.getFullYear(),ve=p===c.getDate()&&j===c.getMonth()&&F===c.getFullYear(),L=h(new Date(F,j,p)),Y=L in d.trainingLog?d.trainingLog[L].length:0;let k=0,P=0;return Y>0&&d.trainingLog[L].forEach(Ce=>{Ce.completed?P++:k++}),t.jsx("td",{children:t.jsxs("div",{style:{...s(e).cell,border:`3px solid ${ve?r.get("currentDateBorder",e):r.get("background",e)}`,backgroundColor:r.get("background",e)},onClick:()=>{ee(new Date(Date.UTC(F,j,p))),ne(Y),N(H)},children:[p,Y>0&&t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"10px"},children:[k>0&&t.jsx("div",{style:{fontSize:"10px",color:r.get("done",e),lineHeight:"5px"},children:"⏳"}),k>0&&t.jsx("div",{style:{fontSize:"11px",color:r.get("subText",e),lineHeight:"5px"},children:k}),P>0&&t.jsx("div",{style:{fontSize:"10px",color:r.get("done",e),lineHeight:"5px"},children:"✅"}),P>0&&t.jsx("div",{style:{fontSize:"11px",color:r.get("subText",e),lineHeight:"5px"},children:P})]})]})},y)})},a))})]})]}),t.jsxs("div",{onClick:()=>z("TrainingList"),style:{display:"flex",width:"100%",alignSelf:"center",justifyContent:"center",backgroundColor:r.get("currentDateBorder",e),alignItems:"center"},children:[t.jsx("div",{style:s(e).text,children:o===0?"журнал":"journal"}),t.jsx($e,{style:{...s(e).icon,fontSize:"14px",marginLeft:"14px"}})]}),t.jsxs("div",{style:{height:"30vh",width:"95%",display:"flex",flexDirection:"column",alignContent:"center"},children:[t.jsx("h1",{style:{...s(e).subtext,fontSize:"18px",textAlign:"center"},children:c.getDate()+"-"+(c.getMonth()+1)+"-"+c.getFullYear()+" "+ge[o][Fe(c)]+" • "+Le(te,o)}),t.jsx("div",{style:s(e).scrollView,children:d.trainingLog[h(c)]?.map((n,a)=>t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%",borderBottom:`1px solid ${r.get("border",e)}`},children:[t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:a+1}),t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:n.completed?"✅":"⏳"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{onClick:()=>{B({mode:n.completed?"redact":"new",dayKey:h(new Date(c)),dInd:a}),z("TrainingCurrent")},style:s(e).mainText,children:Array.isArray(d.programs[n.programId]?.name)?d.programs[n.programId]?.name?.[o]:d.programs[n.programId]?.name}),t.jsx("div",{style:s(e).mainText,children:(o===0?"День ":"Day ")+(n.dayIndex+1)+": "+(d.programs[n.programId]?.schedule?.[n.dayIndex]?.name?.[o]||(o===0?`День ${n.dayIndex+1}`:`Day ${n.dayIndex+1}`))}),n.completed&&t.jsx("div",{style:{...s(e).subtext,marginBottom:"10px"},children:`${Math.round(n.duration/6e4)}${o===0?" мин":" min"}  /  ${(n.tonnage*.001).toFixed(2)} ${o===0?" тонн":" tons"}${Ye(n,o)}`})]}),t.jsx(ze,{onClick:()=>{je(h(new Date(c)),a),A(!0)},style:{...s(e).subtext,width:"18px",height:"18px",marginLeft:"auto",marginRight:"10px"}})]},a))})]}),re&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"20%"},children:[t.jsx("div",{style:{...s(e,m).text},children:o===0?"Удалить тренировку?":"Delete session?"}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(E,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>A(!1)}),t.jsx(O,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>{we()}})]})]})}),oe&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начать тренировку?":"Start training?"}),t.jsx("select",{value:b,style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>K(Number(n.target.value)),children:Q(e,o)}),t.jsx("select",{value:$,style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(Number(n.target.value)),children:X(e,o,m,b)}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(E,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>M(!1)}),t.jsx(O,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>{be()}})]})]})}),ie&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Добавить предыдущую тренировку?":"Add previous training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>K(Number(n.target.value)),children:Q(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(Number(n.target.value)),children:X(e,o,m,b)}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начало тренировки":"Training start time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ue,onClick:()=>v(n=>(n-f+u)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})}),t.jsx("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:Z(S)}),t.jsxs("div",{...pe,onClick:()=>v(n=>(n+f)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:[t.jsx(J,{})," "]})]}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Окончание тренировки":"Training end time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...he,onClick:()=>{const n=(C-f+u)%u;n>=S&&D(n)},style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})})," ",t.jsxs("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:[" ",Z(C)," "]}),t.jsx("div",{...fe,onClick:()=>D(n=>(n+f)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(J,{})})]}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(E,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>R(!1)}),t.jsx(O,{style:{fontSize:"38px",color:r.get("icons",e)},onClick:()=>{Se()}})]})]})})]})},Q=(e,l,o)=>Object.entries(d.programs).filter(([,x])=>x.show!==!1).map(([x,i])=>t.jsx("option",{value:x,style:{...s(e,!1).text},children:Array.isArray(i?.name)?i?.name?.[l]:i?.name||`Program ${x}`},x)),X=(e,l,o,x)=>{const i=d.programs[x];return!i||!i.schedule?[t.jsx("option",{value:"",children:"0"},"none")]:i.schedule.map((w,c)=>t.jsx("option",{value:c,style:{...s(e,!1).text},children:w.name?.[l]||`Day ${c+1}`},c))},s=(e,l)=>({container:{backgroundColor:r.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${r.get("border",e)}`},scrollView:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",height:"100%",overflowY:"scroll",backgroundColor:r.get("trainingGroup",e),borderRadius:"12px"},mainText:{textAlign:"left",fontSize:l===0?"13px":"15px",color:r.get("mainText",e),marginLeft:"10px",marginBottom:"2px"},subtext:{textAlign:"left",fontSize:l===0?"11px":"13px",color:r.get("subText",e),marginLeft:"10px",marginBottom:"12px"},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:r.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:r.get("subText",e)},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",color:r.get("mainText",e),fontFamily:"Segoe UI"},icon:{fontSize:"26px",color:r.get("icons",e)},cP:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",backgroundColor:r.get("bottomPanel",e),width:"100%",height:"90vh"},confirmContainer:{position:"fixed",top:0,left:-10,bottom:0,width:"95vw",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,padding:"20px"},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}});function N(e){d.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),d.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Le=(e,l)=>e==0?l==0?"нет тренировок":"no trainings":e==1?l==0?"1 тренировка":"1 training":e>1&&e<5?e+(l==0?" тренировки":" trainings"):e+(l==0?" тренировок":" trainings"),Z=e=>{const l=Math.floor(e/6e4),o=Math.floor(l/60)%24,x=l%60;return`${o.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`};function Ye(e,l){if(!e?.exercises)return l===0?"0 упр./ 0 подх.":"0 ex./ 0 sets";let o=0,x=0;for(const i of Object.values(e.exercises))o++,Array.isArray(i.sets)&&(x+=i.sets.length);return l===0?` / ${o} упр. / ${x} подх.`:` / ${o} ex. / ${x} sets`}export{We as default,Ye as getTrainingSummary};
