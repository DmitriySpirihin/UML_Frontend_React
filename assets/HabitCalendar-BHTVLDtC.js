import{c as ne,j as t,A as c,t as re,f as ie,l as se,C as i,s as Q,a as Z,b as _,m as ae,e as le}from"./index-CFssqZtW.js";import{R as V,r as b}from"./recharts-k8ghPecL.js";import{u as ce,a as de,b as ee,I as te}from"./Icons-Bh02lLKB.js";import{I as fe,a as ge}from"./index-DlKPMVLE.js";const xe=ne(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),pe=ne(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),E=e=>{const n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${n}-${o}-${u}`},ue=e=>(e.getDay()+6)%7,O=new Audio("Audio/Click.wav"),he=new Audio("Audio/IsDone.wav"),be=new Audio("Audio/Skip.wav");function ye(){return _.concat((c.CustomHabits||[]).filter(e=>!_.some(n=>n.id===e.id)))}const d=(e,n)=>({container:{backgroundColor:i.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"88vh",marginTop:"100px",width:"100vw",fontFamily:"Segoe UI, Roboto, Helvetica, sans-serif",overflowY:"scroll",paddingTop:"10px"},panel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"500px",height:"100%",alignItems:"center",justifyContent:"start",backgroundColor:i.get("background",e),position:"relative",overflow:"hidden"},calendarHead:{padding:"15px 20px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:"20px",width:"100%",boxSizing:"border-box",backgroundColor:i.get("background",e),zIndex:2},headerWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minWidth:"150px"},header:{fontFamily:"Segoe UI",fontSize:"20px",margin:0,fontWeight:"700",color:i.get("mainText",e),textTransform:"capitalize",whiteSpace:"nowrap"},navBtn:{padding:"8px",borderRadius:"12px",cursor:"pointer",backgroundColor:e==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",zIndex:10},tableWrapper:{width:"100%",padding:"15px 0px 15px 0px",boxSizing:"border-box"},table:{width:"90%",borderCollapse:"collapse",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"12vw",height:"13vw",maxHeight:"50px",maxWidth:"50px",borderRadius:"14px",fontSize:"16px",fontWeight:"600",fontFamily:"Segoe UI",transition:"all 0.2s ease-in-out",cursor:"pointer",margin:"auto"},infoPanelContainer:{disolay:"flex",width:"100%",borderTop:`1px solid ${e==="light"?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)"}`,padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column",backgroundColor:i.get("background",e)},infoHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},text:{fontFamily:"Segoe UI",fontSize:"17px",color:i.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"14px",color:i.get("subText",e)},icon:{width:"22px",height:"22px"}}),me=(e,n)=>{if(e<25)return n==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)";if(e>=100)return n==="light"?"rgba(50, 215, 80, 0.64)":"rgba(36, 151, 57, 0.4)";const o=45,s=110-o,f=(e-25)/75;return`hsla(${o+f*s}, 90%, 40%, 0.3)`},Se=(e,n)=>i.get("mainText",n),je={enter:e=>({y:e>0?-20:20,opacity:0}),center:{y:0,opacity:1},exit:e=>({y:e>0?20:-20,opacity:0})},ke=()=>{const[e,n]=V.useState("dark"),[o,u]=b.useState(c.prefs[0]),[s,f]=b.useState(new Date),[w,D]=b.useState(0),[l,h]=b.useState(s),[v,I]=b.useState(!1),a=new Date().getDate(),W=new Date().getMonth(),[B,T]=b.useState(0);V.useEffect(()=>{const r=re.subscribe(n),p=ie.subscribe(D);return()=>{r.unsubscribe(),p.unsubscribe()}},[]),V.useEffect(()=>{const r=se.subscribe(p=>{u(p==="ru"?0:1)});return()=>r.unsubscribe()},[]);const k=new Date(s.getFullYear(),s.getMonth(),1),Y=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),z=(k.getDay()+6)%7,N=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],P=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],y=[],C=[];for(let r=0;r<z;r++)y.push(null);for(let r=1;r<=Y;r++)y.push(r);for(let r=0;r<y.length;r+=7)C.push(y.slice(r,r+7));const M=()=>{T(-1),f(new Date(s.getFullYear(),s.getMonth()-1)),j(O)},H=()=>{T(1),f(new Date(s.getFullYear(),s.getMonth()+1)),j(O)},m=[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]],F=r=>{j(O),Q&&Q(r),Z&&Z(0)};return t.jsxs("div",{style:d(e).container,children:[t.jsxs("div",{style:d(e).calendarHead,children:[t.jsx("div",{whileTap:{scale:.9},onClick:M,style:d(e).navBtn,children:t.jsx(fe,{size:22,color:i.get("mainText",e)})}),t.jsx("div",{style:d(e).headerWrapper,children:t.jsxs("h1",{variants:je,custom:B,initial:"enter",animate:"center",exit:"exit",transition:{duration:.25},style:d(e).header,children:[m[o][s.getMonth()]," ",s.getFullYear()]},s.toISOString())}),t.jsx("div",{whileTap:{scale:.9},onClick:H,style:d(e).navBtn,children:t.jsx(ge,{size:22,color:i.get("mainText",e)})})]}),t.jsx("div",{style:d(e).tableWrapper,children:t.jsxs("table",{style:d(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:N[o].map((r,p)=>t.jsx("th",{style:{paddingBottom:"15px"},children:t.jsx("p",{style:{textAlign:"center",fontSize:w===0?"13px":"14px",fontWeight:"600",color:p===5||p===6?"#ff5e5e":i.get("subText",e),margin:0,opacity:.8},children:r})},r))})}),t.jsx("tbody",{children:C.map((r,p)=>t.jsx("tr",{children:r.map((g,x)=>{const S=s.getMonth(),$=s.getFullYear(),U=g===l.getDate()&&S===l.getMonth()&&$===l.getFullYear(),X=E(new Date($,S,g));let K="",A=0;if(Object.keys(c.habitsByDate).includes(X)){const G=Array.from(Object.values(c.habitsByDate[X])),q=G.length;A=q>0?Math.round(G.filter(oe=>oe>0).length/q*100):0,K=A+"%"}let J="transparent",L=i.get("mainText",e);return U?(J=i.get("currentDateBorder",e),L="#ffffff"):g>0&&A>0&&(J=me(A,e),L=Se(A,e)),t.jsx("td",{style:{padding:"4px"},children:g?t.jsxs("div",{style:{...d(e).cell,backgroundColor:J,color:L,border:a===g&&W===S?`2px solid ${i.get("currentDateBorder",e)}`:"transparent",boxShadow:U?`0 4px 12px ${i.get("shadow",e)}`:"none"},onClick:()=>{h(new Date($,S,g)),I(c.hasKey(E(new Date($,S,g)))),j(O)},children:[g,g>0&&K&&!U&&t.jsx("div",{style:{fontSize:"9px",marginTop:"2px",opacity:.9,fontWeight:"bold"},children:K})]}):t.jsx("div",{style:{...d(e).cell,pointerEvents:"none"}})},x)})},p))})]})}),t.jsx("div",{style:d(e).infoPanelContainer,children:v?t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:d(e).infoHeader,children:t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:i.get("mainText",e),margin:0},children:[l.getDate()," ",m[o][l.getMonth()],", ",P[o][ue(l)]]})}),t.jsx("div",{style:d(e).scrollView,children:t.jsx(we,{theme:e,langIndex:o,date:l,fSize:w,onHabitClick:F})})]}):t.jsxs("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:.6,flexDirection:"column"},children:[t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:i.get("mainText",e),margin:"0 0 10px 0"},children:[l.getDate()," ",m[o][l.getMonth()]]}),t.jsx("p",{style:{color:i.get("subText",e),margin:0,fontSize:"14px"},children:o===0?"Нет привычек на этот день":"No habits for this day"})]})}),t.jsx("div",{style:{marginBottom:"150px"}})]})},we=({theme:e,langIndex:n,date:o,fSize:u,onHabitClick:s})=>{const f=E(o);return c.hasKey(f)?Object.entries(c.habitsByDate[f]).map(([D,l])=>{const h=Number(D),v=ye().find(I=>I.id===h);return v?t.jsx(ve,{id:h,habitData:v,theme:e,date:o,statusInit:l<2?l:1,langIndex:n,fSize:u,onHabitClick:s},`${f}-${D}`):null}):null},ve=({id:e,habitData:n,theme:o,date:u,statusInit:s,langIndex:f,fSize:w,onHabitClick:D})=>{const l=n.name[f];let h="";n.category?Array.isArray(n.category)?h=n.category[f]:h=n.category:h=f===0?"Общее":"General";const v=()=>n.isCustom&&n.iconName?te.getIcon(n.iconName,{size:24,style:{color:"inherit"}}):te.getHabitIcon(n.name?n.name[0]:"default",{size:24,style:{color:"inherit"}}),I=c.choosenHabitsTypes[c.choosenHabits.indexOf(e)],[a,W]=b.useState(s),[B,T]=b.useState(!I),k=70,R=-70,Y=ce(0),z=de(Y,[-1,1],[R,k]);b.useEffect(()=>{W(s)},[s,u]);const N=(r,p)=>{const g=p.offset.x;if(Math.abs(g)>k){if(!B)return;let x=a;if(g>0?a===0?x=1:a===-1&&(x=0):a===0?x=-1:a===1&&(x=0),x!==a){const S=E(u);c.changeStatus(S,e,x),W(x),le(),x===1?c.prefs[2]==0&&j(he):x===-1&&c.prefs[2]==0&&j(be),j(null)}T(!1),ee(z,0,{type:"tween",duration:.2})}},P=()=>{ee(z,0,{type:"tween",duration:.2}),T(!0)};let y=o==="light"?i.get("background",o):"rgba(255,255,255,0.05)",C=o==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",M=i.get("mainText",o),H=i.get("subText",o),m="rgba(255,255,255,0.1)",F=i.get("habitIcon",o);return a===1?(y="rgba(20, 60, 30, 0.85)",C="rgba(46, 151, 65, 0.0)",M="#ffffff",H="rgba(255,255,255,0.7)",m="#4ade80",F="#ffffff"):a===-1&&(y="rgba(60, 20, 20, 0.85)",C="rgba(151, 57, 57, 0.0)",M="#ffffff",H="rgba(255,255,255,0.7)",m="#f87171",F="#ffffff"),t.jsx("div",{style:{width:"100%",marginBottom:"12px",overflow:"hidden",borderRadius:"18px"},children:t.jsxs(ae.div,{id:`cal-${e}`,style:{backgroundColor:y,border:`1px solid ${C}`,display:"flex",flexDirection:"row",width:"100%",padding:"16px 20px",alignItems:"center",borderRadius:"18px",boxSizing:"border-box",x:z,cursor:"pointer",position:"relative"},drag:B?"x":!1,dragConstraints:{left:R,right:a===1?0:k},dragElastic:.1,onDrag:N,onDragEnd:P,children:[t.jsx("div",{style:{fontSize:"24px",marginRight:"15px",width:"30px",textAlign:"center",color:F,display:"flex",alignItems:"center",justifyContent:"center"},children:v()}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{fontFamily:"Segoe UI",color:H,fontSize:"11px",marginBottom:"4px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.8px",pointerEvents:"none"},children:h}),t.jsx("p",{style:{fontFamily:"Segoe UI",color:M,margin:0,fontWeight:"600",fontSize:w===0?"16px":"18px",pointerEvents:"none"},children:l})]}),t.jsxs("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:a!==0?m:"transparent",border:a===0?`2px solid ${i.get("subText",o)}`:"none",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"10px"},children:[a===1&&t.jsx(xe,{style:{color:"#fff",fontSize:"18px"}}),a===-1&&t.jsx(pe,{style:{color:"#fff",fontSize:"18px"}})]})]})})};function j(e){c.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),c.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{ke as default};
