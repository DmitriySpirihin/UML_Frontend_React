import{bj as X,A as V,t as re,l as oe,f as le,ab as d,a as O,j as e,C as de,m as x,bk as pe,bl as ce,d as xe}from"./index-DgjiXy-O.js";import{r as i}from"./recharts-k8ghPecL.js";import{m as ge,u as he,n as ue,o as fe}from"./TrainingLogHelper-ByGsZD7X.js";import{b as me,c as be,d as ye,e as je,f as Se,g as ve,h as we}from"./index-DoKQF0yM.js";import{S as w}from"./ScrollPicker-ux3eLOkz.js";import{S as C}from"./Slider-D8iJbG_K.js";const Ce=new X("RUNNING"),ke=new X({mode:"new",dayKey:"",dInd:null}),k=(n,I)=>({height:28,padding:"0 0",marginTop:0,"& .MuiSlider-rail":{height:8,borderRadius:4,backgroundColor:I==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.08)",top:"50%",transform:"translateY(-50%)",opacity:1},"& .MuiSlider-track":{height:8,borderRadius:4,background:`linear-gradient(90deg, ${n}88, ${n})`,top:"50%",transform:"translateY(-50%)"},"& .MuiSlider-thumb":{height:28,width:28,backgroundColor:"#fff",border:`3px solid ${n}`,boxShadow:"0 4px 12px rgba(0,0,0,0.25)","&:hover, &.Mui-focusVisible, &.Mui-active":{boxShadow:`0 0 0 8px ${n}30, 0 4px 15px rgba(0,0,0,0.3)`},"&:before":{display:"none"},top:"50%",transform:"translateY(-50%)"},"& .MuiSlider-mark":{height:10,width:3,backgroundColor:"rgba(255,255,255,0.7)",borderRadius:1,top:"50%",transform:"translateY(-50%)"},"& .MuiSlider-markLabel":{display:"none"},"& .MuiSlider-thumb.Mui-focusVisible":{boxShadow:`0 0 0 8px ${n}30, 0 4px 15px rgba(0,0,0,0.3)`},"& .MuiSlider-thumb.Mui-active":{boxShadow:`0 0 0 8px ${n}30, 0 4px 15px rgba(0,0,0,0.3)`},"& .MuiSlider-thumb:focus":{outline:"none"},width:"100%"}),Ne=()=>{const[n,I]=i.useState("dark"),[a,q]=i.useState(V.prefs[0]),[Ie,J]=i.useState(V.prefs[4]),[p,b]=i.useState("RUNNING"),[R,z]=i.useState(new Date),[y,F]=i.useState(5),[j,T]=i.useState(0),[S,D]=i.useState(0),[v,M]=i.useState(30),[g,N]=i.useState(0),[h,W]=i.useState(140),[u,B]=i.useState(170),[f,A]=i.useState(7),[E,L]=i.useState(""),[l,H]=i.useState("new"),[c,_]=i.useState(null),[Q,Y]=i.useState(!1),P=i.useRef(!0);i.useEffect(()=>{const s=[re.subscribe(I),oe.subscribe(t=>q(t==="ru"?0:1)),le.subscribe(J),ke.subscribe(t=>{t.mode==="edit"&&t.dayKey&&t.dInd!==null&&t.dInd!==void 0?(H("edit"),ae(t.dayKey,t.dInd)):t.mode==="new"&&t.dayKey?(H("new"),z($(t.dayKey)),G()):(H("new"),m())}),Ce.subscribe(t=>{P.current&&(b(t),P.current=!1),b(t)})];return()=>s.forEach(t=>t.unsubscribe())},[]);const $=s=>{const[t,r,U]=s.split("-").map(Number);return new Date(t,r-1,U+1)},K=i.useMemo(()=>({RUNNING:{label:a===0?"Бег":"Running",color:"#917237",gradient:"linear-gradient(120deg, #8b5325, #a52c00)"},CYCLING:{label:a===0?"Велосипед":"Cycling",color:"#468932",gradient:"linear-gradient(120deg, #368a36, #00842a)"},SWIMMING:{label:a===0?"Плавание":"Swimming",color:"#407a97",gradient:"linear-gradient(120deg, #2f3d7d, #201c70)"},GYM:{label:a===0?"Силовая":"Strength",color:"#9D4EDD",gradient:"linear-gradient(120deg, #9d4edd, #7209b7)"}}),[a]),o=K[p]||K.RUNNING,Z=i.useMemo(()=>Array.from({length:51},(s,t)=>t),[]),ee=i.useMemo(()=>Array.from({length:10},(s,t)=>t*100),[]),te=i.useMemo(()=>Array.from({length:6},(s,t)=>t),[]),se=i.useMemo(()=>Array.from({length:60},(s,t)=>t),[]),ae=i.useCallback(async(s,t)=>{try{Y(!0);const r=await ge(s,t);r&&(_(`${s}_${t}`),z($(s)),b(r.type||"RUNNING"),F(Math.floor(r.distance)),T(Math.round(r.distance%1*1e3)),D(Math.floor(r.duration/60)),M(r.duration%60),N(r.elevationGain||0),W(r.avgHeartRate||140),B(r.avgCadence||170),A(r.rpe||7),L(r.notes||""))}catch(r){console.error("Load error:",r),d(a===0?"Ошибка загрузки":"Load error",2e3,!1)}finally{Y(!1)}},[a]),G=i.useCallback(()=>{F(5),T(0),D(0),M(30),N(0),W(140),B(170),A(7),L("")},[]),m=i.useCallback(()=>{G(),b("RUNNING"),z($(new Date().toISOString().split("T")[0])),_(null)},[G]),ie=i.useCallback(()=>{const s=y+j/1e3,t=S*60+v;if(t<=0||s<=0){d(a===0?"Дистанция и длительность > 0":"Distance & duration > 0",2e3,!1);return}const r={type:p,distance:s,duration:t,elevationGain:g,avgCadence:u,avgHeartRate:h,rpe:f,notes:E,startTime:16*36e5};try{l==="edit"&&c?(he(c,r),d(a===0?"✅ Обновлено!":"✅ Updated!",1500,!0)):(ue(R,p,s,t,r.startTime,r),d(a===0?"✅ Добавлено!":"✅ Added!",1500,!0)),setTimeout(()=>{m(),O("TrainingMain")},400)}catch(U){console.error("Save error:",U),d(a===0?"❌ Ошибка сохранения":"❌ Save error",2e3,!1)}},[y,j,S,v,g,h,u,f,E,p,R,l,c,a,m]),ne=i.useCallback(()=>{if(!(l!=="edit"||!c)&&window.confirm(a===0?"Вы уверены, что хотите удалить эту тренировку?":"Are you sure you want to delete this session?"))try{fe(c),d(a===0?"✅ Удалено!":"✅ Deleted!",1500,!0),setTimeout(()=>{m(),O("TrainingMain")},400)}catch(s){console.error("Delete error:",s),d(a===0?"❌ Ошибка удаления":"❌ Delete error",2e3,!1)}},[l,c,a,m]);return e.jsxs("div",{style:{backgroundColor:de.get("background",n),display:"flex",flexDirection:"column",alignItems:"center",height:"90vh",marginTop:"100px",width:"100vw",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",overflowY:"scroll",paddingTop:"10px",overflowX:"hidden"},children:[e.jsx(x.header,{style:{background:o.gradient,width:"100vw",height:"15vh",marginTop:"10px",boxShadow:"0 10px 30px rgba(0,0,0,0.25)",borderBottomLeftRadius:"32px",borderBottomRightRadius:"32px"},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",gap:"16px"},children:[e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"15px",color:"rgba(255,255,255,0.85)",fontWeight:"500",margin:"19px"},children:R.toLocaleDateString(a===0?"ru-RU":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("h1",{style:{fontSize:"18px",fontWeight:"800",color:"#fff",margin:15,textShadow:"0 2px 6px rgba(0,0,0,0.3)"},children:l==="edit"?a===0?"Редактировать тренировку: "+o.label:"Edit Session: "+o.label:a===0?"Новая тренировка: "+o.label:"New Session: "+o.label})]}),l==="edit"&&e.jsx(x.button,{whileTap:{scale:.9},onClick:ne,style:{width:"52px",height:"52px",borderRadius:"18px",background:"rgba(255,255,255,0.15)",border:"none",cursor:"pointer",backdropFilter:"blur(8px)"},children:e.jsx(pe,{size:26,color:"#ff5252"})})]})}),e.jsx("div",{style:{minWidth:"85vw",maxWidth:"600px",margin:"24px auto 0",padding:"0 24px",display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs(x.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"800",marginBottom:"24px",color:n==="dark"?"#e6e6ff":"#1a1a2e",textAlign:"center"},children:a===0?"Параметры тренировки":"Session Metrics"}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(me,{size:18,color:o.color}),a===0?"Дистанция":"Distance"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:o.color},children:[y," km ",j," m"]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(w,{items:Z.map(s=>s.toString()),value:y.toString(),onChange:s=>F(parseInt(s)),theme:n,width:"100%",itemHeight:44})}),e.jsx("div",{style:{flex:1},children:e.jsx(w,{items:ee.map(s=>s.toString()),value:j.toString(),onChange:s=>T(parseInt(s)),theme:n,width:"100%",itemHeight:44})})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(be,{size:18,color:o.color}),a===0?"Длительность":"Duration"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:o.color},children:[S,"h ",v.toString().padStart(2,"0"),"m"]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(w,{items:te.map(s=>s.toString()),value:S.toString(),onChange:s=>D(parseInt(s)),theme:n,width:"100%",itemHeight:44})}),e.jsx("div",{style:{flex:1},children:e.jsx(w,{items:se.map(s=>s.toString()),value:v.toString(),onChange:s=>M(parseInt(s)),theme:n,width:"100%",itemHeight:44})})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ye,{size:18,color:"#FF9E6D"}),a===0?"Набор высоты":"Elevation"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:"#FF9E6D"},children:[g," m"]})]}),e.jsxs("div",{style:{width:"100%",marginTop:"12px"},children:[e.jsx(C,{value:g,onChange:(s,t)=>N(t),min:0,max:500,step:5,marks:[{value:0},{value:250},{value:500}],sx:k("#FF9E6D",n),valueLabelDisplay:"off"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"14px",color:n==="dark"?"rgba(255,255,255,0.85)":"rgba(0,0,0,0.7)",userSelect:"none"},children:[e.jsx("span",{children:"0"}),e.jsxs("span",{style:{fontWeight:"700",color:"#fff",background:"#FF9E6D20",padding:"2px 8px",borderRadius:"12px"},children:[g," m"]}),e.jsx("span",{children:"500"})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(je,{size:18,color:"#FF6B9D"}),a===0?"Пульс":"Heart Rate"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:"#FF6B9D"},children:[h," bpm"]})]}),e.jsxs("div",{style:{width:"100%",marginTop:"12px"},children:[e.jsx(C,{value:h,onChange:(s,t)=>W(t),min:60,max:180,step:1,marks:[{value:60},{value:120},{value:180}],sx:k("#FF6B9D",n),valueLabelDisplay:"off"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"14px",color:n==="dark"?"rgba(255,255,255,0.85)":"rgba(0,0,0,0.7)",userSelect:"none"},children:[e.jsx("span",{children:"60"}),e.jsxs("span",{style:{fontWeight:"700",color:"#fff",background:"#FF6B9D20",padding:"2px 8px",borderRadius:"12px"},children:[h," bpm"]}),e.jsx("span",{children:"180"})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Se,{size:18,color:"#4CC9F0"}),a===0?"Каденс":"Cadence",e.jsx("span",{style:{fontSize:"12px",fontWeight:"500",color:"#888",background:n==="dark"?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",padding:"1px 6px",borderRadius:"10px",marginLeft:"6px"},children:p==="RUNNING"?"spm":p==="CYCLING"?"rpm":"spm"})]}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"700",color:"#4CC9F0"},children:u})]}),e.jsxs("div",{style:{width:"100%",marginTop:"12px"},children:[e.jsx(C,{value:u,onChange:(s,t)=>B(t),min:50,max:200,step:1,marks:[{value:50},{value:125},{value:200}],sx:k("#4CC9F0",n),valueLabelDisplay:"off"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"14px",color:n==="dark"?"rgba(255,255,255,0.85)":"rgba(0,0,0,0.7)",userSelect:"none"},children:[e.jsx("span",{children:"50"}),e.jsx("span",{style:{fontWeight:"700",color:"#fff",background:"#4CC9F020",padding:"2px 8px",borderRadius:"12px"},children:u}),e.jsx("span",{children:"200"})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ve,{size:18,color:"#FFA500"}),a===0?"Воспр. (RPE)":"Effort (RPE)"]}),e.jsxs("span",{style:{fontSize:"20px",fontWeight:"800",color:"#FFA500",background:"rgba(255, 165, 0, 0.15)",padding:"3px 12px",borderRadius:"16px"},children:[f,"/10"]})]}),e.jsxs("div",{style:{width:"100%",marginTop:"12px"},children:[e.jsx(C,{value:f,onChange:(s,t)=>A(t),min:1,max:10,step:1,marks:[{value:1},{value:5},{value:10}],sx:k("#FFA500",n),valueLabelDisplay:"off"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"14px",color:n==="dark"?"rgba(255,255,255,0.85)":"rgba(0,0,0,0.7)",userSelect:"none"},children:[e.jsx("span",{children:"1"}),e.jsxs("span",{style:{fontWeight:"700",color:"#fff",background:"#FFA50020",padding:"2px 8px",borderRadius:"12px"},children:[f,"/10"]}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"13px",color:n==="dark"?"#aaa":"#666"},children:[e.jsx("span",{children:a===0?"Легко":"Easy"}),e.jsx("span",{children:a===0?"Тяжело":"Hard"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx(we,{size:18,color:"#A0A0A0"}),a===0?"Заметки":"Notes"]}),e.jsx("textarea",{value:E,onChange:s=>L(s.target.value),placeholder:a===0?"Как прошла тренировка? Погода, ощущения...":"How was your session? Weather, feelings...",style:{width:"90%",minHeight:"90px",padding:"16px",borderRadius:"20px",border:`2px solid ${n==="dark"?"rgba(100,100,150,0.4)":"rgba(0,0,0,0.08)"}`,background:n==="dark"?"rgba(40,40,70,0.7)":"rgba(255,255,255,0.9)",color:n==="dark"?"#e6e6ff":"#1a1a2e",fontSize:"16px",fontFamily:"inherit",resize:"vertical",transition:"all 0.25s ease"}})]})]})}),e.jsx(x.footer,{style:{bottom:0,width:"100%",padding:"16px 24px 32px",display:"flex",justifyContent:"center",background:"transparent",zIndex:90},initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.4,delay:.2},children:e.jsxs(x.button,{whileTap:{scale:.97},whileHover:{scale:1.02},onClick:ie,style:{background:o.gradient,color:"#fff",border:"none",borderRadius:"28px",width:"90%",maxWidth:"560px",height:"68px",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",fontSize:"18px",fontWeight:"700",cursor:"pointer",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ce,{size:22,style:{transform:"rotate(180deg)"}})}),l==="edit"?a===0?"Сохранить изменения":"Save Changes":a===0?"Добавить тренировку":"Add Session"]})}),e.jsx("div",{style:{marginBottom:"150px"}}),e.jsx(xe,{children:Q&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:n==="dark"?"rgba(15,15,27,0.95)":"rgba(248,249,255,0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(10px)"},children:e.jsx("div",{style:{width:"50px",height:"50px",border:"3px solid rgba(255,255,255,0.2)",borderTopColor:o.color,borderRadius:"50%",animation:"spin 0.9s linear infinite"}})})})]})};export{Ce as cardioType$,Ne as default,ke as trainInfo$};
