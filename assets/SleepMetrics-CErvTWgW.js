import{j as s,C as o,A as y,t as T,l as w,f as $}from"./index-BChLsca3.js";import{h as k,B as C,q as z,X as I,Y as L,T as B,s as R,u as A,r as c}from"./recharts-DVuIdjrD.js";const M=t=>{if(!t||t<=0)return"0:00";const r=Math.floor(t/6e4),n=Math.floor(r/60),a=r%60;return`${n}:${a.toString().padStart(2,"0")}`},F=t=>t/(1e3*60*60),O=({data:t=[],theme:r="dark",textColor:n="#94a3b8",linesColor:a="#334155",backgroundColor:d="#0f172a",height:x=220})=>{if(!Array.isArray(t)||t.length===0)return s.jsx("div",{style:{height:`${x}px`,display:"flex",alignItems:"center",justifyContent:"center",color:n,backgroundColor:d,fontFamily:"Segoe UI, system-ui, sans-serif",fontSize:"14px",borderRadius:"12px"},children:"No data"});const l={1:o.get("difficulty3",r),2:o.get("difficulty2",r),3:o.get("difficulty1",r),4:o.get("difficulty0",r),5:o.get("difficulty5",r)},g=t.map(e=>({date:e.date,ms:e.ms||0,mood:Math.max(1,Math.min(5,Math.round(e.mood||3))),hours:F(e.ms||0)})),h=Math.max(...g.map(e=>e.hours),1),p=e=>l[e]||l[3],b=({active:e,payload:i,label:m})=>{if(e&&i&&i.length){const u=i[0].payload,j=u?.ms||0,f=u?.mood||0,S=f?"★".repeat(f)+"☆".repeat(5-f):"—";return s.jsxs("div",{style:{backgroundColor:o.get("panel",r)||"#1e293b",padding:"10px",borderRadius:"8px",border:`1px solid ${a}`,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",fontFamily:"Segoe UI",fontSize:"13px",color:o.get("mainText",r)||"#f1f5f9"},children:[s.jsx("div",{style:{fontWeight:"600",marginBottom:"4px"},children:m}),s.jsxs("div",{children:["Sleep: ",M(j)]}),s.jsxs("div",{style:{marginTop:"4px",color:p(f)},children:["Mood: ",S]})]})}return null};return s.jsx("div",{style:{width:"100%",height:`${x}px`,backgroundColor:d,borderRadius:"12px",padding:"8px 4px",fontFamily:"Segoe UI, system-ui, sans-serif"},children:s.jsx(k,{width:"100%",height:"100%",children:s.jsxs(C,{data:g,margin:{top:15,right:10,left:-10,bottom:5},children:[s.jsx(z,{stroke:a,strokeOpacity:.2,vertical:!1}),s.jsx(I,{dataKey:"date",tick:{fill:n,fontSize:11},axisLine:!1,tickLine:!1,minTickGap:20}),s.jsx(L,{domain:[0,Math.ceil(h)],tick:{fill:n,fontSize:10},axisLine:!1,tickLine:!1,width:30,tickFormatter:e=>`${Math.round(e)}h`}),s.jsx(B,{content:s.jsx(b,{}),cursor:{fill:"rgba(100,100,100,0.1)"}}),s.jsx(R,{dataKey:"hours",radius:[4,4,0,0],barSize:28,fill:"#6366f1",shape:e=>{const{x:i,y:m,width:u,height:j,index:f}=e,S=g[f]?.mood||3,D=p(S);return s.jsx("rect",{x:i,y:m,width:u,height:j,fill:D,rx:4,ry:4})},children:s.jsx(A,{dataKey:"ms",position:"top",fontSize:11,fill:n,formatter:e=>M(e)})})]})})})},v=[["месяц","month"],["пол года","half year"],["год","year"]],U=[28,180,360],W=t=>Math.floor(t/6e4),Y=t=>{const r=W(t),n=Math.floor(r/60),a=r%60;return n>0?`${n}h ${a}m`:`${a}m`},E=(t,r)=>new Date(t).toLocaleDateString(r===0?"ru-RU":"en-US",{day:"2-digit",month:"short"}),H=({theme:t,langIndex:r,fSize:n,periodIndex:a,setPeriodIndex:d})=>s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0"},children:v.map((x,l)=>s.jsxs("span",{onClick:()=>d(l),style:{padding:"6px 10px",cursor:"pointer",fontSize:n===0?"11px":"13px",fontWeight:a===l?"600":"400",color:a===l?o.get("mainText",t):o.get("subText",t),opacity:a===l?1:.8,transition:"all 0.2s ease"},children:[x[r],l<v.length-1&&s.jsx("span",{style:{margin:"0 8px",color:o.get("border",t),fontSize:n===0?"12px":"14px"},children:"|"})]},l))}),N=()=>{const[t,r]=c.useState("dark"),[n,a]=c.useState(y.prefs[0]),[d,x]=c.useState(y.prefs[4]),[l,g]=c.useState(0);c.useEffect(()=>{const e=T.subscribe(r),i=w.subscribe(u=>a(u==="ru"?0:1)),m=$.subscribe(x);return()=>{e.unsubscribe(),i.unsubscribe(),m.unsubscribe()}},[]);const h=c.useMemo(()=>y.sleepingLog?Object.entries(y.sleepingLog).map(([e,i])=>({date:e,durationMs:i.duration||0,mood:i.mood||0,note:i.note||""})).sort((e,i)=>new Date(e.date)-new Date(i.date)):[],[]),p=c.useMemo(()=>{if(h.length===0)return[];const e=new Date;return e.setDate(e.getDate()-U[l]),h.filter(i=>new Date(i.date)>=e)},[h,l]),b=c.useMemo(()=>p.map(e=>({date:e.date.split("-").slice(1).reverse().join("."),ms:e.durationMs,mood:e.mood||3})),[p]);return s.jsxs("div",{style:K(t).container,children:[s.jsx("div",{style:{fontSize:d===0?"14px":"16px",fontWeight:"bold",fontFamily:"Segoe UI",color:o.get("mainText",t),marginBottom:"8px"},children:n===0?"Продолжительность сна":"Sleep Duration"}),s.jsx("div",{style:{width:"100%",height:"220px",marginBottom:"16px"},children:s.jsx(O,{data:b,theme:t,textColor:o.get("subText",t),linesColor:o.get("border",t),backgroundColor:o.get("background",t)})}),s.jsx("div",{style:{display:"flex",justifyContent:"center",width:"100%",marginBottom:"12px"},children:s.jsx(H,{theme:t,langIndex:n,fSize:d,periodIndex:l,setPeriodIndex:g})}),s.jsx("div",{style:{width:"90%",height:"48%",overflowY:"auto",padding:"8px",backgroundColor:o.get("panel",t),borderRadius:"12px",border:`1px solid ${o.get("border",t)}`,scrollbarWidth:"thin",scrollbarColor:`${o.get("icons",t)} ${o.get("background",t)}`},children:p.length===0?s.jsx("div",{style:{color:o.get("subText",t),fontSize:d===0?"13px":"15px",textAlign:"center"},children:n===0?"Нет данных за выбранный период":"No data for selected period"}):p.slice().reverse().map((e,i)=>s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 12px",borderBottom:`1px solid ${o.get("border",t)}`},children:[s.jsx("span",{style:{color:o.get("mainText",t),fontSize:d===0?"13px":"15px"},children:E(e.date,n)}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{style:{color:o.get("icons",t),fontSize:d===0?"13px":"15px",fontWeight:"500"},children:Y(e.durationMs)}),e.mood>0&&s.jsxs("span",{style:{color:o.get("subText",t),fontSize:d===0?"12px":"14px"},children:["★".repeat(e.mood),"☆".repeat(5-e.mood)]})]})]},`${e.date}-${i}`))})]})},K=t=>({container:{backgroundColor:o.get("background",t),display:"flex",position:"absolute",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",top:"14vh",width:"100vw",fontFamily:"Segoe UI"}});export{N as default};
