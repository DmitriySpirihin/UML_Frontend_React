import{A as y,t as V,f as Y,X as _,l as Z,cg as H,j as t,a as ee,m as u,bV as te,H as ne,C as o,ch as oe,ci as ae,cj as re,ck as le,cl as ce,cm as de,cn as pe,M as xe,co as ge,a$ as ue,h as fe,i as ye,bw as U,cp as be}from"./index-25B83RUT.js";import{r as p}from"./recharts-Bg6K2Pzo.js";import{M as he}from"./MyInput-BWgoWLxb.js";import{S as me}from"./Slider-Btb07Gtn.js";const Se=(e,n,i,r,s)=>{const d={bedtime:i,duration:n,mood:r,note:s??""};y.sleepingLog={...y.sleepingLog,[e]:d}},je=new Audio("Audio/Click.wav"),ve=[ae,re,le,ce,de],we=3,Ce=14,Te=10,Me=we*60*60*1e3,ke=Ce*60*60*1e3,De=Te*60*1e3,X=e=>{const n=Math.floor(e/6e4),i=Math.floor(n/60),r=n%60;return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},Be=(e,n)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][n];function K(e){y.prefs[2]===0&&e&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),y.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Ie(e){const n=new Date(e),i=new Date;return n.setHours(0,0,0,0),i.setHours(0,0,0,0),n<=i}const ze=({dateString:e})=>{const[n,i]=p.useState(V.value),[r,s]=p.useState(Y.value),[d,x]=p.useState(y.prefs[0]),[b,D]=p.useState(_.value),[B,I]=p.useState(4),[g,T]=p.useState(480*60*1e3),[w,G]=p.useState(1380*60*1e3),[M,z]=p.useState("");p.useEffect(()=>{const j=V.subscribe(i),S=Y.subscribe(s),v=Z.subscribe(h=>x(h==="ru"?0:1)),f=_.subscribe(D);return()=>{j.unsubscribe(),S.unsubscribe(),v.unsubscribe(),f.unsubscribe()}},[]),p.useEffect(()=>{b==="SleepNew"&&!Ie(e)&&H("")},[b,e]);const F=async()=>{K(je),Se(e,g,w,B,M),await ue(),H("")},R=b==="SleepNew";return t.jsx(ee,{children:R&&t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:l(n).backdrop,children:t.jsxs(u.div,{initial:{y:"100%",opacity:0,scale:.95},animate:{y:"0%",opacity:1,scale:1},exit:{y:"100%",opacity:0,scale:.95},transition:{type:"spring",damping:25,stiffness:300},style:l(n).panel,children:[t.jsxs("div",{style:l(n).header,children:[t.jsxs("div",{style:l(n).iconContainer,children:[t.jsx(te,{size:24,color:"#fff"}),t.jsx("div",{style:l(n).iconGlow})]}),t.jsxs("div",{style:l(n).headerTextContainer,children:[t.jsx("h2",{style:l(n,r).title,children:d===0?"Сон":"Sleep Log"}),t.jsx("span",{style:l(n).dateBadge,children:e})]})]}),t.jsxs("div",{style:l(n).body,children:[t.jsxs("div",{style:{...l(n).sectionCard,height:"300px"},children:[t.jsxs("div",{style:l(n).labelRow,children:[t.jsx(ne,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Время отбоя":"Bedtime"})]}),t.jsx("div",{style:l(n).heroValue,children:X(w)}),t.jsx("div",{style:{padding:"0 10px"},children:t.jsx(q,{value:w,onChange:G,min:0,max:1440*60*1e3-1,theme:n,accentColor:o.get("difficulty5",n)})}),t.jsxs("div",{style:l(n).labelRow,children:[t.jsx(oe,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Длительность":"Duration"})]}),t.jsx("div",{style:l(n).heroValue,children:X(g)}),t.jsx("div",{style:{padding:"0 10px"},children:t.jsx(q,{value:g,onChange:T,min:Me,max:ke,theme:n,accentColor:o.get("accent",n)})})]}),t.jsxs("div",{style:l(n).sectionCard,children:[t.jsx("div",{style:l(n).labelRow,children:t.jsx("span",{children:d===0?"Самочувствие":"How do you feel?"})}),t.jsx("div",{style:l(n).moodContainer,children:ve.map((j,S)=>{const v=S+1,f=B===v,h=Be(n,S);return t.jsx(u.div,{whileTap:{scale:.8},animate:{scale:f?1.2:1,opacity:f?1:.4},onClick:()=>{K(null),I(v)},style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:t.jsx(j,{size:42,color:f?h:o.get("subText",n),style:{filter:f?`drop-shadow(0 0 8px ${h})`:"none"}})},S)})})]}),t.jsxs("div",{style:l(n).sectionCard,children:[t.jsxs("div",{style:l(n).labelRow,children:[t.jsx(pe,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Заметка":"Note"})]}),t.jsx(he,{maxL:500,h:"60px",w:"100%",placeHolder:d===0?"Сны, мысли...":"Dreams, thoughts...",theme:n,value:M,onChange:z})]}),t.jsx("div",{style:{marginBottom:"180px"}})," "]}),t.jsxs("div",{style:l(n).footer,children:[t.jsx(u.button,{whileTap:{scale:.95},onClick:()=>H(""),style:l(n).cancelButton,children:t.jsx(xe,{size:24,color:o.get("subText",n)})}),t.jsxs(u.button,{whileTap:{scale:.95},onClick:F,style:l(n).saveButton,children:[t.jsx(ge,{size:24,color:"#fff"}),t.jsx("span",{style:{marginLeft:8},children:d===0?"Сохранить":"Save Sleep"})]})]})]})})})},q=({value:e,onChange:n,min:i,max:r,theme:s,accentColor:d})=>t.jsx(me,{value:e,onChange:(x,b)=>n(b),min:i,max:r,step:De,sx:{color:d,height:6,"& .MuiSlider-thumb":{width:24,height:24,backgroundColor:o.get("simplePanel",s),border:`2px solid ${d}`,"&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:`0 0 0 8px ${d}30`}},"& .MuiSlider-track":{border:"none"},"& .MuiSlider-rail":{opacity:.2,backgroundColor:o.get("subText",s)}}}),l=(e,n)=>{const i=e==="dark";return{backdrop:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(6px)",zIndex:2900,display:"flex",alignItems:"flex-end",justifyContent:"center"},panel:{width:"100%",maxWidth:"500px",height:"95vh",backgroundColor:i?"rgba(16, 16, 17, 0.91)":"#ffffff",borderTopLeftRadius:"32px",borderTopRightRadius:"32px",display:"flex",flexDirection:"column",boxShadow:"0 -10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{padding:"24px",display:"flex",alignItems:"center",gap:"16px",borderBottom:`1px solid ${o.get("border",e)}50`},iconContainer:{width:"48px",height:"48px",borderRadius:"16px",backgroundColor:"#3F51B5",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxShadow:"0 4px 12px rgba(63, 81, 181, 0.4)"},iconGlow:{position:"absolute",inset:0,borderRadius:"16px",background:"inherit",filter:"blur(10px)",opacity:.5,zIndex:-1},headerTextContainer:{display:"flex",flexDirection:"column"},title:{margin:0,fontSize:n===0?"22px":"24px",fontWeight:"800",color:o.get("mainText",e),fontFamily:"Segoe UI, sans-serif"},dateBadge:{fontSize:"12px",color:o.get("subText",e),marginTop:"2px",fontWeight:"500"},body:{flex:1,overflowY:"auto",padding:"24px",display:"flex",flexDirection:"column",gap:"20px"},sectionCard:{backgroundColor:o.get("simplePanel",e),height:"96px",borderRadius:"20px",padding:"16px",border:`1px solid ${o.get("border",e)}50`},labelRow:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"600",color:o.get("subText",e),textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"10px"},heroValue:{fontSize:"32px",fontWeight:"800",color:o.get("mainText",e),textAlign:"center",marginBottom:"4px",fontVariantNumeric:"tabular-nums"},moodContainer:{display:"flex",justifyContent:"space-between",padding:"10px 0"},footer:{padding:"20px 24px 30px 24px",borderTop:`1px solid ${o.get("border",e)}50`,display:"flex",alignItems:"center",gap:"12px",backgroundColor:i?"rgba(16, 16, 17, 0.91)":"#ffffff"},cancelButton:{width:"56px",height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("simplePanel",e),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},saveButton:{flex:1,height:"56px",borderRadius:"18px",border:"none",background:`linear-gradient(135deg, ${o.get("difficulty5",e)}, #3F51B5)`,color:"#fff",fontSize:"16px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 8px 20px rgba(63, 81, 181, 0.3)"}}},Fe=e=>(e.getDay()+6)%7,P=e=>{const n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${n}-${i}-${r}`},N=new Audio("Audio/Click.wav"),E=(e,n)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][n]||o.get("accent",e),J=e=>{if(typeof e!="number"||e<0)return"--:--";const n=Math.floor(e/(60*1e3)),i=Math.floor(n/60),r=n%60;return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},Re=e=>{if(typeof e!="number"||e<0)return 0;const n=3600*1e3,i=4,r=10,s=i*n,d=r*n;if(e<=s)return 15;if(e>=d)return 100;const x=d-s,b=(e-s)/x;return 15+Math.round(b*85)};function O(e){y.prefs[2]===0&&e&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),y.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const He=()=>{const[e,n]=p.useState("dark"),[i,r]=p.useState(y.prefs[0]),[s,d]=p.useState(new Date),[x,b]=p.useState(new Date),D=p.useRef(x),[B,I]=p.useState(y.prefs[4]),[g,T]=p.useState(null);p.useEffect(()=>{const c=V.subscribe(n),m=Z.subscribe(W=>r(W==="ru"?0:1)),$=Y.subscribe(I);return()=>{c.unsubscribe(),m.unsubscribe(),$.unsubscribe()}},[]),p.useEffect(()=>{D.current=x;const c=P(x),m=y.sleepingLog?.[c];T(m||null)},[x]);const w=new Date(s.getFullYear(),s.getMonth(),1),M=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),z=(w.getDay()+6)%7,F=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],R=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],j=Array(z).fill(null);for(let c=1;c<=M;c++)j.push(c);const S=()=>{d(new Date(s.getFullYear(),s.getMonth()-1)),O(N)},v=()=>{d(new Date(s.getFullYear(),s.getMonth()+1)),O(N)},f=s.getMonth(),h=s.getFullYear();return t.jsxs("div",{style:a(e).container,children:[t.jsxs("div",{style:a(e).headerContainer,children:[t.jsx(u.button,{whileTap:{scale:.9},onClick:S,style:a(e).navBtn,children:t.jsx(fe,{})}),t.jsxs("div",{style:a(e).monthTitle,children:[s.toLocaleString(i===0?"ru":"en",{month:"long"}),t.jsx("span",{style:{opacity:.5,marginLeft:"6px"},children:s.getFullYear()})]}),t.jsx(u.button,{whileTap:{scale:.9},onClick:v,style:a(e).navBtn,children:t.jsx(ye,{})})]}),t.jsxs("div",{style:a(e).gridWrapper,children:[t.jsx("div",{style:a(e).weekRow,children:F[i].map((c,m)=>t.jsx("div",{style:{...a(e).weekDay,color:m===6||m===5?o.get("skipped",e):o.get("subText",e)},children:c},m))}),t.jsx("div",{style:a(e).daysGrid,children:j.map((c,m)=>{if(c===null)return t.jsx("div",{},`empty-${m}`);const $=new Date(h,f,c),W=P($),k=y.sleepingLog?.[W],L=c===x.getDate()&&f===x.getMonth()&&h===x.getFullYear(),ie=c===new Date().getDate()&&f===new Date().getMonth()&&h===new Date().getFullYear(),C=!!k,A=C?E(e,k.mood-1):"transparent",se=C?Re(k.duration):0;return t.jsxs(u.div,{whileTap:{scale:.95},onClick:()=>{b(new Date(h,f,c)),O(N),T(k||null)},style:a(e).dayCell(L,ie),children:[C&&t.jsx(u.div,{initial:{height:0},animate:{height:`${se}%`},transition:{type:"spring",stiffness:100},style:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:A,opacity:L?.4:.25,zIndex:0}}),L&&t.jsx(u.div,{layoutId:"selInd",style:{position:"absolute",top:0,left:0,right:0,height:"3px",backgroundColor:C?A:o.get("mainText",e),boxShadow:`0 2px 8px ${C?A:o.get("mainText",e)}`}}),t.jsx("span",{style:{zIndex:1,position:"relative"},children:c})]},c)})})]}),t.jsxs("div",{style:a(e).detailsContainer,children:[t.jsxs("div",{style:a(e).dateLabel,children:[x.getDate()," ",R[i][Fe(x)]]}),t.jsx(ee,{mode:"wait",children:g?t.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:a(e).card,children:[t.jsx("div",{style:a(e).cardGlow(E(e,g.mood-1))}),t.jsxs("div",{style:{position:"relative",zIndex:2},children:[t.jsxs("div",{style:a(e).metricsGrid,children:[t.jsx(Q,{icon:t.jsx(te,{}),label:i===0?"Отбой":"Bedtime",value:J(g.bedtime),theme:e,color:o.get("accent",e)}),t.jsx(Q,{icon:t.jsx(oe,{}),label:i===0?"Длительность":"Duration",value:J(g.duration),theme:e,color:E(e,g.mood-1)}),t.jsxs("div",{style:a(e).metricBox,children:[t.jsx("div",{style:{...a(e).iconBox,color:o.get("difficulty3",e)},children:t.jsx(U,{})}),t.jsx("div",{style:a(e).metricLabel,children:i===0?"Настроение":"Mood"}),t.jsx("div",{style:{display:"flex",gap:"2px",marginTop:"4px"},children:[1,2,3,4,5].map(c=>t.jsx(U,{size:10,color:c<=g.mood?o.get("difficulty3",e):o.get("subText",e),style:{opacity:c<=g.mood?1:.2}},c))})]})]}),g.note&&t.jsxs("div",{style:a(e).noteBox,children:[t.jsx(be,{size:14,style:{minWidth:"16px",marginTop:"2px",opacity:.7}}),t.jsx("span",{style:{fontSize:"13px",fontStyle:"italic",opacity:.9},children:g.note})]})]})]},"entry"):t.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},style:a(e).emptyState,children:[t.jsx(ne,{size:32,color:o.get("subText",e),style:{opacity:.3,marginBottom:"10px"}}),t.jsx("span",{children:i===0?"Нет данных о сне":"No sleep data"})]},"empty")})]}),t.jsx(ze,{dateString:P(x)})]})},Q=({icon:e,label:n,value:i,theme:r,color:s})=>t.jsxs("div",{style:a(r).metricBox,children:[t.jsx("div",{style:{...a(r).iconBox,color:s},children:e}),t.jsx("div",{style:a(r).metricLabel,children:n}),t.jsx("div",{style:a(r).metricValue,children:i})]}),a=(e,n)=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",alignItems:"center",height:"85vh",paddingTop:"80px",marginTop:"70px",width:"100vw",fontFamily:"Segoe UI, sans-serif",overflow:"hidden"},headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"90%",marginBottom:"20px"},navBtn:{background:"transparent",border:"none",color:o.get("mainText",e),fontSize:"20px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},monthTitle:{fontSize:"22px",fontWeight:"700",color:o.get("mainText",e),textTransform:"capitalize"},gridWrapper:{width:"94%",padding:"0 10px"},weekRow:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",marginBottom:"10px",textAlign:"center"},weekDay:{fontSize:"12px",fontWeight:"600",textTransform:"uppercase"},daysGrid:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"6px",width:"100%"},dayCell:(i,r)=>({aspectRatio:"1/1",borderRadius:"12px",backgroundColor:i?o.get("simplePanel",e):"transparent",border:r?`1px solid ${o.get("accent",e)}`:`1px solid ${o.get("border",e)}30`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:i||r?"700":"500",color:o.get("mainText",e),position:"relative",overflow:"hidden",cursor:"pointer",boxShadow:i?"0 4px 12px rgba(0,0,0,0.1)":"none"}),detailsContainer:{width:"90%",marginTop:"55px",marginBottom:"40px",display:"flex",flexDirection:"column",gap:"12px"},dateLabel:{fontSize:"16px",fontWeight:"bold",color:o.get("subText",e),paddingLeft:"4px"},card:{position:"relative",backgroundColor:o.get("simplePanel",e),borderRadius:"24px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:`1px solid ${o.get("border",e)}50`,overflow:"hidden"},cardGlow:i=>({position:"absolute",top:"-50%",right:"-50%",width:"200px",height:"200px",background:`radial-gradient(circle, ${i}30 0%, transparent 70%)`,filter:"blur(30px)",pointerEvents:"none"}),metricsGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",marginBottom:"15px"},metricBox:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:e==="dark"?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)",borderRadius:"16px",padding:"12px 5px"},iconBox:{fontSize:"18px",marginBottom:"6px"},metricLabel:{fontSize:"10px",textTransform:"uppercase",color:o.get("subText",e),marginBottom:"2px"},metricValue:{fontSize:"14px",fontWeight:"700",color:o.get("mainText",e)},noteBox:{display:"flex",gap:"10px",backgroundColor:e==="dark"?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",padding:"12px",borderRadius:"12px",color:o.get("mainText",e),lineHeight:"1.4"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"30px",backgroundColor:o.get("simplePanel",e),borderRadius:"24px",border:`1px dashed ${o.get("border",e)}`,color:o.get("subText",e),fontSize:"14px"}});export{He as default};
