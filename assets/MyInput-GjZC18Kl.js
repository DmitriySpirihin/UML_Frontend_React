import{r as f,aO as W,aP as $,j as y,C as p,A as I,aQ as z,aR as B}from"./index-BpCdv4iI.js";const T=({maxL:u=500,placeHolder:P,theme:d,h:j="90%",w:C="vh",value:S="",onChange:x=null,clear:M=!1})=>{const[o,r]=f.useState({myString:"",cursorPos:0}),[a,h]=f.useState(!1),[w,g]=f.useState(!0);return f.useEffect(()=>{r({myString:S,cursorPos:0})},[S]),f.useEffect(()=>{const i=W.subscribe(s=>{const l=t=>t==="bs"||t==="bsall"||t===`
`?!1:Array.from(t).length===1&&t.length>1;a&&(s==="bs"?r(t=>{const e=Array.from(t.myString);return t.cursorPos===0?t:{myString:[...e.slice(0,t.cursorPos-1),...e.slice(t.cursorPos)].join(""),cursorPos:t.cursorPos-1}}):s==="bsall"?r({myString:"",cursorPos:0}):s===`
`?r(t=>{if(t.myString.length>=u)return t;const e=Array.from(t.myString),n=e.slice(0,t.cursorPos).join(""),c=e.slice(t.cursorPos).join("");return{myString:n+`
`+c,cursorPos:t.cursorPos+1}}):s.startsWith("paste")?r(t=>{const e=s.slice(5),n=Array.from(t.myString),c=Math.max(0,Math.min(t.cursorPos,n.length)),A=Math.max(0,u-n.length),m=e.slice(0,A);if(m.length===0)return t;const b=n.slice(0,c).join(""),E=n.slice(c).join(""),k=b+m+E,O=c+m.length;return{myString:k,cursorPos:O}}):(s.length===1||l(s))&&r(t=>{const e=Array.from(t.myString),n=Math.max(0,Math.min(t.cursorPos,e.length)),c=s.slice(0,Math.max(0,u-e.length)),A=e.slice(0,n).join(""),m=e.slice(n).join(""),b=A+c+m,E=Math.min(n+b.length,u);return{myString:b,cursorPos:E}}))});return()=>i.unsubscribe()},[a]),f.useEffect(()=>{if(!a){g(!1);return}g(!0);const i=setInterval(()=>{g(s=>!s)},500);return()=>clearInterval(i)},[a]),f.useEffect(()=>{const i=$.subscribe(s=>{s===!1&&(h(!1),M&&r({myString:"",cursorPos:0}))});return()=>i.unsubscribe()},[]),f.useEffect(()=>{x&&a&&x(o.myString)},[o]),y.jsx("div",{style:{width:C,height:j,borderBottom:`1px solid ${p.get("border",d)}`,display:"flex",alignItems:"flex-end",justifyContent:"flex-start"},onClick:i=>{z(""),h(!0),B(!0),r(s=>({myString:s.myString,cursorPos:H(i,s.myString)}))},children:y.jsx("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflow:"hidden",fontSize:I.prefs[4]===0?"13px":"15px",display:"block",paddingLeft:"8px",textAlign:"left",paddingBottom:"2px",lineHeight:"18px",fontFamily:"Segoe UI",color:o.myString.length===0?p.get("icons",d):p.get("mainText",d)},children:o.myString.length>0||a?y.jsxs(y.Fragment,{children:[o.myString.slice(0,o.cursorPos),w&&y.jsx("span",{style:{color:p.get("iconsHighlited",d),fontSize:I.prefs[4]===0?"13px":"15px",fontWeight:"bold"},children:"|"}),o.myString.slice(o.cursorPos)]}):P})})},H=(u,P)=>{const j=I.prefs[4]===0?13:15,C=18,S=u.nativeEvent.offsetX-8,x=u.nativeEvent.offsetY,o=document.createElement("canvas").getContext("2d");o.font=`${j}px 'Segoe UI', 'Apple Color Emoji', 'Noto Color Emoji', 'Arial'`;const r=P.split(`
`),a=Math.floor(x/C),h=Math.min(a,r.length-1),w=r[h],g=Array.from(w);let i=0;for(let l=0;l<g.length;l++){const t=o.measureText(g[l]).width;if(i+=t,S<i)return r.slice(0,h).reduce((n,c)=>n+Array.from(c).length+1,0)+l}return r.slice(0,h).reduce((l,t)=>l+Array.from(t).length+1,0)+g.length};export{T as M};
