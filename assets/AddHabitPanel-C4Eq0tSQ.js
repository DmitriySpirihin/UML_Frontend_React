import{r as l,G as ae,t as E,l as Y,A as g,y as Ae,z as Te,j as t,C as o,B as Le,D as b,E as ne,H as se,I as ie,J as oe,K as Fe,L as He,M as Re,a as N,O as J}from"./index-Ct2OsxXV.js";import{I as O,a as ze}from"./HabitsMain-CnW2e8al.js";import{b as Me,M as Be,a as $e}from"./index-C0YazLWR.js";import"./index-CwkHO2hh.js";function I(e){const r=l.useRef(),d=l.useRef(),i=l.useRef(300),c=80,w=40,a=()=>{e(),i.current>c&&(i.current-=w,i.current<c&&(i.current=c)),clearInterval(d.current),d.current=setInterval(a,i.current)},D=()=>{i.current=300,r.current=setTimeout(()=>{e(),d.current=setInterval(a,i.current)},300)},f=()=>{clearTimeout(r.current),clearInterval(d.current)};return{onPointerDown:D,onPointerUp:f,onPointerLeave:f,onMouseLeave:f,onTouchEnd:f}}function W(e){return ae({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function U(e){return ae({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}const x=new Audio("Audio/Click.wav"),P=()=>N.concat((g.CustomHabits||[]).filter(e=>!N.some(r=>r.id===e.id))),k=new Date,Je=()=>{const[e,r]=l.useState(E.value),[d,i]=l.useState(Y.value),[c,w]=l.useState(!1),[a,D]=l.useState(g.prefs[0]),[f,G]=l.useState(!1),[X,ce]=l.useState(""),[de,L]=l.useState(!1),[j,ue]=l.useState(""),[y,xe]=l.useState(""),[M,pe]=l.useState(""),[q,ge]=l.useState("default"),[he,fe]=l.useState(-1),[m,F]=l.useState(new Date().getFullYear()),[C,A]=l.useState(new Date().getMonth()),[B,T]=l.useState(new Date().getDate()),[Q,Z]=l.useState(P()),[be,_]=l.useState(null),[H,ee]=l.useState(!1),[ye,te]=l.useState(0),[me,we]=l.useState("default"),[R,v]=l.useState(!1),[je,$]=l.useState({text:a===0?"Добавить":"Add",onClick:()=>K(!1,m.toString()+"-"+C+"-"+B)}),S=(s,h)=>{h===2?T(u=>V(s,u,m,C)):h===1?A(u=>s?u+1<12?u+1:0:u-1>-1?u-1:11):h===0&&F(u=>s&&u+1<=k.getFullYear()+2&&u-1>=k.getFullYear()-2?u+1:u-1)},Ce=I(()=>S(!1,0)),ve=I(()=>S(!0,0)),Se=I(()=>S(!1,1)),Ie=I(()=>S(!0,1)),ke=I(()=>S(!1,2)),Pe=I(()=>S(!0,2)),De=[["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],["January","February","March","April","May","June","July","August","September","October","November","December"]];l.useEffect(()=>{const s=E.subscribe(r),h=Y.subscribe(i),u=Ae.subscribe(w);return()=>{s.unsubscribe(),h.unsubscribe(),u.unsubscribe()}},[]),l.useEffect(()=>{const s=E.subscribe(r),h=Y.subscribe(u=>{D(u==="ru"?0:1)});return()=>{s.unsubscribe(),h.unsubscribe()}},[]),l.useEffect(()=>{Z(P())},[]),l.useEffect(()=>{const s=Te.subscribe(ce);return X==="AddHabitPanel"?setTimeout(()=>te(1),400):te(0),()=>{s.unsubscribe()}},[]);const z=(s,h)=>{s.length>0&&(h===0?ue(s[0].toUpperCase()+s.toLowerCase().slice(1)):h===1?xe(s[0].toUpperCase()+s.toLowerCase().slice(1)):h===2&&pe(s[0].toUpperCase()+s.toLowerCase().slice(1)))};return l.useEffect(()=>{j.length>3&&y.length>3?(v(!0),$({text:a===0?"создать и добавить":"create and add",onClick:()=>re(j,y,M,q)})):v(!1)},[j,y,M,q,a]),t.jsxs("div",{style:{...n(e).container,transform:X==="AddHabitPanel"?"translateX(0)":"translateX(-100%)",backgroundColor:ye===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:[!f&&t.jsxs("div",{style:n(e,c).panel,children:[t.jsx("div",{style:n(e).headerText,children:a===0?"добавь привычку":"add habit"}),t.jsxs("div",{style:{...n(e).simplePanel,height:c?"66vh":"52vh"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(Le,{style:{color:o.get("mainText",e),width:"5vw",marginTop:"10px",marginLeft:"10px"}}),t.jsx("input",{type:"text",onFocus:()=>b(!0),onBlur:()=>b(!1),style:{...n(e).input,height:c?"50%":"40%"},onChange:s=>Ye(s.target.value,Q,Z)})]}),t.jsx("div",{style:n(e).scrollView,children:Q.map(s=>!g.choosenHabits.includes(s.id)&&t.jsx("li",{style:{...n(e).text,borderRadius:"24px",backgroundColor:s.id===be?o.get("highlitedPanel",e):"transparent"},onClick:()=>{_(s.id),fe(s.id),v(!0),p(x),$({text:a===0?"Добавить":"Add",onClick:()=>K(s.id,s.name[a],!1,m.toString()+"-"+C+"-"+B)})},children:t.jsx("p",{style:n(e).text,children:s.name[a]})},s.id))})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{se(""),ie(0),p(x)},children:t.jsx(ne,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{G(!0),v(!1)},children:t.jsx(Me,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{R&&(L(!0),p(x))},children:t.jsx(oe,{style:{...n(e).miniIcon,color:R?o.get("icons",e):o.get("iconsDisabled",e)}})})]})]}),f&&t.jsxs("div",{style:n(e,c).panel,children:[t.jsx("div",{style:n(e).headerText,children:a===0?"или создай свою":"or create your own"}),t.jsxs("div",{style:{...n(e).simplePanel,height:c?"66vh":"52vh",justifyContent:"center"},children:[t.jsx("textarea",{maxLength:25,placeholder:a===0?"имя":"name",style:n(e).input,onChange:s=>z(s.target.value,0),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("textarea",{maxLength:25,placeholder:y===""?a===0?"категория":"category":y,style:{...n(e).input,width:"48%"},onChange:s=>z(s.target.value,1),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsx("select",{style:{...n(e).input,width:"48%"},onChange:s=>z(s.target.value,1),children:Ee(e,a)})]}),t.jsx("textarea",{maxLength:60,placeholder:a===0?"описание(опционально)":"description(optional)",style:{...n(e).input,height:c?"40%":"25%"},onChange:s=>z(s.target.value,2),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsx("div",{style:n(e).headerText,children:a===0?"выбери иконку(опционально)":"choose icon(optional)"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("div",{style:{width:"80%",marginLeft:"30px",padding:"5px"},children:t.jsxs("div",{style:n(e).button,onClick:()=>ee(!H),children:[!H&&t.jsx(Fe,{style:n(e).miniIcon}),H&&t.jsx(He,{style:n(e).miniIcon})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"20%",height:"100%",padding:"8px"},children:O.getIcon(me,{size:48,style:{marginRight:"70px",color:o.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{se(""),ie(0),p(x)},children:t.jsx(ne,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{G(!1),v(!1),_(null)},children:t.jsx(Re,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{R&&(L(!0),p(x))},children:t.jsx(oe,{style:{...n(e).miniIcon,color:R?o.get("icons",e):o.get("iconsDisabled",e)}})})]})]}),H&&t.jsx("div",{style:n(e).selectPanel,children:Object.entries(O.ic).map(([s])=>t.jsx("div",{style:{width:"15%",padding:"12px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",":hover":{backgroundColor:o.get("highlitedPanel",e)}},onClick:()=>{we(s),ge(s),p(x),ee(!1),j.length>3&&y.length>3&&(v(!0),$({text:a===0?"создать и добавить":"create and add",onClick:()=>{re(j,y,M,s),p(x)}}))},children:O.getIcon(s,{size:32,style:{color:o.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})},s))}),de&&t.jsx("div",{style:n(e).container,children:t.jsxs("div",{style:n(e).confirmationPanel,children:[t.jsx("p",{style:n(e).text,children:Oe(a,f,he,j)}),t.jsxs("div",{style:{...n(e).simplePanelRow,flexDirection:"column",alignItems:"center",backgroundColor:o.get("background",e),width:"90%",borderRadius:"24px"},children:[t.jsx("p",{style:n(e).text,children:a===0?"установите дату":"set date"}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Ce,style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(W,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",m," "]}),t.jsx("div",{...ve,onClick:()=>{k.getFullYear()+2>=m+1&&F(s=>s+1),p(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(U,{style:{userSelect:"none",touchAction:"none"}})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Se,onClick:()=>{A(s=>s-1>-1?s-1:11),p(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(W,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",De[a][C]," "]}),t.jsx("div",{...Ie,onClick:()=>{A(s=>s+1<12?s+1:0),p(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(U,{style:{userSelect:"none",touchAction:"none"}})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ke,onClick:()=>{T(s=>V(!1,s,m,C)),p(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(W,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",B," "]}),t.jsx("div",{...Pe,onClick:()=>{T(s=>V(!0,s,m,C)),p(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(U,{style:{userSelect:"none",touchAction:"none"}})})]})]}),t.jsxs("div",{style:n(e).simplePanelRow,children:[t.jsx("div",{style:n(e).button,onClick:()=>{L(!1),le(T,A,F),p(x)},children:t.jsx(Be,{style:n(e).miniIcon})}),t.jsx("div",{style:n(e).button,onClick:()=>{je.onClick(),p(x),L(!1),le(T,A,F)},children:t.jsx($e,{style:n(e).miniIcon})})]})]})})]})},Ee=(e,r)=>Array.from(new Set(N.map(i=>i.category[r]))).map(i=>t.jsx("option",{value:i,style:{...n(e).text},children:i},i)),K=(e,r,d,i)=>{if(g.IsHabitInChoosenList(e)){J(g.prefs[0]===0?"привычка уже в списке":"habit already in list",2500,!1);return}ze(e,i);const c=d?g.prefs[0]===0?`привычка: ${r} создана и добавлена`:`habit: ${r} was created and added`:g.prefs[0]===0?"привычка добавлена":"habit added";J(c,2500,!0)},re=(e,r,d,i)=>{const c=P(),a=(c.length>0?Math.max(...c.map(D=>D.id)):0)+1;g.IsCustomHabitExists(a)?J(g.prefs[0]===0?"привычка с таким названием уже существует":"habit with this name already exists",2500,!1):(g.AddCustomHabit(e,r,d,i,a),setTimeout(()=>{K(a,e,!0,dateString)},100))},Ye=(e,r,d)=>{if(e.length>0){const i=P().filter(c=>c.name[g.prefs[0]].toLowerCase().startsWith(e.toLowerCase()));d(i)}else{const i=P();r.length!=i.length&&d(i)}},n=(e,r)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9900,padding:"20px"},panel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",overflow:"hidden",boxSizing:"border-box",overflowY:"scroll",border:`1px solid ${o.get("border",e)}`,margin:"5px",backgroundColor:o.get("simplePanel",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`,width:"85vw",height:r?"85vh":"65vh"},confirmationPanel:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,margin:"5px",backgroundColor:o.get("simplePanel",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`,width:"85vw",height:"80vw"},text:{textAlign:"center",fontSize:"12px",color:o.get("mainText",e),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:o.get("mainText",e),marginBottom:"4px"},headerText:{textAlign:"center",margin:"5px",padding:"5px",fontSize:"14px",color:o.get("subText",e)},scrollView:{overflowY:"auto",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"},simplePanel:{marginLeft:"7.5vw",width:"70vw",height:"30vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch",background:"rgba(0, 0, 0, 0.1)",borderRadius:"24px"},input:{width:"65vw",height:r?"6vh":"3vh",borderRadius:"12px",border:`1px solid ${o.get("border",e)}`,margin:"12px",fontSize:"14px",fontFamily:"Segoe UI",color:o.get("subText",e),backgroundColor:o.get("inputField",e)},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",userSelect:"none",touchAction:"none"},select:{width:"20vw",height:"6vw",borderRadius:"12px",border:`1px solid ${o.get("border",e)}`,marginTop:"12px",fontSize:"14px",color:o.get("subText",e),backgroundColor:o.get("habitCard",e)},selectOption:{color:o.get("subText",e),backgroundColor:o.get("habitCard",e),fontSize:"8px"},selectPanel:{backgroundColor:o.get("habitCard",e),borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexWrap:"wrap",width:"77vw",maxHeight:"42vh",overflowY:"auto",padding:"16px",gap:"8px",justifyContent:"center",zIndex:1e3},selectIcon:{flex:"{0,0,33.33%}",width:"20vw",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignContent:"center",justifyContent:"center",width:"15vw",marginTop:"12px",fontSize:"12px"},miniIcon:{fontSize:"28px",padding:"5px",marginTop:"10px",color:o.get("icons",e),userSelect:"none",touchAction:"none",filter:`drop-shadow(0 0px 1px ${o.get("iconsShadow",e)})`}});function p(e){g.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),g.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Oe(e,r,d,i){if(r)return e===0?"добавить привычку "+i+"?":"add habit "+i+"?";{const c=P().find(w=>w.id===d).name[e];return e===0?"добавить привычку "+c+"?":"add habit "+c+"?"}}function V(e,r,d,i){const c=new Date(d,i,0).getDate();return e?r+1<=c&&new Date(d,i,r+1).getTime()<=k.getTime()?r+1:1:r-1>0?r-1:new Date(d,i,r-1).getTime()<=k.getTime()?k.getDate():c}function le(e,r,d){const i=new Date;e(i.getDate()),r(i.getMonth()),d(i.getFullYear())}export{Je as default};
