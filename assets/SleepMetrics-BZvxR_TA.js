import{A as f,U as B,t as S,l as w,f as R,p as $,j as t,C as o,cu as A,bX as P,bx as v,bY as F,m as C}from"./index-Uo9z0Acz.js";import{r as d}from"./recharts-Bg6K2Pzo.js";import{M as W}from"./MyBarChart-Cngl_Uc6.js";const L=[28,180,360],E=[["Месяц","Month"],["6 Мес","6 Mon"],["Год","Year"]],H=e=>Math.floor(e/6e4),j=e=>{if(!e)return"0h 0m";const a=H(e),r=Math.floor(a/60),c=a%60;return r>0?`${r}h ${c}m`:`${c}m`},U=(e,a)=>new Date(e).toLocaleDateString(a===0?"ru-RU":"en-US",{day:"numeric",month:"short"}),T=(e,a)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][a-1]||o.get("subText",e),O=({selectedIndex:e,setSelectedIndex:a,theme:r,langIndex:c})=>t.jsx("div",{style:s(r).segmentedControl,children:E.map((x,p)=>{const g=e===p;return t.jsxs(C.div,{onClick:()=>a(p),style:{...s(r).segmentBtn,color:g?o.get("mainText",r):o.get("subText",r),fontWeight:g?"600":"500"},children:[g&&t.jsx(C.div,{layoutId:"segmentBg",style:s(r).segmentActiveBg}),t.jsx("span",{style:{position:"relative",zIndex:1},children:x[c]})]},p)})}),D=({icon:e,label:a,value:r,subLabel:c,theme:x,color:p})=>t.jsxs("div",{style:s(x).statCard,children:[t.jsx("div",{style:{...s(x).iconBox,color:p,backgroundColor:`${p}15`},children:e}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:s(x).statLabel,children:a}),t.jsx("div",{style:s(x).statValue,children:r}),c&&t.jsx("div",{style:s(x).statSub,children:c})]})]}),_=()=>{const[e,a]=d.useState("dark"),[r,c]=d.useState(f.prefs[0]),[x,p]=d.useState(f.prefs[4]),[g,M]=d.useState(B.hasPremium);d.useEffect(()=>{const n=S.subscribe(a),i=w.subscribe(c),h=R.subscribe(p),u=$.subscribe(M);return()=>{n.unsubscribe(),i.unsubscribe(),h.unsubscribe(),u.unsubscribe()}},[]);const[b,I]=d.useState(0),y=d.useMemo(()=>f.sleepingLog?Object.entries(f.sleepingLog).map(([n,i])=>({date:n,durationMs:i.duration||0,mood:i.mood||0,note:i.note||""})).sort((n,i)=>new Date(n.date)-new Date(i.date)):[],[]),l=d.useMemo(()=>{if(y.length===0)return[];const n=new Date;return n.setDate(n.getDate()-L[b]),y.filter(i=>new Date(i.date)>=n)},[y,b]),z=d.useMemo(()=>l.map(n=>({date:n.date.split("-").slice(1).reverse().join("."),ms:n.durationMs,mood:n.mood||3})),[l]),m=d.useMemo(()=>{if(l.length===0)return{avg:0,best:0,count:0};const i=l.reduce((u,k)=>u+k.durationMs,0)/l.length,h=Math.max(...l.map(u=>u.durationMs));return{avg:i,best:h,count:l.length}},[l]);return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).scrollContent,children:[t.jsxs("div",{style:s(e).headerSection,children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px"},children:[t.jsx(A,{size:20,color:o.get("accent",e)}),t.jsx("h2",{style:s(e).pageTitle,children:r===0?"Аналитика Сна":"Sleep Analytics"})]}),t.jsx(O,{selectedIndex:b,setSelectedIndex:I,theme:e,langIndex:r})]}),t.jsxs("div",{style:s(e).statsRow,children:[t.jsx(D,{icon:t.jsx(P,{}),label:r===0?"Средний сон":"Avg Sleep",value:j(m.avg),theme:e,color:o.get("normal",e)}),t.jsx(D,{icon:t.jsx(v,{}),label:r===0?"Лучший сон":"Best Sleep",value:j(m.best),theme:e,color:o.get("perfect",e)})]}),t.jsxs("div",{style:s(e).chartContainer,children:[t.jsxs("div",{style:s(e).chartHeader,children:[t.jsx("span",{style:s(e).chartTitle,children:r===0?"Динамика":"Dynamics"}),t.jsxs("span",{style:s(e).chartSub,children:[m.count," ",r===0?"записей":"records"]})]}),t.jsx("div",{style:{height:"200px",width:"100%"},children:t.jsx(W,{data:z,theme:e,textColor:o.get("subText",e),linesColor:o.get("border",e),backgroundColor:o.get("simplePanel",e),barColor:o.get("accent",e)})})]}),t.jsxs("div",{style:s(e).historySection,children:[t.jsxs("div",{style:s(e).sectionHeader,children:[t.jsx(F,{size:14,color:o.get("subText",e)}),t.jsx("span",{children:r===0?"История":"History"})]}),t.jsx("div",{style:s(e).listContainer,children:l.length===0?t.jsx("div",{style:s(e).emptyState,children:r===0?"Нет данных за период":"No data for this period"}):l.slice().reverse().map((n,i)=>t.jsxs("div",{style:s(e).listItem,children:[t.jsx("div",{style:s(e).dateBox,children:t.jsx("span",{style:s(e).dateDay,children:U(n.date,r)})}),t.jsxs("div",{style:s(e).itemCenter,children:[t.jsx("div",{style:s(e).durationText,children:j(n.durationMs)}),n.note&&t.jsx("div",{style:s(e).noteText,children:n.note})]}),n.mood>0&&t.jsxs("div",{style:s(e).moodBox,children:[t.jsx(v,{size:12,color:T(e,n.mood)}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:T(e,n.mood)},children:n.mood})]})]},`${n.date}-${i}`))})]}),t.jsx("div",{style:{marginBottom:"80px"}})," "]}),!g&&t.jsx("div",{onClick:n=>n.stopPropagation(),style:{position:"absolute",inset:0,zIndex:2,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:S.value==="dark"?"rgba(10, 10, 10, 0.85)":"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(5px)",textAlign:"center"},children:t.jsx("div",{style:{color:S.value==="dark"?"#FFD700":"#D97706",fontSize:"11px",fontWeight:"bold",fontFamily:"Segoe UI"},children:r===0?"ТОЛЬКО ДЛЯ ПРЕМИУМ":"PREMIUM USERS ONLY"})})]})},s=e=>({container:{backgroundColor:o.get("background",e),height:"90vh",marginTop:"40px",width:"100vw",paddingTop:"80px",display:"flex",flexDirection:"column",fontFamily:"Segoe UI, sans-serif"},scrollContent:{flex:1,overflowY:"auto",padding:"0 20px 40px 20px",display:"flex",flexDirection:"column",gap:"20px"},headerSection:{display:"flex",flexDirection:"column",marginTop:"20px"},pageTitle:{fontSize:"24px",fontWeight:"800",color:o.get("mainText",e),margin:0},segmentedControl:{display:"flex",backgroundColor:o.get("simplePanel",e),borderRadius:"12px",padding:"4px",border:`1px solid ${o.get("border",e)}50`},segmentBtn:{flex:1,position:"relative",textAlign:"center",padding:"8px",fontSize:"13px",cursor:"pointer",zIndex:1},segmentActiveBg:{position:"absolute",inset:0,backgroundColor:e==="dark"?"rgba(255,255,255,0.1)":"#fff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:-1},statsRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},statCard:{backgroundColor:o.get("simplePanel",e),borderRadius:"16px",padding:"16px",display:"flex",alignItems:"center",gap:"12px",border:`1px solid ${o.get("border",e)}30`},iconBox:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px"},statLabel:{fontSize:"11px",color:o.get("subText",e),textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"2px"},statValue:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",e)},chartContainer:{backgroundColor:o.get("simplePanel",e),borderRadius:"20px",padding:"20px",border:`1px solid ${o.get("border",e)}30`},chartHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},chartTitle:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",e)},chartSub:{fontSize:"12px",color:o.get("subText",e)},historySection:{display:"flex",flexDirection:"column",gap:"10px"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",fontWeight:"600",color:o.get("subText",e),paddingLeft:"4px"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},listItem:{display:"flex",alignItems:"center",backgroundColor:e==="dark"?"rgba(255,255,255,0.03)":"#fff",padding:"12px",borderRadius:"16px",border:`1px solid ${o.get("border",e)}30`},dateBox:{width:"50px",display:"flex",flexDirection:"column",alignItems:"center",borderRight:`1px solid ${o.get("border",e)}30`,paddingRight:"12px",marginRight:"12px"},dateDay:{fontSize:"12px",fontWeight:"700",color:o.get("mainText",e),textAlign:"center"},itemCenter:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},durationText:{fontSize:"15px",fontWeight:"600",color:o.get("mainText",e)},noteText:{fontSize:"11px",color:o.get("subText",e),marginTop:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px"},moodBox:{display:"flex",alignItems:"center",gap:"4px",backgroundColor:o.get("background",e),padding:"4px 8px",borderRadius:"8px"},emptyState:{textAlign:"center",padding:"40px",color:o.get("subText",e),fontSize:"14px",fontStyle:"italic"}});export{_ as default};
