import{A as l,t as Te,l as De,f as ke,O as z,aB as Pe,j as t,C as i,s as M,aC as O,a2 as Ie,i as N,k as H,a0 as S}from"./index-L6N8QMHc.js";import{R as ze,r as x}from"./recharts-Bg6K2Pzo.js";import{d as Me,a as Re,b as Ae}from"./TrainingLogHelper-CwQdyGy7.js";import{b as $e}from"./index-CycIhM95.js";import{F as q,a as J}from"./index-Cc7asrFA.js";const f=e=>{const a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${a}-${o}-${u}`},Fe=e=>(e.getDay()+6)%7;f(new Date);const W=new Audio("Audio/Click.wav"),Ke=()=>{const[e,a]=ze.useState("dark"),[o,u]=x.useState(l.prefs[0]),[r,v]=x.useState(new Date),[d,ee]=x.useState(r),U=x.useRef(d),[te,ne]=x.useState(0),[y,se]=x.useState(l.prefs[4]),[oe,R]=x.useState(!1),[re,A]=x.useState(!1),[ie,$]=x.useState(!1),[h,G]=x.useState(l.getLastProgramId()),[F,E]=x.useState(l.getLastTrainingDayIndex()||0),[j,C]=x.useState(16*36e5),[T,D]=x.useState(17*36e5),[V,le]=x.useState({date:"",key:0}),m=600*1e3,p=24*36e5;x.useEffect(()=>{const n=Te.subscribe(a),c=De.subscribe(b=>{u(b==="ru"?0:1)}),g=ke.subscribe(b=>{se(b)});return()=>{n.unsubscribe(),c.unsubscribe(),g.unsubscribe()}},[]);const ae=new Date(r.getFullYear(),r.getMonth(),1),ce=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),de=(ae.getDay()+6)%7,xe=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],ue=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],ge=z(()=>C(n=>(n-m+p)%p)),pe=z(()=>C(n=>(n+m)%p)),he=z(()=>D(n=>{const c=(n-m+p)%p;return c>=j?c:n})),fe=z(()=>D(n=>(n+m)%p)),k=[],_=[];for(let n=0;n<de;n++)k.push(null);for(let n=1;n<=ce;n++)k.push(n);for(let n=0;n<k.length;n+=7)_.push(k.slice(n,n+7));const me=()=>{v(new Date(r.getFullYear(),r.getMonth()-1)),K(W)},ye=()=>{v(new Date(r.getFullYear(),r.getMonth()+1)),K(W)};x.useEffect(()=>{U.current=d},[d]),x.useEffect(()=>{E(0)},[h]),x.useEffect(()=>{const n=Pe.subscribe(()=>{const c=new Date,g=U.current;if(g>c)return;const b=f(g),w=f(c);b===w?R(!0):A(!0)});return()=>n.unsubscribe()},[]);const be=()=>{const c=f(new Date);if(!l.programs[h])return S(o===0?"Ошибка! Программа не найдена":"Error! The program not found",2e3,!1),null;if(l.programs[h].schedule.length===0)return S(o===0?"Ошибка! Программа пустая":"Error! The program is empty",2e3,!1),null;Re(new Date,h,F),R(!1),setTimeout(()=>{const g=l.trainingLog[c].length-1;O({mode:"new",dayKey:c,dInd:g}),M("TrainingCurrent")},100)},Se=()=>{if(!l.programs[h])return S(o===0?"Ошибка! Программа не найдена":"Error! The program not found",2e3,!1),null;if(l.programs[h].schedule.length===0)return S(o===0?"Ошибка! Программа пустая":"Error! The program is empty",2e3,!1),null;if(T<=j){S(o===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Ae(d,h,F,j,T),A(!1);const n=f(d),c=l.trainingLog[n].length-1;O({mode:"redact",dayKey:n,dInd:c}),M("TrainingCurrent")},je=(n,c)=>{le({date:n,key:c})},we=()=>{Me(V.date,V.key),$(!1),S(o===0?"Тренировка удалена":"Session deleted",2e3,!0)};return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).panel,children:[t.jsxs("div",{style:s(e).calendarHead,children:[t.jsx("h1",{style:s(e).header,children:r.getFullYear()+"/"+(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)}),t.jsx("div",{onClick:me,children:t.jsx("h1",{style:s(e).header,children:"<"})}),t.jsx("div",{onClick:ye,children:t.jsx("h1",{style:s(e).header,children:">"})})]}),t.jsxs("table",{style:s(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:xe[o].map(n=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:n==="Вс"||n==="Sun"?"#873535ff":i.get("subText",e)},children:n})},n))})}),t.jsx("tbody",{children:_.map((n,c)=>t.jsx("tr",{children:n.map((g,b)=>{const w=r.getMonth(),L=r.getFullYear(),ve=g===d.getDate()&&w===d.getMonth()&&L===d.getFullYear(),B=f(new Date(L,w,g)),Y=B in l.trainingLog?l.trainingLog[B].length:0;let P=0,I=0;return Y>0&&l.trainingLog[B].forEach(Ce=>{Ce.completed?I++:P++}),t.jsx("td",{children:t.jsxs("div",{style:{...s(e).cell,border:`3px solid ${ve?i.get("currentDateBorder",e):i.get("background",e)}`,backgroundColor:i.get("background",e)},onClick:()=>{ee(new Date(Date.UTC(L,w,g))),ne(Y),K(W)},children:[g,Y>0&&t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"10px"},children:[P>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"⏳"}),P>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:P}),I>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"✅"}),I>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:I})]})]})},b)})},c))})]})]}),t.jsxs("div",{onClick:()=>M("TrainingList"),style:{display:"flex",width:"100%",alignSelf:"center",justifyContent:"center",backgroundColor:i.get("currentDateBorder",e),alignItems:"center"},children:[t.jsx("div",{style:s(e).text,children:o===0?"журнал":"journal"}),t.jsx($e,{style:{...s(e).icon,fontSize:"14px",marginLeft:"14px"}})]}),t.jsxs("div",{style:{height:"30vh",width:"95%",display:"flex",flexDirection:"column",alignContent:"center"},children:[t.jsx("h1",{style:{...s(e).subtext,fontSize:"18px",textAlign:"center"},children:d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear()+" "+ue[o][Fe(d)]+" • "+Ee(te,o)}),t.jsx("div",{style:s(e).scrollView,children:l.trainingLog[f(d)]?.map((n,c)=>t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%",borderBottom:`1px solid ${i.get("border",e)}`},children:[t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:c+1}),t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:n.completed?"✅":"⏳"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{onClick:()=>{O({mode:n.completed?"redact":"new",dayKey:f(new Date(d)),dInd:c}),M("TrainingCurrent")},style:s(e).mainText,children:Array.isArray(l.programs[n.programId]?.name)?l.programs[n.programId]?.name?.[o]:l.programs[n.programId]?.name}),t.jsx("div",{style:s(e).mainText,children:(o===0?"День ":"Day ")+(n.dayIndex+1)+": "+(l.programs[n.programId]?.schedule?.[n.dayIndex]?.name?.[o]||(o===0?`День ${n.dayIndex+1}`:`Day ${n.dayIndex+1}`))}),n.completed&&t.jsx("div",{style:{...s(e).subtext,marginBottom:"10px"},children:`${Math.round(n.duration/6e4)}${o===0?" мин":" min"}  /  ${(n.tonnage*.001).toFixed(2)} ${o===0?" тонн":" tons"}${Le(n,o)}`})]}),t.jsx(Ie,{onClick:()=>{je(f(new Date(d)),c),$(!0)},style:{...s(e).subtext,width:"18px",height:"18px",marginLeft:"auto",marginRight:"10px"}})]},c))})]}),ie&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"20%"},children:[t.jsx("div",{style:{...s(e,y).text},children:o===0?"Удалить тренировку?":"Delete session?"}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(N,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>$(!1)}),t.jsx(H,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{we()}})]})]})}),oe&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,y).mainText,marginBottom:"10px"},children:o===0?"Начать тренировку?":"Start training?"}),t.jsx("select",{value:h,style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>G(Number(n.target.value)),children:Q(e,o)}),t.jsx("select",{value:F,style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>E(Number(n.target.value)),children:X(e,o,y,h)}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(N,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>R(!1)}),t.jsx(H,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{be()}})]})]})}),re&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,y).mainText,marginBottom:"10px"},children:o===0?"Добавить предыдущую тренировку?":"Add previous training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>G(Number(n.target.value)),children:Q(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>E(Number(n.target.value)),children:X(e,o,y,h)}),t.jsx("p",{style:{...s(e,y).mainText,marginBottom:"10px"},children:o===0?"Начало тренировки":"Training start time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ge,onClick:()=>C(n=>(n-m+p)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})}),t.jsx("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:Z(j)}),t.jsxs("div",{...pe,onClick:()=>C(n=>(n+m)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:[t.jsx(J,{})," "]})]}),t.jsx("p",{style:{...s(e,y).mainText,marginBottom:"10px"},children:o===0?"Окончание тренировки":"Training end time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...he,onClick:()=>{const n=(T-m+p)%p;n>=j&&D(n)},style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})})," ",t.jsxs("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:[" ",Z(T)," "]}),t.jsx("div",{...fe,onClick:()=>D(n=>(n+m)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(J,{})})]}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(N,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>A(!1)}),t.jsx(H,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{Se()}})]})]})})]})},Q=(e,a,o)=>Object.entries(l.programs).filter(([,u])=>u.show!==!1).map(([u,r])=>t.jsx("option",{value:u,style:{...s(e,!1).text},children:Array.isArray(r?.name)?r?.name?.[a]:r?.name||`Program ${u}`},u)),X=(e,a,o,u)=>{const r=l.programs[u];return!r||!r.schedule?[t.jsx("option",{value:"",children:"0"},"none")]:r.schedule.map((v,d)=>t.jsx("option",{value:d,style:{...s(e,!1).text},children:v.name?.[a]||`Day ${d+1}`},d))},s=(e,a)=>({container:{backgroundColor:i.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${i.get("border",e)}`},scrollView:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",height:"100%",overflowY:"scroll",backgroundColor:i.get("trainingGroup",e),borderRadius:"12px"},mainText:{textAlign:"left",fontSize:a===0?"13px":"15px",color:i.get("mainText",e),marginLeft:"10px",marginBottom:"2px"},subtext:{textAlign:"left",fontSize:a===0?"11px":"13px",color:i.get("subText",e),marginLeft:"10px",marginBottom:"12px"},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:i.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",e)},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",color:i.get("mainText",e),fontFamily:"Segoe UI"},icon:{fontSize:"26px",color:i.get("icons",e)},cP:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",backgroundColor:i.get("bottomPanel",e),width:"100%",height:"90vh"},confirmContainer:{position:"fixed",top:0,left:-10,bottom:0,width:"95vw",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,padding:"20px"},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}});function K(e){l.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),l.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Ee=(e,a)=>e==0?a==0?"нет тренировок":"no trainings":e==1?a==0?"1 тренировка":"1 training":e>1&&e<5?e+(a==0?" тренировки":" trainings"):e+(a==0?" тренировок":" trainings"),Z=e=>{const a=Math.floor(e/6e4),o=Math.floor(a/60)%24,u=a%60;return`${o.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};function Le(e,a){if(!e?.exercises)return a===0?"0 упр./ 0 подх.":"0 ex./ 0 sets";let o=0,u=0;for(const r of Object.values(e.exercises))o++,Array.isArray(r.sets)&&(u+=r.sets.length);return a===0?` / ${o} упр. / ${u} подх.`:` / ${o} ex. / ${u} sets`}export{Ke as default,Le as getTrainingSummary};
