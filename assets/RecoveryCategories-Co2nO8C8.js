import{A as T,a$ as et,t as Ge,l as Ke,f as _e,C as o,j as e,m as p,a as fe,h as tt,i as st,k as nt,bC as we,bD as ot,bE as it,bF as rt,bG as De,bH as at,g as vt,bI as wt,aY as Oe,_ as Ne,bJ as Ze,bK as kt,H as lt,bL as ct,M as dt,W as pt,bh as Ie,bM as zt,bN as It,U as Tt,p as Rt,bO as ge,bP as Ft,bQ as Bt,bR as $t,bS as Mt,bT as Dt,bU as At,bV as Wt}from"./index-BuO-3MTY.js";import{r as i,R as Pt}from"./recharts-Bg6K2Pzo.js";import{B as Et}from"./BreathAudio-BrJNN4AB.js";const xt=t=>new Date(t).toISOString().split("T")[0],ht=async(t,n)=>{const s=xt(t);T.meditationLog[s]||(T.meditationLog[s]=[]),T.meditationLog[s].push({startTime:t,endTime:n}),await et()},gt=async(t,n,s)=>{const l=xt(t);T.breathingLog[l]||(T.breathingLog[l]=[]),T.breathingLog[l].push({startTime:t,endTime:n,maxHold:s}),await et()},yt=async(t,n,s)=>{const l=xt(t);T.hardeningLog[l]||(T.hardeningLog[l]=[]),T.hardeningLog[l].push({startTime:t,endTime:n,timeInColdWater:s}),await et()},qe=[{level:["Для новичков","For beginners"],protocols:[{name:["Квадратное дыхание","Box Breathing"],aim:["Фокусировка, снятие стресса","Focus, stress relief"],instructions:["Медленно вдохните на счёт, задержите дыхание, выдохните на счёт, снова задержите дыхание. Повторяйте цикл.","Inhale slowly for a count, hold your breath, exhale for a count, then hold again. Repeat the cycle."],levels:[{cycles:6,strategy:"4-4-4-4",steps:[{in:4e3},{hold:4e3},{out:4e3},{hold:4e3}]},{cycles:8,strategy:"5-5-5-5",steps:[{in:5e3},{hold:5e3},{out:5e3},{hold:5e3}]},{cycles:10,strategy:"6-6-6-6",steps:[{in:6e3},{hold:6e3},{out:6e3},{hold:6e3}]}]},{name:["4–7–8 для расслабления","4–7–8 Relax"],aim:["Успокоение, сон","Calm, sleep"],instructions:["Вдохните через нос на 4 счёта, задержите дыхание на 7 счётов, затем медленно выдохните через рот на 8 счётов. Повторите.","Inhale through your nose for a count of 4, hold your breath for 7 counts, then exhale slowly through your mouth for 8 counts. Repeat."],levels:[{cycles:8,strategy:"4-7-8",steps:[{in:4e3},{hold:7e3},{out:8e3}]},{cycles:10,strategy:"5-8-9",steps:[{in:5e3},{hold:8e3},{out:9e3}]}]},{name:["Удлинённый выдох 1:2","Extended Exhale 1:2"],aim:["Снятие тревоги","Anxiety relief"],instructions:["Вдохните спокойно, затем выдыхайте в два раза дольше, чем вдыхали. Например: вдох — 3 с, выдох — 6 с.","Inhale gently, then exhale for twice as long as your inhale. For example: inhale for 3 seconds, exhale for 6 seconds."],levels:[{cycles:8,strategy:"3-6 (1:2)",steps:[{in:3e3},{out:6e3}]},{cycles:10,strategy:"4-8 (1:2)",steps:[{in:4e3},{out:8e3}]}]},{name:["Диафрагмальное дыхание","Diaphragmatic Breathing"],aim:["Базовый контроль дыхания","Basic breath control"],instructions:["Дышите глубоко через нос, надувая живот при вдохе и опуская его при выдохе. Следите, чтобы грудь почти не двигалась.","Breathe deeply through your nose, expanding your belly on the inhale and gently drawing it in on the exhale. Keep your chest still."],levels:[{cycles:10,strategy:"4-6",steps:[{in:4e3},{out:6e3}]},{cycles:12,strategy:"5-7",steps:[{in:5e3},{out:7e3}]}]}]},{level:["Для любителей","For amateurs"],protocols:[{name:["Резонансное дыхание","Resonant Breathing"],aim:["HRV, устойчивость к стрессу","HRV, stress resilience"],instructions:["Дышите ровно и спокойно, вдыхая и выдыхая на 6 секунд. Это уравновешивает сердечный ритм и активирует парасимпатическую нервную систему.","Breathe evenly and calmly, inhaling and exhaling for 6 seconds each. This balances heart rate variability and activates the parasympathetic nervous system."],levels:[{cycles:10,strategy:"6-6",steps:[{in:6e3},{out:6e3}]},{cycles:12,strategy:"5.5-5.5",steps:[{in:5500},{out:5500}]},{cycles:15,strategy:"7-7",steps:[{in:7e3},{out:7e3}]}]},{name:["Чередующееся дыхание","Alternate Nostril Breathing"],aim:["Баланс, концентрация","Balance, focus"],instructions:["Закройте правую ноздрю, вдохните через левую. Затем закройте левую, выдохните через правую. Повторите, чередуя ноздри.","Close your right nostril, inhale through the left. Then close the left nostril and exhale through the right. Alternate sides with each breath."],levels:[{cycles:8,strategy:"4-2-4 / 4-2-4",steps:[{in:4e3},{hold:2e3},{out:4e3},{in:4e3},{hold:2e3},{out:4e3}]},{cycles:10,strategy:"5-3-5 / 5-3-5",steps:[{in:5e3},{hold:3e3},{out:5e3},{in:5e3},{hold:3e3},{out:5e3}]}]},{name:["Физиологический вздох","Physiological Sigh"],aim:["Быстрое снижение стресса","Fast stress reduction"],instructions:["Сделайте короткий вдох через нос, сразу добавьте ещё один небольшой вдох, затем медленно и полностью выдохните через рот.","Take a short inhale through your nose, immediately follow with a second small inhale, then exhale slowly and fully through your mouth."],levels:[{cycles:3,strategy:"2+1-5",steps:[{in:2e3},{in:1e3},{out:5e3},{rest:2e4}]},{cycles:5,strategy:"2.5+1-6",steps:[{in:2500},{in:1e3},{out:6e3},{rest:2e4}]}]},{name:["Энергетическое дыхание с задержкой","Energizing Breathing with Hold"],aim:["Энергия, стрессоустойчивость","Energy, stress resilience"],instructions:["Выполните серию быстрых вдохов и выдохов, затем сделайте длинную задержку дыхания после выдоха. Завершите глубоким вдохом и замедленным выдохом.","Perform a series of rapid inhales and exhales, then hold your breath after a full exhale. Finish with a deep inhale and slow exhale."],levels:[{cycles:2,strategy:"15×(1.5-1.5) + 60s",steps:[...Array(15).fill(null).flatMap(()=>[{in:1500},{out:1500}]),{hold:6e4},{in:3e3},{hold:15e3},{out:3e3},{rest:3e4}]},{cycles:3,strategy:"20×(1.2-1.2) + 90s",steps:[...Array(20).fill(null).flatMap(()=>[{in:1200},{out:1200}]),{hold:9e4},{in:3e3},{hold:25e3},{out:3e3},{rest:45e3}]},{cycles:3,strategy:"25×(1.1-1.1) + 120s",steps:[...Array(25).fill(null).flatMap(()=>[{in:1100},{out:1100}]),{hold:12e4},{in:3e3},{hold:4e4},{out:3e3},{rest:6e4}]},{cycles:3,strategy:"30×(1.0-1.0) + 180s",steps:[...Array(30).fill(null).flatMap(()=>[{in:1e3},{out:1e3}]),{hold:18e4},{in:3e3},{hold:5e4},{out:3e3},{rest:6e4}]}]}]},{level:["Средний уровень","Intermediate"],protocols:[{name:["Треугольное дыхание","Triangle Breathing"],aim:["Баланс, концентрация","Balance, focus"],instructions:["Вдохните, задержите дыхание, затем выдохните — все три фазы одинаковой длительности. Представьте равносторонний треугольник.","Inhale, hold your breath, then exhale — all three phases of equal duration. Visualize an equilateral triangle."],levels:[{cycles:5,strategy:"6-6-6",steps:[{in:6e3},{hold:6e3},{out:6e3}]},{cycles:6,strategy:"7-7-7",steps:[{in:7e3},{hold:7e3},{out:7e3}]}]},{name:["Удлинённый выдох 2:1","2-to-1 Breathing"],aim:["Глубокое расслабление","Deep relaxation"],instructions:["Вдохните на короткое время, затем выдыхайте втрое дольше (например, 3 сек вдох, 9 сек выдох). Это активирует расслабление.","Inhale for a short duration, then exhale for triple the time (e.g., 3 seconds in, 9 seconds out). This strongly triggers relaxation."],levels:[{cycles:8,strategy:"3-9 (1:3)",steps:[{in:3e3},{out:9e3}]},{cycles:10,strategy:"4-12 (1:3)",steps:[{in:4e3},{out:12e3}]}]},{name:["Пульсирующее дыхание","Pulsed Breathing"],aim:["Расслабление, контроль дыхания","Relaxation, breath control"],instructions:["Сделайте несколько коротких выдохов на один вдох, затем задержите дыхание. Например: вдох на 3 сек, три коротких выдоха по 1.5 сек.","Take one long inhale, then break the exhale into several short pulses (e.g., 3 pulses of 1.5 sec each), followed by a brief hold."],levels:[{cycles:5,strategy:"5×(3-1.5) + 5s",steps:[...Array(5).fill(null).flatMap(()=>[{in:3e3},{out:1500}]),{hold:5e3}]},{cycles:6,strategy:"6×(2.5-1.25) + 6s",steps:[...Array(6).fill(null).flatMap(()=>[{in:2500},{out:1250}]),{hold:6e3}]}]}]},{level:["Для опытных","For advanced"],protocols:[{name:["Двухфазный вдох с задержкой","Two-Stage Inhale + Hold"],aim:["Контроль и выносливость","Control and endurance"],instructions:["Сделайте первый вдох до половины лёгких, затем второй — до полного объёма. Задержите, выдохните, и сделайте короткую паузу.","Inhale halfway, then top off your lungs with a second inhale. Hold, exhale fully, then pause briefly before the next cycle."],levels:[{cycles:5,strategy:"2.5+2.5-6-6-2",steps:[{in:2500},{in:2500},{hold:6e3},{out:6e3},{hold:2e3}]},{cycles:6,strategy:"3+3-8-8-3",steps:[{in:3e3},{in:3e3},{hold:8e3},{out:8e3},{hold:3e3}]}]},{name:["CO₂ толерантность","CO₂ Tolerance"],aim:["Толерантность к CO₂","CO₂ tolerance"],instructions:["Сделайте обычный вдох, затем задержите дыхание как можно дольше после выдоха. Это тренирует терпимость к углекислому газу.","Take a normal inhale, then hold your breath for an extended period after a full exhale. This trains CO₂ tolerance and breath-hold capacity."],levels:[{cycles:3,strategy:"3-30-5-10",steps:[{in:3e3},{hold:3e4},{out:5e3},{hold:1e4},{rest:45e3}]},{cycles:3,strategy:"3-45-6-15",steps:[{in:3e3},{hold:45e3},{out:6e3},{hold:15e3},{rest:6e4}]},{cycles:2,strategy:"3-60-7-20",steps:[{in:3e3},{hold:6e4},{out:7e3},{hold:2e4},{rest:9e4}]}]},{name:["Продвинутое резонансное дыхание","Advanced Resonant Breathing"],aim:["HRV, восстановление","HRV, recovery"],instructions:["Поддерживайте медленный, ровный ритм дыхания (5.5–6 сек на вдох и выдох) в течение длительного времени для глубокого восстановления.","Maintain a slow, steady breathing rhythm (5.5–6 seconds in, 5.5–6 seconds out) for an extended period to enhance deep recovery and HRV."],levels:[{cycles:15,strategy:"5.5-5.5",steps:[{in:5500},{out:5500}]},{cycles:18,strategy:"6-6",steps:[{in:6e3},{out:6e3}]}]}]}],Lt=[{level:["Для новичков","For beginners"],protocols:[{name:["Осознанное дыхание","Mindful Breathing"],aim:["Базовая осознанность, успокоение","Basic mindfulness, calming"],instructions:["Сядьте удобно, направьте внимание на дыхание. Замечайте вдох и выдох и мягко возвращайте внимание при отвлечении.","Sit comfortably and focus on your breath. Notice each inhale and exhale, gently returning attention when it wanders."],levels:[{strategy:"Короткая сессия для старта",cycles:1,steps:[{meditateSeconds:300,restSeconds:0}]},{strategy:"Стандартная сессия",cycles:1,steps:[{meditateSeconds:600,restSeconds:0}]},{strategy:"2 коротких подхода",cycles:2,steps:[{meditateSeconds:300,restSeconds:60}]}]},{name:["Сканирование тела","Body Scan"],aim:["Расслабление, контакт с телом","Relaxation, body awareness"],instructions:["Медленно проводите вниманием по телу от стоп до головы, замечая ощущения без оценки.","Slowly move your attention through the body from feet to head, noticing sensations without judging."],levels:[{strategy:"Краткое сканирование",cycles:1,steps:[{meditateSeconds:300,restSeconds:0}]},{strategy:"Более глубокое сканирование",cycles:1,steps:[{meditateSeconds:900,restSeconds:0}]}]}]},{level:["Для любителей","For amateurs"],protocols:[{name:["Концентрация на объекте","Focused Attention"],aim:["Концентрация, тренировка внимания","Focus, attention training"],instructions:["Удерживайте внимание на одном объекте (дыхание, звук, пламя), мягко возвращаясь при отвлечении.","Keep your attention on a single object (breath, sound, flame), gently returning when distracted."],levels:[{strategy:"1 блок средней длительности",cycles:1,steps:[{meditateSeconds:900,restSeconds:0}]},{strategy:"2 блока с коротким отдыхом",cycles:2,steps:[{meditateSeconds:600,restSeconds:60}]}]},{name:["Практика благодарности","Gratitude Meditation"],aim:["Позитивный настрой, настроение","Positive mindset, mood"],instructions:["Вспоминайте 3–5 вещей, за которые вы благодарны, стараясь прочувствовать это состояние.","Recall 3–5 things you feel grateful for and try to fully feel the gratitude."],levels:[{strategy:"Короткая практика",cycles:1,steps:[{meditateSeconds:300,restSeconds:0}]},{strategy:"Расширенная практика",cycles:1,steps:[{meditateSeconds:600,restSeconds:0}]}]}]},{level:["Средний уровень","Intermediate"],protocols:[{name:["Подсчёт дыханий","Breath Counting"],aim:["Устойчивое внимание","Stable attention"],instructions:["Считайте выдохи от 1 до 10, затем начинайте сначала. При потере счёта просто вернитесь к 1.","Count exhales from 1 to 10 and then start again. If you lose count, just return to 1."],levels:[{strategy:"Один длинный блок",cycles:1,steps:[{meditateSeconds:1200,restSeconds:0}]},{strategy:"Два блока с паузой",cycles:2,steps:[{meditateSeconds:600,restSeconds:120}]}]},{name:["Открытое наблюдение","Open Monitoring"],aim:["Широкая осознанность","Open awareness"],instructions:["Наблюдайте мысли, звуки и ощущения, не цепляясь и не оценивая.","Observe thoughts, sounds, and sensations without clinging or judging."],levels:[{strategy:"Средняя сессия",cycles:1,steps:[{meditateSeconds:900,restSeconds:0}]},{strategy:"Длинная сессия",cycles:1,steps:[{meditateSeconds:1500,restSeconds:0}]}]}]},{level:["Для опытных","For advanced"],protocols:[{name:["Глубокая одноточечная концентрация","Deep Single‑Point Focus"],aim:["Глубокое сосредоточение","Deep concentration"],instructions:["Поддерживайте устойчивый фокус на одном объекте длительное время.","Maintain a steady focus on a single object for an extended period."],levels:[{strategy:"Один длинный сет",cycles:1,steps:[{meditateSeconds:1800,restSeconds:0}]},{strategy:"2 интенсивных сета",cycles:2,steps:[{meditateSeconds:900,restSeconds:180}]}]},{name:["Комбинированная практика","Alternating Practices"],aim:["Глубокая тренировка ума","Deep mental training"],instructions:["Чередуйте фокус на дыхании, открытое наблюдение и доброжелательность в рамках одной сессии.","Alternate breath focus, open monitoring, and loving‑kindness within a single session."],levels:[{strategy:"3 блока по 10 минут",cycles:3,steps:[{meditateSeconds:600,restSeconds:60}]},{strategy:"3 блока по 15 минут",cycles:3,steps:[{meditateSeconds:900,restSeconds:90}]}]}]}],Ht=[{level:["Для новичков","For beginners"],protocols:[{name:["Контрастный душ с холодным финалом","Shower Finish Cold"],aim:["Мягкое знакомство с холодом","Gentle introduction to cold"],instructions:["Примите тёплый душ, затем завершите под холодной водой, сохраняя спокойное дыхание.","Take a warm shower, then finish under cold water while keeping your breathing calm."],levels:[{strategy:"Старт: короткий холодный финал",cycles:1,steps:[{hotSeconds:180,coldSeconds:30,restSeconds:0}]},{strategy:"Увеличение холодной фазы",cycles:1,steps:[{hotSeconds:180,coldSeconds:60,restSeconds:0}]},{strategy:"Продвинутый финал",cycles:1,steps:[{hotSeconds:180,coldSeconds:120,restSeconds:0}]}]},{name:["Чередование тёплой и холодной воды","Warm–Cold Alternating Shower"],aim:["Сосудистый тренинг, бодрость","Vascular training, alertness"],instructions:["Чередуйте тёплую и холодную воду короткими отрезками, всегда заканчивайте холодной.","Alternate warm and cold water in short intervals, always ending on cold."],levels:[{strategy:"2 цикла по 30 с",cycles:2,steps:[{hotSeconds:30,coldSeconds:30,restSeconds:0}]},{strategy:"3 цикла по 45–60 с",cycles:3,steps:[{hotSeconds:45,coldSeconds:45,restSeconds:0}]},{strategy:"4 цикла, финал дольше холод",cycles:4,steps:[{hotSeconds:45,coldSeconds:45,restSeconds:0}]}]}]},{level:["Для любителей","For amateurs"],protocols:[{name:["Полностью холодный душ","Full Cold Shower"],aim:["Стрессоустойчивость, энергия","Stress resilience, energy"],instructions:["Используйте только холодную воду, начиная с конечностей и переходя к корпусу, контролируя дыхание.","Use only cold water, starting with limbs and then torso while controlling your breath."],levels:[{strategy:"Короткий холодный душ",cycles:1,steps:[{hotSeconds:0,coldSeconds:60,restSeconds:0}]},{strategy:"Умеренный холодный душ",cycles:1,steps:[{hotSeconds:0,coldSeconds:120,restSeconds:0}]},{strategy:"Длинный холодный душ",cycles:1,steps:[{hotSeconds:0,coldSeconds:300,restSeconds:0}]}]},{name:["Холодный душ после разминки","Post‑Warmup Cold Shower"],aim:["Восстановление, психическая устойчивость","Recovery, mental resilience"],instructions:["После лёгкой разминки или тренировки примите холодный душ, избегая задержки дыхания.","After a light warm‑up or workout, take a cold shower while avoiding breath‑holding."],levels:[{strategy:"Короткий после тренировки",cycles:1,steps:[{hotSeconds:0,coldSeconds:90,restSeconds:0}]},{strategy:"Стандартный",cycles:1,steps:[{hotSeconds:0,coldSeconds:180,restSeconds:0}]},{strategy:"Удлинённый",cycles:1,steps:[{hotSeconds:0,coldSeconds:300,restSeconds:0}]}]}]},{level:["Средний уровень","Intermediate"],protocols:[{name:["Погружение в прохладную ванну","Cool Bath Immersion"],aim:["Глубжеe закаливание, восстановление","Deeper hardening, recovery"],instructions:["Погрузите тело до пояса или груди в прохладную воду. Оставайтесь на уровне, где можете спокойно дышать.","Immerse your body up to the waist or chest in cool water, staying at an intensity where you can breathe calmly."],levels:[{strategy:"Короткое погружение",cycles:1,steps:[{hotSeconds:0,coldSeconds:60,restSeconds:120}]},{strategy:"2 погружения",cycles:2,steps:[{hotSeconds:0,coldSeconds:90,restSeconds:180}]},{strategy:"Длинное погружение",cycles:1,steps:[{hotSeconds:0,coldSeconds:300,restSeconds:300}]}]},{name:["Тёплый душ → прохладная ванна","Warm‑Then‑Cool Bath"],aim:["Комфортная адаптация, расслабление","Comfortable adaptation, relaxation"],instructions:["Сначала согрейтесь под тёплым душем, затем перейдите в прохладную ванну и завершите сессию мягким согреванием.","First warm up under a warm shower, then move into a cool bath and finish with gentle rewarming."],levels:[{strategy:"Короткий переход",cycles:1,steps:[{hotSeconds:180,coldSeconds:60,restSeconds:180}]},{strategy:"Умеренный переход",cycles:1,steps:[{hotSeconds:180,coldSeconds:180,restSeconds:240}]},{strategy:"Углублённый переход",cycles:1,steps:[{hotSeconds:180,coldSeconds:300,restSeconds:300}]}]}]},{level:["Для опытных","For advanced"],protocols:[{name:["Холодный пландж / бочка","Cold Plunge / Tub"],aim:["Максимальная адаптация, сила воли","Max adaptation, willpower"],instructions:["Погружайтесь в очень холодную воду до груди или шеи. Сохраняйте спокойное дыхание и выходите до сильного онемения.","Immerse yourself in very cold water up to chest or neck. Keep breathing calmly and exit before intense numbness."],levels:[{strategy:"Стартовый пландж",cycles:1,steps:[{hotSeconds:0,coldSeconds:30,restSeconds:180}]},{strategy:"Умеренный пландж",cycles:1,steps:[{hotSeconds:0,coldSeconds:60,restSeconds:240}]},{strategy:"Продвинутый пландж",cycles:1,steps:[{hotSeconds:0,coldSeconds:180,restSeconds:300}]}]},{name:["Повторные короткие планджи","Repeated Short Plunges"],aim:["Тренировка нервной системы","Nervous system training"],instructions:["Делайте несколько коротких заходов в холодную воду с полным согреванием между циклами.","Do several short immersions in cold water with full rewarming between cycles."],levels:[{strategy:"2 коротких захода",cycles:2,steps:[{hotSeconds:0,coldSeconds:30,restSeconds:180}]},{strategy:"3 умеренных захода",cycles:3,steps:[{hotSeconds:0,coldSeconds:60,restSeconds:240}]},{strategy:"3 продвинутых захода",cycles:3,steps:[{hotSeconds:0,coldSeconds:120,restSeconds:300}]}]}]}],ut=(t,n,s,l)=>{T.recoveryProtocols[t][n][s][l]=!0},Vt="Audio/Ambient.wav",Ue=new Audio(Vt);Ue.loop=!0;Ue.volume=.4;const Ut=3e3,Ot=({show:t,setShow:n,protocol:s,protocolIndex:l,categoryIndex:a,isCustom:d=!1})=>{const[c,h]=i.useState(ft(a,l,d)),[r,w]=i.useState("dark"),[x,k]=i.useState(T.prefs[0]),[R,y]=i.useState(T.prefs[4]),[f,F]=i.useState(!1),{initAudio:C,playInhale:I,playExhale:L,playHold:m,playRest:g}=Et(f),[u,j]=i.useState(0),[A,b]=i.useState(0),[M,W]=i.useState(!1),[B,z]=i.useState(!1),[$,V]=i.useState(!1),[_,P]=i.useState(0),[le,re]=i.useState(!1),[Te,te]=i.useState(1),[ce,de]=i.useState(!1),[Z,Ce]=i.useState(""),ne=i.useRef(1),K=i.useRef(1),be=i.useRef(),pe=i.useRef(0),[Re,Ae]=i.useState(0),[xe,Fe]=i.useState(0),oe=i.useRef(0);i.useEffect(()=>{const D=Ge.subscribe(w),G=Ke.subscribe(ve=>k(ve==="ru"?0:1)),je=_e.subscribe(y);return()=>{D.unsubscribe(),G.unsubscribe(),je.unsubscribe()}},[]),i.useEffect(()=>{h(d?0:ft(a,l,d))},[s,l,a,d]),i.useEffect(()=>{if(!$){P(0);return}const D=Math.ceil(Ut/1e3);P(D);const G=setInterval(()=>{P(je=>je<=1?(clearInterval(G),Y(),V(!1),0):je-1)},1e3);return()=>clearInterval(G)},[$]),i.useEffect(()=>{u===0?K.current=1:K.current=ne.current,b(0),pe.current=0},[u]);const ee=i.useMemo(()=>s?.levels?.length?d?s.levels[0]:s.levels[c]||s.levels[0]:{cycles:1,steps:[{in:4e3},{out:4e3}]},[s,c,d]),me=i.useMemo(()=>{const D=[];for(let G=0;G<ee.cycles;G++)ee.steps.forEach(je=>D.push({...je,cycle:G}));return D},[ee]),U=me[u]||null,We=D=>D?D.in!==void 0?{name:x===0?"Вдох":"Inhale",color:"#00E5FF",secondary:"#2979FF",type:"in"}:D.out!==void 0?{name:x===0?"Выдох":"Exhale",color:"#00E676",secondary:"#00B0FF",type:"out"}:D.hold!==void 0?{name:x===0?"Задержка":"Hold",color:"#FFEA00",secondary:"#FF9100",type:"hold"}:D.rest!==void 0?{name:x===0?"Отдых":"Rest",color:"#B0BEC5",secondary:"#78909C",type:"rest"}:{name:"",color:"#fff",type:"none"}:{name:"",color:"#94a3b8",type:"none"},{name:ae,color:E,secondary:q,type:N}=We(U),X=U?U.in??U.out??U.hold??U.rest??1e3:1e3,H=()=>ee.steps?B?`${Math.floor(u/ee.steps.length)+1} / ${ee.cycles}`:"0":"0 / 0",Se=(X*(1-A)/1e3).toFixed(1);i.useEffect(()=>{if(!M||!U)return;const D=G=>{pe.current||(pe.current=G);const je=G-pe.current,ve=Math.min(je/X,1);b(ve);let $e;if(U.in!==void 0){const ye=K.current,Pe=1-Math.pow(1-ve,3);$e=ye+(1.6-ye)*Pe}else if(U.out!==void 0){const ye=K.current,Pe=ve<.5?2*ve*ve:1-Math.pow(-2*ve+2,2)/2;$e=ye+(1-ye)*Pe}else if(U.hold!==void 0){const ye=K.current,Pe=.03*Math.sin(2*Math.PI*.8*(je/1e3));$e=ye+Pe}else $e=1;if(ne.current=$e,te($e),ve>=1){const ye=u+1;if(ye>=me.length){W(!1),z(!0),Be();return}j(ye)}else be.current=requestAnimationFrame(D)};return be.current=requestAnimationFrame(D),()=>{be.current&&cancelAnimationFrame(be.current)}},[u,M,X,me.length]),i.useEffect(()=>{!M||!U||A<.02&&(U.in!==void 0?I():U.out!==void 0?L():U.hold!==void 0?m():U.rest!==void 0&&g(),T.prefs[3]==0&&window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light"))},[u,M,A,f]);const v=()=>{j(0),b(0),W(!1),z(!1),re(!1),pe.current=0,oe.current=0,ne.current=1,te(1),Ue.pause(),Ue.currentTime=0};i.useEffect(()=>{v()},[ee]);const Y=()=>{let D=0;ee.steps.forEach(G=>{G.hold!==void 0&&G.hold>D&&(D=G.hold)}),oe.current=D,C(),Ae(Date.now()),F(!0),z(!0),W(!0),re(!1)},se=()=>{Fe(Date.now()),W(!1),re(!0),Ue.pause()},ie=()=>{W(!0),re(!1)},ke=()=>{v()},Be=async()=>{d||ut(0,a,l,c),await gt(Re,Date.now(),oe.current),Ce(Gt(x)),de(!0)},ze=async()=>{await gt(Re,xe),v(),n(!1)},ue=o.get("mainText",r),he=o.get("subText",r),Ct=E||o.get("in",r);return e.jsxs("div",{style:Nt(r,t).container,children:[e.jsx(p.div,{animate:{background:B&&!ce?`radial-gradient(circle at 50% 50%, ${E}20 0%, ${q}10 40%, ${o.get("background",r)} 100%)`:`radial-gradient(circle at 50% 50%, ${o.get("background",r)} 100%, ${o.get("background",r)} 100%)`},transition:{duration:1.5},style:{position:"absolute",inset:0,zIndex:0}}),e.jsx("div",{style:{position:"absolute",inset:0,overflow:"hidden",pointerEvents:"none",zIndex:1},children:[...Array(6)].map((D,G)=>e.jsx(p.div,{animate:{y:[0,-100,0],x:[0,Math.random()*50-25,0],opacity:[.1,.3,.1]},transition:{duration:10+G*2,repeat:1/0,ease:"linear"},style:{position:"absolute",top:`${Math.random()*100}%`,left:`${Math.random()*100}%`,width:`${Math.random()*4+2}px`,height:`${Math.random()*4+2}px`,background:"#fff",borderRadius:"50%",filter:"blur(1px)"}},G))}),e.jsxs(fe,{mode:"wait",children:[!ce&&!B&&!$&&e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",height:"100%",padding:"40px 20px",boxSizing:"border-box",zIndex:10,position:"relative"},children:[e.jsxs("div",{style:{textAlign:"center",width:"100%",flexShrink:0,marginBottom:"20px"},children:[e.jsx("div",{style:{fontSize:"11px",color:he,letterSpacing:"2px",textTransform:"uppercase",marginBottom:"8px"},children:x===0?"Дыхание":"Breathwork"}),e.jsx("h2",{style:{fontSize:"28px",color:ue,margin:0,fontWeight:"300",fontFamily:"Segoe UI Light"},children:s.name[x]})]}),e.jsx("div",{style:{flex:1,width:"100%",maxWidth:"360px",overflowY:"auto",display:"flex",flexDirection:"column",scrollbarWidth:"none"},children:e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"30px",padding:"25px",display:"flex",flexDirection:"column",gap:"20px",boxShadow:"0 20px 50px -20px rgba(0,0,0,0.3)",marginBottom:"20px"},children:[e.jsxs("div",{style:{paddingBottom:"10px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{fontSize:"11px",color:he,marginBottom:"4px",fontWeight:"bold",textTransform:"uppercase"},children:x===0?"Цель":"Goal"}),e.jsx("div",{style:{fontSize:"15px",color:ue,lineHeight:"1.4"},children:s.aim[x]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"11px",color:he,fontWeight:"bold",textTransform:"uppercase"},children:x===0?"Уровень":"Level"}),e.jsx("span",{style:{fontSize:"11px",color:o.get("in",r),fontWeight:"bold"},children:Kt(a,l,c,d)?x===0?"ПРОЙДЕН":"DONE":""})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(0,0,0,0.2)",borderRadius:"50px",padding:"5px"},children:[e.jsx(Ee,{onClick:()=>h(D=>Math.max(0,D-1)),icon:e.jsx(tt,{size:12}),theme:r}),e.jsxs("span",{style:{fontSize:"20px",fontWeight:"600",color:ue,fontVariantNumeric:"tabular-nums"},children:[c+1," ",e.jsxs("span",{style:{fontSize:"12px",opacity:.5,fontWeight:"400"},children:["/ ",s.levels.length]})]}),e.jsx(Ee,{onClick:()=>h(D=>Math.min(s.levels.length-1,D+1)),icon:e.jsx(st,{size:12}),theme:r})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"9px",color:he,marginBottom:"2px",textTransform:"uppercase"},children:x===0?"СХЕМА":"RATIO"}),e.jsx("div",{style:{color:ue,fontWeight:"600",fontSize:"12px"},children:ee.strategy||"Custom"})]}),e.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"9px",color:he,marginBottom:"2px",textTransform:"uppercase"},children:x===0?"ЦИКЛЫ":"CYCLES"}),e.jsx("div",{style:{color:ue,fontWeight:"600",fontSize:"14px"},children:ee.cycles})]})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:he,marginBottom:"6px",fontWeight:"bold",textTransform:"uppercase"},children:[e.jsx(nt,{})," ",x===0?"Инструкция":"Instruction"]}),e.jsx("div",{style:{fontSize:"13px",color:ue,lineHeight:"1.4"},children:s.instructions[x]})]}),e.jsx("p",{style:{fontSize:"9px",color:he,textAlign:"center",opacity:.5,lineHeight:"1.3",margin:0},children:Yt(x)})]})}),e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",flexShrink:0},children:[e.jsxs(p.div,{whileTap:{scale:.9},onClick:()=>n(!1),style:{display:"flex",alignItems:"center",gap:"8px",color:he,cursor:"pointer"},children:[e.jsx(we,{size:24}),e.jsx("span",{style:{fontSize:"14px"},children:x===0?"Закрыть":"Close"})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>V(!0),style:{padding:"15px 45px",borderRadius:"50px",border:"none",background:o.get("in",r),color:"#fff",fontSize:"16px",fontWeight:"bold",boxShadow:`0 10px 40px -10px ${o.get("in",r)}60`},children:x===0?"Начать":"Start"})]})]},"menu"),!ce&&$&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",zIndex:10},children:[e.jsx(p.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0},style:{fontSize:"140px",fontWeight:"200",color:ue,fontFamily:"Segoe UI Light"},children:_},_),e.jsx("div",{style:{marginTop:"20px",fontSize:"16px",color:he,letterSpacing:"1px"},children:x===0?"ПРИГОТОВЬТЕСЬ...":"GET READY..."})]},"countdown"),!ce&&B&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",zIndex:10,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",textAlign:"center",width:"85%",color:ue,opacity:.8,fontSize:"16px",lineHeight:"1.4"},children:s?.instructions?.[x]}),e.jsxs("div",{style:{position:"relative",width:"340px",height:"340px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(p.div,{style:{width:"200px",height:"200px",borderRadius:"50%",border:`2px solid ${E}`,position:"absolute",transform:`scale(${Te})`}}),e.jsx(p.div,{style:{width:"180px",height:"180px",borderRadius:"50%",background:E,position:"absolute",opacity:.2,filter:"blur(30px)",transform:`scale(${Te})`}}),e.jsxs("div",{style:{position:"absolute",display:"flex",flexDirection:"column",alignItems:"center",zIndex:5},children:[e.jsx("div",{style:{fontSize:"72px",fontWeight:"200",color:ue,fontFamily:"Segoe UI Light",fontVariantNumeric:"tabular-nums",textShadow:`0 0 30px ${E}40`},children:Se}),e.jsx(p.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},style:{fontSize:"18px",color:E,textTransform:"uppercase",letterSpacing:"3px",fontWeight:"600"},children:ae},N)]})]}),e.jsxs("div",{style:{marginTop:"50px",fontSize:"14px",color:he,letterSpacing:"1px"},children:[x===0?"Цикл":"Cycle"," ",H()]}),e.jsxs("div",{style:{position:"absolute",bottom:"50px",display:"flex",gap:"30px",alignItems:"center"},children:[e.jsx(Ee,{onClick:()=>F(!f),icon:f?e.jsx(ot,{size:20}):e.jsx(it,{size:20}),theme:r,size:50}),e.jsx(Ee,{onClick:M?se:ie,icon:M?e.jsx(rt,{size:30}):e.jsx(De,{size:30,style:{marginLeft:"4px"}}),theme:r,size:80,accent:E}),e.jsx(Ee,{onClick:se,icon:e.jsx(we,{size:24}),theme:r,size:50})]}),e.jsx(fe,{children:le&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(15px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"30px",zIndex:20},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"300",color:"#fff",letterSpacing:"1px"},children:x===0?"ПАУЗА":"PAUSED"}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx(Xe,{onClick:ke,icon:e.jsx(we,{size:22}),label:x===0?"Выйти":"Exit",theme:r}),e.jsx(Xe,{onClick:ie,icon:e.jsx(De,{size:32,style:{marginLeft:"4px"}}),label:x===0?"Продолжить":"Resume",theme:r,type:"primary",accent:Ct,size:70}),e.jsx(Xe,{onClick:ze,icon:e.jsx(at,{size:22}),label:x===0?"Финиш":"Finish",theme:r})]})]})})]},"active"),ce&&e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"40px",zIndex:10},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:10,repeat:1/0,ease:"linear"},style:{width:"150px",height:"150px",borderRadius:"50%",border:`1px dashed ${o.get("in",r)}`,position:"absolute",top:-15,left:-15}}),e.jsx("img",{src:"images/Congrat.png",style:{width:"120px",height:"120px",borderRadius:"50%"},alt:"Done"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{style:{fontSize:"32px",color:ue,margin:"0 0 10px 0",fontWeight:"300"},children:x===0?"Дыхание восстановлено":"Breath Restored"}),e.jsx("p",{style:{width:"80%",color:he,fontSize:"16px",lineHeight:"1.6",margin:"0 auto"},children:Z})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>{de(!1),n(!1)},style:{padding:"15px 50px",borderRadius:"30px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",color:ue,fontSize:"16px",fontWeight:"500"},children:x===0?"В меню":"Done"})]},"finish")]})]})},Ee=({onClick:t,icon:n,theme:s,size:l=45,accent:a})=>e.jsx(p.button,{whileTap:{scale:.9},onClick:t,style:{width:l,height:l,borderRadius:"50%",border:"none",outline:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:a||(s==="dark"||s==="specialdark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"),color:a?"#fff":o.get("mainText",s),boxShadow:a?`0 8px 25px ${a}60`:"none"},children:n}),Xe=({onClick:t,icon:n,label:s,theme:l,type:a="secondary",accent:d,size:c=55})=>{const h=a==="primary";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[e.jsx(p.button,{whileTap:{scale:.92},onClick:t,style:{width:c,height:c,borderRadius:"50%",border:"none",outline:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:h?d||"#BF5AF2":l==="dark"||l==="specialdark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",color:h?"#fff":o.get("mainText",l),boxShadow:h?`0 8px 30px ${d||"#BF5AF2"}50`:"none",backdropFilter:"blur(5px)"},children:n}),s&&e.jsx("span",{style:{fontSize:"12px",color:o.get("subText",l),fontWeight:"600"},children:s})]})},Nt=(t,n)=>({container:{backgroundColor:o.get("background",t),position:"fixed",height:"86vh",transform:n?"translateY(0)":"translateY(100%)",bottom:"0",transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)",width:"100vw",fontFamily:"Segoe UI",borderTop:`1px solid ${o.get("border",t)}`,borderTopLeftRadius:"32px",borderTopRightRadius:"32px",zIndex:2e3,overflow:"hidden",boxShadow:"0 -20px 60px rgba(0,0,0,0.5)"}}),Yt=t=>t===0?"Внимание: Дыхательные практики — это инструмент поддержки. При головокружении остановитесь.":"Notice: Breathing exercises are a support tool. Stop if you feel dizzy.",Gt=t=>{const n={ru:["Дыхание спокойно.","Ум очищен.","Энергия восстановлена.","Гармония внутри."],en:["Breath is calm.","Mind is clear.","Energy restored.","Inner harmony."]},s=t===0?n.ru:n.en;return s[Math.floor(Math.random()*s.length)]},ft=(t,n,s)=>{if(s)return 0;let l=-1;const a=T.recoveryProtocols[0][t][n];for(let d=0;d<a.length;d++)if(!a[d]){l=d;break}return l>-1?l:a.length-1},Kt=(t,n,s,l)=>l?!1:T.recoveryProtocols[0][t][n][s],_t="Audio/Ambient.wav",Me=new Audio(_t);Me.loop=!0;Me.volume=.3;const qt=3e3,Xt=({show:t,setShow:n,protocol:s,protocolIndex:l,categoryIndex:a,isCustom:d=!1})=>{const[c,h]=i.useState("dark"),[r,w]=i.useState(T.prefs[0]),[x,k]=i.useState(T.prefs[4]),[R,y]=i.useState(!1),[f,F]=i.useState(bt(a,l,d)),[C,I]=i.useState(0),[L,m]=i.useState(0),[g,u]=i.useState(!1),[j,A]=i.useState(!1),[b,M]=i.useState(!1),[W,B]=i.useState(!1),[z,$]=i.useState(!1),[V,_]=i.useState(""),[P,le]=i.useState(0),[re,Te]=i.useState(0);i.useEffect(()=>{const N=Ge.subscribe(h),X=Ke.subscribe(O=>w(O==="ru"?0:1)),H=_e.subscribe(k);return()=>{N.unsubscribe(),X.unsubscribe(),H.unsubscribe()}},[]),i.useEffect(()=>{F(d?0:bt(a,l,d))},[s,l,a,d]);const te=i.useMemo(()=>s?.levels?.length?d?s.levels[0]:s.levels[f]||s.levels[0]:{cycles:1,steps:[{meditateSeconds:300,restSeconds:0}]},[s,f,d]),ce=i.useMemo(()=>{const{cycles:N,steps:X}=te;if(!X?.length)return[{type:"meditate",duration:3e5,cycle:0}];const{meditateSeconds:H,restSeconds:O}=X[0],Se=[];for(let v=0;v<N;v++)Se.push({type:"meditate",duration:H*1e3,cycle:v}),O>0&&v<N-1&&Se.push({type:"rest",duration:O*1e3,cycle:v});return Se.length>0?Se:[{type:"meditate",duration:3e5,cycle:0}]},[te]),de=ce[C]||null,Z=de?.duration||1e3;i.useEffect(()=>{I(0),m(0),u(!1),A(!1),B(!1),$(!1)},[te]),i.useEffect(()=>{if(!g||!de)return;const N=setInterval(()=>{m(X=>{const H=X+100;if(H>=Z){const O=C+1;if(O>=ce.length)u(!1),U();else return I(O),0}return H})},100);return()=>clearInterval(N)},[g,C,Z,ce.length]),i.useEffect(()=>{R&&g&&Me.paused?Me.play():Me.pause()},[g,R]);const[Ce,ne]=i.useState(0);i.useEffect(()=>{if(!b){ne(0);return}const N=Math.ceil(qt/1e3);ne(N);const X=setInterval(()=>{ne(H=>H<=1?(clearInterval(X),Fe(),M(!1),0):H-1)},1e3);return()=>clearInterval(X)},[b]);const K=de?.type==="rest"?{name:r===0?"Отдых":"Rest",color:"#A0AEC0"}:{name:r===0?"Медитация":"Meditate",color:o.get("meditate",c)},be=()=>{if(!te.steps)return"0/0";const N=te.steps[0].restSeconds>0?2:1;return`${Math.floor(C/N)+1} / ${te.cycles}`},pe=Math.max(0,Z-L),Re=Math.floor(pe/1e3),Ae=`${Math.floor(Re/60).toString().padStart(2,"0")}:${(Re%60).toString().padStart(2,"0")}`,xe=de?L/de.duration:0,Fe=()=>{y(!0),le(Date.now()),A(!0),u(!0),B(!1)},oe=()=>{Te(Date.now()),u(!1),B(!0),Me.pause()},ee=()=>{u(!0),B(!1)},me=()=>{I(0),m(0),u(!1),A(!1),B(!1),$(!1)},U=async()=>{d||ut(1,a,l,f),await ht(P,Date.now()),_(Zt(r)),$(!0)},We=async()=>{await ht(P,re),me(),n(!1)},ae=o.get("meditate",c),E=o.get("mainText",c),q=o.get("subText",c);return e.jsxs("div",{style:Jt(c,t).container,children:[e.jsxs("div",{style:{position:"absolute",inset:0,overflow:"hidden",pointerEvents:"none"},children:[e.jsx(p.div,{animate:{x:[0,50,-50,0],y:[0,-50,50,0],scale:[1,1.2,.9,1]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{position:"absolute",top:"-10%",left:"-10%",width:"600px",height:"600px",background:`radial-gradient(circle, ${ae}30 0%, transparent 70%)`,filter:"blur(60px)",opacity:.6}}),e.jsx(p.div,{animate:{x:[0,-30,30,0],y:[0,30,-30,0],scale:[1,1.1,1]},transition:{duration:15,repeat:1/0,ease:"linear",delay:2},style:{position:"absolute",bottom:"-10%",right:"-10%",width:"500px",height:"500px",background:"radial-gradient(circle, #4DFF8820 0%, transparent 70%)",filter:"blur(50px)",opacity:.5}})]}),e.jsxs(fe,{mode:"wait",children:[!z&&!j&&!b&&e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",width:"100%",height:"100%",padding:"40px 20px",boxSizing:"border-box",zIndex:10},children:[e.jsxs("div",{style:{textAlign:"center",width:"100%"},children:[e.jsx("div",{style:{fontSize:"12px",color:q,letterSpacing:"2px",textTransform:"uppercase",marginBottom:"8px"},children:r===0?"Протокол":"Protocol"}),e.jsx("h2",{style:{fontSize:"32px",color:E,margin:0,fontWeight:"300",fontFamily:"Segoe UI Light, sans-serif"},children:s.name[r]})]}),e.jsxs("div",{style:{width:"100%",maxWidth:"360px",background:"rgba(255,255,255,0.03)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"30px",padding:"25px",display:"flex",flexDirection:"column",gap:"20px",boxShadow:"0 20px 50px -20px rgba(0,0,0,0.3)",overflowY:"auto",maxHeight:"55vh"},children:[e.jsxs("div",{style:{paddingBottom:"10px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{fontSize:"11px",color:q,marginBottom:"4px",fontWeight:"bold",textTransform:"uppercase"},children:r===0?"Цель":"Goal"}),e.jsx("div",{style:{fontSize:"15px",color:E,lineHeight:"1.4"},children:s.aim[r]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"11px",color:q,fontWeight:"bold",textTransform:"uppercase"},children:r===0?"Уровень":"Level"}),e.jsx("span",{style:{fontSize:"11px",color:ae,fontWeight:"bold"},children:es(a,l,f,d)?r===0?"ПРОЙДЕН":"COMPLETED":""})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(0,0,0,0.2)",borderRadius:"50px",padding:"5px"},children:[e.jsx(Le,{onClick:()=>F(N=>Math.max(0,N-1)),icon:e.jsx(tt,{size:12}),theme:c}),e.jsxs("span",{style:{fontSize:"20px",fontWeight:"600",color:E,fontVariantNumeric:"tabular-nums"},children:[f+1," ",e.jsxs("span",{style:{fontSize:"12px",opacity:.5,fontWeight:"400"},children:["/ ",s.levels.length]})]}),e.jsx(Le,{onClick:()=>F(N=>Math.min(s.levels.length-1,N+1)),icon:e.jsx(st,{size:12}),theme:c})]})]}),e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[e.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:q,marginBottom:"2px"},children:r===0?"ВРЕМЯ":"TIME"}),e.jsxs("div",{style:{color:E,fontWeight:"600"},children:[Math.floor(te.steps[0].meditateSeconds*te.cycles/60)," min"]})]}),e.jsxs("div",{style:{flex:1,background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:q,marginBottom:"2px"},children:r===0?"ЦИКЛЫ":"CYCLES"}),e.jsx("div",{style:{color:E,fontWeight:"600"},children:te.cycles})]})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:q,marginBottom:"6px",fontWeight:"bold",textTransform:"uppercase"},children:[e.jsx(nt,{})," ",r===0?"Инструкция":"Instruction"]}),e.jsx("div",{style:{fontSize:"14px",color:E,lineHeight:"1.4"},children:s.instructions[r]})]}),e.jsx("p",{style:{fontSize:"10px",color:q,textAlign:"center",opacity:.6,lineHeight:"1.3",margin:0},children:Qt(r)})]}),e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 10px"},children:[e.jsxs(p.div,{whileTap:{scale:.9},onClick:()=>n(!1),style:{display:"flex",alignItems:"center",gap:"8px",color:q,cursor:"pointer"},children:[e.jsx(we,{size:24}),e.jsx("span",{style:{fontSize:"14px"},children:r===0?"Закрыть":"Close"})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>M(!0),style:{padding:"15px 40px",borderRadius:"50px",border:"none",background:ae,color:"#fff",fontSize:"16px",fontWeight:"bold",boxShadow:`0 10px 30px -5px ${ae}60`},children:r===0?"Начать":"Start"})]})]},"menu"),!z&&b&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",zIndex:10},children:[e.jsx(p.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0},style:{fontSize:"140px",fontWeight:"200",color:E,fontFamily:"Segoe UI Light"},children:Ce},Ce),e.jsx("div",{style:{marginTop:"20px",fontSize:"16px",color:q,letterSpacing:"1px"},children:r===0?"Приготовьтесь...":"Get ready..."})]},"countdown"),!z&&j&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",zIndex:10,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",textAlign:"center",width:"80%",color:E,opacity:.8,fontSize:"16px",lineHeight:"1.4"},children:s?.instructions?.[r]}),e.jsxs("div",{style:{position:"relative",width:"320px",height:"320px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(p.div,{animate:{scale:[1,1.05,1],opacity:[.3,.5,.3]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},style:{position:"absolute",inset:0,borderRadius:"50%",background:`radial-gradient(circle, ${K.color} 0%, transparent 60%)`,filter:"blur(30px)"}}),e.jsxs("svg",{width:"320",height:"320",style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:"160",cy:"160",r:"140",fill:"none",stroke:o.get("border",c),strokeWidth:"2",opacity:"0.2"}),e.jsx("circle",{cx:"160",cy:"160",r:"140",fill:"none",stroke:K.color,strokeWidth:"3",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*140}`,strokeDashoffset:`${2*Math.PI*140*(1-xe)}`,style:{transition:"stroke-dashoffset 0.1s linear",filter:`drop-shadow(0 0 8px ${K.color})`}})]}),e.jsxs("div",{style:{position:"absolute",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"64px",fontWeight:"200",color:E,fontFamily:"Segoe UI Light",fontVariantNumeric:"tabular-nums"},children:Ae}),e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{fontSize:"14px",color:K.color,textTransform:"uppercase",letterSpacing:"2px",fontWeight:"bold"},children:K.name},K.name)]})]}),e.jsxs("div",{style:{marginTop:"40px",fontSize:"14px",color:q},children:[r===0?"Цикл":"Cycle"," ",be()]}),e.jsxs("div",{style:{position:"absolute",bottom:"50px",display:"flex",gap:"30px",alignItems:"center"},children:[e.jsx(Le,{onClick:()=>y(!R),icon:R?e.jsx(ot,{size:20}):e.jsx(it,{size:20}),theme:c,size:50}),e.jsx(Le,{onClick:g?oe:ee,icon:g?e.jsx(rt,{size:30}):e.jsx(De,{size:30,style:{marginLeft:"4px"}}),theme:c,size:80,accent:K.color}),e.jsx(Le,{onClick:oe,icon:e.jsx(we,{size:24}),theme:c,size:50})]}),e.jsx(fe,{children:W&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(15px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"30px",zIndex:20},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"300",color:"#fff",letterSpacing:"1px"},children:r===0?"ПАУЗА":"PAUSED"}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsxs("div",{onClick:me,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",border:"1px solid rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:e.jsx(we,{size:24})}),e.jsx("span",{style:{fontSize:"12px",color:"#fff"},children:r===0?"Выйти":"Exit"})]}),e.jsxs("div",{onClick:ee,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:ae,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",boxShadow:`0 0 20px ${ae}60`},children:e.jsx(De,{size:24})}),e.jsx("span",{style:{fontSize:"12px",color:"#fff"},children:r===0?"Далее":"Resume"})]}),e.jsxs("div",{onClick:We,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",border:"1px solid rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:e.jsx(at,{size:24})}),e.jsx("span",{style:{fontSize:"12px",color:"#fff"},children:r===0?"Финиш":"Finish"})]})]})]})})]},"active"),z&&e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"40px",zIndex:10},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:10,repeat:1/0,ease:"linear"},style:{width:"150px",height:"150px",borderRadius:"50%",border:`1px dashed ${ae}`,position:"absolute",top:-15,left:-15}}),e.jsx("img",{src:"images/Congrat.png",style:{width:"120px",height:"120px",borderRadius:"50%"},alt:"Done"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{style:{fontSize:"32px",color:E,margin:"0 0 10px 0",fontWeight:"300"},children:r===0?"Сессия завершена":"Session Complete"}),e.jsx("p",{style:{width:"80%",color:q,fontSize:"16px",lineHeight:"1.6",margin:"0 auto"},children:V})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>{$(!1),n(!1)},style:{padding:"15px 50px",borderRadius:"30px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",color:E,fontSize:"16px",fontWeight:"500"},children:r===0?"В меню":"Done"})]},"finish")]})]})},Le=({onClick:t,icon:n,theme:s,size:l=45,accent:a})=>e.jsx(p.button,{whileTap:{scale:.9},onClick:t,style:{width:l,height:l,borderRadius:"50%",border:"none",outline:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:a||(s==="dark"||s==="specialdark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"),color:a?"#fff":o.get("mainText",s),boxShadow:a?`0 8px 25px ${a}60`:"none"},children:n}),Jt=(t,n)=>({container:{backgroundColor:o.get("background",t),position:"fixed",height:"86vh",transform:n?"translateY(0)":"translateY(100%)",bottom:"0",transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)",width:"100vw",fontFamily:"Segoe UI",borderTop:`1px solid ${o.get("border",t)}`,borderTopLeftRadius:"32px",borderTopRightRadius:"32px",zIndex:2e3,overflow:"hidden",boxShadow:"0 -20px 60px rgba(0,0,0,0.5)"},decorLayer:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),Qt=t=>t===0?"Внимание: медитация предназначена для поддержки общего благополучия и не заменяет медицинскую помощь. При наличии психических, неврологических или сердечно-сосудистых заболеваний, при беременности или ухудшении самочувствия прекратите практику и при необходимости обратитесь к врачу.":"Notice: Meditation is intended to support general well-being and is not a substitute for medical care. If you have mental health, neurological, or cardiovascular conditions, are pregnant, or feel unwell, please stop the practice and consult a healthcare professional if needed.",Zt=t=>{const n={ru:["Чистое сознание.","Гармония внутри.","Спокойствие ума.","Момент тишины."],en:["Pure awareness.","Inner harmony.","Calm mind.","A moment of peace."]},s=t===0?n.ru:n.en;return s[Math.floor(Math.random()*s.length)]},bt=(t,n,s)=>{if(s)return 0;let l=-1;const a=T.recoveryProtocols[1][t][n];for(let d=0;d<a.length;d++)if(!a[d]){l=d;break}return l>-1?l:a.length-1},es=(t,n,s,l)=>l?!1:T.recoveryProtocols[1][t][n][s],ts=3e3,ss=({show:t,setShow:n,protocol:s,protocolIndex:l,categoryIndex:a,isCustom:d=!1})=>{const[c,h]=i.useState("dark"),[r,w]=i.useState(T.prefs[0]),[x,k]=i.useState(T.prefs[4]),[R,y]=i.useState(!1),[f,F]=i.useState(mt(a,l,d)),[C,I]=i.useState(0),[L,m]=i.useState(0),[g,u]=i.useState(!1),[j,A]=i.useState(!1),[b,M]=i.useState(!1),[W,B]=i.useState(!1),[z,$]=i.useState(!1),[V,_]=i.useState(""),P=i.useRef(0),le=i.useRef(),re=i.useRef(0),[Te,te]=i.useState(0),[ce,de]=i.useState(0);i.useEffect(()=>{const v=Ge.subscribe(h),Y=Ke.subscribe(ie=>w(ie==="ru"?0:1)),se=_e.subscribe(k);return()=>{v.unsubscribe(),Y.unsubscribe(),se.unsubscribe()}},[]),i.useEffect(()=>{F(d?0:mt(a,l,d))},[s,l,a,d]);const Z=i.useMemo(()=>s?.levels?.length?d?s.levels[0]:s.levels[f]||s.levels[0]:{cycles:1,steps:[{hotSeconds:180,coldSeconds:30,restSeconds:0}]},[s,f,d]),Ce=i.useMemo(()=>{const{cycles:v,steps:Y}=Z;if(!Y?.length)return[];const{hotSeconds:se,coldSeconds:ie,restSeconds:ke}=Y[0],Be=[];for(let ze=0;ze<v;ze++)se>0&&Be.push({type:"hot",duration:se*1e3,cycle:ze}),ie>0&&Be.push({type:"cold",duration:ie*1e3,cycle:ze}),ke>0&&ze<v-1&&Be.push({type:"rest",duration:ke*1e3,cycle:ze});return Be},[Z]),ne=Ce[C]||null,K=ne?.duration||1e3;i.useEffect(()=>{I(0),m(0),u(!1),A(!1),B(!1),$(!1),re.current=0,P.current=0},[Z]),i.useEffect(()=>{if(!g||!ne)return;const v=Y=>{P.current||(P.current=Y);const se=Y-P.current,ie=Math.min(se/K,1);if(m(ie),ie>=1){ne.type==="cold"&&(re.current+=ne.duration);const ke=C+1;ke>=Ce.length?(u(!1),de(Date.now()),N()):(I(ke),P.current=0)}else le.current=requestAnimationFrame(v)};return le.current=requestAnimationFrame(v),()=>{le.current&&cancelAnimationFrame(le.current)}},[C,g,K,Ce.length]);const[be,pe]=i.useState(0);i.useEffect(()=>{if(!b){pe(0);return}const v=Math.ceil(ts/1e3);pe(v);const Y=setInterval(()=>{pe(se=>se<=1?(clearInterval(Y),We(),M(!1),0):se-1)},1e3);return()=>clearInterval(Y)},[b]);const Re=v=>v?v.type==="hot"?{name:r===0?"Тепло":"Warm",color:"#FF5722",secondary:"#FF9100",type:"hot"}:v.type==="cold"?{name:r===0?"Холод":"Cold",color:"#00E5FF",secondary:"#2979FF",type:"cold"}:v.type==="rest"?{name:r===0?"Отдых":"Rest",color:"#B0BEC5",secondary:"#78909C",type:"rest"}:{name:"",color:"#fff",type:"none"}:{name:"",color:"#94a3b8",type:"none"},{name:Ae,color:xe,secondary:Fe,type:oe}=Re(ne),ee=()=>{if(!Z.steps)return"0 / 0";const{hotSeconds:v,coldSeconds:Y,restSeconds:se}=Z.steps[0],ie=(v>0?1:0)+(Y>0?1:0)+(se>0?1:0);return`${ie?Math.floor(C/ie)+1:1} / ${Z.cycles}`},me=K*(1-L),U=`${Math.floor(me/6e4).toString().padStart(2,"0")}:${Math.floor(me%6e4/1e3).toString().padStart(2,"0")}`,We=()=>{y(!0),te(Date.now()),A(!0),u(!0),B(!1)},ae=()=>{de(Date.now()),u(!1),B(!0),audio.pause()},E=()=>{u(!0),B(!1)},q=()=>{I(0),m(0),u(!1),A(!1),B(!1),$(!1),re.current=0,P.current=0},N=async()=>{d||ut(2,a,l,f),await yt(Te,Date.now(),re.current),_(rs(r)),$(!0)},X=async()=>{await yt(Te,ce,re.current),q(),n(!1)},H=o.get("mainText",c),O=o.get("subText",c),Se=xe||o.get("cold",c);return e.jsxs("div",{style:ns(c,t).container,children:[e.jsx(p.div,{animate:{background:j&&!z?`linear-gradient(180deg, ${xe}40 0%, ${Fe}10 100%)`:`linear-gradient(180deg, ${o.get("background",c)} 0%, ${o.get("background",c)} 100%)`},transition:{duration:1},style:{position:"absolute",inset:0,zIndex:0}}),e.jsxs("div",{style:{position:"absolute",inset:0,overflow:"hidden",pointerEvents:"none",zIndex:1},children:[oe==="hot"&&[...Array(10)].map((v,Y)=>e.jsx(p.div,{initial:{y:"110%",opacity:0},animate:{y:"-10%",opacity:[0,.8,0],x:Math.random()*100-50},transition:{duration:Math.random()*2+3,repeat:1/0,ease:"linear",delay:Math.random()*2},style:{position:"absolute",left:`${Math.random()*100}%`,width:"4px",height:"4px",background:"#FFC107",borderRadius:"50%",filter:"blur(1px)"}},`hot-${Y}`)),oe==="cold"&&[...Array(10)].map((v,Y)=>e.jsx(p.div,{initial:{y:"-10%",opacity:0},animate:{y:"110%",opacity:[0,.8,0],x:Math.random()*50-25},transition:{duration:Math.random()*3+2,repeat:1/0,ease:"linear",delay:Math.random()*2},style:{position:"absolute",left:`${Math.random()*100}%`,width:"6px",height:"6px",background:"#E0F7FA",borderRadius:"50%",filter:"blur(1px)"}},`cold-${Y}`))]}),e.jsxs(fe,{mode:"wait",children:[!z&&!j&&!b&&e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{position:"absolute",inset:0,zIndex:10,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"40px 20px 100px 20px",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"25px",width:"100%"},children:[e.jsx("div",{style:{fontSize:"11px",color:O,letterSpacing:"2px",textTransform:"uppercase",marginBottom:"8px"},children:r===0?"Контраст":"Contrast"}),e.jsx("h2",{style:{fontSize:"28px",color:H,margin:0,fontWeight:"300",fontFamily:"Segoe UI Light"},children:s.name[r]})]}),e.jsxs("div",{style:{width:"100%",maxWidth:"360px",background:"rgba(255,255,255,0.03)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"30px",padding:"25px",display:"flex",flexDirection:"column",gap:"20px",boxShadow:"0 20px 50px -20px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{paddingBottom:"10px",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{fontSize:"11px",color:O,marginBottom:"4px",fontWeight:"bold",textTransform:"uppercase"},children:r===0?"Цель":"Goal"}),e.jsx("div",{style:{fontSize:"15px",color:H,lineHeight:"1.4"},children:s.aim[r]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"11px",color:O,fontWeight:"bold",textTransform:"uppercase"},children:r===0?"Уровень":"Level"}),e.jsx("span",{style:{fontSize:"11px",color:o.get("cold",c),fontWeight:"bold"},children:os(a,l,f,d)?r===0?"ПРОЙДЕН":"DONE":""})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(0,0,0,0.2)",borderRadius:"50px",padding:"5px"},children:[e.jsx(He,{onClick:()=>F(v=>Math.max(0,v-1)),icon:e.jsx(tt,{size:12}),theme:c}),e.jsxs("span",{style:{fontSize:"20px",fontWeight:"600",color:H,fontVariantNumeric:"tabular-nums"},children:[f+1," ",e.jsxs("span",{style:{fontSize:"12px",opacity:.5,fontWeight:"400"},children:["/ ",s.levels.length]})]}),e.jsx(He,{onClick:()=>F(v=>Math.min(s.levels.length-1,v+1)),icon:e.jsx(st,{size:12}),theme:c})]})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:o.get("hot",c)},children:[e.jsx(vt,{size:14})," ",e.jsxs("span",{style:{fontSize:"15px",fontWeight:"bold"},children:[Z.steps[0].hotSeconds/60,"m"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:o.get("cold",c)},children:[e.jsx(wt,{size:14})," ",e.jsxs("span",{style:{fontSize:"15px",fontWeight:"bold"},children:[Z.steps[0].coldSeconds,"s"]})]})]}),e.jsxs("div",{style:{fontSize:"11px",color:O,textAlign:"center",textTransform:"uppercase",letterSpacing:"1px"},children:[Z.cycles," ",r===0?"циклов":"cycles"]})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",borderRadius:"15px",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:O,marginBottom:"6px",fontWeight:"bold",textTransform:"uppercase"},children:[e.jsx(nt,{})," ",r===0?"Инструкция":"Instruction"]}),e.jsx("div",{style:{fontSize:"14px",color:H,lineHeight:"1.4"},children:s.instructions[r]})]}),e.jsx("p",{style:{fontSize:"10px",color:O,textAlign:"center",opacity:.5,lineHeight:"1.3",margin:0},children:is(r)})]})]}),e.jsxs("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",padding:"20px",boxSizing:"border-box",display:"flex",justifyContent:"space-between",alignItems:"center",background:`linear-gradient(to top, ${o.get("background",c)} 80%, transparent 100%)`,zIndex:20},children:[e.jsxs(p.div,{whileTap:{scale:.9},onClick:()=>n(!1),style:{display:"flex",alignItems:"center",gap:"8px",color:O,cursor:"pointer"},children:[e.jsx(we,{size:24}),e.jsx("span",{style:{fontSize:"14px"},children:r===0?"Закрыть":"Close"})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>M(!0),style:{padding:"15px 45px",borderRadius:"50px",border:"none",background:o.get("cold",c),color:"#fff",fontSize:"16px",fontWeight:"bold",boxShadow:`0 10px 40px -10px ${o.get("cold",c)}60`},children:r===0?"Начать":"Start"})]})]},"menu"),!z&&b&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",zIndex:10},children:[e.jsx(p.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.2,opacity:0},style:{fontSize:"140px",fontWeight:"200",color:H,fontFamily:"Segoe UI Light"},children:be},be),e.jsx("div",{style:{marginTop:"20px",fontSize:"16px",color:O,letterSpacing:"1px"},children:r===0?"ПРИГОТОВЬТЕСЬ...":"GET READY..."})]},"countdown"),!z&&j&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",zIndex:10,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",textAlign:"center",width:"85%",color:H,opacity:.8,fontSize:"16px",lineHeight:"1.4"},children:s?.instructions?.[r]}),e.jsxs("div",{style:{position:"relative",width:"340px",height:"340px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(p.div,{animate:oe==="hot"?{scale:[1,1.1,1],opacity:.8}:oe==="cold"?{x:[-2,2,-2],rotate:[0,1,-1,0]}:{scale:1},transition:oe==="hot"?{duration:4,repeat:1/0,ease:"easeInOut"}:{duration:.1,repeat:1/0},style:{width:"220px",height:"220px",borderRadius:"50%",background:`radial-gradient(circle at 30% 30%, ${xe} 0%, ${Fe} 100%)`,position:"absolute",boxShadow:`0 0 60px ${xe}60`}}),e.jsxs("svg",{width:"320",height:"320",style:{transform:"rotate(-90deg)",position:"absolute"},children:[e.jsx("circle",{cx:"160",cy:"160",r:"140",fill:"none",stroke:o.get("border",c),strokeWidth:"2",opacity:"0.2"}),e.jsx("circle",{cx:"160",cy:"160",r:"140",fill:"none",stroke:xe,strokeWidth:"4",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*140}`,strokeDashoffset:`${2*Math.PI*140*(1-L)}`,style:{transition:"stroke-dashoffset 0.1s linear",filter:`drop-shadow(0 0 10px ${xe})`}})]}),e.jsxs("div",{style:{position:"absolute",display:"flex",flexDirection:"column",alignItems:"center",zIndex:5},children:[e.jsx("div",{style:{fontSize:"72px",fontWeight:"200",color:"#fff",fontFamily:"Segoe UI Light",fontVariantNumeric:"tabular-nums",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:U}),e.jsx(p.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},style:{fontSize:"18px",color:"#fff",textTransform:"uppercase",letterSpacing:"2px",fontWeight:"bold"},children:Ae},oe)]})]}),e.jsxs("div",{style:{marginTop:"50px",fontSize:"14px",color:O,letterSpacing:"1px"},children:[r===0?"Цикл":"Cycle"," ",ee()]}),e.jsxs("div",{style:{position:"absolute",bottom:"50px",display:"flex",gap:"30px",alignItems:"center"},children:[e.jsx(He,{onClick:()=>y(!R),icon:R?e.jsx(ot,{size:20}):e.jsx(it,{size:20}),theme:c,size:50}),e.jsx(He,{onClick:g?ae:E,icon:g?e.jsx(rt,{size:30}):e.jsx(De,{size:30,style:{marginLeft:"4px"}}),theme:c,size:80,accent:xe}),e.jsx(He,{onClick:ae,icon:e.jsx(we,{size:24}),theme:c,size:50})]}),e.jsx(fe,{children:W&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(15px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"30px",zIndex:20},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"300",color:"#fff",letterSpacing:"1px"},children:r===0?"ПАУЗА":"PAUSED"}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx(Je,{onClick:q,icon:e.jsx(we,{size:22}),label:r===0?"Выйти":"Exit",theme:c}),e.jsx(Je,{onClick:E,icon:e.jsx(De,{size:32,style:{marginLeft:"4px"}}),label:r===0?"Продолжить":"Resume",theme:c,type:"primary",accent:Se,size:70}),e.jsx(Je,{onClick:X,icon:e.jsx(at,{size:22}),label:r===0?"Финиш":"Finish",theme:c})]})]})})]},"active"),z&&e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"40px",zIndex:10},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:10,repeat:1/0,ease:"linear"},style:{width:"150px",height:"150px",borderRadius:"50%",border:`1px dashed ${Se}`,position:"absolute",top:-15,left:-15}}),e.jsx("img",{src:"images/Congrat.png",style:{width:"120px",height:"120px",borderRadius:"50%"},alt:"Done"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{style:{fontSize:"32px",color:H,margin:"0 0 10px 0",fontWeight:"300"},children:r===0?"Закалка завершена":"Session Complete"}),e.jsx("p",{style:{width:"80%",color:O,fontSize:"16px",lineHeight:"1.6",margin:"0 auto"},children:V})]}),e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>{$(!1),n(!1)},style:{padding:"15px 50px",borderRadius:"30px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",color:H,fontSize:"16px",fontWeight:"500"},children:r===0?"В меню":"Done"})]},"finish")]})]})},He=({onClick:t,icon:n,theme:s,size:l=45,accent:a})=>e.jsx(p.button,{whileTap:{scale:.9},onClick:t,style:{width:l,height:l,borderRadius:"50%",border:"none",outline:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:a||(s==="dark"||s==="specialdark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"),color:a?"#fff":o.get("mainText",s),boxShadow:a?`0 8px 25px ${a}60`:"none"},children:n}),Je=({onClick:t,icon:n,label:s,theme:l,type:a="secondary",accent:d,size:c=55})=>{const h=a==="primary";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[e.jsx(p.button,{whileTap:{scale:.92},onClick:t,style:{width:c,height:c,borderRadius:"50%",border:"none",outline:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:h?d||"#BF5AF2":l==="dark"||l==="specialdark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",color:h?"#fff":o.get("mainText",l),boxShadow:h?`0 8px 30px ${d||"#BF5AF2"}50`:"none",backdropFilter:"blur(5px)"},children:n}),s&&e.jsx("span",{style:{fontSize:"12px",color:o.get("subText",l),fontWeight:"600"},children:s})]})},ns=(t,n)=>({container:{backgroundColor:o.get("background",t),position:"fixed",height:"86vh",transform:n?"translateY(0)":"translateY(100%)",bottom:"0",transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)",width:"100vw",fontFamily:"Segoe UI",borderTop:`1px solid ${o.get("border",t)}`,borderTopLeftRadius:"32px",borderTopRightRadius:"32px",zIndex:2e3,overflow:"hidden",boxShadow:"0 -20px 60px rgba(0,0,0,0.5)"}}),mt=(t,n,s)=>{if(s)return 0;let l=-1;const a=T.recoveryProtocols[2][t][n];for(let d=0;d<a.length;d++)if(!a[d]){l=d;break}return l>-1?l:a.length-1},os=(t,n,s,l)=>l?!1:T.recoveryProtocols[2][t][n][s],is=t=>t===0?"Внимание: Закаливание требует осторожности. Если вам стало плохо, немедленно прекратите и согрейтесь.":"Notice: Cold exposure requires caution. If you feel unwell, stop immediately and warm up.",rs=t=>{const n={ru:["Сила духа.","Энергия холода.","Иммунитет укреплен.","Ты справился!"],en:["Mental strength.","Cold energy.","Immunity boosted.","You did it!"]},s=t===0?n.ru:n.en;return s[Math.floor(Math.random()*s.length)]},as=({theme:t,langIndex:n,fSize:s,setProtocol:l,show:a,setShow:d,showTimer:c})=>{const[h,r]=i.useState([]),[w,x]=i.useState(1),[k,R]=i.useState(1),[y,f]=i.useState(!1);function F(){const g=[];h.forEach(b=>{const[M,W]=Object.entries(b)[0],z={вдох:"in",выдох:"out",задержка:"hold",отдых:"rest",inhale:"in",exhale:"out",hold:"hold",rest:"rest","вдох/выдох":"inout","inhale/exhale":"inout"}[M]||"rest",$=typeof W=="object"?W.duration:W,V=typeof W=="object"&&W.amount||1,_=Number($),P=Number(V);if(z==="inout")for(let le=0;le<P;le++)g.push({in:_}),g.push({out:_});else g.push({[z]:_})});const u=g.map(b=>{const[M,W]=Object.entries(b)[0];return{[M]:typeof W=="number"&&!isNaN(W)?W:4e3}}),j=u.map(b=>(b.in??b.out??b.hold??b.rest)/1e3).map(b=>b.toFixed(1)).join(","),A={name:n===0?["Своя сессия"]:["Custom session"],aim:n===0?["Фокус и расслабление"]:["Focus and relaxation"],instructions:n===0?["Дышите в ритме"]:["Breathe with the rhythm"],levels:[{cycles:Math.max(1,Number(w)),strategy:j,steps:u}]};l(A),f(!0),d(!1),c(!0)}function C(g){const u=[4e3,4e3,1500,4e3,2e3],A=[{0:"вдох",1:"выдох",2:"вдох/выдох",3:"задержка",4:"отдых"},{0:"inhale",1:"exhale",2:"inhale/exhale",3:"hold",4:"rest"}][n][g];let b;g===2?b={[A]:{duration:u[g],amount:1}}:b={[A]:u[g]},r(M=>[...M,b]),f(!0)}function I(g,u,j="duration"){r(A=>{const b=[...A],M={...b[g]},[W,B]=Object.entries(M)[0];let z;if(typeof B=="object"&&B!==null){z={...B};const $=u==="up"?j==="duration"?500:1:j==="duration"?-500:-1;let V=z[j]+$;j==="duration"?V=Math.min(3e5,Math.max(1e3,V)):j==="amount"&&(V=Math.max(1,V)),z[j]=V}else z=Math.min(3e5,Math.max(1e3,B+(u==="up"?500:-500)));return b[g]={[W]:z},b})}function L(g){r(u=>{const j=[...u];return j.splice(g,1),j}),h.length<=1&&f(!1)}const m={hidden:{y:"100%",opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{y:"100%",opacity:0}};return e.jsx(fe,{children:a&&e.jsx("div",{style:S(t).overlay,children:e.jsxs(p.div,{initial:"hidden",animate:"visible",exit:"exit",variants:m,style:S(t).panel,children:[e.jsxs("div",{style:S(t).header,children:[e.jsx("h2",{style:S(t).title,children:n===0?"Конструктор":"Constructor"}),e.jsxs("div",{style:S(t).cycleControl,children:[e.jsx("span",{style:S(t).subLabel,children:n===0?"Циклы":"Cycles"}),e.jsxs("div",{style:S(t).stepperContainer,children:[e.jsx("div",{onClick:()=>x(g=>Math.max(1,g-1)),style:S(t).stepperBtnSmall,children:e.jsx(Oe,{style:{color:o.get("icons",t),fontSize:"15px"}})}),e.jsx("span",{style:S(t).cycleValue,children:w}),e.jsx("div",{onClick:()=>x(g=>g+1),style:S(t).stepperBtnSmall,children:e.jsx(Ne,{style:{color:o.get("icons",t),fontSize:"15px"}})})]})]})]}),e.jsxs("div",{style:S(t).toolBar,children:[e.jsx(Ve,{theme:t,label:n===0?"Вдох":"Inhale",color:"#00E5FF",icon:e.jsx(Ze,{}),onClick:()=>C(0)}),e.jsx(Ve,{theme:t,label:n===0?"Выдох":"Exhale",color:"#00E676",icon:e.jsx(Ze,{style:{transform:"scaleX(-1)"}}),onClick:()=>C(1)}),e.jsx(Ve,{theme:t,label:n===0?"Пауза":"Hold",color:"#FFEA00",icon:e.jsx(kt,{}),onClick:()=>C(3)}),e.jsx(Ve,{theme:t,label:n===0?"Отдых":"Rest",color:"#c7c7c7",icon:e.jsx(lt,{}),onClick:()=>C(4)}),e.jsx(Ve,{theme:t,label:n===0?"Ритм":"Rhythm",color:"linear-gradient(135deg, #00E5FF 0%, #00E676 100%)",icon:e.jsx(ct,{}),onClick:()=>C(2)})]}),e.jsxs("div",{style:S(t).listContainer,children:[h.length===0&&e.jsx("div",{style:S(t).emptyState,children:n===0?"Добавьте шаги сверху":"Add breathing steps above"}),e.jsx(fe,{children:h.map((g,u)=>e.jsx(ls,{index:u,step:g,theme:t,fSize:s,onDelete:L,addTime:I,langIndex:n},u))})]}),e.jsxs("div",{style:S(t).footer,children:[e.jsx("div",{onClick:()=>d(!1),style:S(t).secondaryBtn,children:e.jsx(dt,{size:24})}),e.jsxs("button",{onClick:()=>y&&F(),style:{...S(t).primaryBtn,opacity:y?1:.5,cursor:y?"pointer":"not-allowed"},children:[e.jsx(pt,{size:24}),e.jsx("span",{style:{marginLeft:8},children:n===0?"Готово":"Done"})]})]})]})})})},Ve=({theme:t,label:n,color:s,icon:l,onClick:a})=>e.jsxs(p.button,{whileTap:{scale:.95},onClick:a,style:{...S(t).chip,background:s,color:"#0f0f0f"},children:[e.jsx("span",{style:{fontSize:"12px",marginRight:6},children:l}),n]}),ls=({index:t,step:n,theme:s,onDelete:l,addTime:a,langIndex:d})=>{const[c,h]=Object.entries(n)[0],r=c.includes("вдох/выдох")||c.includes("inhale/exhale"),w=Ie(()=>a(t,"up","duration")),x=Ie(()=>a(t,"down","duration")),k=Ie(()=>a(t,"up","amount")),R=Ie(()=>a(t,"down","amount"));let y=o.get("mainText",s);return(c.includes("вдох")||c.includes("inhale"))&&(y=o.get("in",s)),(c.includes("выдох")||c.includes("exhale"))&&(y=o.get("out",s)),(c.includes("задержка")||c.includes("hold"))&&(y=o.get("hold",s)),(c.includes("отдых")||c.includes("rest"))&&(y=o.get("rest",s)),r&&(y=o.get("reload",s)),e.jsxs(p.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-50},style:{...S(s).stepCard,borderLeft:`4px solid ${y}`},children:[e.jsxs("div",{style:S(s).stepHeader,children:[e.jsx("span",{style:{fontWeight:"600",color:y,textTransform:"capitalize"},children:c}),e.jsx("button",{onClick:()=>l(t),style:S(s).iconBtn,children:e.jsx(zt,{color:o.get("subText",s),size:20})})]}),e.jsxs("div",{style:S(s).stepControls,children:[e.jsxs("div",{style:S(s).controlGroup,children:[e.jsx("span",{style:S(s).controlLabel,children:d===0?"Время":"Time"}),e.jsxs("div",{style:S(s).stepper,children:[e.jsx("div",{...x,onClick:()=>a(t,"down","duration"),style:S(s).stepperBtn,children:e.jsx(Oe,{size:10})}),e.jsxs("span",{style:S(s).stepperValue,children:[r?(h.duration/1e3).toFixed(1):(h/1e3).toFixed(1),"s"]}),e.jsx("div",{...w,onClick:()=>a(t,"up","duration"),style:S(s).stepperBtn,children:e.jsx(Ne,{size:10})})]})]}),r&&e.jsxs("div",{style:S(s).controlGroup,children:[e.jsx("span",{style:S(s).controlLabel,children:d===0?"Раз":"Reps"}),e.jsxs("div",{style:S(s).stepper,children:[e.jsx("div",{...R,onClick:()=>a(t,"down","amount"),style:S(s).stepperBtn,children:e.jsx(Oe,{size:10})}),e.jsxs("span",{style:S(s).stepperValue,children:["x",h.amount]}),e.jsx("div",{...k,onClick:()=>a(t,"up","amount"),style:S(s).stepperBtn,children:e.jsx(Ne,{size:10})})]})]})]})]})},S=t=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",backdropFilter:"blur(5px)",zIndex:2900,display:"flex",justifyContent:"center",alignItems:"flex-end"},panel:{width:"100%",maxWidth:"500px",height:"85vh",backgroundColor:o.get("background",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px",display:"flex",flexDirection:"column",boxShadow:"0 -10px 30px rgba(0,0,0,0.2)",overflow:"hidden"},header:{padding:"20px 24px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${o.get("border",t)}40`},title:{margin:0,fontSize:"20px",color:o.get("mainText",t)},cycleControl:{display:"flex",flexDirection:"column",alignItems:"center"},subLabel:{fontSize:"10px",color:o.get("subText",t),marginBottom:4,textTransform:"uppercase",letterSpacing:1},stepperContainer:{display:"flex",alignItems:"center",backgroundColor:o.get("border",t),borderRadius:"20px",padding:"2px"},stepperBtnSmall:{width:"38px",height:"38px",borderRadius:"50%",border:"none",margin:"8px",backgroundColor:o.get("simplePanel",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},cycleValue:{margin:"0 10px",fontSize:"14px",fontWeight:"bold",color:o.get("mainText",t),minWidth:"16px",textAlign:"center"},toolBar:{padding:"16px",display:"flex",gap:"10px",overflowX:"scroll",borderBottom:`1px solid ${o.get("border",t)}20`},chip:{flex:"0 0 auto",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",outline:"none"},listContainer:{flex:1,overflowY:"auto",padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},emptyState:{textAlign:"center",color:o.get("subText",t),marginTop:"40px",opacity:.6,fontStyle:"italic"},stepCard:{backgroundColor:o.get("simplePanel",t),borderRadius:"12px",padding:"12px 16px",display:"flex",flexDirection:"column",gap:"10px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},stepHeader:{display:"flex",justifyContent:"space-between",alignItems:"center"},stepControls:{display:"flex",gap:"24px"},controlGroup:{display:"flex",flexDirection:"column",gap:"4px"},controlLabel:{fontSize:"10px",color:o.get("subText",t),marginLeft:"4px"},stepper:{display:"flex",alignItems:"center",backgroundColor:o.get("background",t),borderRadius:"8px",padding:"4px",border:`1px solid ${o.get("border",t)}40`},stepperBtn:{width:"32px",height:"32px",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:o.get("icons",t),backgroundColor:o.get("backgroundLight",t),userSelect:"none",active:{opacity:.7}},stepperValue:{minWidth:"50px",textAlign:"center",fontWeight:"bold",fontSize:"14px",color:o.get("mainText",t)},iconBtn:{background:"none",border:"none",cursor:"pointer",padding:4,opacity:.7,transition:"opacity 0.2s"},footer:{padding:"20px",borderTop:`1px solid ${o.get("border",t)}40`,display:"flex",gap:"16px",backgroundColor:o.get("background",t)},secondaryBtn:{width:"50px",height:"50px",borderRadius:"16px",border:"none",backgroundColor:o.get("skipped",t),color:o.get("mainText",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},primaryBtn:{flex:1,height:"50px",borderRadius:"16px",border:"none",backgroundColor:o.get("maxValColor",t),color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),cs=({theme:t,langIndex:n,fSize:s,setProtocol:l,show:a,setShow:d,showTimer:c})=>{const[h,r]=i.useState(300),[w,x]=i.useState(0),[k,R]=i.useState(1),y=(I,L,m=0,g=3600,u=30)=>{I(j=>{const A=j+L;return Math.min(g,Math.max(m,A))})},f=I=>{if(I===0)return n===0?"0 сек":"0s";if(I<60)return`${I} ${n===0?"сек":"s"}`;const L=Math.floor(I/60),m=I%60;return m>0?`${L} ${n===0?"мин":"m"} ${m}`:`${L} ${n===0?"мин":"m"}`},F=()=>{const I=n===0?`${f(h)} медитации${w>0?` + ${f(w)} отдыха`:""} ${k>1?`(×${k})`:""}`:`${f(h)} meditation${w>0?` + ${f(w)} rest`:""} ${k>1?`(×${k})`:""}`;l({name:n===0?["Своя медитация"]:["Custom meditation"],aim:n===0?["Осознанность и покой"]:["Mindfulness and peace"],instructions:n===0?["Дышите естественно, наблюдайте за мыслями."]:["Breathe naturally, observe your thoughts."],levels:[{cycles:k,strategy:I,steps:[{meditateSeconds:h,restSeconds:w}]}]}),d(!1),c(!0)},C={hidden:{y:"100%",opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{y:"100%",opacity:0}};return e.jsx(fe,{children:a&&e.jsx("div",{style:J(t).overlay,children:e.jsxs(p.div,{initial:"hidden",animate:"visible",exit:"exit",variants:C,style:J(t).panel,children:[e.jsxs("div",{style:J(t).header,children:[e.jsx("h2",{style:J(t).title,children:n===0?"Конструктор":"Constructor"}),e.jsx("div",{style:{width:40}})]}),e.jsxs("div",{style:J(t).listContainer,children:[e.jsx(Qe,{theme:t,label:n===0?"Медитация":"Meditate",value:f(h),icon:e.jsx(It,{}),color:"difficulty",onDec:()=>y(r,-30,30,3600),onInc:()=>y(r,30,30,3600)}),e.jsx(Qe,{theme:t,label:n===0?"Отдых":"Rest",value:f(w),icon:e.jsx(lt,{}),color:"difficulty2",onDec:()=>y(x,-30,0,1800),onInc:()=>y(x,30,0,1800)}),e.jsx(Qe,{theme:t,label:n===0?"Циклы":"Cycles",value:k,icon:e.jsx(ct,{}),color:"subText",onDec:()=>y(R,-1,1,10,1),onInc:()=>y(R,1,1,10,1)})]}),e.jsxs("div",{style:J(t).footer,children:[e.jsx("div",{onClick:()=>d(!1),style:J(t).secondaryBtn,children:e.jsx(dt,{size:24})}),e.jsxs("button",{onClick:F,style:J(t).primaryBtn,children:[e.jsx(pt,{size:24}),e.jsx("span",{style:{marginLeft:8},children:n===0?"Готово":"Done"})]})]})]})})})},Qe=({theme:t,label:n,value:s,icon:l,color:a,onDec:d,onInc:c})=>{const h=o.get(a,t),r=Ie(c),w=Ie(d);return e.jsxs("div",{style:{...J(t).card,borderLeft:`4px solid ${h}`},children:[e.jsxs("div",{style:J(t).cardHeader,children:[e.jsx("div",{style:{...J(t).iconBox,color:h,backgroundColor:h+"20"},children:l}),e.jsx("span",{style:J(t).label,children:n})]}),e.jsxs("div",{style:J(t).stepper,children:[e.jsx("button",{...w,onClick:d,style:J(t).stepperBtn,children:e.jsx(Oe,{size:12})}),e.jsx("span",{style:J(t).stepperValue,children:s}),e.jsx("button",{...r,onClick:c,style:J(t).stepperBtn,children:e.jsx(Ne,{size:12})})]})]})},J=t=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",backdropFilter:"blur(5px)",zIndex:2900,display:"flex",justifyContent:"center",alignItems:"flex-end"},panel:{width:"100%",maxWidth:"500px",backgroundColor:o.get("background",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px",display:"flex",flexDirection:"column",boxShadow:"0 -10px 30px rgba(0,0,0,0.2)",paddingBottom:"20px"},header:{padding:"24px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${o.get("border",t)}40`},title:{margin:0,fontSize:"20px",fontWeight:"bold",color:o.get("mainText",t)},listContainer:{padding:"24px",display:"flex",flexDirection:"column",gap:"16px",overflowY:"auto"},card:{backgroundColor:o.get("simplePanel",t),borderRadius:"16px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},cardHeader:{display:"flex",alignItems:"center",gap:"12px"},iconBox:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px"},label:{fontSize:"16px",fontWeight:"600",color:o.get("mainText",t)},stepper:{display:"flex",alignItems:"center",backgroundColor:o.get("background",t),borderRadius:"12px",padding:"4px",border:`1px solid ${o.get("border",t)}40`},stepperBtn:{width:"40px",height:"40px",borderRadius:"10px",border:"none",backgroundColor:o.get("backgroundLight",t),color:o.get("icons",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"background-color 0.2s"},stepperValue:{minWidth:"70px",textAlign:"center",fontWeight:"bold",fontSize:"15px",color:o.get("mainText",t),userSelect:"none"},footer:{padding:"20px 24px",borderTop:`1px solid ${o.get("border",t)}40`,display:"flex",gap:"16px",marginTop:"auto"},secondaryBtn:{width:"56px",height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("skipped",t),color:o.get("mainText",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},primaryBtn:{flex:1,height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("maxValColor",t),color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}}),ds=({theme:t,langIndex:n,fSize:s,setProtocol:l,show:a,setShow:d,showTimer:c})=>{const[h,r]=i.useState(180),[w,x]=i.useState(30),[k,R]=i.useState(0),[y,f]=i.useState(1),F=(m,g,u=0,j=1800,A=30)=>{m(b=>{const M=b+g;return Math.min(j,Math.max(u,M))})},C=m=>{if(m===0)return n===0?"0 сек":"0s";if(m<60)return`${m} ${n===0?"сек":"s"}`;const g=Math.floor(m/60),u=m%60;return u>0?`${g} ${n===0?"мин":"m"} ${u}`:`${g} ${n===0?"мин":"m"}`},I=()=>{const m=[];h>0&&m.push(`${C(h)} ${n===0?"тепла":"warm"}`),w>0&&m.push(`${C(w)} ${n===0?"холода":"cold"}`);let u=`${m.join(" → ")}`;y>1&&(u+=` (×${y})`),k>0&&(u+=` + ${C(k)} ${n===0?"отдых":"rest"}`),l({name:n===0?["Своя закалка"]:["Custom Hardening"],aim:n===0?["Иммунитет и тонус"]:["Immunity and tone"],instructions:n===0?["Дышите спокойно."]:["Breathe calmly."],levels:[{cycles:y,strategy:u,steps:[{hotSeconds:h,coldSeconds:w,restSeconds:k}]}]}),d(!1),c(!0)},L={hidden:{y:"100%",opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{y:"100%",opacity:0}};return e.jsx(fe,{children:a&&e.jsx("div",{style:Q(t).overlay,children:e.jsxs(p.div,{initial:"hidden",animate:"visible",exit:"exit",variants:L,style:Q(t).panel,children:[e.jsxs("div",{style:Q(t).header,children:[e.jsx("h2",{style:Q(t).title,children:n===0?"Конструктор":"Constructor"}),e.jsx("div",{style:{width:40}})," "]}),e.jsxs("div",{style:Q(t).listContainer,children:[e.jsx(Ye,{theme:t,label:n===0?"Тёплая вода":"Warm Water",value:C(h),icon:e.jsx(vt,{}),color:"difficulty5",onDec:()=>F(r,-30,0,600),onInc:()=>F(r,30,0,600)}),e.jsx(Ye,{theme:t,label:n===0?"Холодная вода":"Cold Water",value:C(w),icon:e.jsx(wt,{}),color:"difficulty",onDec:()=>F(x,-10,0,300,10),onInc:()=>F(x,10,0,300,10)}),e.jsx(Ye,{theme:t,label:n===0?"Отдых / Согрев":"Rest / Warm-up",value:C(k),icon:e.jsx(lt,{}),color:"difficulty2",onDec:()=>F(R,-30,0,600),onInc:()=>F(R,30,0,600)}),e.jsx(Ye,{theme:t,label:n===0?"Циклы":"Cycles",value:y,icon:e.jsx(ct,{}),color:"subText",onDec:()=>F(f,-1,1,10),onInc:()=>F(f,1,1,10),isCycle:!0})]}),e.jsxs("div",{style:Q(t).footer,children:[e.jsx("div",{onClick:()=>d(!1),style:Q(t).secondaryBtn,children:e.jsx(dt,{size:24})}),e.jsxs("button",{onClick:I,style:Q(t).primaryBtn,children:[e.jsx(pt,{size:24}),e.jsx("span",{style:{marginLeft:8},children:n===0?"Готово":"Done"})]})]})]})})})},Ye=({theme:t,label:n,value:s,icon:l,color:a,onDec:d,onInc:c,isCycle:h})=>{const r=o.get(a,t),w=Ie(c),x=Ie(d);return e.jsxs("div",{style:{...Q(t).card,borderLeft:`4px solid ${r}`},children:[e.jsxs("div",{style:Q(t).cardHeader,children:[e.jsx("div",{style:{...Q(t).iconBox,color:r,backgroundColor:r+"20"},children:l}),e.jsx("span",{style:Q(t).label,children:n})]}),e.jsxs("div",{style:Q(t).stepper,children:[e.jsx("button",{...x,onClick:d,style:Q(t).stepperBtn,children:e.jsx(Oe,{size:12})}),e.jsx("span",{style:Q(t).stepperValue,children:s}),e.jsx("button",{...w,onClick:c,style:Q(t).stepperBtn,children:e.jsx(Ne,{size:12})})]})]})},Q=t=>({overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",backdropFilter:"blur(5px)",zIndex:2900,display:"flex",justifyContent:"center",alignItems:"flex-end"},panel:{width:"100%",maxWidth:"500px",backgroundColor:o.get("background",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px",display:"flex",flexDirection:"column",boxShadow:"0 -10px 30px rgba(0,0,0,0.2)",paddingBottom:"20px"},header:{padding:"24px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${o.get("border",t)}40`},title:{margin:0,fontSize:"20px",fontWeight:"bold",color:o.get("mainText",t)},listContainer:{padding:"24px",display:"flex",flexDirection:"column",gap:"16px",overflowY:"auto"},card:{backgroundColor:o.get("simplePanel",t),borderRadius:"16px",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},cardHeader:{display:"flex",alignItems:"center",gap:"12px"},iconBox:{width:"36px",height:"36px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px"},label:{fontSize:"16px",fontWeight:"600",color:o.get("mainText",t)},stepper:{display:"flex",alignItems:"center",backgroundColor:o.get("background",t),borderRadius:"12px",padding:"4px",border:`1px solid ${o.get("border",t)}40`},stepperBtn:{width:"40px",height:"40px",borderRadius:"10px",border:"none",backgroundColor:o.get("backgroundLight",t),color:o.get("icons",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"14px",transition:"background-color 0.2s"},stepperValue:{minWidth:"70px",textAlign:"center",fontWeight:"bold",fontSize:"15px",color:o.get("mainText",t),userSelect:"none"},footer:{padding:"20px 24px",borderTop:`1px solid ${o.get("border",t)}40`,display:"flex",gap:"16px",marginTop:"auto"},secondaryBtn:{width:"56px",height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("skipped",t),color:o.get("mainText",t),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},primaryBtn:{flex:1,height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("maxValColor",t),color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}}),ys=()=>{const[t,n]=Pt.useState("dark"),[s,l]=i.useState(T.prefs[0]),[a,d]=i.useState(T.prefs[4]),[c,h]=i.useState(qe[0].protocols[0]),[r,w]=i.useState(0),[x,k]=i.useState(0),[R,y]=i.useState(!1),[f,F]=i.useState(qe),[C,I]=i.useState(!1),[L,m]=i.useState(!1),[g,u]=i.useState(!1),[j,A]=i.useState(Tt.hasPremium);i.useEffect(()=>{const z=Rt.subscribe(A);return()=>z.unsubscribe()},[]),i.useEffect(()=>{const z=Ge.subscribe(n),$=Ke.subscribe(P=>{l(P==="ru"?0:1)}),V=_e.subscribe(P=>{d(P)}),_=ge.subscribe(P=>{F(P===0?qe:P===1?Lt:Ht)});return()=>{z.unsubscribe(),$.unsubscribe(),V.unsubscribe(),_.unsubscribe()}},[]);const b={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},M={hidden:{opacity:0,y:10,scale:.98},show:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:300,damping:25}}},B=ge.value===0?{emoji:"🌬️",ru:"Дыхание",en:"Breathing"}:ge.value===1?{emoji:"🧘",ru:"Медитация",en:"Meditation"}:{emoji:"💧",ru:"Закаливание",en:"Cold Water"};return e.jsxs("div",{style:St(t).container,children:[e.jsxs("div",{style:St(t).scrollView,children:[e.jsx("div",{style:{height:"3vh"}}),e.jsxs("div",{style:{width:"92%",marginBottom:"20px",display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"28px"},children:B.emoji}),e.jsx("h1",{style:{margin:0,color:o.get("mainText",t),fontSize:"26px",fontFamily:"Segoe UI",fontWeight:"800"},children:s===0?B.ru:B.en})]}),e.jsx("span",{style:{fontSize:"14px",color:o.get("subText",t),opacity:.7,marginLeft:"4px"},children:s===0?"Выберите практику":"Choose your practice"})]}),e.jsxs(p.div,{variants:b,initial:"hidden",animate:"show",style:{width:"94%",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",paddingBottom:"30px"},children:[f.map((z,$)=>z.protocols.map((V,_)=>e.jsx(jt,{variants:M,ind:_,difficulty:$,protocol:V,setTimer:y,theme:t,lang:s,fSize:a,onClick:()=>{h(V),w(_),k($)},hasPremium:j,needBlur:$>1},`${$}-${_}`))),e.jsx("div",{style:{gridColumn:"1 / -1",width:"100%"},children:e.jsx(jt,{difficulty:4,variants:M,ind:-1,setTimer:ge.value===0?I:ge.value===1?m:u,theme:t,lang:s,fSize:a,onClick:()=>{k(4)},protocol:void 0,hasPremium:j,needBlur:!0,isConstructor:!0})})]}),e.jsx("div",{style:{marginBottom:"100px"},children:" "})]}),ge.value===0&&e.jsx(Ot,{show:R,isCustom:x===4,setShow:y,protocol:c,protocolIndex:r,categoryIndex:x}),ge.value===1&&e.jsx(Xt,{show:R,isCustom:x===4,setShow:y,protocol:c,protocolIndex:r,categoryIndex:x}),ge.value===2&&e.jsx(ss,{show:R,isCustom:x===4,setShow:y,protocol:c,protocolIndex:r,categoryIndex:x}),e.jsx(as,{show:C,setShow:I,showTimer:y,setProtocol:h,theme:t,langIndex:s,fSize:a}),e.jsx(cs,{show:L,setShow:m,showTimer:y,setProtocol:h,theme:t,langIndex:s,fSize:a}),e.jsx(ds,{show:g,setShow:u,showTimer:y,setProtocol:h,theme:t,langIndex:s,fSize:a})]})},St=(t,n)=>({container:{backgroundColor:o.get("background",t),display:"flex",flexDirection:"column",justifyItems:"center",alignItems:"center",height:"90vh",marginTop:"110px",width:"100vw",fontFamily:"Segoe UI, sans-serif",overflow:"hidden"},scrollView:{height:"100%",width:"100%",overflowY:"scroll",display:"flex",flexDirection:"column",alignItems:"center"},btn:{padding:"8px 24px",borderRadius:"12px",fontSize:"13px",color:o.get("mainText",t),border:"none",fontWeight:"600",marginTop:"12px",cursor:"pointer",backgroundColor:o.get("background",t),boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}),ps=t=>{switch(t){case 0:return{accent:"#64D2FF",bgGlow:"radial-gradient(circle at 100% 0%, rgba(100, 210, 255, 0.12) 0%, transparent 45%)",icon:e.jsx(Wt,{})};case 1:return{accent:"#32D74B",bgGlow:"radial-gradient(circle at 100% 0%, rgba(50, 215, 75, 0.12) 0%, transparent 45%)",icon:e.jsx(At,{})};case 2:return{accent:"#FF9F0A",bgGlow:"radial-gradient(circle at 100% 0%, rgba(255, 159, 10, 0.12) 0%, transparent 45%)",icon:e.jsx(Dt,{})};case 3:return{accent:"#BF5AF2",bgGlow:"radial-gradient(circle at 100% 0%, rgba(191, 90, 242, 0.12) 0%, transparent 45%)",icon:e.jsx(Mt,{})};case 4:return{accent:"#0A84FF",bgGlow:"radial-gradient(circle at 100% 0%, rgba(10, 132, 255, 0.12) 0%, transparent 45%)",icon:e.jsx($t,{})};default:return{accent:"#8E8E93",bgGlow:"none",icon:e.jsx(Ze,{})}}};function jt({protocol:t,difficulty:n,ind:s,setTimer:l,theme:a,lang:d,onClick:c,fSize:h,variants:r,hasPremium:w=!1,needBlur:x=!1,isConstructor:k=!1}){const R=a==="dark",y=!w&&x,{accent:f,bgGlow:F,icon:C}=ps(n),{done:I,all:L,percent:m}=xs(n,s),g={position:"relative",width:"100%",height:k?"120px":"185px",display:"flex",flexDirection:"column",justifyContent:"space-between",borderRadius:"22px",overflow:"hidden",cursor:"pointer",backgroundColor:o.get("simplePanel",a),boxShadow:R?"0 4px 20px rgba(0,0,0,0.3)":"0 4px 15px rgba(0,0,0,0.05)",border:R?"1px solid rgba(255,255,255,0.05)":"1px solid rgba(0,0,0,0.02)",padding:"16px",boxSizing:"border-box"},u={width:"36px",height:"36px",borderRadius:"12px",backgroundColor:R?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.04)",display:"flex",alignItems:"center",justifyContent:"center",color:f,fontSize:"16px"};return e.jsxs(p.div,{variants:r,whileTap:{scale:.96},whileHover:{y:-2},onClick:()=>{y||(c(),l(!0))},style:g,children:[e.jsx("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0,background:F,pointerEvents:"none"}}),y&&e.jsxs("div",{onClick:j=>{j.stopPropagation()},style:{position:"absolute",inset:0,zIndex:10,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:R?"rgba(0,0,0,0.5)":"rgba(255,255,255,0.6)",backdropFilter:"blur(8px)"},children:[e.jsx(Ft,{size:18,color:f,style:{marginBottom:"8px"}}),e.jsx("div",{style:{fontSize:"11px",fontWeight:"bold",color:o.get("mainText",a)},children:"PREMIUM"})]}),e.jsxs("div",{style:{zIndex:2},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsx("div",{style:u,children:C}),!k&&e.jsx("div",{style:{fontSize:"10px",fontWeight:"700",color:f,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"4px"},children:n===0?"Relax":n===1?"Focus":n===2?"Energy":"Pro"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[e.jsx("div",{style:{fontSize:k?"17px":h===0?"16px":"18px",fontWeight:"700",color:o.get("mainText",a),lineHeight:"1.2"},children:t===void 0?d===0?"Конструктор":"Custom":Array.isArray(t.name)?t.name[d]:t.name}),e.jsx("div",{style:{fontSize:"12px",color:o.get("subText",a),opacity:.8,lineHeight:"1.3"},children:t===void 0?d===0?"Свой режим":"Your mode":Array.isArray(t.aim)?t.aim[d]:t.aim})]})]}),!y&&!k&&e.jsxs("div",{style:{zIndex:2,marginTop:"auto"},children:[e.jsx("div",{style:{width:"100%",height:"4px",background:R?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",borderRadius:"2px",marginTop:"10px"},children:e.jsx("div",{style:{width:`${m}%`,height:"100%",background:f,borderRadius:"2px",boxShadow:`0 0 8px ${f}40`}})}),e.jsxs("div",{style:{textAlign:"right",fontSize:"10px",color:o.get("subText",a),marginTop:"4px",opacity:.6},children:[I,"/",L]})]}),k&&e.jsxs("div",{style:{zIndex:2,marginTop:"auto",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Bt,{size:10,color:f}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:o.get("mainText",a)},children:d===0?"Начать":"Start"})]})]})}const xs=(t,n)=>{if(t===4||!T.recoveryProtocols[ge.value]||!T.recoveryProtocols[ge.value][t][n])return{done:0,all:0,percent:0};const s=T.recoveryProtocols[ge.value][t][n];let l=0,a=0;for(let c=0;c<s.length;c++)l++,s[c]&&a++;const d=l>0?a/l*100:0;return{done:a,all:l,percent:d}};export{ys as default};
