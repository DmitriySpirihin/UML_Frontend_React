import{R as w,r as f,A as u,t as ee,g as te,l as ne,h as se,j as t,C as a,s as E,a as ae,b as K,m as ie,e as oe}from"./index-Cg-_c7eF.js";import{B as re,a as le,M as P,b as W,A as ce,c as de,C as ue,d as ge}from"./Calendar_Light-BCEklUL6.js";import{D as pe}from"./Done_Icon-DdkMY8v7.js";import{u as fe,a as he,b as V}from"./index-DBl5ofTr.js";const xe="/UML_Frontend_React/assets/Skipped_Icon-Dw_oKt7q.png",S=e=>{const r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${r}-${i}-${o}`},be=e=>(e.getDay()+6)%7;S(new Date);const R=new Audio(new URL("/UML_Frontend_React/assets/SwitchPanel-CJjFfFgV.wav",import.meta.url).href),ye=new Audio(new URL("/UML_Frontend_React/assets/Click_Calendar-DitEighf.wav",import.meta.url).href),me=new Audio(new URL("/UML_Frontend_React/assets/IsDone-CY5KfW9n.wav",import.meta.url).href),N=new Audio(new URL("/UML_Frontend_React/assets/Skip-C95holY4.wav",import.meta.url).href);function we(){return K.concat((u.CustomHabits||[]).filter(e=>!K.some(r=>r.id===e.id)))}const Re=()=>{const[e,r]=w.useState("dark"),[i,o]=w.useState("dark"),[c,h]=f.useState(u.prefs[0]),[n,p]=f.useState(new Date),[d,y]=f.useState(n),[x,C]=f.useState(!1),[H,j]=f.useState(0);w.useEffect(()=>{const s=ee.subscribe(r);return()=>s.unsubscribe()},[]),w.useEffect(()=>{const s=te.subscribe(o);return()=>s.unsubscribe()},[]),w.useEffect(()=>{const s=ne.subscribe(k=>{h(k==="ru"?0:1)});return()=>s.unsubscribe()},[]),w.useEffect(()=>{const s=se.subscribe(()=>j(k=>k+1));return()=>s.unsubscribe()},[]);const I=new Date(n.getFullYear(),n.getMonth(),1),z=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),T=(I.getDay()+6)%7,v=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],g=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],m=[],A=[];for(let s=0;s<T;s++)m.push(null);for(let s=1;s<=z;s++)m.push(s);for(let s=0;s<m.length;s+=7)A.push(m.slice(s,s+7));const X=()=>{p(new Date(n.getFullYear(),n.getMonth()-1)),D(R,50)},q=()=>{p(new Date(n.getFullYear(),n.getMonth()+1)),D(R,50)};return t.jsxs("div",{style:l(e).container,children:[t.jsxs("div",{style:l(e).panel,children:[t.jsxs("div",{style:l(e).calendarHead,children:[t.jsx("h1",{style:l(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:X,children:t.jsx("h1",{style:l(e).header,children:"<"})}),t.jsx("div",{onClick:q,children:t.jsx("h1",{style:l(e).header,children:">"})})]}),t.jsxs("table",{style:l(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:v[c].map(s=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:s==="Вс"||s==="Sun"?"#873535ff":a.get("subText",e)},children:s})},s))})}),t.jsx("tbody",{children:A.map((s,k)=>t.jsx("tr",{children:s.map((b,G)=>{const M=n.getMonth(),F=n.getFullYear(),J=b===d.getDate()&&M===d.getMonth()&&F===d.getFullYear(),$=S(new Date(F,M,b));let Y="",L=0;if(Object.keys(u.habitsByDate).includes($)){const _=Array.from(Object.values(u.habitsByDate[$])),O=_.length,Q=_.filter(Z=>Z===1).length,B=O>0?Math.round(Q/O*100):0;Y=B+"%",L=B>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...l(e).cell,border:`3px solid ${J?a.get("currentDateBorder",e):a.get("background",e)}`,backgroundColor:b<1?a.get("background",e):L===1?a.get("habitCardDone",e):L===-1?a.get("habitCardSkipped",e):a.get("background",e)},onClick:()=>{y(new Date(F,M,b)),C(u.hasKey(S(new Date(F,M,b)))),D(ye,50)},children:[b,b>0&&t.jsx("div",{style:{fontSize:"8px",color:a.get("subText",e),lineHeight:"5px",padding:"5px"},children:Y})]})},G)})},k))})]}),t.jsxs("div",{style:{position:"fixed",top:"120%",padding:"10%",fontSize:"14px",fontFamily:"Segoe UI",color:a.get("simplePanel",e)},children:[" ",c===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]})]}),x&&t.jsxs("div",{style:{...l(e).panel,height:"30vh",width:"75vw",position:"fixed",top:"74%",left:"50%"},children:[t.jsxs("div",{style:{...l(e).calendarHead,display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",paddingTop:"5px"},children:[t.jsx("h1",{style:{...l(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"1px"},children:d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+" "+g[c][be(d)]}),t.jsx("div",{style:{fontSize:"10px",color:a.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:ke(d,c)})]}),t.jsx("div",{style:l(e).scrollView,children:t.jsx(De,{theme:e,langIndex:c,date:d})})]}),t.jsx(je,{theme:e,globalTheme:i})]})},De=({theme:e,langIndex:r,date:i})=>{const o=S(i);return u.hasKey(o)?Object.entries(u.habitsByDate[o]).map(([h,n])=>{const p=Number(h),d=we().find(x=>x.id===p),y=d?d.name[r]:"";return t.jsx(Se,{id:p,name:y,theme:e,date:i,statusInit:n,langIndex:r},`${o}-${h}`)}):null},Se=({id:e,name:r,theme:i,date:o,statusInit:c,langIndex:h})=>{const[n,p]=f.useState(c),[d,y]=f.useState(!0),x=100,C=-100,H=fe(0),j=he(H,[-1,1],[C,x]);f.useEffect(()=>{p(c)},[c,o]);const I=(z,T)=>{const v=T.offset.x;if(Math.abs(v)>x){if(!d)return;let g=n;if(v>0?n===0?g=1:n===-1&&(g=0):n===0?g=-1:n===1&&(g=0),g!==n){const m=S(o);u.changeStatus(m,e,g),p(g),oe(),g===1?u.prefs[2]==0&&me.play():g===-1&&u.prefs[2]==0&&N.play(),u.prefs[3]==0&&navigator.vibrate?.(50)}y(!1),V(j,0,{type:"tween",duration:.2})}},U=()=>{V(j,0,{type:"tween",duration:.2}),y(!0)};return t.jsxs(ie.div,{id:`cal-${e}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:j},drag:d?"x":!1,dragConstraints:{left:C,right:n===1?0:x},dragElastic:0,onDrag:I,onDragEnd:U,children:[t.jsx("p",{style:{...l(i).text,fontSize:"14px",paddingLeft:"30px"},children:r}),n===1?t.jsx("img",{src:pe,style:l(i).icon}):n===-1?t.jsx("img",{src:xe,style:l(i).icon}):null,t.jsx("span",{style:{...l(i).subText,marginLeft:"6px",color:n===1?a.get("habitCardDone",i):n===-1?a.get("habitCardSkipped",i):a.get("subText",i)},children:n===1?h===0?"Выполнено":"Done":n===-1?h===0?"Пропущено":"Skipped":""})]})};function je({globalTheme:e,theme:r}){const i={position:"fixed",bottom:"0",left:"0",width:"100vw",height:"10vh",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",backgroundColor:a.get("bottomPanel",r),display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:900,boxShadow:`0px -2px 0px ${a.get("bottomPanelShadow",r)}`},o={width:"35px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"};return t.jsx("div",{style:i,children:t.jsxs("div",{style:i,children:[t.jsx("img",{src:e==="dark"?re:le,style:o,onClick:()=>{E("HabitsMain"),D(N,50)}}),t.jsx("img",{src:e==="dark"?P:W,style:o,onClick:()=>{E("HabitMetrics"),D(R,50)}}),t.jsx("img",{src:e==="dark"?ce:de,style:o,onClick:()=>{}}),t.jsx("img",{src:e==="dark"?P:W,style:o,onClick:()=>{ae(!0),D(R,50)}}),t.jsx("img",{src:e==="dark"?ue:ge,style:o,onClick:()=>{}})]})})}const l=e=>({container:{backgroundColor:a.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:a.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:a.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"100%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"11vw",height:"11vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:a.get("mainText",e),fontFamily:"Segoe UI"},panel:{width:"90vw",height:"105vw",position:"absolute",top:"36%",left:"50%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${a.get("border",e)}`,margin:"5px",background:a.get("background",e),boxShadow:`4px 4px 6px ${a.get("shadow",e)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:a.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:a.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"90%",height:"70%",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"start",borderRadius:"24px"},icon:{paddingLeft:"25px",paddingBottom:"5px",width:"25px"}});function ke(e,r){const i=[["привычка","привычки","привычек"],["habit","habits","habits"]],o=S(e);if(u.hasKey(o)){const c=Object.values(u.habitsByDate[o]).length;return c+" "+i[r][c===1?0:c>1&&c<5?1:2]}return"0 "+i[r][2]}function D(e,r){u.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),u.prefs[3]==0&&navigator.vibrate(r)}export{Re as default};
