import{c as N,j as t,R as z,r as p,A as d,t as q,f as J,l as Q,C as a,a as L,m as Z,M as _,e as ee}from"./index-Dqn_qtD2.js";import{u as te,a as ne,b as U}from"./index-_2WTyGrd.js";const se=N(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),ae=N(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),j=e=>{const i=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${i}-${o}-${u}`},oe=e=>(e.getDay()+6)%7;j(new Date);const O=new Audio("Audio/Click.wav"),ie=new Audio("Audio/IsDone.wav"),re=new Audio("Audio/Skip.wav");function le(){return L.concat((d.CustomHabits||[]).filter(e=>!L.some(i=>i.id===e.id)))}const pe=()=>{const[e,i]=z.useState("dark"),[o,u]=p.useState(d.prefs[0]),[n,C]=p.useState(new Date),[f,r]=p.useState(0),[l,h]=p.useState(n),[y,x]=p.useState(!1);z.useEffect(()=>{const s=q.subscribe(i),v=J.subscribe(r);return()=>{s.unsubscribe(),v.unsubscribe()}},[]),z.useEffect(()=>{const s=Q.subscribe(v=>{u(v==="ru"?0:1)});return()=>s.unsubscribe()},[]);const M=new Date(n.getFullYear(),n.getMonth(),1),w=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),F=(M.getDay()+6)%7,I=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],R=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],m=[],S=[];for(let s=0;s<F;s++)m.push(null);for(let s=1;s<=w;s++)m.push(s);for(let s=0;s<m.length;s+=7)S.push(m.slice(s,s+7));const g=()=>{C(new Date(n.getFullYear(),n.getMonth()-1)),D(O)},H=()=>{C(new Date(n.getFullYear(),n.getMonth()+1)),D(O)};return t.jsx("div",{style:c(e).container,children:t.jsxs("div",{style:c(e).panel,children:[t.jsxs("div",{style:c(e).calendarHead,children:[t.jsx("h1",{style:c(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:g,children:t.jsx("h1",{style:c(e).header,children:"<"})}),t.jsx("div",{onClick:H,children:t.jsx("h1",{style:c(e).header,children:">"})})]}),t.jsxs("table",{style:c(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:I[o].map(s=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:f===0?"11px":"13px",color:s==="Вс"||s==="Sun"?"#873535ff":a.get("subText",e)},children:s})},s))})}),t.jsx("tbody",{children:S.map((s,v)=>t.jsx("tr",{children:s.map((b,P)=>{const k=n.getMonth(),T=n.getFullYear(),V=b===l.getDate()&&k===l.getMonth()&&T===l.getFullYear(),Y=j(new Date(T,k,b));let E="",A=0;if(Object.keys(d.habitsByDate).includes(Y)){const K=Array.from(Object.values(d.habitsByDate[Y])),W=K.length,X=K.filter(G=>G>0).length,B=W>0?Math.round(X/W*100):0;E=B+"%",A=B>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...c(e).cell,border:`3px solid ${V?a.get("currentDateBorder",e):a.get("background",e)}`,backgroundColor:b<1?a.get("background",e):A===1?a.get("habitCardDone",e):A===-1?a.get("habitCardSkipped",e):a.get("background",e)},onClick:()=>{h(new Date(T,k,b)),x(d.hasKey(j(new Date(T,k,b)))),D(O)},children:[b,b>0&&t.jsx("div",{style:{fontSize:f===0?"8px":"10px",color:a.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:E})]})},P)})},v))})]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:y&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${a.get("border",e)}`},children:[t.jsx("h1",{style:{...c(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:l.getDate()+"/"+(l.getMonth()+1)+"/"+l.getFullYear()+" "+R[o][oe(l)]}),t.jsx("div",{style:{fontSize:f===0?"10px":"12px",color:a.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:ue(l,o)})]}),t.jsx("div",{style:c(e).scrollView,children:t.jsx(ce,{theme:e,langIndex:o,date:l,fSize:f})})]})})]})})},ce=({theme:e,langIndex:i,date:o,fSize:u})=>{const n=j(o);return d.hasKey(n)?Object.entries(d.habitsByDate[n]).map(([f,r])=>{const l=Number(f),h=le().find(x=>x.id===l),y=h?h.name[i]:"";return t.jsx(de,{id:l,name:y,theme:e,date:o,statusInit:r,langIndex:i,fSize:u},`${n}-${f}`)}):null},de=({id:e,name:i,theme:o,date:u,statusInit:n,langIndex:C,fSize:f})=>{const[r,l]=p.useState(n),[h,y]=p.useState(r<2),x=100,M=-100,$=te(0),w=ne($,[-1,1],[M,x]);p.useEffect(()=>{l(n)},[n,u]);const F=(R,m)=>{const S=m.offset.x;if(Math.abs(S)>x){if(!h)return;let g=r;if(S>0?r===0?g=1:r===-1&&(g=0):r===0?g=-1:r===1&&(g=0),g!==r){const H=j(u);d.changeStatus(H,e,g),l(g),ee(),g===1?d.prefs[2]==0&&D(ie):g===-1&&d.prefs[2]==0&&D(re),D(null)}y(!1),U(w,0,{type:"tween",duration:.2})}},I=()=>{U(w,0,{type:"tween",duration:.2}),y(!0)};return t.jsxs(Z.div,{id:`cal-${e}`,style:{backgroundColor:r<2?"transparent":a.get("habitCardEnded",o),display:"flex",flexDirection:"row",width:"95%",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:w},drag:h?"x":!1,dragConstraints:{left:M,right:r===1?0:x},dragElastic:0,onDrag:F,onDragEnd:I,children:[t.jsx("p",{style:{...c(o,f).text,paddingLeft:"30px"},children:i}),r>0?r>1?t.jsx(_,{style:{...c(o).icon,color:"#8e972eff"}}):t.jsx(se,{style:{...c(o).icon,color:"#2e9741ff"}}):r===-1?t.jsx(ae,{style:{...c(o).icon,color:"#973939ff"}}):null]})},c=(e,i)=>({container:{backgroundColor:a.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"160vw",position:"absolute",top:"51%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${a.get("border",e)}`,margin:"5px",background:a.get("background",e),boxShadow:`4px 4px 6px ${a.get("shadow",e)}`},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:a.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:a.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:a.get("mainText",e),fontFamily:"Segoe UI"},text:{fontFamily:"Segoe UI",fontSize:i===0?"13px":"15px",color:a.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:i===0?"11px":"13px",color:a.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function ue(e,i){const o=[["привычка","привычки","привычек"],["habit","habits","habits"]],u=j(e);if(d.hasKey(u)){const n=Object.values(d.habitsByDate[u]).length;return n+" "+o[i][n===1?0:n>1&&n<5?1:2]}return"0 "+o[i][2]}function D(e){d.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),d.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{pe as default};
