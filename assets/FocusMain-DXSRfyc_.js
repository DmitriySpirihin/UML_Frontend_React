import{A as k,t as Te,l as we,f as Ie,C as o,j as t,bi as oe,bj as be,bt as Se,bk as Qe,bu as Xe,bv as Ze,bp as H,U as et,p as tt,s as st,bo as ot}from"./index-86lo2Bm1.js";import{r as i}from"./recharts-Bg6K2Pzo.js";import{G as nt,a as rt}from"./index-Ce0lMzsK.js";import{f as C,s as it}from"./MentalHelper-DFV9VSwg.js";import{B as lt}from"./BreathAudio-BrJNN4AB.js";const ye=["â—","â–²","â– ","â—†","â¬Ÿ","âœš","â¬¢","â¬Ÿ","âœ¦","âœ³","â„","â¬Ÿ"];function at(s,r,l){if(s!==3)return[[],""];const d=Math.max(0,Math.min(r,C.length-1)),e=C[d],u=e.targetSymbol||"â˜…";let n;switch(d){case 0:n=je(e);break;case 1:n=ct(e);break;case 2:n=dt(e);break;case 3:n=ut(e);break;default:n=je(e)}const m=n.filter(w=>w===u).length;return[n,m.toString()]}const je=s=>U(s),ct=s=>U(s),dt=s=>U(s),ut=s=>U(s);function U(s,r){const l=Ce(...s.totalItemsRange);let d=Ce(...s.targetsPerRoundRange);d=Math.min(d,l);const e=s.targetSymbol||"â˜…",u=Array.from({length:l},()=>ye[Math.floor(Math.random()*ye.length)]),n=new Set;for(;n.size<d;)n.add(Math.floor(Math.random()*l));return n.forEach(m=>{u[m]=e}),u.sort(()=>Math.random()-.5)}function Ce(s,r){return s==null||r==null||isNaN(s)||isNaN(r)?(console.error("[randomInRange] Invalid range:",{min:s,max:r}),4):Math.floor(Math.random()*(r-s+1))+s}function xt(s,r,l,d,e,u,n){if(s!==3)return 0;const w=[100,200,300,400][r]||100,p=Number(u),h=Number(e),v=h!==0?Math.abs(h-p)/h:1,b=v===0?1:v<.15?.5:0,S=Math.min(1+l*.02,1.3),g=d/1e3,R=C[r]?.timeLimitSec||20,y=g/R,O=b===1?Math.max(1,1.3-(y-1)*.6):1,$=n>=5&&b===1?Math.min(1+.1*Math.min(n/10,4),1.5):1;return Math.round(w*b*S*O*$)}const mt=3e3,gt=({show:s,type:r,difficulty:l,setShow:d})=>{const[e,u]=i.useState("dark"),[n,m]=i.useState(k.prefs[0]),[w,p]=i.useState(k.prefs[4]),[h,v]=i.useState(!1),[b,S]=i.useState(!1),[g,R]=i.useState(!1),[y,O]=i.useState(!1),[$,q]=i.useState(!1),[ke,ne]=i.useState(0),[M,Re]=i.useState(null),[A,F]=i.useState(new Set),[re,W]=i.useState({}),[Me,$e]=i.useState(0),[jt,ie]=i.useState(!1),[L,le]=i.useState(0),[ae,Pe]=i.useState(!1),{initAudio:ze,playRight:De,playWrong:_}=lt(k.prefs[2]===0),[P,J]=i.useState(0),[V,K]=i.useState(1),[ce,Q]=i.useState(0),[Ae,X]=i.useState(0),[de,Le]=i.useState(k.mentalRecords[r]?.[l]||0),[Ee,ue]=i.useState(0),[Fe,xe]=i.useState(0),[I,Z]=i.useState(!1),[z,me]=i.useState(0),[We,E]=i.useState(""),[Ve,ge]=i.useState("");i.useEffect(()=>{const a=Te.subscribe(u),c=we.subscribe(f=>m(f==="ru"?0:1)),x=Ie.subscribe(p);return()=>{a.unsubscribe(),c.unsubscribe(),x.unsubscribe()}},[]),i.useEffect(()=>{let a=null;return h&&(a=setInterval(()=>ue(c=>c+100),100)),()=>clearInterval(a)},[h]),i.useEffect(()=>{if(!g)return;const a=Math.ceil(mt/1e3);xe(a);const c=setInterval(()=>{xe(x=>x<=1?(clearInterval(c),Ne(),R(!1),0):x-1)},1e3);return()=>clearInterval(c)},[g]);const Ge=i.useCallback(a=>{if(!b||y||I||$)return;const x=M.items[a]===M.targetSymbol;F(f=>{const j=new Set(f);return j.has(a)?j.delete(a):j.add(a),j}),W(f=>({...f,[a]:x?"correct":"wrong"})),x||_()},[M,b,y,I,$,_]);i.useEffect(()=>{if(A.size===0||I)return;const a=setTimeout(()=>{fe()},800);return()=>clearTimeout(a)},[A,I]);const fe=()=>{if(!M||I)return;const{items:a,targetSymbol:c}=M,f=a.map((T,Ke)=>T===c?Ke:-1).filter(T=>T!==-1).length,j=Array.from(A).filter(T=>a[T]===c).length,te=Array.from(A).filter(T=>a[T]!==c).length,Oe=j,G=f,qe=Date.now()-Me,_e=xt(r,l,V,qe,G,Oe,ce),N=te===0&&j===G;let se="";N?(se=St(n),X(T=>T+1)):se=n===0?`ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾: ${G}. Ğ¢Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»: ${j} (Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: ${te})`:`Correct: ${G}. You selected: ${j} (mistakes: ${te})`;const Je=N?o.get("maxValColor",e):o.get("minValColor",e);ge(Je),E(se),me(_e),Q(T=>N?T+1:0),N?De():_(),Z(!0),ie(!1)};i.useEffect(()=>{if(!ae||L<=0){L<=0&&fe();return}const a=setTimeout(()=>{le(c=>c-1)},1e3);return()=>clearTimeout(a)},[ae,L]),i.useEffect(()=>{if(!I)return;const a=setTimeout(()=>{const c=P+z;J(c),me(0),F(new Set),W({}),V>=20?He(c):(K(x=>x+1),ee(x=>x+1)),Z(!1)},1200);return()=>clearTimeout(a)},[I,P,z,V]);const Ne=()=>{ze(),J(0),K(1),X(0),Q(0),E(""),S(!0),v(!0),q(!1),ue(0),ne(Date.now()),ee(1)},ee=a=>{const c=C[l],[x,f]=at(r,l),j=c.roundTimeSec||10;if(le(j),Pe(!0),console.log("[DEBUG] Problem generated:",{type:r,difficulty:l,stage:a,items:x,answer:f,targetSymbol:c.targetSymbol}),!x||x.length===0){E(n===0?"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸":"Problem generation failed"),ge(o.get("minValColor",e)),Z(!0);return}Re({items:x,targetSymbol:c.targetSymbol||"â˜…"}),F(new Set),W({}),$e(Date.now()),ie(!0)},Be=()=>{v(!1),q(!0)},Ye=()=>{v(!0),q(!1)},pe=()=>{J(0),K(1),X(0),Q(0),E(""),F(new Set),W({}),ne(Date.now()),b&&ee(1)},He=a=>{const c=Date.now(),x=Math.round((c-ke)/1e3);it(x);const f=a>de,j=bt(!1,n,a,Ae,20,f);v(!1),E(j),O(!0),S(!1)},he=()=>{P>de&&(Le(P),k.mentalRecords[r]||(k.mentalRecords[r]={}),k.mentalRecords[r][l]=P),d(!1)},Ue=()=>!M||!M.items?null:t.jsx("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",justifyContent:"center",marginTop:"20px"},children:M.items.map((a,c)=>{let x=o.get("bottomPanel",e),f=o.get("border",e);return re[c]==="correct"?(x=o.get("maxValColor",e)+"20",f=o.get("maxValColor",e)):re[c]==="wrong"?(x=o.get("minValColor",e)+"20",f=o.get("minValColor",e)):A.has(c)&&(f=o.get("mainText",e)),t.jsx("div",{onClick:()=>Ge(c),style:{width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px",fontWeight:"bold",color:o.get("mainText",e),backgroundColor:x,border:`2px solid ${f}`,borderRadius:"8px",cursor:b&&!I&&!$?"pointer":"default",userSelect:"none"},children:a},c)})});return t.jsxs("div",{style:B(e,s).container,children:[!b&&!g&&!y&&t.jsxs("div",{style:ft(),children:[t.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:o.get("mainText",e)},children:C[l].level[n]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:C[l].title[n]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:C[l].description[n]}),t.jsxs("div",{style:{fontSize:"15px",color:o.get("mainText",e),marginTop:"12px"},children:[n===0?"Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²: ":"Items: ",C[l].totalItemsRange[0],"â€“",C[l].totalItemsRange[1]]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:n===0?`Ğ’Ñ€ĞµĞ¼Ñ: ${C[l].timeLimitSec} ÑĞµĞº`:`Time: ${C[l].timeLimitSec} sec`}),t.jsx("div",{style:{fontSize:"12px",color:o.get("subText",e),marginTop:"50px",textAlign:"center"},children:n===0?"ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ñ†ĞµĞ»ĞµĞ²Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ (â˜…). ĞÑˆĞ¸Ğ±ĞºĞ¸ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ÑÑ‚ ÑĞµÑ€Ğ¸Ñ.":"Click only on target symbols (â˜…). Mistakes break your streak."})]}),!b&&!g&&!y&&t.jsxs("div",{style:B(e,s).controls,children:[t.jsx(oe,{onClick:()=>he(),style:{fontSize:"60px",color:o.get("close",e)}}),t.jsx(be,{onClick:()=>R(!0),style:{fontSize:"60px",color:o.get("play",e)}}),t.jsx(Se,{onClick:pe,style:{fontSize:"60px",color:o.get("reload",e)}})]}),!y&&g&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",width:"90%",height:"80%"},children:[t.jsx("div",{style:{fontSize:"10rem",marginTop:"180px",color:o.get("icons",e),fontWeight:"bold",lineHeight:1},children:Fe}),t.jsx("div",{style:{fontSize:"2rem",marginBottom:"80px",textAlign:"center"},children:t.jsx("div",{style:{color:o.get("icons",e),marginBottom:"80px"},children:n===0?"ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²ÑŒÑ‚ĞµÑÑŒ!":"Get ready!"})})]}),b&&!y&&t.jsxs("div",{style:B(e).playContainer,children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",width:"86%",borderBottom:`1px solid ${o.get("border",e)}`},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"6px",width:"60%",gap:"20px",marginRight:"auto"},children:[t.jsx(oe,{onClick:()=>S(!1),style:{fontSize:"25px",color:o.get("close",e)}}),$?t.jsx(be,{onClick:Ye,style:{fontSize:"25px",color:o.get("play",e)}}):t.jsx(Qe,{onClick:Be,style:{fontSize:"25px",color:o.get("pause",e)}}),t.jsx(Se,{onClick:pe,style:{fontSize:"25px",color:o.get("reload",e)}})]}),t.jsxs("div",{style:{display:"flex",marginLeft:"auto",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("subText",e)},children:[t.jsx(Xe,{}),ht(Ee)]})]}),t.jsxs("div",{style:{display:"flex",width:"86%",flexDirection:"row",marginTop:"20px",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("minValColor",e)},children:[t.jsx(Ze,{}),ce]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("difficulty",e)},children:[V,"/20"]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("maxValColor",e)},children:[t.jsx(H,{}),P]})]}),t.jsxs("div",{style:{fontSize:"24px",color:L<=3?"red":"white"},children:[L,"s"]}),t.jsxs("div",{style:{marginTop:"20px",width:"95%",display:"flex"},children:[!I&&t.jsxs("div",{style:ve(e,!1),children:[t.jsx("div",{style:{fontSize:"16px",marginBottom:"12px",color:o.get("subText",e)},children:C[l].rules?.[n]||(n===0?"ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° Ğ²ÑĞµ â˜…":"Click all â˜…")}),Ue()]}),I&&t.jsxs("div",{style:ve(e,!0,Ve),children:[t.jsxs("p",{style:{fontSize:"22px",fontWeight:"bold",color:z>0?o.get("maxValColor",e):o.get("minValColor",e)},children:[z>0&&t.jsx(H,{})," ",z>0?z:n===0?"Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸":"mistakes"]}),t.jsx("p",{style:{fontSize:"16px",fontWeight:"bold",color:o.get("mainText",e)},children:We})]})]})]}),y&&t.jsx("div",{style:pt()}),y&&t.jsx("div",{style:B(e,s).controls,children:t.jsx(oe,{onClick:()=>he(),style:{fontSize:"60px",color:o.get("close",e)}})})]})},ft=(s,r,l)=>({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"80%"}),pt=(s,r,l,d,e,u,n)=>({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"80%"}),ve=(s,r,l)=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"95%",minHeight:"56vh",marginTop:"20px",backgroundColor:o.get("bottomPanel",s),boxShadow:r?`0px 0px 9px 9px ${l}`:`2px 2px ${o.get("shadow",s)}`,borderRadius:"24px",fontSize:"39px",fontWeight:"bold",color:o.get("mainText",s),alignContent:"center",padding:"16px"}),B=(s,r)=>({container:{backgroundColor:o.get("background",s),display:"flex",position:"fixed",flexDirection:"column",alignItems:"center",height:"86vh",transform:r?"translateY(0)":"translateY(100%)",bottom:"0",transition:"transform 0.2s ease-in-out",width:"100vw",fontFamily:"Segoe UI",borderTop:`2px solid ${o.get("border",s)}`,borderTopLeftRadius:"12px",borderTopRightRadius:"12px",zIndex:2e3},controls:{display:"flex",marginTop:"30px",gap:"50px"},playContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",height:"50vh",width:"100vw"}}),ht=s=>{const r=Math.floor(s/1e3),l=Math.floor(r/60),d=r%60;return`${String(l).padStart(2,"0")}:${String(d).padStart(2,"0")}`},bt=(s,r,l,d,e,u)=>{const n=Math.round(d/e*100),m=n>=80,w={ru:{high:[`ğŸ‰ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ${d}/${e} (${n}%)`,`ğŸ”¥ ${l} Ğ¾Ñ‡ĞºĞ¾Ğ² â€” Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ÑĞµÑ‚!`],moderate:[`ğŸ™‚ Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°! ${d}/${e} (${n}%)`,"ğŸŒ± Ğ¢Ñ‹ Ğ½Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿ÑƒÑ‚Ğ¸!"],low:["ğŸ¤— Ğ¢Ñ‹ ÑÑ‚Ğ°Ñ€Ğ°Ğ»ÑÑ â€” ÑÑ‚Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ.","ğŸŒ¤ï¸ ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞµÑ‰Ñ‘!"],record:[`ğŸ† ĞĞĞ’Ğ«Ğ™ Ğ Ğ•ĞšĞĞ Ğ”! ${l} Ğ¾Ñ‡ĞºĞ¾Ğ²!`]},en:{high:[`ğŸ‰ Awesome! ${d}/${e} (${n}%)!`,`ğŸ”¥ ${l} points â€” impressive!`],moderate:[`ğŸ™‚ Good effort! ${d}/${e} (${n}%)`,"ğŸŒ± You're making progress!"],low:["ğŸ¤— You gave it your best!","ğŸŒ¤ï¸ Try again!"],record:[`ğŸ† NEW RECORD! ${l} points!`]}},p=r===0?w.ru:w.en;let h=u?p.record:m?p.high:p.moderate;return n<50&&(h=p.low),h[Math.floor(Math.random()*h.length)]},St=s=>{const d=s===0?["ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!","ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾!","Ğ’ĞµÑ€Ğ½Ğ¾!","Ğ¢Ğ¾Ñ‡Ğ½Ğ¾!"]:["Great!","Perfect!","Yes!","Exactly!"];return d[Math.floor(Math.random()*d.length)]},kt=()=>{const[s,r]=i.useState("dark"),[l,d]=i.useState(k.prefs[0]),[e,u]=i.useState(k.prefs[4]),[n,m]=i.useState(!1),[w,p]=i.useState(0),[h,v]=i.useState(et.hasPremium);i.useEffect(()=>{const S=tt.subscribe(v);return()=>S.unsubscribe()},[]),i.useEffect(()=>{const S=Te.subscribe(r),g=we.subscribe(y=>d(y==="ru"?0:1)),R=Ie.subscribe(u);return()=>{S.unsubscribe(),g.unsubscribe(),R.unsubscribe()}},[]);const b=S=>k.mentalRecords?.[3]?.[S]||0;return t.jsxs("div",{style:D(s).container,children:[t.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:t.jsx("div",{style:{width:"90%",display:"grid",gridTemplateColumns:"1fr 1fr",alignItems:"center",justifyContent:"center",gap:"10px"},children:C.slice(0,4).map((S,g)=>{const R=`difficulty${g}`,y=g>1&&!h;return t.jsx(yt,{width:"46vw",difficulty:g,protocol:S,setLevel:p,color:o.get(R,s),theme:s,lang:l,click:()=>{y||(p(g),m(!0))},fSize:e,hasPremium:h,needBlur:y,record:b(g)},g)})})}),n&&t.jsx(gt,{type:3,difficulty:w,show:n,setShow:m})]})},D=(s,r)=>({container:{backgroundColor:o.get("background",s),display:"flex",flexDirection:"column",overflowY:"scroll",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},mainText:{textAlign:"left",fontSize:r===0?"15px":"17px",color:o.get("mainText",s)},cardText:{textAlign:"left",marginBottom:"5px",fontSize:r===0?"14px":"16px",color:o.get("mainText",s),marginLeft:"30px"},text:{textAlign:"left",fontSize:r===0?"10px":"12px",color:o.get("subText",s),marginLeft:"30px"},btn:{width:"70%",height:"40px",borderRadius:"12px",fontSize:r===0?"13px":"14px",color:o.get("mainText",s),backgroundColor:o.get("simplePanel",s)}});function yt({protocol:s,difficulty:r,click:l,width:d,color:e,theme:u,lang:n,fSize:m,hasPremium:w=!1,needBlur:p=!1,record:h=0}){const v=()=>r===0?t.jsx(ot,{style:Y(u)}):r===1?t.jsx(H,{style:Y(u)}):r===2?t.jsx(nt,{style:Y(u)}):r===3?t.jsx(rt,{style:Y(u)}):null,b={alignItems:"center",justifyContent:"center",display:"flex",width:d,flexDirection:"row",height:"12vh",marginTop:"15px",borderRadius:"24px",backgroundColor:e,position:"relative",overflow:"hidden",boxShadow:"3px 3px 2px rgba(0,0,0,0.3)",cursor:p?"not-allowed":"pointer",opacity:p?.8:1};return t.jsxs("div",{style:b,onClick:l,children:[p&&t.jsxs("div",{onClick:S=>S.stopPropagation(),style:{position:"absolute",display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center",width:"100%",height:"100%",backdropFilter:"blur(8px)",zIndex:2},children:[t.jsx("div",{style:{...D(u,m).mainText},children:n===0?"ĞŸÑ€Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ":"Pro category"}),t.jsxs("div",{style:{...D(u,m).mainText},children:["ğŸ‘‘ ",n===0?"Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼":"premium"," ğŸ‘‘"]}),t.jsx("button",{onClick:()=>st("premium"),style:{...D(u,m).btn},children:n===0?"Ğ¡Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼":"Get premium"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:"5%",right:"10px",fontWeight:"bold",fontSize:"14px",color:o.get("maxValColor",u)},children:[t.jsx(H,{style:{marginRight:"4px"}}),h]}),t.jsxs("div",{style:{width:"90%",height:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",paddingLeft:"16px"},children:[t.jsx("h2",{style:D(u,m).cardText,children:s.level[n]}),t.jsx("p",{style:D(u,m).text,children:s.title[n]})]}),v()]})}const Y=s=>({fontSize:"86px",rotate:"-20deg",position:"absolute",right:"-10px",top:"30%",color:o.get("svgColor",s)});export{kt as default};
