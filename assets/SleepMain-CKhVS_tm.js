import{A as f,t as F,f as K,Q as tt,l as rt,j as n,C as s,bC as wt,bD as jt,bE as Mt,bF as vt,bG as Dt,i as ft,T as et,k as kt,aX as Tt,a as Et,aB as Ct}from"./index-BCGldxNK.js";import{r as i}from"./recharts-Bg6K2Pzo.js";import{M as At}from"./MyInput-DJOTjh9F.js";import{S as ct}from"./Slider-Cj5Ek5wl.js";const It=(t,e,o,r,c)=>{const S={bedtime:o,duration:e,mood:r,note:c??""};f.sleepingLog={...f.sleepingLog,[t]:S}};new Audio("Audio/Click.wav");const J=(t,e)=>[s.get("difficulty3",t),s.get("difficulty2",t),s.get("difficulty1",t),s.get("difficulty0",t),s.get("difficulty5",t)][e],Nt=4,Pt=12,zt=10,Ht=Nt*60*60*1e3,Lt=480*60*1e3,Bt=Pt*60*60*1e3,lt=zt*60*1e3,Rt=({dateString:t})=>{const[e,o]=i.useState(F.value),[r,c]=i.useState(K.value),[S,d]=i.useState(f.prefs[0]),[T,P]=i.useState(tt.value),[y,z]=i.useState(0),[m,E]=i.useState(4),[I,v]=i.useState(Lt),[g,H]=i.useState(1320*60*1e3),[O,W]=i.useState("");i.useEffect(()=>{const $=F.subscribe(o),N=K.subscribe(c);return()=>{$.unsubscribe(),N.unsubscribe()}},[]),i.useEffect(()=>{const $=F.subscribe(o),N=rt.subscribe(G=>{d(G==="ru"?0:1)});return()=>{$.unsubscribe(),N.unsubscribe()}},[]),i.useEffect(()=>{const $=tt.subscribe(P);return T==="SleepNew"?setTimeout(()=>z(1),400):z(0),()=>{$.unsubscribe()}},[T]);const M=async()=>{It(t,I,g,m,O),await Tt(),et("")};return n.jsx("div",{style:{...x(e).container,transform:T==="SleepNew"&&Ft(t)?"translateX(0)":"translateX(-100%)",backgroundColor:y===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:n.jsxs("div",{style:x(e).panel,children:[n.jsx("p",{style:x(e,r).text,children:S===0?"–í–æ —Å–∫–æ–ª—å–∫–æ —É—Å–Ω—É–ª?":"What time did you go to bed?"}),n.jsxs("div",{style:{width:"100%"},children:[n.jsx("p",{style:x(e,r).textDate,children:ut(g)}),n.jsx(ct,{onChange:$=>H($.target.value),min:0,max:1440*60*1e3,step:lt,value:g,style:x(e).slider})]}),n.jsx("p",{style:x(e,r).text,children:S===0?"–°–∫–æ–ª—å–∫–æ —Å–ø–∞–ª —Å–µ–≥–æ–¥–Ω—è?":"How much did you sleep today?"}),n.jsxs("div",{style:{width:"100%"},children:[n.jsx("p",{style:x(e,r).textDate,children:ut(I)}),n.jsx(ct,{onChange:$=>v($.target.value),min:Ht,max:Bt,step:lt,value:I,style:x(e).slider})]}),n.jsx("p",{style:x(e,r).text,children:S===0?"–ö–∞–∫ —Å–∞–º–æ—á—É–≤—Å—Ç–∏–µ?":"How do you feel?"}),n.jsxs("div",{style:x(e).simplePanelRow,children:[n.jsx(wt,{style:{...x(e).icon,color:m===1?J(e,0):s.get("simplePanel",e)},onClick:()=>E(1)}),n.jsx(jt,{style:{...x(e).icon,color:m===2?J(e,1):s.get("simplePanel",e)},onClick:()=>E(2)}),n.jsx(Mt,{style:{...x(e).icon,color:m===3?J(e,2):s.get("simplePanel",e)},onClick:()=>E(3)}),n.jsx(vt,{style:{...x(e).icon,color:m===4?J(e,3):s.get("simplePanel",e)},onClick:()=>E(4)}),n.jsx(Dt,{style:{...x(e).icon,color:m===5?J(e,4):s.get("simplePanel",e)},onClick:()=>E(5)})]}),n.jsx(At,{maxL:500,h:"20%",w:"90%",placeHolder:S===0?"–ó–∞–º–µ—Ç–∫–∞(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ , –º–æ–∂–µ—à—å –∑–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π —Å–æ–Ω)":"Notes(optional , can write your dream)",theme:e,onChange:$=>W($)}),n.jsxs("div",{style:{...x(e).simplePanelRow,marginTop:"55px"},children:[n.jsx(ft,{style:{...x(e).icon,fontSize:"38px"},onClick:()=>et("")}),n.jsx(kt,{style:{...x(e).icon,fontSize:"38px"},onClick:()=>M()})]})]})})},x=(t,e)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,width:"100vw"},panel:{alignItems:"center",justifyItems:"center",borderRadius:"24px",border:`1px solid ${s.get("border",t)}`,margin:"5px",backgroundColor:s.get("background",t),boxShadow:`4px 4px 6px ${s.get("shadow",t)}`,width:"95vw",height:"70vh",marginBottom:"16%"},text:{textAlign:"center",fontSize:e?"13px":"15px",color:s.get("mainText",t),marginBottom:"12px"},subtext:{textAlign:"center",fontSize:e?"11px":"13px",color:s.get("subText",t),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:s.get("mainText",t),marginBottom:"4px"},simplePanelRow:{width:"85vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",userSelect:"none",touchAction:"none"},icon:{fontSize:"58px",padding:"5px",marginTop:"10px",color:s.get("icons",t),userSelect:"none",touchAction:"none"},slider:{width:"90%",userSelect:"none",touchAction:"none",color:s.get("icons",t)}}),ut=t=>{const e=Math.floor(t/6e4),o=Math.floor(e/60),r=e%60;return`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};function Ft(t){const e=new Date(t),o=new Date;e.setHours(0,0,0,0),o.setHours(0,0,0,0);const r=e<=o;return r||et(""),r}const dt=["–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π –∏ –¥–∞–π –∫—Ä–∞—Ç–∫–∏–π, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π –æ—Ç—á—ë—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.","You are a personal fitness analyst. Analyze the data from the last 7 days and provide a short, practical report in English."],gt=[`–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–≤–µ—Ç—É:
1) –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –Ω–µ–¥–µ–ª—é.
2) –û—Ç–º–µ—Ç—å —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã.
3) –£–∫–∞–∂–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã (—á—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ—Å—å, –≥–¥–µ –Ω–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞).
4) –î–∞–π 3‚Äì5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏–º—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é.
5) –°—Ç–∏–ª—å: –∫–æ—Ä–æ—Ç–∫–æ, –ø–æ –¥–µ–ª—É, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–µ, –±–µ–∑ "–≤–æ–¥—ã". –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç ‚Äî —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Markdown, —Å–ø–∏—Å–∫–∏ –∏–ª–∏ –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º:
- –î–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–•–æ–¥—å–±–∞"): status = -1 ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, status = 0 ‚Üí –ø—Ä–æ–ø—É—â–µ–Ω–æ.
- –î–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö—É—Ä–µ–Ω–∏–µ"): status = 1 ‚Üí —É—Å–ø–µ—Ö (–≤–æ–∑–¥–µ—Ä–∂–∞–ª—Å—è), status = 0 ‚Üí —Å—Ä—ã–≤.

–î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:`,`Requirements for your response:
1) Briefly describe the overall activity level and progress over the past week.
2) Highlight strengths and positive trends.
3) Point out problem areas (what is most often skipped or shows no progress).
4) Give 3‚Äì5 specific, actionable recommendations for next week.
5) Style: short, to the point, motivating, no fluff. Each point on a new line. Do not use Markdown, bullets, or bold text.

Habit status note:
- For positive habits (e.g., "Walking"): status = -1 ‚Üí completed, status = 0 ‚Üí skipped.
- For negative habits (e.g., "Smoking"): status = 1 ‚Üí success (abstained), status = 0 ‚Üí relapse.

Data to analyze:`];function Ot(t){const e=new Date,o=[];for(let l=6;l>=0;l--){const a=new Date(e);a.setDate(a.getDate()-l),o.push(a.toISOString().split("T")[0])}const r=f.pData||{},c=f.habitsByDate||{},S=f.trainingLog||{},d=f.breathingLog||{},T=f.meditationLog||{},P=f.hardeningLog||{},y=f.sleepingLog||{},z=f.mentalLog||{},m=f.mentalRecords||[],E=f.programs||{},I=f.exercises||{},v=Et||{},g=(l,a)=>a.length===0?`${l} (last 7 days):
  No data
`:`${l} (last 7 days):
${a.join(`
`)}
`,H=`
USER:
- age: ${r.age||"unknown"}
- gender: ${r.gender!==void 0?r.gender:"unknown"}
- height: ${r.height||"unknown"} cm
- wrist: ${r.wrist||"unknown"} cm
- goal: ${r.goal||"unknown"}
`.trim(),O=[];o.forEach(l=>{const a=c[l];if(!a)return;const w=(Array.isArray(a)?a:Object.entries(a).map(([h,b])=>({habitId:Number(h),status:b}))).map(h=>{const b=v[h.habitId],L=b?.name?b.name[t]||b.name[0]||`Habit #${h.habitId}`:`Habit #${h.habitId}`;return{habitId:h.habitId,status:h.status,habitName:L}});w.length>0&&O.push(`  ${l}: ${JSON.stringify(w)}`)});const W=g(t===0?"–ü–†–ò–í–´–ß–ö–ò (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)":"HABITS_BY_DATE",O),M=[];o.forEach(l=>{const a=S[l];!a||!a.length||(M.push(`  DATE: ${l}`),a.forEach((p,w)=>{const h=E[p.programId],b=h?.name?h.name[t]||h.name[0]||`Program #${p.programId}`:`Program #${p.programId}`;M.push(`    [Session #${w+1}] program: ${b}, dayIndex: ${p.dayIndex}, completed: ${p.completed}, duration(ms): ${p.duration||0}, tonnage: ${p.tonnage||0}`),M.push("      exercises:"),(p.exerciseOrder||[]).forEach(j=>{const k=p.exercises?.[j],R=I[j],St=R?.name?R.name[t]||R.name[0]||`Exercise #${j}`:`Exercise #${j}`;k&&(M.push(`        - ${St} (mgId: ${k.mgId||"N/A"})`),M.push("          sets:"),(k.sets||[]).forEach((Q,$t)=>{M.push(`            * set ${$t+1}: type=${Q.type||"N/A"}, reps=${Q.reps||0}, weight=${Q.weight||0}, time=${Q.time||0}`)}),M.push(`          totalTonnage: ${k.totalTonnage||0}, completed: ${k.completed||!1}`))})}))});const $=g(t===0?"–¢–†–ï–ù–ò–†–û–í–ö–ò":"TRAININGS",M),N=(l,a=[])=>{const p=[];return o.forEach(w=>{const h=l[w];!h||!h.length||(p.push(`  ${w}:`),h.forEach((b,L)=>{const j=(b.endTime||0)-(b.startTime||0);let k=`    #${L+1}: duration(ms): ${j}`;a.forEach(R=>{b[R]!=null&&(k+=`, ${R}: ${b[R]}`)}),p.push(k)}))}),p},G=g(t===0?"–î–´–•–ê–ù–ò–ï":"BREATHING",N(d,["maxHold"])),U=g(t===0?"–ú–ï–î–ò–¢–ê–¶–ò–Ø":"MEDITATION",N(T)),X=g(t===0?"–ó–ê–ö–ê–õ–ò–í–ê–ù–ò–ï":"HARDENING",N(P,["timeInColdWater"])),u=[];let C=0,D=0;o.forEach(l=>{const a=z[l];if(a==null)return;const p=Number(a)||0;C+=p,D++,u.push(`  ${l}: duration(sec): ${p}, duration(min): ${Math.round(p/60*10)/10}`)}),u.length>0&&u.push(`  total(sec): ${C}, total(min): ${Math.round(C/60*10)/10}, days: ${D}`);const _=g(t===0?"–ú–ï–ù–¢–ê–õ–¨–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨":"MENTAL",u),nt=[["–ë—ã—Å—Ç—Ä—ã–π —Å—á—ë—Ç","Mental math"],["–ü–∞–º—è—Ç—å –≤ –¥–µ–π—Å—Ç–≤–∏–∏","Memory"],["–ß–∏—Å–ª–æ–≤–∞—è –ª–æ–≥–∏–∫–∞","Number logic"],["–ß–∏—Å—Ç—ã–π —Ñ–æ–∫—É—Å","Pure focus"]],Y=[];(m||[]).forEach((l,a)=>{const p=nt[a]?.[t]||`Category ${a}`,w=(Array.isArray(l)?l:[]).map(j=>Number(j)||0),h=w.length?Math.max(...w):0,b=w.filter(j=>j>0),L=b.length?Math.round(b.reduce((j,k)=>j+k,0)/b.length*10)/10:0;Y.push(`  ${p}: best=${h}, avg(nonZero)=${L}, byDifficulty=${JSON.stringify(w)}`)});const B=Y.length?t===0?`–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ú–ï–ù–¢–ê–õ–¨–ù–´–• –¢–†–ï–ù–ò–†–û–í–û–ö (–ª—É—á—à–∏–µ):
${Y.join(`
`)}
`:`MENTAL_RECORDS (best scores):
${Y.join(`
`)}
`:t===0?`–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ú–ï–ù–¢–ê–õ–¨–ù–´–• –¢–†–ï–ù–ò–†–û–í–û–ö:
  –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
`:`MENTAL_RECORDS:
  No data
`;function V(l){const p=[100,200,300,400][l]||100;let w=0;for(let h=1;h<=20;h++){const b=Math.min(1+h*.02,1.3),L=1.6,j=h-1,k=j>=5?Math.min(1+.1*Math.min(j/10,4),1.5):1;w+=Math.round(p*b*L*k)}return w}const Z=[["–Ω–∞—á–∞–ª—å–Ω—ã–π","novice"],["—Å—Ä–µ–¥–Ω–∏–π","intermediate"],["–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π","advanced"],["–±–µ–∑—É–º–Ω—ã–π","insane"]].map((l,a)=>`  ${l[t]||l[0]}: estimatedMax‚âà${V(a)}`),mt=t===0?`–ü–û–î–°–ö–ê–ó–ö–ò –ü–û –ú–ê–ö–°. –ë–ê–õ–õ–ê–ú (–º–∞—Å—à—Ç–∞–± –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –º–∞–∫—Å–∏–º—É–º –ø—Ä–∏ –∏–¥–µ–∞–ª—å–Ω–æ–º —Ä–µ—à–µ–Ω–∏–∏ 20 –≤–æ–ø—Ä–æ—Å–æ–≤):
${Z.join(`
`)}
`:`MENTAL_SCORE_HINTS (math scale, estimated max for perfect 20 questions):
${Z.join(`
`)}
`,at=[];o.forEach(l=>{const a=y[l];a&&at.push(`  ${l}: bedtime(ms): ${a.bedtime||0}, duration(ms): ${a.duration||0}, mood(1-5): ${a.mood||"N/A"}, note: "${a.note||""}"`)});const bt=g(t===0?"–°–û–ù":"SLEEP",at),xt=(dt[t]||dt[0]).trim(),yt=`
${(gt[t]||gt[0]).trim()}

${H}

${W}
${$}
${G}
${U}
${X}
${_}
${B}
${mt}
${bt}
`.trim();return{systemPrompt:xt,userPrompt:yt}}async function _t(t){try{const{systemPrompt:e,userPrompt:o}=Ot(t),r=await fetch("/api/insight",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:e},{role:"user",content:o}]})});if(!r.ok)throw new Error(`Insight API error: ${r.status}`);return await r.json()}catch(e){throw console.error("Failed to get insight:",e),e}}new Audio("Audio/Click.wav");const Yt=()=>{const[t,e]=i.useState(F.value),[o,r]=i.useState(K.value),[c,S]=i.useState(f.prefs[0]),[d,T]=i.useState(tt.value),[P,y]=i.useState(0),[z,m]=i.useState(""),[E,I]=i.useState(!0);return i.useEffect(()=>{(async()=>{try{const g=await _t(c);m(g.insight)}catch{m(c===0?"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Å–∞–π—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":"Failed to load insight. Please try again.")}finally{I(!1)}})()},[c]),i.useEffect(()=>{const v=F.subscribe(e),g=K.subscribe(r);return()=>{v.unsubscribe(),g.unsubscribe()}},[]),i.useEffect(()=>{const v=F.subscribe(e),g=rt.subscribe(H=>{S(H==="ru"?0:1)});return()=>{v.unsubscribe(),g.unsubscribe()}},[]),i.useEffect(()=>{const v=tt.subscribe(T);return d==="SleepInsight"?setTimeout(()=>y(1),400):y(0),()=>{v.unsubscribe()}},[d]),n.jsx("div",{style:{...pt(t).container,transform:d==="SleepInsight"?"translateX(0)":"translateX(-100%)",backgroundColor:P===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:n.jsxs("div",{style:pt(t).panel,children:[n.jsx("div",{style:{fontSize:o===0?"15px":"18px",color:s.get("mainText",t),fontWeight:"bold"},children:c===0?"–ò–ò –∞–Ω–∞–ª–∏–∑ü§ñ‚ú®":"AI analysisü§ñ‚ú®"}),n.jsx("div",{style:{width:"90%",height:"80%",overflowY:"scroll",borderTop:`1px solid ${s.get("border",t)}`,borderBottom:`1px solid ${s.get("border",t)}`,padding:"16px",fontSize:o===0?"14px":"16px",color:s.get("mainText",t),textAlign:"left"},children:E?c===0?"–§–æ—Ä–º–∏—Ä—É—é –∏–Ω—Å–∞–π—Ç... ü§ñ":"Forming insight... ü§ñ":n.jsx("div",{children:z.split(`
`).map((v,g)=>n.jsx("p",{style:{margin:"0.5em 0"},children:v},g))})}),n.jsxs("div",{children:[n.jsx(ft,{onClick:()=>{et("")},style:{fontSize:"42px",color:s.get("icons",t)}}),n.jsx("div",{style:{fontSize:"9px",color:s.get("subText",t)},children:c===0?"–∑–∞–∫—Ä—ã—Ç—å":"close"})]})]})})},pt=(t,e)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,width:"100vw"},panel:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",border:`1px solid ${s.get("border",t)}`,margin:"5px",backgroundColor:s.get("background",t),boxShadow:`4px 4px 6px ${s.get("shadow",t)}`,marginTop:"10vh",width:"95vw",height:"79vh",padding:"5px",marginBottom:"16%"},text:{textAlign:"center",fontSize:"15px",color:s.get("mainText",t),marginBottom:"12px"}}),Wt=t=>(t.getDay()+6)%7,q=t=>{const e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${r}`},st=new Audio("Audio/Click.wav"),Gt=(t,e)=>[s.get("difficulty3",t),s.get("difficulty2",t),s.get("difficulty1",t),s.get("difficulty0",t),s.get("difficulty5",t)][e]||s.get("background",t),ht=t=>{if(typeof t!="number"||t<0)return"--:--";const e=Math.floor(t/(60*1e3)),o=Math.floor(e/60),r=e%60;return`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};function ot(t){f.prefs[2]===0&&t&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),f.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Ut=t=>{if(typeof t!="number"||t<0)return 0;const e=3600*1e3,o=4,r=12,c=o*e,S=r*e;if(t<=c)return 0;if(t>=S)return 100;const d=S-c,T=(t-c)/d;return Math.round(T*100)},Zt=()=>{const[t,e]=i.useState("dark"),[o,r]=i.useState(f.prefs[0]),[c,S]=i.useState(new Date),[d,T]=i.useState(new Date),P=i.useRef(d),[y,z]=i.useState(f.prefs[4]),[m,E]=i.useState(null);i.useEffect(()=>{const u=F.subscribe(e),C=rt.subscribe(_=>r(_==="ru"?0:1)),D=K.subscribe(z);return()=>{u.unsubscribe(),C.unsubscribe(),D.unsubscribe()}},[]),i.useEffect(()=>{P.current=d},[d]),i.useEffect(()=>{const u=Ct.subscribe(()=>{const C=new Date,D=P.current;D>C||(q(D),q(C))});return()=>u.unsubscribe()},[]);const I=new Date(c.getFullYear(),c.getMonth(),1),g=new Date(c.getFullYear(),c.getMonth()+1,0).getDate(),H=(I.getDay()+6)%7,O=[["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–í—Å"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],W=[["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞","–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],M=Array(H).fill(null);for(let u=1;u<=g;u++)M.push(u);const $=[];for(let u=0;u<M.length;u+=7)$.push(M.slice(u,u+7));const N=()=>{S(new Date(c.getFullYear(),c.getMonth()-1)),ot(st)},G=()=>{S(new Date(c.getFullYear(),c.getMonth()+1)),ot(st)},U=c.getMonth(),X=c.getFullYear();return n.jsxs("div",{style:A(t,y).container,children:[n.jsxs("div",{style:A(t,y).panel,children:[n.jsxs("div",{style:A(t,y).calendarHead,children:[n.jsxs("h1",{style:A(t,y).header,children:[c.getFullYear(),"/",String(c.getMonth()+1).padStart(2,"0")]}),n.jsx("div",{onClick:N,style:{cursor:"pointer"},children:n.jsx("h1",{style:A(t,y).header,children:"<"})}),n.jsx("div",{onClick:G,style:{cursor:"pointer"},children:n.jsx("h1",{style:A(t,y).header,children:">"})})]}),n.jsxs("table",{style:A(t,y).table,children:[n.jsx("thead",{children:n.jsx("tr",{children:O[o].map(u=>n.jsx("th",{children:n.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:u==="–í—Å"||u==="Sun"?"#873535ff":s.get("subText",t)},children:u})},u))})}),n.jsx("tbody",{children:$.map((u,C)=>n.jsx("tr",{children:u.map((D,_)=>{if(D===null)return n.jsx("td",{},_);const nt=new Date(X,U,D),Y=q(nt),B=f.sleepingLog?.[Y],V=D===d.getDate()&&U===d.getMonth()&&X===d.getFullYear();let it=s.get("background",t);return n.jsx("td",{children:n.jsxs("div",{style:{...A(t,y).cell,backgroundColor:it,border:`3px solid ${V?s.get("currentDateBorder",t):"transparent"}`,color:V?s.get("textHighlight",t):s.get("mainText",t),display:"flex",alignItems:"flex-end",justifyContent:"center",position:"relative",overflow:"hidden",cursor:"pointer"},onClick:()=>{const Z=new Date(X,U,D);T(Z),ot(st),E(B||null)},children:[B&&typeof B.duration=="number"&&n.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:`${Ut(B.duration)}%`,backgroundColor:Gt(t,B.mood-1),backdropFilter:"blur(2px)",zIndex:0}}),n.jsx("span",{style:{position:"relative",zIndex:1},children:D})]})},_)})},C))})]})]}),n.jsxs("p",{style:{...A(t,y).subtext,fontSize:"18px",textAlign:"center",marginTop:"12px"},children:[d.getDate(),"-",d.getMonth()+1,"-",d.getFullYear()," ",W[o][Wt(d)]]}),m&&n.jsxs("div",{style:A(t,y).sleepInfoPanel,children:[n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"–í—Ä–µ–º—è –æ—Ç–±–æ—è:":"Bedtime:"})," ",ht(m.bedtime)]}),n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:":"Duration:"})," ",ht(m.duration)]}),n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:":"Mood:"})," ","‚òÖ".repeat(m.mood),"‚òÜ".repeat(5-m.mood)]}),m.note&&n.jsxs("div",{children:[n.jsx("strong",{children:o===0?"–ó–∞–º–µ—Ç–∫–∞:":"Note:"})," ",m.note]})]}),n.jsx(Rt,{dateString:q(d)}),n.jsx(Yt,{dateString:q(d)})]})},A=(t,e)=>({container:{backgroundColor:s.get("background",t),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${s.get("border",t)}`},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:s.get("headGradient",t)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:s.get("subText",t)},table:{borderCollapse:"collapse",width:"90%",textAlign:"center",tableLayout:"fixed"},cell:{boxSizing:"border-box",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",fontFamily:"Segoe UI"},subtext:{textAlign:"left",fontSize:e===0?"11px":"13px",color:s.get("subText",t),marginLeft:"10px",marginBottom:"12px"},sleepInfoPanel:{marginTop:"16px",padding:"12px",backgroundColor:s.get("card",t),borderRadius:"8px",fontSize:e===0?"13px":"15px",color:s.get("text",t),maxWidth:"90vw",width:"100%"}});export{Zt as default};
