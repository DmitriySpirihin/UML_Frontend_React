import{j as t,C as o,A as v,U as $,t as T,l as R,f as A,p as L,cB as F,bX as W,L as D,bY as P,m as I}from"./index-CrdJj9Qr.js";import{i as O,B as H,s as U,X as E,Y,T as K,t as N,u as X,r as u}from"./recharts-C3psbGwv.js";const k=e=>{if(!e||e<=0)return"0:00";const i=Math.floor(e/6e4),s=Math.floor(i/60),d=i%60;return`${s}:${d.toString().padStart(2,"0")}`},_=e=>e/(1e3*60*60),G=({data:e=[],theme:i="dark",textColor:s="#94a3b8",linesColor:d="#334155",backgroundColor:g="transparent",height:x=220})=>{const h=i==="light";if(!Array.isArray(e)||e.length===0)return t.jsx("div",{style:{height:`${x}px`,display:"flex",alignItems:"center",justifyContent:"center",color:s,opacity:.6,fontFamily:"Segoe UI, sans-serif",fontSize:"14px"},children:"No sleep data available"});const S={1:o.get("veryBad",i),2:o.get("bad",i),3:o.get("normal",i),4:o.get("good",i),5:o.get("perfect",i)},y=e.map(a=>({date:a.date,ms:a.ms||0,mood:Math.max(1,Math.min(5,Math.round(a.mood||3))),hours:_(a.ms||0)})),C=Math.max(...y.map(a=>a.hours),1),b=a=>S[a]||S[3],c=({active:a,payload:f,label:n})=>{if(a&&f&&f.length){const l=f[0].payload,m=l?.ms||0,p=l?.mood||0,j=p?"★".repeat(p):"—",z=b(p);return t.jsxs("div",{style:{backgroundColor:h?"rgba(255,255,255,0.9)":"rgba(30,30,30,0.9)",backdropFilter:"blur(10px)",padding:"10px 14px",borderRadius:"12px",border:`1px solid ${z}40`,boxShadow:"0 8px 20px rgba(0,0,0,0.15)",fontFamily:"Segoe UI",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"12px",color:s,marginBottom:"4px",opacity:.8},children:n}),t.jsxs("div",{style:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",i)},children:[k(m)," ",t.jsx("span",{style:{fontSize:"11px",fontWeight:"400"},children:"hrs"})]}),t.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",fontWeight:"600",color:z,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"Mood:"})," ",t.jsx("span",{style:{letterSpacing:"2px"},children:j})]})]})}return null};return t.jsx("div",{style:{width:"100%",height:`${x}px`,backgroundColor:g,borderRadius:"16px",padding:"10px 0",fontFamily:"Segoe UI, sans-serif"},children:t.jsx(O,{width:"100%",height:"100%",children:t.jsxs(H,{data:y,margin:{top:20,right:10,left:-25,bottom:0},barSize:18,children:[t.jsx("defs",{children:[1,2,3,4,5].map(a=>t.jsxs("linearGradient",{id:`grad-${a}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:b(a),stopOpacity:1}),t.jsx("stop",{offset:"100%",stopColor:b(a),stopOpacity:.6})]},a))}),t.jsx(U,{stroke:d,strokeOpacity:.2,vertical:!1,strokeDasharray:"4 4"}),t.jsx(E,{dataKey:"date",tick:{fill:s,fontSize:10,opacity:.7},axisLine:!1,tickLine:!1,dy:10,interval:"preserveStartEnd"}),t.jsx(Y,{domain:[0,Math.ceil(C+1)],tick:{fill:s,fontSize:10,opacity:.7},axisLine:!1,tickLine:!1,tickFormatter:a=>`${a}h`}),t.jsx(K,{content:t.jsx(c,{}),cursor:{fill:h?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.05)",radius:4}}),t.jsx(N,{dataKey:"hours",radius:[6,6,6,6],animationDuration:1200,shape:a=>{const{x:f,y:n,width:l,height:m,index:p}=a,j=y[p]?.mood||3;return t.jsx("rect",{x:f,y:n,width:l,height:m,fill:`url(#grad-${j})`,rx:l/2,ry:l/2})},children:t.jsx(X,{dataKey:"ms",position:"top",offset:8,fontSize:10,fontWeight:600,fill:s,formatter:a=>k(a)})})]})})})},V=[28,180,360],q=[["Месяц","Month"],["6 Мес","6 Mon"],["Год","Year"]],J=e=>Math.floor(e/6e4),M=e=>{if(!e)return"0h 0m";const i=J(e),s=Math.floor(i/60),d=i%60;return s>0?`${s}h ${d}m`:`${d}m`},Q=(e,i)=>new Date(e).toLocaleDateString(i===0?"ru-RU":"en-US",{day:"numeric",month:"short"}),B=(e,i)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][i-1]||o.get("subText",e),Z=({selectedIndex:e,setSelectedIndex:i,theme:s,langIndex:d})=>t.jsx("div",{style:r(s).segmentedControl,children:q.map((g,x)=>{const h=e===x;return t.jsxs(I.div,{onClick:()=>i(x),style:{...r(s).segmentBtn,color:h?o.get("mainText",s):o.get("subText",s),fontWeight:h?"600":"500"},children:[h&&t.jsx(I.div,{layoutId:"segmentBg",style:r(s).segmentActiveBg}),t.jsx("div",{style:{position:"relative",zIndex:1},children:g[d==="ru"?0:1]})]},x)})}),w=({icon:e,label:i,value:s,subLabel:d,theme:g,color:x})=>t.jsxs("div",{style:r(g).statCard,children:[t.jsx("div",{style:{...r(g).iconBox,color:x,backgroundColor:`${x}15`},children:e}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:r(g).statLabel,children:i}),t.jsx("div",{style:r(g).statValue,children:s}),d&&t.jsx("div",{style:r(g).statSub,children:d})]})]}),oe=()=>{const[e,i]=u.useState("dark"),[s,d]=u.useState(v.prefs[0]),[g,x]=u.useState(v.prefs[4]),[h,S]=u.useState($.hasPremium);u.useEffect(()=>{const n=T.subscribe(i),l=R.subscribe(d),m=A.subscribe(x),p=L.subscribe(S);return()=>{n.unsubscribe(),l.unsubscribe(),m.unsubscribe(),p.unsubscribe()}},[]);const[y,C]=u.useState(0),b=u.useMemo(()=>v.sleepingLog?Object.entries(v.sleepingLog).map(([n,l])=>({date:n,durationMs:l.duration||0,mood:l.mood||0,note:l.note||""})).sort((n,l)=>new Date(n.date)-new Date(l.date)):[],[]),c=u.useMemo(()=>{if(b.length===0)return[];const n=new Date;return n.setDate(n.getDate()-V[y]),b.filter(l=>new Date(l.date)>=n)},[b,y]),a=u.useMemo(()=>c.map(n=>({date:n.date.split("-").slice(1).reverse().join("."),ms:n.durationMs,mood:n.mood||3})),[c]),f=u.useMemo(()=>{if(c.length===0)return{avg:0,best:0,count:0};const l=c.reduce((p,j)=>p+j.durationMs,0)/c.length,m=Math.max(...c.map(p=>p.durationMs));return{avg:l,best:m,count:c.length}},[c]);return t.jsxs("div",{style:r(e).container,children:[t.jsxs("div",{style:r(e).scrollContent,children:[t.jsxs("div",{style:r(e).headerSection,children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px"},children:[t.jsx(F,{size:20,color:o.get("accent",e)}),t.jsx("h2",{style:r(e).pageTitle,children:s===0?"Аналитика Сна":"Sleep Analytics"})]}),t.jsx(Z,{selectedIndex:y,setSelectedIndex:C,theme:e,langIndex:s})]}),t.jsxs("div",{style:r(e).statsRow,children:[t.jsx(w,{icon:t.jsx(W,{}),label:s===0?"Средний сон":"Avg Sleep",value:M(f.avg),theme:e,color:o.get("normal",e)}),t.jsx(w,{icon:t.jsx(D,{}),label:s===0?"Лучший сон":"Best Sleep",value:M(f.best),theme:e,color:o.get("perfect",e)})]}),t.jsxs("div",{style:r(e).chartContainer,children:[t.jsxs("div",{style:r(e).chartHeader,children:[t.jsx("span",{style:r(e).chartTitle,children:s===0?"Динамика":"Dynamics"}),t.jsxs("span",{style:r(e).chartSub,children:[f.count," ",s===0?"записей":"records"]})]}),t.jsx("div",{style:{height:"200px",width:"100%"},children:t.jsx(G,{data:a,theme:e,textColor:o.get("subText",e),linesColor:o.get("border",e),backgroundColor:o.get("simplePanel",e),barColor:o.get("accent",e)})})]}),t.jsxs("div",{style:r(e).historySection,children:[t.jsxs("div",{style:r(e).sectionHeader,children:[t.jsx(P,{size:14,color:o.get("subText",e)}),t.jsx("span",{children:s===0?"История":"History"})]}),t.jsx("div",{style:r(e).listContainer,children:c.length===0?t.jsx("div",{style:r(e).emptyState,children:s===0?"Нет данных за период":"No data for this period"}):c.slice().reverse().map((n,l)=>t.jsxs("div",{style:r(e).listItem,children:[t.jsx("div",{style:r(e).dateBox,children:t.jsx("span",{style:r(e).dateDay,children:Q(n.date,s)})}),t.jsxs("div",{style:r(e).itemCenter,children:[t.jsx("div",{style:r(e).durationText,children:M(n.durationMs)}),n.note&&t.jsx("div",{style:r(e).noteText,children:n.note})]}),n.mood>0&&t.jsxs("div",{style:r(e).moodBox,children:[t.jsx(D,{size:12,color:B(e,n.mood)}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:B(e,n.mood)},children:n.mood})]})]},`${n.date}-${l}`))})]}),t.jsx("div",{style:{marginBottom:"80px"}})," "]}),!h&&t.jsx("div",{onClick:n=>n.stopPropagation(),style:{position:"absolute",inset:0,zIndex:2,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:T.value==="dark"?"rgba(10, 10, 10, 0.85)":"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(11px)",textAlign:"center"},children:t.jsx("div",{style:{color:T.value==="dark"?"#FFD700":"#D97706",fontSize:"11px",fontWeight:"bold",fontFamily:"Segoe UI"},children:s===0?"ТОЛЬКО ДЛЯ ПРЕМИУМ":"PREMIUM USERS ONLY"})})]})},r=e=>({container:{backgroundColor:o.get("background",e),height:"90vh",marginTop:"40px",width:"100vw",paddingTop:"80px",display:"flex",flexDirection:"column",fontFamily:"Segoe UI, sans-serif"},scrollContent:{flex:1,overflowY:"auto",padding:"0 20px 40px 20px",display:"flex",flexDirection:"column",gap:"20px"},headerSection:{display:"flex",flexDirection:"column",marginTop:"20px"},pageTitle:{fontSize:"24px",fontWeight:"800",color:o.get("mainText",e),margin:0},segmentedControl:{display:"flex",backgroundColor:o.get("simplePanel",e),borderRadius:"12px",padding:"4px",border:`1px solid ${o.get("border",e)}50`},segmentBtn:{flex:1,position:"relative",textAlign:"center",padding:"8px",fontSize:"13px",cursor:"pointer",zIndex:1},segmentActiveBg:{position:"absolute",inset:0,backgroundColor:e==="dark"?"rgba(255,255,255,0.1)":"#fff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:-1},statsRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},statCard:{backgroundColor:o.get("simplePanel",e),borderRadius:"16px",padding:"16px",display:"flex",alignItems:"center",gap:"12px",border:`1px solid ${o.get("border",e)}30`},iconBox:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px"},statLabel:{fontSize:"11px",color:o.get("subText",e),textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"2px"},statValue:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",e)},chartContainer:{backgroundColor:o.get("simplePanel",e),borderRadius:"20px",padding:"20px",border:`1px solid ${o.get("border",e)}30`},chartHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},chartTitle:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",e)},chartSub:{fontSize:"12px",color:o.get("subText",e)},historySection:{display:"flex",flexDirection:"column",gap:"10px"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",fontWeight:"600",color:o.get("subText",e),paddingLeft:"4px"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},listItem:{display:"flex",alignItems:"center",backgroundColor:e==="dark"?"rgba(255,255,255,0.03)":"#fff",padding:"12px",borderRadius:"16px",border:`1px solid ${o.get("border",e)}30`},dateBox:{width:"50px",display:"flex",flexDirection:"column",alignItems:"center",borderRight:`1px solid ${o.get("border",e)}30`,paddingRight:"12px",marginRight:"12px"},dateDay:{fontSize:"12px",fontWeight:"700",color:o.get("mainText",e),textAlign:"center"},itemCenter:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},durationText:{fontSize:"15px",fontWeight:"600",color:o.get("mainText",e)},noteText:{fontSize:"11px",color:o.get("subText",e),marginTop:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px"},moodBox:{display:"flex",alignItems:"center",gap:"4px",backgroundColor:o.get("background",e),padding:"4px 8px",borderRadius:"8px"},emptyState:{textAlign:"center",padding:"40px",color:o.get("subText",e),fontSize:"14px",fontStyle:"italic"}});export{oe as default};
