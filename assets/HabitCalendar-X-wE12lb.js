import{R as w,r as h,A as u,t as tt,g as et,l as st,h as nt,j as e,C as i,s as K,a as it,b as P,m as at,e as ot}from"./index-vv74FGn7.js";import{B as rt,a as lt,M as _,b as W,A as ct,c as dt,C as ut,d as gt}from"./Calendar_Light-C4c3AKvL.js";import{D as pt}from"./Done_Icon-Vq4AKoy9.js";import{u as ht,a as ft,b as V}from"./index-BihqGgkw.js";const xt="https://dmitriyspirihin.github.io/UltyMyLife_Bot/assets/Skipped_Icon-Dw_oKt7q.png",S=t=>{const r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${r}-${a}-${o}`},bt=t=>(t.getDay()+6)%7;S(new Date);const T=new Audio(new URL("https://dmitriyspirihin.github.io/UltyMyLife_Bot/assets/SwitchPanel-CJjFfFgV.wav",import.meta.url).href),yt=new Audio(new URL("https://dmitriyspirihin.github.io/UltyMyLife_Bot/assets/Click_Calendar-DitEighf.wav",import.meta.url).href),mt=new Audio(new URL("https://dmitriyspirihin.github.io/UltyMyLife_Bot/assets/IsDone-CY5KfW9n.wav",import.meta.url).href),N=new Audio(new URL("https://dmitriyspirihin.github.io/UltyMyLife_Bot/assets/Skip-C95holY4.wav",import.meta.url).href);function wt(){return P.concat((u.CustomHabits||[]).filter(t=>!P.some(r=>r.id===t.id)))}const Tt=()=>{const[t,r]=w.useState("dark"),[a,o]=w.useState("dark"),[c,f]=h.useState(u.prefs[0]),[s,p]=h.useState(new Date),[d,y]=h.useState(s),[x,C]=h.useState(!1),[R,j]=h.useState(0);w.useEffect(()=>{const n=tt.subscribe(r);return()=>n.unsubscribe()},[]),w.useEffect(()=>{const n=et.subscribe(o);return()=>n.unsubscribe()},[]),w.useEffect(()=>{const n=st.subscribe(k=>{f(k==="ru"?0:1)});return()=>n.unsubscribe()},[]),w.useEffect(()=>{const n=nt.subscribe(()=>j(k=>k+1));return()=>n.unsubscribe()},[]);const F=new Date(s.getFullYear(),s.getMonth(),1),U=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),L=(F.getDay()+6)%7,v=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],g=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],m=[],z=[];for(let n=0;n<L;n++)m.push(null);for(let n=1;n<=U;n++)m.push(n);for(let n=0;n<m.length;n+=7)z.push(m.slice(n,n+7));const X=()=>{p(new Date(s.getFullYear(),s.getMonth()-1)),D(T,50)},q=()=>{p(new Date(s.getFullYear(),s.getMonth()+1)),D(T,50)};return e.jsxs("div",{style:l(t).container,children:[e.jsxs("div",{style:l(t).panel,children:[e.jsxs("div",{style:l(t).calendarHead,children:[e.jsx("h1",{style:l(t).header,children:s.getFullYear()+"/"+(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)}),e.jsx("div",{onClick:X,children:e.jsx("h1",{style:l(t).header,children:"<"})}),e.jsx("div",{onClick:q,children:e.jsx("h1",{style:l(t).header,children:">"})})]}),e.jsxs("table",{style:l(t).table,children:[e.jsx("thead",{children:e.jsx("tr",{children:v[c].map(n=>e.jsx("th",{children:e.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:n==="Вс"||n==="Sun"?"#873535ff":i.get("subText",t)},children:n})},n))})}),e.jsx("tbody",{children:z.map((n,k)=>e.jsx("tr",{children:n.map((b,G)=>{const M=s.getMonth(),I=s.getFullYear(),J=b===d.getDate()&&M===d.getMonth()&&I===d.getFullYear(),A=S(new Date(I,M,b));let $="",H=0;if(Object.keys(u.habitsByDate).includes(A)){const Y=Array.from(Object.values(u.habitsByDate[A])),O=Y.length,Q=Y.filter(Z=>Z===1).length,E=O>0?Math.round(Q/O*100):0;$=E+"%",H=E>=100?1:-1}return e.jsx("td",{children:e.jsxs("div",{style:{...l(t).cell,border:`3px solid ${J?i.get("currentDateBorder",t):i.get("background",t)}`,backgroundColor:b<1?i.get("background",t):H===1?i.get("habitCardDone",t):H===-1?i.get("habitCardSkipped",t):i.get("background",t)},onClick:()=>{y(new Date(I,M,b)),C(u.hasKey(S(new Date(I,M,b)))),D(yt,50)},children:[b,b>0&&e.jsx("div",{style:{fontSize:"8px",color:i.get("subText",t),lineHeight:"5px",padding:"5px"},children:$})]})},G)})},k))})]}),e.jsxs("div",{style:{position:"fixed",top:"120%",padding:"10%",fontSize:"14px",fontFamily:"Segoe UI",color:i.get("simplePanel",t)},children:[" ",c===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]})]}),x&&e.jsxs("div",{style:{...l(t).panel,height:"30vh",width:"75vw",position:"fixed",top:"74%",left:"50%"},children:[e.jsxs("div",{style:{...l(t).calendarHead,display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",paddingTop:"5px"},children:[e.jsx("h1",{style:{...l(t).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"1px"},children:d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+" "+g[c][bt(d)]}),e.jsx("div",{style:{fontSize:"10px",color:i.get("subText",t),lineHeight:"1px",paddingRight:"50%"},children:kt(d,c)})]}),e.jsx("div",{style:l(t).scrollView,children:e.jsx(Dt,{theme:t,langIndex:c,date:d})})]}),e.jsx(jt,{theme:t,globalTheme:a})]})},Dt=({theme:t,langIndex:r,date:a})=>{const o=S(a);return u.hasKey(o)?Object.entries(u.habitsByDate[o]).map(([f,s])=>{const p=Number(f),d=wt().find(x=>x.id===p),y=d?d.name[r]:"";return e.jsx(St,{id:p,name:y,theme:t,date:a,statusInit:s,langIndex:r},`${o}-${f}`)}):null},St=({id:t,name:r,theme:a,date:o,statusInit:c,langIndex:f})=>{const[s,p]=h.useState(c),[d,y]=h.useState(!0),x=100,C=-100,R=ht(0),j=ft(R,[-1,1],[C,x]);h.useEffect(()=>{p(c)},[c,o]);const F=(U,L)=>{const v=L.offset.x;if(Math.abs(v)>x){if(!d)return;let g=s;if(v>0?s===0?g=1:s===-1&&(g=0):s===0?g=-1:s===1&&(g=0),g!==s){const m=S(o);u.changeStatus(m,t,g),p(g),ot(),g===1?u.prefs[2]==0&&mt.play():g===-1&&u.prefs[2]==0&&N.play(),u.prefs[3]==0&&navigator.vibrate?.(50)}y(!1),V(j,0,{type:"tween",duration:.2})}},B=()=>{V(j,0,{type:"tween",duration:.2}),y(!0)};return e.jsxs(at.div,{id:`cal-${t}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:j},drag:d?"x":!1,dragConstraints:{left:C,right:s===1?0:x},dragElastic:0,onDrag:F,onDragEnd:B,children:[e.jsx("p",{style:{...l(a).text,fontSize:"14px",paddingLeft:"30px"},children:r}),s===1?e.jsx("img",{src:pt,style:l(a).icon}):s===-1?e.jsx("img",{src:xt,style:l(a).icon}):null,e.jsx("span",{style:{...l(a).subText,marginLeft:"6px",color:s===1?i.get("habitCardDone",a):s===-1?i.get("habitCardSkipped",a):i.get("subText",a)},children:s===1?f===0?"Выполнено":"Done":s===-1?f===0?"Пропущено":"Skipped":""})]})};function jt({globalTheme:t,theme:r}){const a={position:"fixed",bottom:"0",left:"0",width:"100vw",height:"10vh",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",backgroundColor:i.get("bottomPanel",r),display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:900,boxShadow:`0px -2px 0px ${i.get("bottomPanelShadow",r)}`},o={width:"35px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"};return e.jsx("div",{style:a,children:e.jsxs("div",{style:a,children:[e.jsx("img",{src:t==="dark"?rt:lt,style:o,onClick:()=>{K("HabitsMain"),D(N,50)}}),e.jsx("img",{src:t==="dark"?_:W,style:o,onClick:()=>{K("HabitMetrics"),D(T,50)}}),e.jsx("img",{src:t==="dark"?ct:dt,style:o,onClick:()=>{}}),e.jsx("img",{src:t==="dark"?_:W,style:o,onClick:()=>{it(!0),D(T,50)}}),e.jsx("img",{src:t==="dark"?ut:gt,style:o,onClick:()=>{}})]})})}const l=t=>({container:{backgroundColor:i.get("background",t),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:i.get("headGradient",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",t),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"100%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"11vw",height:"11vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:i.get("mainText",t),fontFamily:"Segoe UI"},panel:{width:"90vw",height:"105vw",position:"absolute",top:"36%",left:"50%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${i.get("border",t)}`,margin:"5px",background:i.get("background",t),boxShadow:`4px 4px 6px ${i.get("shadow",t)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:i.get("mainText",t)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:i.get("subText",t)},scrollView:{margin:"15px",overflowY:"scroll",width:"90%",height:"70%",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"start",borderRadius:"24px"},icon:{paddingLeft:"25px",paddingBottom:"5px",width:"25px"}});function kt(t,r){const a=[["привычка","привычки","привычек"],["habit","habits","habits"]],o=S(t);if(u.hasKey(o)){const c=Object.values(u.habitsByDate[o]).length;return c+" "+a[r][c===1?0:c>1&&c<5?1:2]}return"0 "+a[r][2]}function D(t,r){u.prefs[2]==0&&t!==null&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),u.prefs[3]==0&&navigator.vibrate(r)}export{Tt as default};
