import{R as C,r as p,A as u,t as et,g as nt,l as P,j as d,C as o,b as B,I as at,s as T,J as st,a as it,K as rt,m as ot,L as dt,M as ct}from"./index-CAsMHsGn.js";import{B as lt,a as ut,M as K,b as $,A as pt,c as ft,C as ht,d as bt}from"./Calendar_Light-Dm4YCClt.js";import{s as gt,b as xt}from"./SaveHelper-DF29RwKr.js";import{u as yt,a as mt,b as W}from"./index-C3Hwv-nC.js";const R=new Date().toISOString().split("T")[0],Ct=new Audio(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Click-5rJ2A-_B.wav",import.meta.url).href),wt=new Audio(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/IsDone-CY5KfW9n.wav",import.meta.url).href),z=new Audio(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Skip-C95holY4.wav",import.meta.url).href),F=new Audio(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/SwitchPanel-CJjFfFgV.wav",import.meta.url).href),St=new Audio(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Transition-DNEfmScM.wav",import.meta.url).href);let Dt,kt,Lt;const Tt=()=>{const[t,s]=C.useState("dark"),[l,n]=C.useState("dark"),[a,e]=C.useState([]),[h,w]=C.useState([]),[y,k]=p.useState(u.prefs[0]),[f,m]=p.useState(u.choosenHabits.length>0);C.useEffect(()=>{const c=et.subscribe(s);return()=>c.unsubscribe()},[]),C.useEffect(()=>{const c=nt.subscribe(n);return()=>c.unsubscribe()},[]),C.useEffect(()=>{const c=P.subscribe(b=>{k(b==="ru"?0:1)});return()=>c.unsubscribe()},[]),C.useEffect(()=>{e(u.choosenHabits)},[]),C.useEffect(()=>{if(a.length>0){const c=new Set;a.forEach(b=>{const g=N().find(D=>D.id===b);g&&g.category&&g.category[y]&&c.add(g.category[y])}),w(Array.from(c))}},[a]);const I=c=>{e(b=>{const g=new Set(b);return g.has(c)?b:(u.addHabit(R,c),[...g,c])}),m(u.choosenHabits.length>0)};return Dt=c=>{if(a.includes(c)){u.removeHabit(R,c),e(v=>v.filter(A=>A!==c));const D=(N().find(v=>v.id===c)?.name||["",""])[y]||(y===0?"Привычка":"Habit"),L=y===0?`Привычка: '${D}' удалена`:`Habit: '${D}' deleted`;at(L,2e3),m(u.choosenHabits.length>0)}},kt=I,d.jsxs("div",{style:j(t).container,children:[!f&&d.jsx("div",{style:{...j(t).panel,justifyContent:"center",alignItems:"center",marginTop:"30%"},children:d.jsx("p",{style:{...j(t).subText,fontSize:"12px",margin:"10%",whiteSpace:"pre-line",color:o.get("subText",t)},children:Mt(y)})}),f&&d.jsx("div",{style:j(t).scrollView,children:vt({theme:t,habitsCards:a,categories:h})}),d.jsx(It,{theme:t,globalTheme:l})]})};function N(){return B.concat((u.CustomHabits||[]).filter(t=>!B.some(s=>s.id===t.id)))}function vt({theme:t,habitsCards:s,categories:l}){return l.map(n=>{const a=s.map(e=>N().find(h=>h.id===e)).filter(e=>e&&e.category&&Array.isArray(e.category)&&e.category[0]===n);return d.jsx(jt,{text:n,theme:t,children:a.map(e=>{const h=(e.isCustom,e.src);return d.jsx(Rt,{id:e.id,text:e.name,descr:e.description,imgsrc:h,theme:t},e.id)})},n)})}function Rt({id:t=0,text:s=["Название","Name"],descr:l=["Описание","Description"],imgsrc:n,theme:a}){const[e,h]=p.useState(u.habitsByDate[R]?.[t]),[w,y]=p.useState(u.prefs[0]),[k,f]=p.useState(n||new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href),m=100,I=-m,[U,c]=p.useState(!0);let b=o.get(e===1?"habitCardDone":e===-1?"habitCardSkipped":"habitCard",a),g=o.get(e===0?"habitCardSkipped":e===1?"habitCard":"habitCardSkipped",a),D=o.get(e===0?"habitCardDone":e===-1?"habitCard":"habitCardDone",a);const[L,v]=p.useState(!1),[A,M]=p.useState(b);p.useEffect(()=>{const r=P.subscribe(i=>{y(i==="ru"?0:1)});return()=>r.unsubscribe()},[]),p.useEffect(()=>{u.changeStatus(R,t,e)},[e]),p.useEffect(()=>{let r=!0;return(async()=>{if(!n){console.log("No icon source provided, using default"),r&&f(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href);return}try{if(typeof n=="string"){if(n.startsWith("data:")||n.startsWith("blob:")||n.startsWith("http")||n.startsWith("/")){r&&f(n);return}if(n.startsWith("icon_")){try{console.log("Loading custom icon with key:",n);const _=await xt(n);_?(console.log("Successfully loaded custom icon:",n),r&&f(_)):(console.warn("Custom icon not found, using default:",n),r&&f(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href))}catch(_){console.error("Error loading custom icon:",_),r&&f(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href)}return}const x=new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href;r&&f(habitIcons[n]&&typeof habitIcons[n]=="string"?habitIcons[n]:x);return}if(n&&typeof n=="object"){const x=n.default||n;r&&f(typeof x=="string"?x:defaultIcon);return}console.log("No valid icon source provided, using default"),r&&f(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href)}catch(x){console.error("Error in icon loading logic:",x),r&&f(new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href)}})(),()=>{if(r=!1,n&&typeof n=="string"&&n.startsWith("blob:"))try{URL.revokeObjectURL(n)}catch(x){console.warn("Error revoking object URL:",x)}}},[n]);const H=Array.isArray(s)?s[w]:s,Y=Array.isArray(l)?l[w]:l;p.useEffect(()=>{M(o.get(e===1?"habitCardDone":e===-1?"habitCardSkipped":"habitCard",a))},[a,e]);const O=yt(0),E=mt(O,[-1,1],[I,m]),V=()=>{b=o.get(e===1?"habitCardDone":e===-1?"habitCardSkipped":"habitCard",a),g=o.get(e===0?"habitCardSkipped":e===1?"habitCard":"habitCardSkipped",a),D=o.get(e===0?"habitCardDone":e===-1?"habitCard":"habitCardDone",a)},J=(r,i)=>{(e===1&&i.offset.x<0||e!==1)&&M(Ut(b,i.offset.x>0?D:g,Math.abs(i.offset.x)/m)),Math.abs(i.offset.x)>m&&U&&(G(i.offset.x>0),W(E,0,{type:"tween",duration:.2}),c(!1))},X=()=>{U&&W(E,0,{type:"tween",duration:.2}),M(o.get(e===1?"habitCardDone":e===-1?"habitCardSkipped":"habitCard",a)),c(!0)},G=r=>{let i=0;if(r)e===0?i=1:e===-1?i=0:i=1,u.habitsByDate[R][t]=i;else{if(e===0)i=-1;else if(e===1)i=0;else{i=-1,Lt=t;const x=u.prefs[0]===0?`Вы уверены, что хотите удалить привычку: '${H}' ?`:`Are you sure you want to delete '${H}' habit?`;ct(x)}u.habitsByDate[R][t]=i}i===1?S(wt,50):i===-1&&S(z,50),M(o.get(i===1?"habitCardDone":i===-1?"habitCardSkipped":"habitCard",a)),h(i)},q=()=>{S(Ct,50);const r=!L;v(r),dt(r?t:null)};p.useEffect(()=>{const r=rt.subscribe(i=>{v(i===t)});return()=>r.unsubscribe()},[t]);const Q={display:"flex",flexDirection:"column",alignItems:"stretch",borderRadius:"24px",margin:"10px",overflow:"hidden",borderStyle:"solid",borderColor:o.get("border",a),borderWidth:1,position:"relative",backgroundColor:A,x:E},Z={fontSize:"14px",color:o.get("mainText",a),marginLeft:"20px"},tt={textAlign:"left",fontSize:"10px",color:o.get("subText",a),marginLeft:"70px"};return d.jsxs(ot.div,{id:t,style:Q,onClick:q,drag:U?"x":!1,dragConstraints:{left:I,right:e===1?0:m},onDragStart:V,dragElastic:0,onDrag:J,onDragEnd:X,animate:{height:L?"10vh":"4.5vh",outline:L?"3px solid "+o.get("border",a):"1px solid "+o.get("border",a)},transition:{type:"tween",duration:.4,ease:"easeInOut"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",maxHeight:"40px",paddingBottom:"5px"},children:[k&&d.jsx("img",{src:k,style:{width:"24px",objectFit:"contain",marginLeft:"15px",marginTop:"8px"},onError:r=>{r.target.onerror=null,r.target.src=new URL("https://dmitriyspirihin.github.io/UML_Frontend_React/assets/Default-f6NamDK1.png",import.meta.url).href},alt:""}),d.jsx("h2",{style:Z,children:H})]}),L&&d.jsx("div",{style:{paddingBottom:"25px"},children:d.jsx("p",{style:tt,children:Y})})]})}function jt({text:t=["Имя","Name"],children:s,theme:l}){const[n,a]=p.useState(u.prefs[0]);p.useEffect(()=>{const h=P.subscribe(w=>{a(w==="ru"?0:1)});return()=>h.unsubscribe()},[]);const e=Array.isArray(t)?t[n]:t;return d.jsxs("div",{style:j(l).categoryPanel,children:[d.jsx("h2",{style:{textAlign:"center",fontSize:"14px",color:o.get("mainText",l)},children:e}),s]})}function It({globalTheme:t,theme:s}){const l={position:"fixed",bottom:"0",left:"0",width:"100vw",height:"10vh",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",backgroundColor:o.get("bottomPanel",s),display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:900,boxShadow:`0px -2px 0px ${o.get("bottomPanelShadow",s)}`},n={width:"35px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"};return d.jsxs("div",{style:l,children:[d.jsx("img",{src:t==="dark"?lt:ut,style:n,onClick:()=>{T("MainMenu"),gt(),S(z,50)}}),d.jsx("img",{src:t==="dark"?K:$,style:n,onClick:()=>{T("HabitMetrics"),S(F,50)}}),d.jsx("img",{src:t==="dark"?pt:ft,style:n,onClick:()=>{st(!0),S(St,50)}}),d.jsx("img",{src:t==="dark"?K:$,style:n,onClick:()=>{it(!0),S(F,50)}}),d.jsx("img",{src:t==="dark"?ht:bt,style:n,onClick:()=>{T("HabitCalendar"),S(F,50)}})]})}const j=t=>({container:{backgroundColor:o.get("background",t),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},categoryPanel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${o.get("border",t)}`,margin:"5px",background:o.get("panelGradient",t),boxShadow:`4px 4px 6px ${o.get("shadow",t)}`},text:{textAlign:"left",fontSize:"10px",color:o.get("subText",t),marginLeft:"30px",marginBottom:"12px"},scrollView:{width:"85vw",height:"74vh",overflowY:"auto",marginTop:"17vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"}});function Ut(t,s,l){if(!t||!s)return t||s||"#000000";l=Math.max(0,Math.min(1,l)),t=t.replace("#",""),s=s.replace("#","");const n=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),e=parseInt(t.slice(4,6),16),h=parseInt(s.slice(0,2),16),w=parseInt(s.slice(2,4),16),y=parseInt(s.slice(4,6),16),k=Math.round(n+(h-n)*l),f=Math.round(a+(w-a)*l),m=Math.round(e+(y-e)*l);return"#"+k.toString(16).padStart(2,"0")+f.toString(16).padStart(2,"0")+m.toString(16).padStart(2,"0")}function Mt(t){return t===0?`Вы еще не добавили ни одной привычки

 Вы можете выбрать из списка или добавить свою привычку.

Выбранные привычки будут обновляться автоматически каждый день, если вы пропустите день, привычка будет не выполнена для этого дня.

Вы должны выполнить свою привычку и затем свайпнуть вправо, чтобы отметить её как выполненную.

Чтобы сформировать привычку, вам нужно выполнить ее 66 дней подряд.

Вы можете просмотреть прогресс ваших привычек в панели метрик и календаре.


 * Чтобы начать, нажмите кнопку "+" ниже`:`You have not added any habits yet

 You can choose from the list or add your own habit.

Choosen habits will update automatically every day, if you skip a day, the habit will be skipped for that day.

You need to perform your habit and then swipe right to mark it as done.

To form a habit you need to perform it for 66 days in a row.

You can view a progress of your habits in the metrics panel and calendar.


 * To get started tap the "+" button below`}function S(t,s){u.prefs[2]==0&&t!==null&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),u.prefs[3]==0&&navigator.vibrate(s)}export{kt as addHabitFn,Lt as currentId,Tt as default,Dt as removeHabitFn};
