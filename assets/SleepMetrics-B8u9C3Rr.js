import{j as e,C as o,A as v,t as w,l as $,f as R,cf as A,bV as L,bw as z,bW as W,m as D}from"./index-CPOV7rZk.js";import{h as F,B as O,q as H,X as P,Y as E,T as U,s as Y,u as K,r as f}from"./recharts-Bg6K2Pzo.js";const I=t=>{if(!t||t<=0)return"0:00";const i=Math.floor(t/6e4),n=Math.floor(i/60),l=i%60;return`${n}:${l.toString().padStart(2,"0")}`},V=t=>t/(1e3*60*60),_=({data:t=[],theme:i="dark",textColor:n="#94a3b8",linesColor:l="#334155",backgroundColor:p="transparent",height:x=220})=>{const g=i==="light";if(!Array.isArray(t)||t.length===0)return e.jsx("div",{style:{height:`${x}px`,display:"flex",alignItems:"center",justifyContent:"center",color:n,opacity:.6,fontFamily:"Segoe UI, sans-serif",fontSize:"14px"},children:"No sleep data available"});const S={1:o.get("veryBad",i),2:o.get("bad",i),3:o.get("normal",i),4:o.get("good",i),5:o.get("perfect",i)},u=t.map(s=>({date:s.date,ms:s.ms||0,mood:Math.max(1,Math.min(5,Math.round(s.mood||3))),hours:V(s.ms||0)})),d=Math.max(...u.map(s=>s.hours),1),y=s=>S[s]||S[3],b=({active:s,payload:a,label:h})=>{if(s&&a&&a.length){const c=a[0].payload,m=c?.ms||0,j=c?.mood||0,C=j?"★".repeat(j):"—",M=y(j);return e.jsxs("div",{style:{backgroundColor:g?"rgba(255,255,255,0.9)":"rgba(30,30,30,0.9)",backdropFilter:"blur(10px)",padding:"10px 14px",borderRadius:"12px",border:`1px solid ${M}40`,boxShadow:"0 8px 20px rgba(0,0,0,0.15)",fontFamily:"Segoe UI",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:n,marginBottom:"4px",opacity:.8},children:h}),e.jsxs("div",{style:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",i)},children:[I(m)," ",e.jsx("span",{style:{fontSize:"11px",fontWeight:"400"},children:"hrs"})]}),e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",fontWeight:"600",color:M,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{children:"Mood:"})," ",e.jsx("span",{style:{letterSpacing:"2px"},children:C})]})]})}return null};return e.jsx("div",{style:{width:"100%",height:`${x}px`,backgroundColor:p,borderRadius:"16px",padding:"10px 0",fontFamily:"Segoe UI, sans-serif"},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(O,{data:u,margin:{top:20,right:10,left:-25,bottom:0},barSize:18,children:[e.jsx("defs",{children:[1,2,3,4,5].map(s=>e.jsxs("linearGradient",{id:`grad-${s}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:y(s),stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:y(s),stopOpacity:.6})]},s))}),e.jsx(H,{stroke:l,strokeOpacity:.2,vertical:!1,strokeDasharray:"4 4"}),e.jsx(P,{dataKey:"date",tick:{fill:n,fontSize:10,opacity:.7},axisLine:!1,tickLine:!1,dy:10,interval:"preserveStartEnd"}),e.jsx(E,{domain:[0,Math.ceil(d+1)],tick:{fill:n,fontSize:10,opacity:.7},axisLine:!1,tickLine:!1,tickFormatter:s=>`${s}h`}),e.jsx(U,{content:e.jsx(b,{}),cursor:{fill:g?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.05)",radius:4}}),e.jsx(Y,{dataKey:"hours",radius:[6,6,6,6],animationDuration:1200,shape:s=>{const{x:a,y:h,width:c,height:m,index:j}=s,C=u[j]?.mood||3;return e.jsx("rect",{x:a,y:h,width:c,height:m,fill:`url(#grad-${C})`,rx:c/2,ry:c/2})},children:e.jsx(K,{dataKey:"ms",position:"top",offset:8,fontSize:10,fontWeight:600,fill:n,formatter:s=>I(s)})})]})})})},G=[28,180,360],N=[["Месяц","Month"],["6 Мес","6 Mon"],["Год","Year"]],X=t=>Math.floor(t/6e4),T=t=>{if(!t)return"0h 0m";const i=X(t),n=Math.floor(i/60),l=i%60;return n>0?`${n}h ${l}m`:`${l}m`},q=(t,i)=>new Date(t).toLocaleDateString(i===0?"ru-RU":"en-US",{day:"numeric",month:"short"}),k=(t,i)=>[o.get("veryBad",t),o.get("bad",t),o.get("normal",t),o.get("good",t),o.get("perfect",t)][i-1]||o.get("subText",t),J=({selectedIndex:t,setSelectedIndex:i,theme:n,langIndex:l})=>e.jsx("div",{style:r(n).segmentedControl,children:N.map((p,x)=>{const g=t===x;return e.jsxs(D.div,{onClick:()=>i(x),style:{...r(n).segmentBtn,color:g?o.get("mainText",n):o.get("subText",n),fontWeight:g?"600":"500"},children:[g&&e.jsx(D.div,{layoutId:"segmentBg",style:r(n).segmentActiveBg}),e.jsx("span",{style:{position:"relative",zIndex:1},children:p[l]})]},x)})}),B=({icon:t,label:i,value:n,subLabel:l,theme:p,color:x})=>e.jsxs("div",{style:r(p).statCard,children:[e.jsx("div",{style:{...r(p).iconBox,color:x,backgroundColor:`${x}15`},children:t}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:r(p).statLabel,children:i}),e.jsx("div",{style:r(p).statValue,children:n}),l&&e.jsx("div",{style:r(p).statSub,children:l})]})]}),tt=()=>{const[t,i]=f.useState("dark"),[n,l]=f.useState(v.prefs[0]),[p,x]=f.useState(v.prefs[4]),[g,S]=f.useState(0);f.useEffect(()=>{const s=w.subscribe(i),a=$.subscribe(c=>l(c==="ru"?0:1)),h=R.subscribe(x);return()=>{s.unsubscribe(),a.unsubscribe(),h.unsubscribe()}},[]);const u=f.useMemo(()=>v.sleepingLog?Object.entries(v.sleepingLog).map(([s,a])=>({date:s,durationMs:a.duration||0,mood:a.mood||0,note:a.note||""})).sort((s,a)=>new Date(s.date)-new Date(a.date)):[],[]),d=f.useMemo(()=>{if(u.length===0)return[];const s=new Date;return s.setDate(s.getDate()-G[g]),u.filter(a=>new Date(a.date)>=s)},[u,g]),y=f.useMemo(()=>d.map(s=>({date:s.date.split("-").slice(1).reverse().join("."),ms:s.durationMs,mood:s.mood||3})),[d]),b=f.useMemo(()=>{if(d.length===0)return{avg:0,best:0,count:0};const a=d.reduce((c,m)=>c+m.durationMs,0)/d.length,h=Math.max(...d.map(c=>c.durationMs));return{avg:a,best:h,count:d.length}},[d]);return e.jsx("div",{style:r(t).container,children:e.jsxs("div",{style:r(t).scrollContent,children:[e.jsxs("div",{style:r(t).headerSection,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px"},children:[e.jsx(A,{size:20,color:o.get("accent",t)}),e.jsx("h2",{style:r(t).pageTitle,children:n===0?"Аналитика Сна":"Sleep Analytics"})]}),e.jsx(J,{selectedIndex:g,setSelectedIndex:S,theme:t,langIndex:n})]}),e.jsxs("div",{style:r(t).statsRow,children:[e.jsx(B,{icon:e.jsx(L,{}),label:n===0?"Средний сон":"Avg Sleep",value:T(b.avg),theme:t,color:o.get("normal",t)}),e.jsx(B,{icon:e.jsx(z,{}),label:n===0?"Лучший сон":"Best Sleep",value:T(b.best),theme:t,color:o.get("perfect",t)})]}),e.jsxs("div",{style:r(t).chartContainer,children:[e.jsxs("div",{style:r(t).chartHeader,children:[e.jsx("span",{style:r(t).chartTitle,children:n===0?"Динамика":"Dynamics"}),e.jsxs("span",{style:r(t).chartSub,children:[b.count," ",n===0?"записей":"records"]})]}),e.jsx("div",{style:{height:"200px",width:"100%"},children:e.jsx(_,{data:y,theme:t,textColor:o.get("subText",t),linesColor:o.get("border",t),backgroundColor:o.get("simplePanel",t),barColor:o.get("accent",t)})})]}),e.jsxs("div",{style:r(t).historySection,children:[e.jsxs("div",{style:r(t).sectionHeader,children:[e.jsx(W,{size:14,color:o.get("subText",t)}),e.jsx("span",{children:n===0?"История":"History"})]}),e.jsx("div",{style:r(t).listContainer,children:d.length===0?e.jsx("div",{style:r(t).emptyState,children:n===0?"Нет данных за период":"No data for this period"}):d.slice().reverse().map((s,a)=>e.jsxs("div",{style:r(t).listItem,children:[e.jsx("div",{style:r(t).dateBox,children:e.jsx("span",{style:r(t).dateDay,children:q(s.date,n)})}),e.jsxs("div",{style:r(t).itemCenter,children:[e.jsx("div",{style:r(t).durationText,children:T(s.durationMs)}),s.note&&e.jsx("div",{style:r(t).noteText,children:s.note})]}),s.mood>0&&e.jsxs("div",{style:r(t).moodBox,children:[e.jsx(z,{size:12,color:k(t,s.mood)}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"bold",color:k(t,s.mood)},children:s.mood})]})]},`${s.date}-${a}`))})]}),e.jsx("div",{style:{marginBottom:"80px"}})," "]})})},r=t=>({container:{backgroundColor:o.get("background",t),height:"90vh",marginTop:"40px",width:"100vw",paddingTop:"80px",display:"flex",flexDirection:"column",fontFamily:"Segoe UI, sans-serif"},scrollContent:{flex:1,overflowY:"auto",padding:"0 20px 40px 20px",display:"flex",flexDirection:"column",gap:"20px"},headerSection:{display:"flex",flexDirection:"column"},pageTitle:{fontSize:"24px",fontWeight:"800",color:o.get("mainText",t),margin:0},segmentedControl:{display:"flex",backgroundColor:o.get("simplePanel",t),borderRadius:"12px",padding:"4px",border:`1px solid ${o.get("border",t)}50`},segmentBtn:{flex:1,position:"relative",textAlign:"center",padding:"8px",fontSize:"13px",cursor:"pointer",zIndex:1},segmentActiveBg:{position:"absolute",inset:0,backgroundColor:t==="dark"?"rgba(255,255,255,0.1)":"#fff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",zIndex:-1},statsRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},statCard:{backgroundColor:o.get("simplePanel",t),borderRadius:"16px",padding:"16px",display:"flex",alignItems:"center",gap:"12px",border:`1px solid ${o.get("border",t)}30`},iconBox:{width:"40px",height:"40px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px"},statLabel:{fontSize:"11px",color:o.get("subText",t),textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"2px"},statValue:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",t)},chartContainer:{backgroundColor:o.get("simplePanel",t),borderRadius:"20px",padding:"20px",border:`1px solid ${o.get("border",t)}30`},chartHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},chartTitle:{fontSize:"16px",fontWeight:"700",color:o.get("mainText",t)},chartSub:{fontSize:"12px",color:o.get("subText",t)},historySection:{display:"flex",flexDirection:"column",gap:"10px"},sectionHeader:{display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",fontWeight:"600",color:o.get("subText",t),paddingLeft:"4px"},listContainer:{display:"flex",flexDirection:"column",gap:"10px"},listItem:{display:"flex",alignItems:"center",backgroundColor:t==="dark"?"rgba(255,255,255,0.03)":"#fff",padding:"12px",borderRadius:"16px",border:`1px solid ${o.get("border",t)}30`},dateBox:{width:"50px",display:"flex",flexDirection:"column",alignItems:"center",borderRight:`1px solid ${o.get("border",t)}30`,paddingRight:"12px",marginRight:"12px"},dateDay:{fontSize:"12px",fontWeight:"700",color:o.get("mainText",t),textAlign:"center"},itemCenter:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},durationText:{fontSize:"15px",fontWeight:"600",color:o.get("mainText",t)},noteText:{fontSize:"11px",color:o.get("subText",t),marginTop:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px"},moodBox:{display:"flex",alignItems:"center",gap:"4px",backgroundColor:o.get("background",t),padding:"4px 8px",borderRadius:"8px"},emptyState:{textAlign:"center",padding:"40px",color:o.get("subText",t),fontSize:"14px",fontStyle:"italic"}});export{tt as default};
