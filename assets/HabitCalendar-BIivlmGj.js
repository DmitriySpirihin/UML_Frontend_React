import{c as V,j as t,R as z,r as p,A as l,t as X,l as G,C as o,a as B,m as q,e as J}from"./index-Bvgb8T9x.js";import{C as Q}from"./Check-DY3Oyev5.js";import{u as Z,a as _,b as U}from"./index-C-stBVtt.js";const ee=V(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),m=e=>{const r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${r}-${i}-${c}`},te=e=>(e.getDay()+6)%7;m(new Date);const O=new Audio("Audio/Click.wav"),ne=new Audio("Audio/IsDone.wav"),se=new Audio("Audio/Skip.wav");function ae(){return B.concat((l.CustomHabits||[]).filter(e=>!B.some(r=>r.id===e.id)))}const ue=()=>{const[e,r]=z.useState("dark"),[i,c]=p.useState(l.prefs[0]),[n,b]=p.useState(new Date),[a,g]=p.useState(n),[f,y]=p.useState(!1);z.useEffect(()=>{const s=X.subscribe(r);return()=>s.unsubscribe()},[]),z.useEffect(()=>{const s=G.subscribe(H=>{c(H==="ru"?0:1)});return()=>s.unsubscribe()},[]);const h=new Date(n.getFullYear(),n.getMonth(),1),I=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),D=(h.getDay()+6)%7,T=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],F=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],S=[],w=[];for(let s=0;s<D;s++)S.push(null);for(let s=1;s<=I;s++)S.push(s);for(let s=0;s<S.length;s+=7)w.push(S.slice(s,s+7));const v=()=>{b(new Date(n.getFullYear(),n.getMonth()-1)),j(O,50)},u=()=>{b(new Date(n.getFullYear(),n.getMonth()+1)),j(O,50)};return t.jsx("div",{style:d(e).container,children:t.jsxs("div",{style:d(e).panel,children:[t.jsxs("div",{style:d(e).calendarHead,children:[t.jsx("h1",{style:d(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:v,children:t.jsx("h1",{style:d(e).header,children:"<"})}),t.jsx("div",{onClick:u,children:t.jsx("h1",{style:d(e).header,children:">"})})]}),t.jsxs("table",{style:d(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:T[i].map(s=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:s==="Вс"||s==="Sun"?"#873535ff":o.get("subText",e)},children:s})},s))})}),t.jsx("tbody",{children:w.map((s,H)=>t.jsx("tr",{children:s.map((x,W)=>{const C=n.getMonth(),M=n.getFullYear(),L=x===a.getDate()&&C===a.getMonth()&&M===a.getFullYear(),$=m(new Date(M,C,x));let R="",A=0;if(Object.keys(l.habitsByDate).includes($)){const Y=Array.from(Object.values(l.habitsByDate[$])),E=Y.length,P=Y.filter(N=>N===1).length,K=E>0?Math.round(P/E*100):0;R=K+"%",A=K>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...d(e).cell,border:`3px solid ${L?o.get("currentDateBorder",e):o.get("background",e)}`,backgroundColor:x<1?o.get("background",e):A===1?o.get("habitCardDone",e):A===-1?o.get("habitCardSkipped",e):o.get("background",e)},onClick:()=>{g(new Date(M,C,x)),y(l.hasKey(m(new Date(M,C,x)))),j(O,50)},children:[x,x>0&&t.jsx("div",{style:{fontSize:"8px",color:o.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:R})]})},W)})},H))})]}),t.jsxs("div",{style:{position:"fixed",top:"120%",left:"20%",fontSize:"14px",fontFamily:"Segoe UI",color:o.get("simplePanel",e)},children:[" ",i===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:f&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${o.get("border",e)}`},children:[t.jsx("h1",{style:{...d(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+" "+F[i][te(a)]}),t.jsx("div",{style:{fontSize:"10px",color:o.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:re(a,i)})]}),t.jsx("div",{style:d(e).scrollView,children:t.jsx(oe,{theme:e,langIndex:i,date:a})})]})})]})})},oe=({theme:e,langIndex:r,date:i})=>{const c=m(i);return l.hasKey(c)?Object.entries(l.habitsByDate[c]).map(([b,a])=>{const g=Number(b),f=ae().find(h=>h.id===g),y=f?f.name[r]:"";return t.jsx(ie,{id:g,name:y,theme:e,date:i,statusInit:a,langIndex:r},`${c}-${b}`)}):null},ie=({id:e,name:r,theme:i,date:c,statusInit:n,langIndex:b})=>{const[a,g]=p.useState(n),[f,y]=p.useState(!0),h=100,k=-100,I=Z(0),D=_(I,[-1,1],[k,h]);p.useEffect(()=>{g(n)},[n,c]);const T=(S,w)=>{const v=w.offset.x;if(Math.abs(v)>h){if(!f)return;let u=a;if(v>0?a===0?u=1:a===-1&&(u=0):a===0?u=-1:a===1&&(u=0),u!==a){const s=m(c);l.changeStatus(s,e,u),g(u),J(),u===1?l.prefs[2]==0&&j(ne,80):u===-1&&l.prefs[2]==0&&j(se,80),l.prefs[3]==0&&navigator.vibrate?.(50)}y(!1),U(D,0,{type:"tween",duration:.2})}},F=()=>{U(D,0,{type:"tween",duration:.2}),y(!0)};return t.jsxs(q.div,{id:`cal-${e}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:D},drag:f?"x":!1,dragConstraints:{left:k,right:a===1?0:h},dragElastic:0,onDrag:T,onDragEnd:F,children:[t.jsx("p",{style:{...d(i).text,fontSize:"14px",paddingLeft:"30px"},children:r}),a===1?t.jsx(Q,{style:{...d(i).icon,color:"#2e9741ff"}}):a===-1?t.jsx(ee,{style:{...d(i).icon,color:"#973939ff"}}):null]})},d=e=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:o.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:o.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:o.get("mainText",e),fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"160vw",position:"absolute",top:"51%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,margin:"5px",background:o.get("background",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:o.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:o.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function re(e,r){const i=[["привычка","привычки","привычек"],["habit","habits","habits"]],c=m(e);if(l.hasKey(c)){const n=Object.values(l.habitsByDate[c]).length;return n+" "+i[r][n===1?0:n>1&&n<5?1:2]}return"0 "+i[r][2]}function j(e,r){l.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),l.prefs[3]==0&&navigator.vibrate(r)}export{ue as default};
