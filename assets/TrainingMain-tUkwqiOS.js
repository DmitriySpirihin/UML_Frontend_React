import{A as d,t as Be,l as Fe,f as We,aE as $e,j as e,C as a,m as f,a as Y,b as L,W as E,a7 as Re,aF as K,M as V,aG as Le,a3 as D}from"./index-ratF5980.js";import{R as Ee,r as l}from"./recharts-Bg6K2Pzo.js";import{d as Oe,a as Ne,b as Ye}from"./TrainingLogHelper-DRoQrQPZ.js";import{a as Ke}from"./index-BUXNfOFh.js";import{I as Ve,a as He}from"./index-CtkMzCW6.js";import{S as y}from"./ScrollPicker-zHO88XKC.js";const b=t=>{const r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0");return`${r}-${n}-${g}`},Ue=t=>(t.getDay()+6)%7,H=new Audio("Audio/Click.wav"),xe=Array.from({length:24},(t,r)=>r),pe=Array.from({length:12},(t,r)=>r*5),Je={enter:t=>({x:t>0?50:-50,opacity:0,scale:.95}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:t=>({zIndex:0,x:t<0?50:-50,opacity:0,scale:.95})},_e={enter:t=>({y:t>0?-20:20,opacity:0}),center:{y:0,opacity:1},exit:t=>({y:t>0?20:-20,opacity:0})},Ge={hidden:{y:"100%",opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{y:"100%",opacity:0}},ot=()=>{const[t,r]=Ee.useState("dark"),[n,g]=l.useState(d.prefs[0]),[c,z]=l.useState(new Date),[p,M]=l.useState(c),_=l.useRef(p),[ge,ue]=l.useState(0),[G,he]=l.useState(d.prefs[4]),[fe,P]=l.useState(!1),[me,A]=l.useState(!1),[ye,B]=l.useState(!1),[u,be]=l.useState(d.getLastProgramId()),[F,q]=l.useState(d.getLastTrainingDayIndex()||0),[j,Q]=l.useState(16*36e5),[v,X]=l.useState(17*36e5),[Z,je]=l.useState({date:"",key:0}),[W,ee]=l.useState(0);l.useEffect(()=>{const s=Be.subscribe(r),i=Fe.subscribe(h=>{g(h==="ru"?0:1)}),o=We.subscribe(h=>{he(h)});return()=>{s.unsubscribe(),i.unsubscribe(),o.unsubscribe()}},[]);const ve=new Date(c.getFullYear(),c.getMonth(),1),we=new Date(c.getFullYear(),c.getMonth()+1,0).getDate(),Se=(ve.getDay()+6)%7,Ce=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],Te=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],te=[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]],$=[],se=[];for(let s=0;s<Se;s++)$.push(null);for(let s=1;s<=we;s++)$.push(s);for(let s=0;s<$.length;s+=7)se.push($.slice(s,s+7));const De=()=>{ee(-1),z(new Date(c.getFullYear(),c.getMonth()-1)),J(H)},Ie=()=>{ee(1),z(new Date(c.getFullYear(),c.getMonth()+1)),J(H)};l.useEffect(()=>{_.current=p},[p]),l.useEffect(()=>{q(0)},[u]),l.useEffect(()=>{const s=$e.subscribe(()=>{const i=new Date,o=_.current;if(o>i)return;const h=b(o),m=b(i);h===m?P(!0):A(!0)});return()=>s.unsubscribe()},[]);const w=l.useMemo(()=>{const s=Object.entries(d.programs).filter(([,i])=>i.show!==!1).map(([i,o])=>({value:Number(i),label:Array.isArray(o?.name)?o?.name?.[n]:o?.name||`Program ${i}`}));return s.length>0?s:[{value:0,label:n===0?"Нет программ":"No Programs"}]},[n]),S=l.useMemo(()=>{const s=d.programs[u];return!s||!s.schedule||s.schedule.length===0?[{value:0,label:n===0?"День 1":"Day 1"}]:s.schedule.map((i,o)=>({value:o,label:i.name?.[n]||(n===0?`День ${o+1}`:`Day ${o+1}`)}))},[u,n]),ne=l.useMemo(()=>w.find(s=>s.value===u)?.label||w[0].label,[u,w]),ie=l.useMemo(()=>S.find(s=>s.value===F)?.label||S[0].label,[F,S]),oe=s=>{const i=w.find(o=>o.label===s);i&&be(i.value)},ae=s=>{const i=S.find(o=>o.label===s);i&&q(i.value)},R=(s,i,o,h)=>{const m=Math.floor(i/6e4);let C=Math.floor(m/60)%24,T=m%60;o==="h"&&(C=h),o==="m"&&(T=h);const k=(C*60+T)*6e4;s(k)},ke=()=>{const i=b(new Date);if(!d.programs[u])return D(n===0?"Ошибка! Программа не найдена":"Error! The program not found",2e3,!1),null;if(d.programs[u].schedule.length===0)return D(n===0?"Ошибка! Программа пустая":"Error! The program is empty",2e3,!1),null;Ne(new Date,u,F),P(!1),setTimeout(()=>{const o=d.trainingLog[i].length-1;K({mode:"new",dayKey:i,dInd:o}),L("TrainingCurrent")},100)},ze=()=>{if(!d.programs[u])return D(n===0?"Ошибка! Программа не найдена":"Error! The program not found",2e3,!1),null;if(d.programs[u].schedule.length===0)return D(n===0?"Ошибка! Программа пустая":"Error! The program is empty",2e3,!1),null;if(v<=j){D(n===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Ye(p,u,F,j,v),A(!1);const s=b(p),i=d.trainingLog[s].length-1;K({mode:"redact",dayKey:s,dInd:i}),L("TrainingCurrent")},Me=(s,i)=>{je({date:s,key:i})},Pe=()=>{Oe(Z.date,Z.key),B(!1),D(n===0?"Тренировка удалена":"Session deleted",2e3,!0)};return e.jsxs("div",{style:x(t).container,children:[e.jsxs("div",{style:x(t).panel,children:[e.jsxs("div",{style:x(t).calendarHead,children:[e.jsx(f.div,{whileTap:{scale:.9},onClick:De,style:x(t).navBtn,children:e.jsx(Ve,{size:22,color:a.get("mainText",t)})}),e.jsx("div",{style:x(t).headerWrapper,children:e.jsx(Y,{mode:"popLayout",custom:W,children:e.jsxs(f.h1,{variants:_e,custom:W,initial:"enter",animate:"center",exit:"exit",transition:{duration:.25},style:x(t).header,children:[te[n][c.getMonth()]," ",c.getFullYear()]},c.toISOString())})}),e.jsx(f.div,{whileTap:{scale:.9},onClick:Ie,style:x(t).navBtn,children:e.jsx(He,{size:22,color:a.get("mainText",t)})})]}),e.jsx("div",{style:{width:"100%",paddingBottom:"20px",overflow:"hidden"},children:e.jsx(Y,{mode:"wait",custom:W,children:e.jsx(f.div,{variants:Je,custom:W,initial:"enter",animate:"center",exit:"exit",transition:{type:"tween",ease:"easeInOut",duration:.25},style:{width:"100%"},children:e.jsxs("table",{style:x(t).table,children:[e.jsx("thead",{children:e.jsx("tr",{children:Ce[n].map((s,i)=>e.jsx("th",{style:{paddingBottom:"10px"},children:e.jsx("p",{style:{textAlign:"center",fontSize:"13px",fontWeight:"600",opacity:.8,color:i>=5?"#ff5e5e":a.get("subText",t)},children:s})},s))})}),e.jsx("tbody",{children:se.map((s,i)=>e.jsx("tr",{children:s.map((o,h)=>{const m=c.getMonth(),C=c.getFullYear(),T=o===p.getDate()&&m===p.getMonth()&&C===p.getFullYear(),k=b(new Date(C,m,o)),N=k in d.trainingLog?d.trainingLog[k].length:0;let re=0,le=0;N>0&&d.trainingLog[k].forEach(Ae=>{Ae.completed?le++:re++});let de="transparent",ce=a.get("mainText",t);return T&&(de=a.get("currentDateBorder",t),ce="#ffffff"),e.jsx("td",{style:{padding:"3px"},children:o?e.jsxs("div",{style:{...x(t).cell,backgroundColor:de,color:ce,boxShadow:T?`0 4px 12px ${a.get("shadow",t)}`:"none"},onClick:()=>{M(new Date(Date.UTC(C,m,o))),ue(N),J(H)},children:[o,N>0&&!T&&e.jsxs("div",{style:{display:"flex",gap:"2px",marginTop:"6px"},children:[re>0&&e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:a.get("subText",t),opacity:.5}}),le>0&&e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4ade80"}})]})]}):e.jsx("div",{style:{...x(t).cell,pointerEvents:"none"}})},h)})},i))})]})},c.toISOString())})})]}),e.jsxs("div",{style:{flex:1,width:"100%",display:"flex",flexDirection:"column",backgroundColor:a.get("background",t)},children:[e.jsxs("div",{onClick:()=>L("TrainingList"),style:x(t).journalBtn,children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"15px"},children:n===0?"Журнал":"Journal"}),e.jsx(Ke,{size:14})]}),e.jsxs("div",{style:{flex:1,overflowY:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"15px 20px 10px 20px"},children:[e.jsxs("h2",{style:{margin:0,fontSize:"18px",color:a.get("mainText",t)},children:[p.getDate()," ",te[n][p.getMonth()],", ",Te[n][Ue(p)]]}),e.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:a.get("subText",t)},children:qe(ge,n)})]}),e.jsxs("div",{style:x(t).scrollView,children:[d.trainingLog[b(p)]?.map((s,i)=>e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.05},style:x(t).sessionCard,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:s.completed?"#4ade80":"rgba(128,128,128,0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.completed?e.jsx(E,{color:"#fff",size:16}):e.jsx("span",{style:{fontSize:"10px"},children:"⏳"})}),e.jsx("span",{style:{fontWeight:"bold",color:a.get("mainText",t),fontSize:G===0?"16px":"18px"},children:Array.isArray(d.programs[s.programId]?.name)?d.programs[s.programId]?.name?.[n]:d.programs[s.programId]?.name})]}),e.jsx(f.div,{whileTap:{scale:.9},onClick:()=>{Me(b(new Date(p)),i),B(!0)},style:{padding:"8px",cursor:"pointer",opacity:.7},children:e.jsx(Re,{size:16,color:a.get("subText",t)})})]}),e.jsxs("div",{onClick:()=>{K({mode:s.completed?"redact":"new",dayKey:b(new Date(p)),dInd:i}),L("TrainingCurrent")},style:{cursor:"pointer",paddingLeft:"34px"},children:[e.jsx("div",{style:{fontSize:G===0?"14px":"16px",color:a.get("mainText",t),marginBottom:"4px"},children:(n===0?"День ":"Day ")+(s.dayIndex+1)+": "+(d.programs[s.programId]?.schedule?.[s.dayIndex]?.name?.[n]||(n===0?`День ${s.dayIndex+1}`:`Day ${s.dayIndex+1}`))}),s.completed&&e.jsx("div",{style:{fontSize:"13px",color:a.get("subText",t)},children:`${Math.round(s.duration/6e4)}${n===0?" мин":" min"}  •  ${(s.tonnage*.001).toFixed(2)} ${n===0?" т":" t"}${Qe(s,n)}`})]})]},i)),e.jsx("div",{style:{display:"flex",height:"55px"}})]})]})]}),e.jsxs(Y,{children:[ye&&e.jsxs(U,{theme:t,onClose:()=>B(!1),children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:x(t).modalTitle,children:n===0?"Удалить тренировку?":"Delete session?"}),e.jsx("p",{style:{color:a.get("subText",t),fontSize:"14px"},children:n===0?"Это действие нельзя отменить":"This action cannot be undone"})]}),e.jsxs("div",{style:{display:"flex",width:"100%",gap:"15px"},children:[e.jsx(O,{icon:e.jsx(V,{size:24}),label:n===0?"Нет":"No",onClick:()=>B(!1),theme:t}),e.jsx(O,{icon:e.jsx(E,{size:24}),label:n===0?"Да":"Yes",onClick:Pe,theme:t,isPrimary:!0,isDestructive:!0})]})]}),fe&&e.jsxs(U,{theme:t,onClose:()=>P(!1),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("p",{style:x(t).modalTitle,children:n===0?"Новая тренировка":"New Session"}),e.jsx("div",{onClick:()=>P(!1),style:{padding:"5px",cursor:"pointer"},children:e.jsx(V,{size:24,color:a.get("subText",t)})})]}),e.jsxs("div",{style:{marginBottom:"20px",width:"100%"},children:[e.jsx(I,{label:n===0?"Программа":"Program",theme:t}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(y,{items:w.map(s=>s.label),value:ne,onChange:oe,theme:t,width:"100%"})})]}),e.jsxs("div",{style:{marginBottom:"20px",width:"100%"},children:[e.jsx(I,{label:n===0?"День":"Day",theme:t}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(y,{items:S.map(s=>s.label),value:ie,onChange:ae,theme:t,width:"100%"})})]}),e.jsx("div",{style:{marginTop:"15px"},children:e.jsx(O,{icon:e.jsx(E,{size:24}),label:n===0?"Начать":"Start",onClick:ke,theme:t,isPrimary:!0})})]}),me&&e.jsxs(U,{theme:t,onClose:()=>A(!1),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("p",{style:x(t).modalTitle,children:n===0?"Добавить прошлую":"Log Previous"}),e.jsx("div",{onClick:()=>A(!1),style:{padding:"5px",cursor:"pointer"},children:e.jsx(V,{size:24,color:a.get("subText",t)})})]}),e.jsxs("div",{style:{marginBottom:"20px",width:"100%"},children:[e.jsx(I,{label:n===0?"Программа":"Program",theme:t}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(y,{items:w.map(s=>s.label),value:ne,onChange:oe,theme:t,width:"100%"})})]}),e.jsxs("div",{style:{marginBottom:"20px",width:"100%"},children:[e.jsx(I,{label:n===0?"День":"Day",theme:t}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(y,{items:S.map(s=>s.label),value:ie,onChange:ae,theme:t,width:"100%"})})]}),e.jsxs("div",{style:{backgroundColor:t==="light"?"rgba(0,0,0,0.03)":"rgba(255,255,255,0.03)",borderRadius:"20px",padding:"15px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px",opacity:.7},children:[e.jsx(Le,{}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",textTransform:"uppercase",letterSpacing:"1px"},children:n===0?"Время":"Time"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"20px"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(I,{label:n===0?"Начало":"Start",theme:t}),e.jsxs("div",{style:{display:"flex",gap:"5px",width:"100%",justifyContent:"center"},children:[e.jsx(y,{items:xe,value:Math.floor(j/36e5),onChange:s=>R(Q,j,"h",s),theme:t,width:"60px"}),e.jsx("span",{style:{paddingTop:"20px",fontWeight:"bold"},children:":"}),e.jsx(y,{items:pe,value:j/6e4%60,onChange:s=>R(Q,j,"m",s),theme:t,width:"60px",suffix:""})]})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(I,{label:n===0?"Конец":"End",theme:t}),e.jsxs("div",{style:{display:"flex",gap:"5px",width:"100%",justifyContent:"center"},children:[e.jsx(y,{items:xe,value:Math.floor(v/36e5),onChange:s=>R(X,v,"h",s),theme:t,width:"60px"}),e.jsx("span",{style:{paddingTop:"20px",fontWeight:"bold"},children:":"}),e.jsx(y,{items:pe,value:v/6e4%60,onChange:s=>R(X,v,"m",s),theme:t,width:"60px",suffix:""})]})]})]})]}),e.jsx(O,{icon:e.jsx(E,{size:24}),label:n===0?"Сохранить":"Save Log",onClick:ze,theme:t,isPrimary:!0})]})]})]})},U=({children:t,theme:r,onClose:n})=>e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:x(r).backdrop,onClick:n,children:e.jsxs(f.div,{variants:Ge,initial:"hidden",animate:"visible",exit:"exit",style:x(r).bottomSheet,onClick:g=>g.stopPropagation(),children:[e.jsx("div",{style:{width:"40px",height:"4px",backgroundColor:a.get("subText",r),borderRadius:"2px",margin:"0 auto 20px auto",opacity:.3}}),t]})}),I=({label:t,theme:r})=>e.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",color:a.get("subText",r),textTransform:"uppercase",marginBottom:"8px",textAlign:"center"},children:t}),O=({icon:t,label:r,onClick:n,theme:g,isPrimary:c,isDestructive:z})=>{let p=g==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",M=a.get("mainText",g);return c&&(p=z?a.get("minValColor",g):a.get("maxValColor",g),M="#fff"),e.jsxs(f.div,{whileTap:{scale:.98},onClick:n,style:{flex:1,height:"56px",borderRadius:"16px",backgroundColor:p,display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",color:M,cursor:"pointer",fontWeight:"600",fontSize:"16px",boxShadow:c?"0 4px 12px rgba(0,0,0,0.15)":"none"},children:[t,r&&e.jsx("span",{children:r})]})};function J(t){d.prefs[2]==0&&t!==null&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),d.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const qe=(t,r)=>t==0?r==0?"Нет тренировок":"No trainings":t==1?r==0?"1 тренировка":"1 training":t>1&&t<5?t+(r==0?" тренировки":" trainings"):t+(r==0?" тренировок":" trainings");function Qe(t,r){if(!t?.exercises)return r===0?" • 0 упр.":" • 0 ex.";let n=0,g=0;for(const c of Object.values(t.exercises))n++,Array.isArray(c.sets)&&(g+=c.sets.length);return r===0?` • ${n} упр. / ${g} подх.`:` • ${n} ex. / ${g} sets`}const x=(t,r)=>({container:{backgroundColor:a.get("background",t),display:"flex",flexDirection:"column",alignItems:"center",height:"90vh",marginTop:"100px",width:"100vw",fontFamily:"Segoe UI, Roboto, sans-serif",overflowY:"scroll",paddingTop:"10px"},panel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"500px",alignItems:"center",justifyContent:"start",position:"relative",zIndex:1},calendarHead:{padding:"15px 20px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",boxSizing:"border-box",marginTop:"20px"},headerWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minWidth:"150px"},header:{fontFamily:"Segoe UI",fontSize:"20px",margin:0,fontWeight:"700",color:a.get("mainText",t),textTransform:"capitalize",whiteSpace:"nowrap"},navBtn:{padding:"8px",borderRadius:"12px",cursor:"pointer",backgroundColor:t==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},table:{width:"100%",borderCollapse:"collapse",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"13vw",height:"13vw",maxHeight:"50px",maxWidth:"50px",borderRadius:"14px",fontSize:"16px",fontWeight:"600",fontFamily:"Segoe UI",transition:"all 0.2s ease-in-out",cursor:"pointer",margin:"auto",position:"relative"},journalBtn:{alignSelf:"center",margin:"10px 0",backgroundColor:t==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",color:a.get("mainText",t),padding:"10px 20px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},scrollView:{flex:1,width:"100%",padding:"10px 20px 80px 20px"},sessionCard:{backgroundColor:t==="light"?"#fff":"rgba(255,255,255,0.05)",borderRadius:"16px",padding:"5px",marginBottom:"12px",marginRight:"35px",boxShadow:t==="light"?"0 2px 8px rgba(0,0,0,0.05)":"none",border:`1px solid ${t==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)"}`},backdrop:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:3e3},bottomSheet:{width:"100%",maxWidth:"500px",backgroundColor:a.get("background",t),borderTopLeftRadius:"28px",borderTopRightRadius:"28px",padding:"20px 25px 40px 25px",boxShadow:"0 -10px 40px rgba(0,0,0,0.2)",position:"relative",zIndex:3001,backdropFilter:"blur(20px)",borderTop:`1px solid ${t==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)"}`},modalTitle:{fontSize:"20px",fontWeight:"bold",color:a.get("mainText",t),margin:0}});export{ot as default,Qe as getTrainingSummary};
