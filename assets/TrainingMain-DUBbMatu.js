import{R as Te,r as d,A as x,t as De,l as ke,f as Pe,H as M,ax as Me,j as t,C as i,ay as L,s as Y,_ as Ie,i as B,k as E,Y as _}from"./index-pDhTsUxD.js";import{g as ze,d as Re,a as Fe,b as Ae}from"./TrainingLogHelper-DJAl_1R8.js";import{F as q,a as J}from"./index-Di-J1pNR.js";const h=e=>{const a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${a}-${o}-${p}`},$e=e=>(e.getDay()+6)%7;h(new Date);const H=new Audio("Audio/Click.wav"),Ke=()=>{const[e,a]=Te.useState("dark"),[o,p]=d.useState(x.prefs[0]),[r,b]=d.useState(new Date),[c,ee]=d.useState(r),O=d.useRef(c),[te,ne]=d.useState(0),[m,se]=d.useState(x.prefs[4]),[oe,I]=d.useState(!1),[ie,z]=d.useState(!1),[re,R]=d.useState(!1),[w,W]=d.useState(x.getLastProgramId()),[N,U]=d.useState(x.getLastTrainingDayIndex()),[S,v]=d.useState(16*36e5),[C,T]=d.useState(17*36e5),[G,le]=d.useState({date:"",key:0}),f=600*1e3,u=24*36e5;d.useEffect(()=>{const n=De.subscribe(a),l=ke.subscribe(y=>{p(y==="ru"?0:1)}),g=Pe.subscribe(y=>{se(y)});return()=>{n.unsubscribe(),l.unsubscribe(),g.unsubscribe()}},[]);const ae=new Date(r.getFullYear(),r.getMonth(),1),ce=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),de=(ae.getDay()+6)%7,xe=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],ge=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],ue=M(()=>v(n=>(n-f+u)%u)),pe=M(()=>v(n=>(n+f)%u)),he=M(()=>T(n=>{const l=(n-f+u)%u;return l>=S?l:n})),fe=M(()=>T(n=>(n+f)%u)),D=[],V=[];for(let n=0;n<de;n++)D.push(null);for(let n=1;n<=ce;n++)D.push(n);for(let n=0;n<D.length;n+=7)V.push(D.slice(n,n+7));const me=()=>{b(new Date(r.getFullYear(),r.getMonth()-1)),K(H)},ye=()=>{b(new Date(r.getFullYear(),r.getMonth()+1)),K(H)};d.useEffect(()=>{O.current=c},[c]),d.useEffect(()=>{const n=Me.subscribe(()=>{const l=new Date,g=O.current;if(g>l)return;const y=h(g),j=h(l);y===j?I(!0):z(!0)});return()=>n.unsubscribe()},[]);const be=()=>{Fe(new Date,w,N),I(!1),setTimeout(()=>{const l=h(new Date),g=x.trainingLog[l].length-1;L({mode:"new",dayKey:h(new Date),dInd:g}),Y("TrainingCurrent")},100)},Se=()=>{if(C<=S){_(o===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Ae(c,w,N,S,C),z(!1);const n=h(c),l=x.trainingLog[n].length-1;L({mode:"redact",dayKey:n,dInd:l}),Y("TrainingCurrent")},je=(n,l)=>{le({date:n,key:l})},we=()=>{Re(G.date,G.key),R(!1),_(o===0?"Тренировка удалена":"Session deleted",2e3,!0)};return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).panel,children:[t.jsxs("div",{style:s(e).calendarHead,children:[t.jsx("h1",{style:s(e).header,children:r.getFullYear()+"/"+(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)}),t.jsx("div",{onClick:me,children:t.jsx("h1",{style:s(e).header,children:"<"})}),t.jsx("div",{onClick:ye,children:t.jsx("h1",{style:s(e).header,children:">"})})]}),t.jsxs("table",{style:s(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:xe[o].map(n=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:n==="Вс"||n==="Sun"?"#873535ff":i.get("subText",e)},children:n})},n))})}),t.jsx("tbody",{children:V.map((n,l)=>t.jsx("tr",{children:n.map((g,y)=>{const j=r.getMonth(),F=r.getFullYear(),ve=g===c.getDate()&&j===c.getMonth()&&F===c.getFullYear(),A=h(new Date(F,j,g)),$=A in x.trainingLog?x.trainingLog[A].length:0;let k=0,P=0;return $>0&&x.trainingLog[A].forEach(Ce=>{Ce.completed?P++:k++}),t.jsx("td",{children:t.jsxs("div",{style:{...s(e).cell,border:`3px solid ${ve?i.get("currentDateBorder",e):i.get("background",e)}`,backgroundColor:i.get("background",e)},onClick:()=>{ee(new Date(Date.UTC(F,j,g))),ne($),K(H)},children:[g,$>0&&t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"10px"},children:[k>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"⏳"}),k>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:k}),P>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"✅"}),P>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:P})]})]})},y)})},l))})]})]}),t.jsxs("div",{style:{height:"30vh",width:"95%",display:"flex",flexDirection:"column",alignContent:"center"},children:[t.jsx("h1",{style:{...s(e).subtext,fontSize:"18px",textAlign:"center"},children:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+ge[o][$e(c)]+" / "+Le(te,o)}),t.jsx("div",{style:s(e).scrollView,children:x.trainingLog[h(c)]?.map((n,l)=>t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%",borderBottom:`1px solid ${i.get("border",e)}`},children:[t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:l+1}),t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:n.completed?"✅":"⏳"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{onClick:()=>{L({mode:n.completed?"redact":"new",dayKey:h(new Date(c)),dInd:n.dayIndex}),Y("TrainingCurrent")},style:s(e).mainText,children:x.programs.find(g=>g.id===n.programId).name[o]}),t.jsx("div",{style:s(e).mainText,children:(o===0?"День ":"Day ")+(l+1)+": "+x.programs.find(g=>g.id===n.programId).schedule[n.dayIndex].name[o]}),n.completed&&t.jsx("div",{style:{...s(e).subtext,marginBottom:"10px"},children:`${Math.round(n.duration/6e4)}${o===0?" мин":" min"}  /  ${(n.tonnage*.001).toFixed(2)} ${o===0?" тонн":" tons"}${ze(n,o)}`})]}),t.jsx(Ie,{onClick:()=>{je(h(new Date(c)),n.dayIndex),R(!0)},style:{...s(e).subtext,width:"18px",height:"18px",marginLeft:"auto",marginRight:"10px"}})]},l))})]}),re&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"20%"},children:[t.jsx("div",{style:{...s(e,m).text},children:o===0?"Удалить тренировку?":"Delete session?"}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>R(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{we()}})]})]})}),oe&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начать тренировку?":"Start training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>W(n.target.value),children:Q(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(n.target.value),children:X(e,o,m,w)}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>I(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{be()}})]})]})}),ie&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Добавить предыдущую тренировку?":"Add previous training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>W(n.target.value),children:Q(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(n.target.value),children:X(e,o,m,w)}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начало тренировки":"Training start time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ue,onClick:()=>v(n=>(n-f+u)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})}),t.jsx("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:Z(S)}),t.jsxs("div",{...pe,onClick:()=>v(n=>(n+f)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:[t.jsx(J,{})," "]})]}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Окончание тренировки":"Training end time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...he,onClick:()=>{const n=(C-f+u)%u;n>=S&&T(n)},style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})})," ",t.jsxs("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:[" ",Z(C)," "]}),t.jsx("div",{...fe,onClick:()=>T(n=>(n+f)%u),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(J,{})})]}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>z(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{Se()}})]})]})})]})},Q=(e,a,o)=>x.programs.map(p=>t.jsx("option",{value:p.id,style:{...s(e,!1).text},children:p.name[a]},p.id)),X=(e,a,o,p)=>{const r=x.programs.find(b=>b.id===p);return!r||!r.schedule?[t.jsx("option",{value:"",children:"0"},"none")]:r.schedule.map((b,c)=>t.jsx("option",{value:c,style:{...s(e,!1).text},children:b.name[a]},c))},s=(e,a)=>({container:{backgroundColor:i.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${i.get("border",e)}`},scrollView:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",height:"100%",overflowY:"scroll",backgroundColor:i.get("trainingGroup",e),borderRadius:"12px"},mainText:{textAlign:"left",fontSize:a===0?"13px":"15px",color:i.get("mainText",e),marginLeft:"10px",marginBottom:"2px"},subtext:{textAlign:"left",fontSize:a===0?"11px":"13px",color:i.get("subText",e),marginLeft:"10px",marginBottom:"12px"},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:i.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",e)},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",color:i.get("mainText",e),fontFamily:"Segoe UI"},cP:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",backgroundColor:i.get("bottomPanel",e),width:"100%",height:"90vh"},confirmContainer:{position:"fixed",top:0,left:-10,bottom:0,width:"95vw",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,padding:"20px"},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}});function K(e){x.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),x.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Le=(e,a)=>e==0?a==0?"нет тренировок":"no trainings":e==1?a==0?"1 тренировка":"1 training":e>1&&e<5?e+(a==0?" тренировки":" trainings"):e+(a==0?" тренировок":" trainings"),Z=e=>{const a=Math.floor(e/6e4),o=Math.floor(a/60)%24,p=a%60;return`${o.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`};export{Ke as default};
