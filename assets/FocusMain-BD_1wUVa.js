import{A as P,t as ye,l as je,f as ve,C as o,j as t,bj as oe,bk as qe,bu as _e,bv as Je,bw as Ke,bq as _,U as Qe,p as Xe,s as Ze,bp as et}from"./index-BkK6-Tob.js";import{r}from"./recharts-Bg6K2Pzo.js";import{G as tt,a as st}from"./index-Cd4FQdkn.js";import{f as j,s as ot}from"./MentalHelper-hWJEtbla.js";import{B as nt}from"./BreathAudio-BrJNN4AB.js";const pe=["â—","â–²","â– ","â—†","â¬Ÿ","âœš","â¬¢","â¬Ÿ","âœ¦","âœ³","â„","â¬Ÿ"];function rt(s,i,l){if(s!==3)return[[],""];const d=Math.max(0,Math.min(i,j.length-1)),e=j[d],u=e.targetSymbol||"â˜…";let n;switch(d){case 0:n=he(e);break;case 1:n=it(e);break;case 2:n=lt(e);break;case 3:n=at(e);break;default:n=he(e)}const g=n.filter(w=>w===u).length;return[n,g.toString()]}const he=s=>J(s),it=s=>J(s),lt=s=>J(s),at=s=>J(s);function J(s,i){const l=be(...s.totalItemsRange);let d=be(...s.targetsPerRoundRange);d=Math.min(d,l);const e=s.targetSymbol||"â˜…",u=Array.from({length:l},()=>pe[Math.floor(Math.random()*pe.length)]),n=new Set;for(;n.size<d;)n.add(Math.floor(Math.random()*l));return n.forEach(g=>{u[g]=e}),u.sort(()=>Math.random()-.5)}function be(s,i){return s==null||i==null||isNaN(s)||isNaN(i)?(console.error("[randomInRange] Invalid range:",{min:s,max:i}),4):Math.floor(Math.random()*(i-s+1))+s}function ct(s,i,l,d,e,u,n){if(s!==3)return 0;const w=[100,200,300,400][i]||100,f=Number(u),p=Number(e),k=p!==0?Math.abs(p-f)/p:1,h=k===0?1:k<.15?.5:0,S=Math.min(1+l*.02,1.3),x=d/1e3,R=j[i]?.timeLimitSec||20,b=x/R,F=h===1?Math.max(1,1.3-(b-1)*.6):1,D=n>=5&&h===1?Math.min(1+.1*Math.min(n/10,4),1.5):1;return Math.round(w*h*S*F*D)}const dt=3e3,ut=({show:s,type:i,difficulty:l,setShow:d})=>{const[e,u]=r.useState("dark"),[n,g]=r.useState(P.prefs[0]),[w,f]=r.useState(P.prefs[4]),[p,k]=r.useState(!1),[h,S]=r.useState(!1),[x,R]=r.useState(!1),[b,F]=r.useState(!1),[D,Te]=r.useState(!1),[Ce,ne]=r.useState(0),[$,we]=r.useState(null),[A,W]=r.useState(new Set),[re,V]=r.useState({}),[Ie,ke]=r.useState(0),[bt,ie]=r.useState(!1),[L,le]=r.useState(0),[ae,Me]=r.useState(!1),{initAudio:Re,playRight:$e,playWrong:K}=nt(P.prefs[2]===0),[M,G]=r.useState(0),[N,B]=r.useState(1),[ce,Q]=r.useState(0),[Pe,Y]=r.useState(0),[X,ze]=r.useState(P.mentalRecords[i]?.[l]||0),[De,de]=r.useState(0),[Ae,ue]=r.useState(0),[I,Z]=r.useState(!1),[v,me]=r.useState(0),[Le,E]=r.useState(""),[Ee,ge]=r.useState("");r.useEffect(()=>{const a=ye.subscribe(u),c=je.subscribe(y=>g(y==="ru"?0:1)),m=ve.subscribe(f);return()=>{a.unsubscribe(),c.unsubscribe(),m.unsubscribe()}},[]),r.useEffect(()=>{let a=null;return p&&(a=setInterval(()=>de(c=>c+100),100)),()=>clearInterval(a)},[p]),r.useEffect(()=>{if(!x)return;const a=Math.ceil(dt/1e3);ue(a);const c=setInterval(()=>{ue(m=>m<=1?(clearInterval(c),We(),R(!1),0):m-1)},1e3);return()=>clearInterval(c)},[x]);const Fe=r.useCallback(a=>{if(!h||b||I||D)return;const m=$.items[a]===$.targetSymbol;W(y=>{const T=new Set(y);return T.has(a)?T.delete(a):T.add(a),T}),V(y=>({...y,[a]:m?"correct":"wrong"})),m||K()},[$,h,b,I,D,K]);r.useEffect(()=>{if(A.size===0||I)return;const a=setTimeout(()=>{xe()},800);return()=>clearTimeout(a)},[A,I]);const xe=()=>{if(!$||I)return;const{items:a,targetSymbol:c}=$,y=a.map((C,Oe)=>C===c?Oe:-1).filter(C=>C!==-1).length,T=Array.from(A).filter(C=>a[C]===c).length,te=Array.from(A).filter(C=>a[C]!==c).length,Be=T,H=y,Ye=Date.now()-Ie,He=ct(i,l,N,Ye,H,Be,ce),U=te===0&&T===H;let se="";U?(se=pt(n),Y(C=>C+1)):se=n===0?`ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾: ${H}. Ğ¢Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»: ${T} (Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: ${te})`:`Correct: ${H}. You selected: ${T} (mistakes: ${te})`;const Ue=U?o.get("maxValColor",e):o.get("minValColor",e);ge(Ue),E(se),me(He),Q(C=>U?C+1:0),U?$e():K(),Z(!0),ie(!1)};r.useEffect(()=>{if(!ae||L<=0){L<=0&&xe();return}const a=setTimeout(()=>{le(c=>c-1)},1e3);return()=>clearTimeout(a)},[ae,L]),r.useEffect(()=>{if(!I)return;const a=setTimeout(()=>{const c=M+v;G(c),me(0),W(new Set),V({}),N>=20?fe(c):(B(m=>m+1),ee(m=>m+1)),Z(!1)},1200);return()=>clearTimeout(a)},[I,M,v,N]);const We=()=>{Re(),G(0),B(1),Y(0),Q(0),E(""),S(!0),k(!0),Te(!1),de(0),ne(Date.now()),ee(1)},ee=a=>{const c=j[l],[m,y]=rt(i,l),T=c.roundTimeSec||10;if(le(T),Me(!0),console.log("[DEBUG] Problem generated:",{type:i,difficulty:l,stage:a,items:m,answer:y,targetSymbol:c.targetSymbol}),!m||m.length===0){E(n===0?"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸":"Problem generation failed"),ge(o.get("minValColor",e)),Z(!0);return}we({items:m,targetSymbol:c.targetSymbol||"â˜…"}),W(new Set),V({}),ke(Date.now()),ie(!0)},Ve=()=>{G(0),B(1),Y(0),Q(0),E(""),W(new Set),V({}),ne(Date.now()),h&&ee(1)},fe=a=>{Ge();const c=a>X,m=ft(!1,n,a,Pe,20,c);k(!1),E(m),F(!0),S(!1)},Ge=()=>{M+v>X&&(ze(M+v),P.mentalRecords[i][l]=M+v);const a=Date.now(),c=Math.round((a-Ce)/1e3);ot(c,M+v>X,i,l,M+v),G(0),setAddValue(0),B(1),Y(0),F(!1),d(!1)},Ne=()=>!$||!$.items?null:t.jsx("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",justifyContent:"center",marginTop:"20px"},children:$.items.map((a,c)=>{let m=o.get("bottomPanel",e),y=o.get("border",e);return re[c]==="correct"?(m=o.get("maxValColor",e)+"20",y=o.get("maxValColor",e)):re[c]==="wrong"?(m=o.get("minValColor",e)+"20",y=o.get("minValColor",e)):A.has(c)&&(y=o.get("mainText",e)),t.jsx("div",{onClick:()=>Fe(c),style:{width:"50px",height:"50px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px",fontWeight:"bold",color:o.get("mainText",e),backgroundColor:m,border:`2px solid ${y}`,borderRadius:"8px",cursor:h&&!I&&!D?"pointer":"default",userSelect:"none"},children:a},c)})});return t.jsxs("div",{style:O(e,s).container,children:[!h&&!x&&!b&&t.jsxs("div",{style:mt(),children:[t.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:o.get("mainText",e)},children:j[l].level[n]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:j[l].title[n]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:j[l].description[n]}),t.jsxs("div",{style:{fontSize:"15px",color:o.get("mainText",e),marginTop:"12px"},children:[n===0?"Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²: ":"Items: ",j[l].totalItemsRange[0],"â€“",j[l].totalItemsRange[1]]}),t.jsx("div",{style:{fontSize:"15px",color:o.get("subText",e),marginTop:"12px"},children:n===0?`Ğ’Ñ€ĞµĞ¼Ñ: ${j[l].timeLimitSec} ÑĞµĞº`:`Time: ${j[l].timeLimitSec} sec`}),t.jsx("div",{style:{fontSize:"12px",color:o.get("subText",e),marginTop:"50px",textAlign:"center"},children:n===0?"ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ñ†ĞµĞ»ĞµĞ²Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ (â˜…). ĞÑˆĞ¸Ğ±ĞºĞ¸ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ÑÑ‚ ÑĞµÑ€Ğ¸Ñ.":"Click only on target symbols (â˜…). Mistakes break your streak."})]}),!h&&!x&&!b&&t.jsxs("div",{style:O(e,s).controls,children:[t.jsx(oe,{onClick:()=>d(!1),style:{fontSize:"60px",color:o.get("close",e)}}),t.jsx(qe,{onClick:()=>R(!0),style:{fontSize:"60px",color:o.get("play",e)}}),t.jsx(_e,{onClick:Ve,style:{fontSize:"60px",color:o.get("reload",e)}})]}),!b&&x&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",width:"90%",height:"80%"},children:[t.jsx("div",{style:{fontSize:"10rem",marginTop:"180px",color:o.get("icons",e),fontWeight:"bold",lineHeight:1},children:Ae}),t.jsx("div",{style:{fontSize:"2rem",marginBottom:"80px",textAlign:"center"},children:t.jsx("div",{style:{color:o.get("icons",e),marginBottom:"80px"},children:n===0?"ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²ÑŒÑ‚ĞµÑÑŒ!":"Get ready!"})})]}),h&&!b&&t.jsxs("div",{style:O(e).playContainer,children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",width:"86%",borderBottom:`1px solid ${o.get("border",e)}`},children:[t.jsx("div",{style:{display:"flex",flexDirection:"row",marginTop:"6px",width:"60%",gap:"20px",marginRight:"auto"},children:t.jsx(oe,{onClick:()=>fe(M+v),style:{fontSize:"25px",color:o.get("close",e)}})}),t.jsxs("div",{style:{display:"flex",marginLeft:"auto",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("subText",e)},children:[t.jsx(Je,{}),xt(De)]})]}),t.jsxs("div",{style:{display:"flex",width:"86%",flexDirection:"row",marginTop:"20px",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("minValColor",e)},children:[t.jsx(Ke,{}),ce]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("difficulty",e)},children:[N,"/20"]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",fontWeight:"bold",color:o.get("maxValColor",e)},children:[t.jsx(_,{}),M]})]}),t.jsxs("div",{style:{fontSize:"24px",color:L<=3?"red":"white"},children:[L,"s"]}),t.jsxs("div",{style:{marginTop:"20px",width:"95%",display:"flex"},children:[!I&&t.jsxs("div",{style:Se(e,!1),children:[t.jsx("div",{style:{fontSize:"16px",marginBottom:"12px",color:o.get("subText",e)},children:j[l].rules?.[n]||(n===0?"ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° Ğ²ÑĞµ â˜…":"Click all â˜…")}),Ne()]}),I&&t.jsxs("div",{style:Se(e,!0,Ee),children:[t.jsxs("p",{style:{fontSize:"22px",fontWeight:"bold",color:v>0?o.get("maxValColor",e):o.get("minValColor",e)},children:[v>0&&t.jsx(_,{})," ",v>0?v:n===0?"Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸":"mistakes"]}),t.jsx("p",{style:{fontSize:"16px",fontWeight:"bold",color:o.get("mainText",e)},children:Le})]})]})]}),b&&t.jsx("div",{style:gt()}),b&&t.jsx("div",{style:O(e,s).controls,children:t.jsx(oe,{onClick:()=>d(!1),style:{fontSize:"60px",color:o.get("close",e)}})})]})},mt=(s,i,l)=>({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"80%"}),gt=(s,i,l,d,e,u,n)=>({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"80%"}),Se=(s,i,l)=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"95%",minHeight:"56vh",marginTop:"20px",backgroundColor:o.get("bottomPanel",s),boxShadow:i?`0px 0px 9px 9px ${l}`:`2px 2px ${o.get("shadow",s)}`,borderRadius:"24px",fontSize:"39px",fontWeight:"bold",color:o.get("mainText",s),alignContent:"center",padding:"16px"}),O=(s,i)=>({container:{backgroundColor:o.get("background",s),display:"flex",position:"fixed",flexDirection:"column",alignItems:"center",height:"86vh",transform:i?"translateY(0)":"translateY(100%)",bottom:"0",transition:"transform 0.2s ease-in-out",width:"100vw",fontFamily:"Segoe UI",borderTop:`2px solid ${o.get("border",s)}`,borderTopLeftRadius:"12px",borderTopRightRadius:"12px",zIndex:2e3},controls:{display:"flex",marginTop:"30px",gap:"50px"},playContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",height:"50vh",width:"100vw"}}),xt=s=>{const i=Math.floor(s/1e3),l=Math.floor(i/60),d=i%60;return`${String(l).padStart(2,"0")}:${String(d).padStart(2,"0")}`},ft=(s,i,l,d,e,u)=>{const n=Math.round(d/e*100),g=n>=80,w={ru:{high:[`ğŸ‰ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ${d}/${e} (${n}%)`,`ğŸ”¥ ${l} Ğ¾Ñ‡ĞºĞ¾Ğ² â€” Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ÑĞµÑ‚!`],moderate:[`ğŸ™‚ Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°! ${d}/${e} (${n}%)`,"ğŸŒ± Ğ¢Ñ‹ Ğ½Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿ÑƒÑ‚Ğ¸!"],low:["ğŸ¤— Ğ¢Ñ‹ ÑÑ‚Ğ°Ñ€Ğ°Ğ»ÑÑ â€” ÑÑ‚Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ.","ğŸŒ¤ï¸ ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞµÑ‰Ñ‘!"],record:[`ğŸ† ĞĞĞ’Ğ«Ğ™ Ğ Ğ•ĞšĞĞ Ğ”! ${l} Ğ¾Ñ‡ĞºĞ¾Ğ²!`]},en:{high:[`ğŸ‰ Awesome! ${d}/${e} (${n}%)!`,`ğŸ”¥ ${l} points â€” impressive!`],moderate:[`ğŸ™‚ Good effort! ${d}/${e} (${n}%)`,"ğŸŒ± You're making progress!"],low:["ğŸ¤— You gave it your best!","ğŸŒ¤ï¸ Try again!"],record:[`ğŸ† NEW RECORD! ${l} points!`]}},f=i===0?w.ru:w.en;let p=u?f.record:g?f.high:f.moderate;return n<50&&(p=f.low),p[Math.floor(Math.random()*p.length)]},pt=s=>{const d=s===0?["ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!","ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾!","Ğ’ĞµÑ€Ğ½Ğ¾!","Ğ¢Ğ¾Ñ‡Ğ½Ğ¾!"]:["Great!","Perfect!","Yes!","Exactly!"];return d[Math.floor(Math.random()*d.length)]},Ct=()=>{const[s,i]=r.useState("dark"),[l,d]=r.useState(P.prefs[0]),[e,u]=r.useState(P.prefs[4]),[n,g]=r.useState(!1),[w,f]=r.useState(0),[p,k]=r.useState(Qe.hasPremium);r.useEffect(()=>{const S=Xe.subscribe(k);return()=>S.unsubscribe()},[]),r.useEffect(()=>{const S=ye.subscribe(i),x=je.subscribe(b=>d(b==="ru"?0:1)),R=ve.subscribe(u);return()=>{S.unsubscribe(),x.unsubscribe(),R.unsubscribe()}},[]);const h=S=>P.mentalRecords?.[3]?.[S]||0;return t.jsxs("div",{style:z(s).container,children:[t.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:t.jsx("div",{style:{width:"90%",display:"grid",gridTemplateColumns:"1fr 1fr",alignItems:"center",justifyContent:"center",gap:"10px"},children:j.slice(0,4).map((S,x)=>{const R=`difficulty${x}`,b=x>1&&!p;return t.jsx(ht,{width:"46vw",difficulty:x,protocol:S,setLevel:f,color:o.get(R,s),theme:s,lang:l,click:()=>{b||(f(x),g(!0))},fSize:e,hasPremium:p,needBlur:b,record:h(x)},x)})})}),n&&t.jsx(ut,{type:3,difficulty:w,show:n,setShow:g})]})},z=(s,i)=>({container:{backgroundColor:o.get("background",s),display:"flex",flexDirection:"column",overflowY:"scroll",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},mainText:{textAlign:"left",fontSize:i===0?"15px":"17px",color:o.get("mainText",s)},cardText:{textAlign:"left",marginBottom:"5px",fontSize:i===0?"14px":"16px",color:o.get("mainText",s),marginLeft:"30px"},text:{textAlign:"left",fontSize:i===0?"10px":"12px",color:o.get("subText",s),marginLeft:"30px"},btn:{width:"70%",height:"40px",borderRadius:"12px",fontSize:i===0?"13px":"14px",color:o.get("mainText",s),backgroundColor:o.get("simplePanel",s)}});function ht({protocol:s,difficulty:i,click:l,width:d,color:e,theme:u,lang:n,fSize:g,hasPremium:w=!1,needBlur:f=!1,record:p=0}){const k=()=>i===0?t.jsx(et,{style:q(u)}):i===1?t.jsx(_,{style:q(u)}):i===2?t.jsx(tt,{style:q(u)}):i===3?t.jsx(st,{style:q(u)}):null,h={alignItems:"center",justifyContent:"center",display:"flex",width:d,flexDirection:"row",height:"12vh",marginTop:"15px",borderRadius:"24px",backgroundColor:e,position:"relative",overflow:"hidden",boxShadow:"3px 3px 2px rgba(0,0,0,0.3)",cursor:f?"not-allowed":"pointer",opacity:f?.8:1};return t.jsxs("div",{style:h,onClick:l,children:[f&&t.jsxs("div",{onClick:S=>S.stopPropagation(),style:{position:"absolute",display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center",width:"100%",height:"100%",backdropFilter:"blur(8px)",zIndex:2},children:[t.jsx("div",{style:{...z(u,g).mainText},children:n===0?"ĞŸÑ€Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ":"Pro category"}),t.jsxs("div",{style:{...z(u,g).mainText},children:["ğŸ‘‘ ",n===0?"Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼":"premium"," ğŸ‘‘"]}),t.jsx("button",{onClick:()=>Ze("premium"),style:{...z(u,g).btn},children:n===0?"Ğ¡Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼":"Get premium"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:"5%",right:"10px",fontWeight:"bold",fontSize:"14px",color:o.get("maxValColor",u)},children:[t.jsx(_,{style:{marginRight:"4px"}}),p]}),t.jsxs("div",{style:{width:"90%",height:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",paddingLeft:"16px"},children:[t.jsx("h2",{style:z(u,g).cardText,children:s.level[n]}),t.jsx("p",{style:z(u,g).text,children:s.title[n]})]}),k()]})}const q=s=>({fontSize:"86px",rotate:"-20deg",position:"absolute",right:"-10px",top:"30%",color:o.get("svgColor",s)});export{Ct as default};
