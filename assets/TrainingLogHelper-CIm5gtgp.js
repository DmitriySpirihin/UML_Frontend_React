import{A as i,aT as h}from"./index-D_44Glyf.js";function x(n){return new Date(n).toISOString().split("T")[0]}function O(n,o,s,e){if(!e||typeof n!="string"||typeof o!="number")return null;const t=s.getTime();let r=null,a=-1/0;for(const[d,f]of Object.entries(e)){const c=new Date(d).getTime();if(!(c>=t))for(const u of f){if(!u.completed)continue;const m=u.exercises?.[n];if(!m||!Array.isArray(m.sets))continue;const l=m.sets[o];!l||typeof l.reps!="number"||typeof l.weight!="number"||c>a&&(a=c,r={type:l.type,reps:l.reps,weight:l.weight,time:l.time})}}return r}async function b(n,o,s){const e=i.programs[o];if(!e||!e.schedule[s])return console.error("Invalid program or dayIndex"),!1;const t={},r=[];e.schedule[s].exercises.forEach(f=>{const g=i.exercises[f.exId];if(!g){console.warn(`Exercise ${f.exId} not found in AppData.exercises`);return}t[f.exId]={mgId:g.mgId,sets:[],totalTonnage:0,completed:!1},r.push(f.exId)});const a=x(n),d={programId:o,dayIndex:s,completed:!1,startTime:Date.now(),endTime:null,duration:0,tonnage:0,exercises:t,exerciseOrder:r};i.trainingLog[a]||(i.trainingLog[a]=[]),i.trainingLog[a].push(d),await h()}async function E(n,o,s,e,t){const r=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=r.getTime()+e,d=r.getTime()+t,f=d-a,g={},c=[],u=i.programs[o];if(!u||!u.schedule[s]){console.error("Invalid program or dayIndex in addPreviousSession");return}u.schedule[s].exercises.forEach(p=>{const y=i.exercises[p.exId];if(!y){console.warn(`Exercise ${p.exId} not found in AppData.exercises`);return}g[p.exId]={mgId:y.mgId,sets:[],totalTonnage:0,completed:!0},c.push(p.exId)});const m={programId:o,dayIndex:s,completed:!0,startTime:a,endTime:d,duration:f,tonnage:0,exercises:g,exerciseOrder:c},l=x(n);i.trainingLog[l]||(i.trainingLog[l]=[]),i.trainingLog[l].push(m);for(const p in m.exercises){const y=m.exercises[p];let T=i.exercises[p]?.rm||0;for(const w of y.sets){const S=D(w.reps,w.weight);S>T&&(T=S)}T>(i.exercises[p]?.rm||0)&&(i.exercises[p].rm=T,i.exercises[p].rmDate=x(new Date))}await h()}async function K(n,o){const s=x(n),e=i.trainingLog[s];if(!e||o<0||o>=e.length)return!1;e.splice(o,1),e.length===0&&delete i.trainingLog[s],await h()}function v(n,o){const s=x(n),e=i.trainingLog[s]?.[o];if(!e||e.completed)return[];e.endTime=Date.now(),e.duration=e.endTime-e.startTime,e.completed=!0,Object.values(e.exercises).forEach(r=>{r.completed=!0}),e.tonnage=Object.values(e.exercises).reduce((r,a)=>r+(a.totalTonnage||0),0);const t=[];return e.exerciseOrder.forEach(r=>{const a=e.exercises[r],d=Number(r),f=i.exercises[d];if(!a||!f||!a.sets?.length)return;const g=a.sets.reduce((m,l)=>l.weight>m.weight?l:m,{weight:0,reps:1}),c=D(g.reps,g.weight);if(isNaN(c)||c<=0)return;const u=f.rm;if(c>u){f.rm=c,f.rmDate=s;const m=c-u;t.push({exId:d,newRm:c,oldRm:u,improvement:m})}}),t}function M(n,o,s){const e=x(n),t=i.trainingLog[e]?.[o];return!t||t.exercises[s]?!1:(t.exercises[s]={mgId:i.exercises[s]?.mgId||0,sets:[],totalTonnage:0,completed:!1},t.exerciseOrder.push(s),!0)}function A(n,o,s){const e=x(n),t=i.trainingLog[e]?.[o];if(!t||!t.exercises[s])return!1;const r=t.exercises[s];return t.tonnage=Math.max(0,t.tonnage-(r.totalTonnage||0)),delete t.exercises[s],t.exerciseOrder&&(t.exerciseOrder=t.exerciseOrder.filter(a=>a!==s)),!0}function R(n,o,s,e,t,r,a){const d=x(n),f=i.trainingLog[d]?.[o],g=f?.exercises?.[s];if(!g)return!1;const u={type:a?0:1,reps:e,weight:t,time:r};g.sets.push(u);const m=e*t;if(g.totalTonnage=(g.totalTonnage||0)+m,f.tonnage=(f.tonnage||0)+m,g.completed&&!a&&e>0&&t>0){const l=D(e,t),p=i.exercises[s]?.rm||0;l>p&&(i.exercises[s].rm=l,i.exercises[s].rmDate=x(new Date))}return!0}function j(n,o,s,e,t,r,a,d){const f=x(n),g=i.trainingLog[f]?.[o],c=g?.exercises?.[s];if(!c||e<0||e>=c.sets.length)return!1;const u=c.sets[e],m=d?0:1;if(u.reps===t&&u.weight===r&&a===u.time&&u.type===m)return!0;const l=u.reps*u.weight;c.totalTonnage=Math.max(0,(c.totalTonnage||0)-l),g.tonnage=Math.max(0,(g.tonnage||0)-l),u.reps=t,u.weight=r,u.type=m;const p=t*r;return c.totalTonnage=(c.totalTonnage||0)+p,g.tonnage=(g.tonnage||0)+p,!0}function N(n,o,s){const e=x(n),r=i.trainingLog[e]?.[o]?.exercises?.[s];return r?(r.completed=!0,!0):!1}function k(n,o){const s=x(n);return i.trainingLog[s]?.[o]?.tonnage||0}function P(n,o){const s=x(n),e=i.trainingLog[s]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))for(const a of r.sets)t+=a.reps;return t}function F(n,o){const s=x(n),e=i.trainingLog[s]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))t+=r.sets.length;return t}function D(n,o){if(!n||!o||n<1||o<=0)return 0;if(n===1)return o;const s=o*(36/(37-n)),e=o*(1+.0333*n),t=o*Math.pow(n,.1),r=s+e+t;return Math.round(r/3)}const I=()=>{try{const n=i?.trainingLog||{},o=new Date;let s=0;const e=[];for(let t=0;t<7;t++){const r=new Date(o);r.setDate(o.getDate()-t);const a=r.toISOString().split("T")[0];e.push(a)}for(const t of e){const r=n[t];if(Array.isArray(r)){const a=r.filter(d=>d.completed===!0).length;s+=a}}return Math.min(s,7)}catch(n){return console.warn("Error calculating weekly training amount:",n),0}};export{b as a,E as b,N as c,K as d,R as e,O as f,F as g,k as h,P as i,v as j,A as k,M as l,I as m,j as r};
