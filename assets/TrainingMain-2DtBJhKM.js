import{R as Te,r as x,A as d,t as De,l as ke,f as Pe,H as P,ax as Me,j as t,C as i,ay as L,s as Y,_ as Ie,i as B,k as E,Y as V}from"./index-BNFii3Dw.js";import{g as ze,d as Re,a as Ae,b as Fe}from"./TrainingLogHelper-CBn7bcto.js";import{F as _,a as q}from"./index-DKEErazu.js";const h=e=>{const l=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${l}-${o}-${u}`},$e=e=>(e.getDay()+6)%7;h(new Date);const H=new Audio("Audio/Click.wav"),Ke=()=>{const[e,l]=Te.useState("dark"),[o,u]=x.useState(d.prefs[0]),[r,y]=x.useState(new Date),[c,Z]=x.useState(r),[ee,te]=x.useState(0),[m,ne]=x.useState(d.prefs[4]),[se,M]=x.useState(!1),[oe,I]=x.useState(!1),[ie,z]=x.useState(!1),[j,O]=x.useState(d.getLastProgramId()),[W,N]=x.useState(d.getLastTrainingDayIndex()),[b,w]=x.useState(16*36e5),[v,C]=x.useState(17*36e5),[U,re]=x.useState({date:"",key:0}),f=600*1e3,p=24*36e5;x.useEffect(()=>{const n=De.subscribe(l),a=ke.subscribe(S=>{u(S==="ru"?0:1)}),g=Pe.subscribe(S=>{ne(S)});return()=>{n.unsubscribe(),a.unsubscribe(),g.unsubscribe()}},[]);const le=new Date(r.getFullYear(),r.getMonth(),1),ae=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),ce=(le.getDay()+6)%7,de=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],xe=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],ge=P(()=>w(n=>(n-f+p)%p)),pe=P(()=>w(n=>(n+f)%p)),ue=P(()=>C(n=>{const a=(n-f+p)%p;return a>=b?a:n})),he=P(()=>C(n=>(n+f)%p)),T=[],G=[];for(let n=0;n<ce;n++)T.push(null);for(let n=1;n<=ae;n++)T.push(n);for(let n=0;n<T.length;n+=7)G.push(T.slice(n,n+7));const fe=()=>{y(new Date(r.getFullYear(),r.getMonth()-1)),K(H)},me=()=>{y(new Date(r.getFullYear(),r.getMonth()+1)),K(H)};x.useEffect(()=>{const n=Me.subscribe(ye);return()=>n.unsubscribe()},[]);const ye=()=>{const n=new Date;if(c>n)return;const a=h(c),g=h(n);a===g?M(!0):I(!0)},be=()=>{Ae(new Date,j,W),M(!1),setTimeout(()=>{const a=h(new Date),g=d.trainingLog[a].length-1;L({mode:"new",dayKey:h(new Date),dInd:g}),Y("TrainingCurrent")},100)},Se=()=>{if(v<=b){V(o===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Fe(c,j,W,b,v),I(!1);const n=h(c),a=d.trainingLog[n].length-1;L({mode:"redact",dayKey:n,dInd:a}),Y("TrainingCurrent")},je=(n,a)=>{re({date:n,key:a})},we=()=>{Re(U.date,U.key),z(!1),V(o===0?"Тренировка удалена":"Session deleted",2e3,!0)};return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).panel,children:[t.jsxs("div",{style:s(e).calendarHead,children:[t.jsx("h1",{style:s(e).header,children:r.getFullYear()+"/"+(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)}),t.jsx("div",{onClick:fe,children:t.jsx("h1",{style:s(e).header,children:"<"})}),t.jsx("div",{onClick:me,children:t.jsx("h1",{style:s(e).header,children:">"})})]}),t.jsxs("table",{style:s(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:de[o].map(n=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:n==="Вс"||n==="Sun"?"#873535ff":i.get("subText",e)},children:n})},n))})}),t.jsx("tbody",{children:G.map((n,a)=>t.jsx("tr",{children:n.map((g,S)=>{const R=r.getMonth(),A=r.getFullYear(),ve=g===c.getDate()&&R===c.getMonth()&&A===c.getFullYear(),F=h(new Date(A,R,g)),$=F in d.trainingLog?d.trainingLog[F].length:0;let D=0,k=0;return $>0&&d.trainingLog[F].forEach(Ce=>{Ce.completed?k++:D++}),t.jsx("td",{children:t.jsxs("div",{style:{...s(e).cell,border:`3px solid ${ve?i.get("currentDateBorder",e):i.get("background",e)}`,backgroundColor:i.get("background",e)},onClick:()=>{Z(new Date(Date.UTC(A,R,g))),te($),K(H)},children:[g,$>0&&t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"10px"},children:[D>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"⏳"}),D>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:D}),k>0&&t.jsx("div",{style:{fontSize:"10px",color:i.get("done",e),lineHeight:"5px"},children:"✅"}),k>0&&t.jsx("div",{style:{fontSize:"11px",color:i.get("subText",e),lineHeight:"5px"},children:k})]})]})},S)})},a))})]})]}),t.jsxs("div",{style:{height:"30vh",width:"95%",display:"flex",flexDirection:"column",alignContent:"center"},children:[t.jsx("h1",{style:{...s(e).subtext,fontSize:"18px",textAlign:"center"},children:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+xe[o][$e(c)]+" / "+Le(ee,o)}),t.jsx("div",{style:s(e).scrollView,children:d.trainingLog[h(c)]?.map((n,a)=>t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%",borderBottom:`1px solid ${i.get("border",e)}`},children:[t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:a+1}),t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:n.completed?"✅":"⏳"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{onClick:()=>{L({mode:n.completed?"redact":"new",dayKey:h(new Date(c)),dInd:n.dayIndex}),Y("TrainingCurrent")},style:s(e).mainText,children:d.programs.find(g=>g.id===n.programId).name[o]}),t.jsx("div",{style:s(e).mainText,children:(o===0?"День ":"Day ")+(a+1)+": "+d.programs.find(g=>g.id===n.programId).schedule[n.dayIndex].name[o]}),n.completed&&t.jsx("div",{style:{...s(e).subtext,marginBottom:"10px"},children:`${Math.round(n.duration/6e4)}${o===0?" мин":" min"}  /  ${n.tonnage*.001} ${o===0?" тонн":" tons"}${ze(n,o)}`})]}),t.jsx(Ie,{onClick:()=>{je(h(new Date(c)),n.dayIndex),z(!0)},style:{...s(e).subtext,width:"18px",height:"18px",marginLeft:"auto",marginRight:"10px"}})]},a))})]}),ie&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"20%"},children:[t.jsx("div",{style:{...s(e,m).text},children:o===0?"Удалить тренировку?":"Delete session?"}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>z(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{we()}})]})]})}),se&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начать тренировку?":"Start training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>O(n.target.value),children:J(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>N(n.target.value),children:Q(e,o,m,j)}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>M(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{be()}})]})]})}),oe&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Добавить предыдущую тренировку?":"Add previous training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>O(n.target.value),children:J(e,o)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>N(n.target.value),children:Q(e,o,m,j)}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Начало тренировки":"Training start time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ge,onClick:()=>w(n=>(n-f+p)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(_,{})}),t.jsx("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:X(b)}),t.jsxs("div",{...pe,onClick:()=>w(n=>(n+f)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:[t.jsx(q,{})," "]})]}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:o===0?"Окончание тренировки":"Training end time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ue,onClick:()=>{const n=(v-f+p)%p;n>=b&&C(n)},style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(_,{})})," ",t.jsxs("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:[" ",X(v)," "]}),t.jsx("div",{...he,onClick:()=>C(n=>(n+f)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})})]}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>I(!1)}),t.jsx(E,{style:{fontSize:"38px",color:i.get("icons",e)},onClick:()=>{Se()}})]})]})})]})},J=(e,l,o)=>d.programs.map(u=>t.jsx("option",{value:u.id,style:{...s(e,!1).text},children:u.name[l]},u.id)),Q=(e,l,o,u)=>{const r=d.programs.find(y=>y.id===u);return!r||!r.schedule?[t.jsx("option",{value:"",children:"0"},"none")]:r.schedule.map((y,c)=>t.jsx("option",{value:c,style:{...s(e,!1).text},children:y.name[l]},c))},s=(e,l)=>({container:{backgroundColor:i.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${i.get("border",e)}`},scrollView:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",height:"100%",overflowY:"scroll",backgroundColor:i.get("trainingGroup",e),borderRadius:"12px"},mainText:{textAlign:"left",fontSize:l===0?"13px":"15px",color:i.get("mainText",e),marginLeft:"10px",marginBottom:"2px"},subtext:{textAlign:"left",fontSize:l===0?"11px":"13px",color:i.get("subText",e),marginLeft:"10px",marginBottom:"12px"},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:i.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",e)},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",color:i.get("mainText",e),fontFamily:"Segoe UI"},cP:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",backgroundColor:i.get("bottomPanel",e),width:"100%",height:"90vh"},confirmContainer:{position:"fixed",top:0,left:-10,bottom:0,width:"95vw",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,padding:"20px"},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}});function K(e){d.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),d.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Le=(e,l)=>e==0?l==0?"нет тренировок":"no trainings":e==1?l==0?"1 тренировка":"1 training":e>1&&e<5?e+(l==0?" тренировки":" trainings"):e+(l==0?" тренировок":" trainings"),X=e=>{const l=Math.floor(e/6e4),o=Math.floor(l/60)%24,u=l%60;return`${o.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};export{Ke as default};
