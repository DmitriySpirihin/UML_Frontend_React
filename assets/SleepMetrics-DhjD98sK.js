import{j as o,C as s,r as c,A as y,t as w,l as T,f as $}from"./index--aUvu4x0.js";import{aS as k,aV as C,aW as z,aX as I,aU as L,bb as B}from"./CartesianChart-DGqMSBVU.js";import{B as R,d as A}from"./BarChart-Dm_LObdp.js";const M=t=>{if(!t||t<=0)return"0:00";const r=Math.floor(t/6e4),n=Math.floor(r/60),a=r%60;return`${n}:${a.toString().padStart(2,"0")}`},U=t=>t/(1e3*60*60),F=({data:t=[],theme:r="dark",textColor:n="#94a3b8",linesColor:a="#334155",backgroundColor:d="#0f172a",height:x=220})=>{if(!Array.isArray(t)||t.length===0)return o.jsx("div",{style:{height:`${x}px`,display:"flex",alignItems:"center",justifyContent:"center",color:n,backgroundColor:d,fontFamily:"Segoe UI, system-ui, sans-serif",fontSize:"14px",borderRadius:"12px"},children:"No data"});const l={1:s.get("difficulty3",r),2:s.get("difficulty2",r),3:s.get("difficulty1",r),4:s.get("difficulty0",r),5:s.get("difficulty5",r)},g=t.map(e=>({date:e.date,ms:e.ms||0,mood:Math.max(1,Math.min(5,Math.round(e.mood||3))),hours:U(e.ms||0)})),h=Math.max(...g.map(e=>e.hours),1),p=e=>l[e]||l[3],b=({active:e,payload:i,label:m})=>{if(e&&i&&i.length){const u=i[0].payload,j=u?.ms||0,f=u?.mood||0,S=f?"★".repeat(f)+"☆".repeat(5-f):"—";return o.jsxs("div",{style:{backgroundColor:s.get("panel",r)||"#1e293b",padding:"10px",borderRadius:"8px",border:`1px solid ${a}`,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",fontFamily:"Segoe UI",fontSize:"13px",color:s.get("mainText",r)||"#f1f5f9"},children:[o.jsx("div",{style:{fontWeight:"600",marginBottom:"4px"},children:m}),o.jsxs("div",{children:["Sleep: ",M(j)]}),o.jsxs("div",{style:{marginTop:"4px",color:p(f)},children:["Mood: ",S]})]})}return null};return o.jsx("div",{style:{width:"100%",height:`${x}px`,backgroundColor:d,borderRadius:"12px",padding:"8px 4px",fontFamily:"Segoe UI, system-ui, sans-serif"},children:o.jsx(k,{width:"100%",height:"100%",children:o.jsxs(R,{data:g,margin:{top:15,right:10,left:-10,bottom:5},children:[o.jsx(C,{stroke:a,strokeOpacity:.2,vertical:!1}),o.jsx(z,{dataKey:"date",tick:{fill:n,fontSize:11},axisLine:!1,tickLine:!1,minTickGap:20}),o.jsx(I,{domain:[0,Math.ceil(h)],tick:{fill:n,fontSize:10},axisLine:!1,tickLine:!1,width:30,tickFormatter:e=>`${Math.round(e)}h`}),o.jsx(L,{content:o.jsx(b,{}),cursor:{fill:"rgba(100,100,100,0.1)"}}),o.jsx(A,{dataKey:"hours",radius:[4,4,0,0],barSize:28,fill:"#6366f1",shape:e=>{const{x:i,y:m,width:u,height:j,index:f}=e,S=g[f]?.mood||3,D=p(S);return o.jsx("rect",{x:i,y:m,width:u,height:j,fill:D,rx:4,ry:4})},children:o.jsx(B,{dataKey:"ms",position:"top",fontSize:11,fill:n,formatter:e=>M(e)})})]})})})},v=[["месяц","month"],["пол года","half year"],["год","year"]],O=[28,180,360],W=t=>Math.floor(t/6e4),E=t=>{const r=W(t),n=Math.floor(r/60),a=r%60;return n>0?`${n}h ${a}m`:`${a}m`},H=(t,r)=>new Date(t).toLocaleDateString(r===0?"ru-RU":"en-US",{day:"2-digit",month:"short"}),Y=({theme:t,langIndex:r,fSize:n,periodIndex:a,setPeriodIndex:d})=>o.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0"},children:v.map((x,l)=>o.jsxs("span",{onClick:()=>d(l),style:{padding:"6px 10px",cursor:"pointer",fontSize:n===0?"11px":"13px",fontWeight:a===l?"600":"400",color:a===l?s.get("mainText",t):s.get("subText",t),opacity:a===l?1:.8,transition:"all 0.2s ease"},children:[x[r],l<v.length-1&&o.jsx("span",{style:{margin:"0 8px",color:s.get("border",t),fontSize:n===0?"12px":"14px"},children:"|"})]},l))}),X=()=>{const[t,r]=c.useState("dark"),[n,a]=c.useState(y.prefs[0]),[d,x]=c.useState(y.prefs[4]),[l,g]=c.useState(0);c.useEffect(()=>{const e=w.subscribe(r),i=T.subscribe(u=>a(u==="ru"?0:1)),m=$.subscribe(x);return()=>{e.unsubscribe(),i.unsubscribe(),m.unsubscribe()}},[]);const h=c.useMemo(()=>y.sleepingLog?Object.entries(y.sleepingLog).map(([e,i])=>({date:e,durationMs:i.duration||0,mood:i.mood||0,note:i.note||""})).sort((e,i)=>new Date(e.date)-new Date(i.date)):[],[]),p=c.useMemo(()=>{if(h.length===0)return[];const e=new Date;return e.setDate(e.getDate()-O[l]),h.filter(i=>new Date(i.date)>=e)},[h,l]),b=c.useMemo(()=>p.map(e=>({date:e.date.split("-").slice(1).reverse().join("."),ms:e.durationMs,mood:e.mood||3})),[p]);return o.jsxs("div",{style:K(t).container,children:[o.jsx("div",{style:{fontSize:d===0?"14px":"16px",fontWeight:"bold",fontFamily:"Segoe UI",color:s.get("mainText",t),marginBottom:"8px"},children:n===0?"Продолжительность сна":"Sleep Duration"}),o.jsx("div",{style:{width:"100%",height:"220px",marginBottom:"16px"},children:o.jsx(F,{data:b,theme:t,textColor:s.get("subText",t),linesColor:s.get("border",t),backgroundColor:s.get("background",t)})}),o.jsx("div",{style:{display:"flex",justifyContent:"center",width:"100%",marginBottom:"12px"},children:o.jsx(Y,{theme:t,langIndex:n,fSize:d,periodIndex:l,setPeriodIndex:g})}),o.jsx("div",{style:{width:"90%",height:"48%",overflowY:"auto",padding:"8px",backgroundColor:s.get("panel",t),borderRadius:"12px",border:`1px solid ${s.get("border",t)}`,scrollbarWidth:"thin",scrollbarColor:`${s.get("icons",t)} ${s.get("background",t)}`},children:p.length===0?o.jsx("div",{style:{color:s.get("subText",t),fontSize:d===0?"13px":"15px",textAlign:"center"},children:n===0?"Нет данных за выбранный период":"No data for selected period"}):p.slice().reverse().map((e,i)=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 12px",borderBottom:`1px solid ${s.get("border",t)}`},children:[o.jsx("span",{style:{color:s.get("mainText",t),fontSize:d===0?"13px":"15px"},children:H(e.date,n)}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("span",{style:{color:s.get("icons",t),fontSize:d===0?"13px":"15px",fontWeight:"500"},children:E(e.durationMs)}),e.mood>0&&o.jsxs("span",{style:{color:s.get("subText",t),fontSize:d===0?"12px":"14px"},children:["★".repeat(e.mood),"☆".repeat(5-e.mood)]})]})]},`${e.date}-${i}`))})]})},K=t=>({container:{backgroundColor:s.get("background",t),display:"flex",position:"absolute",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",top:"14vh",width:"100vw",fontFamily:"Segoe UI"}});export{X as default};
