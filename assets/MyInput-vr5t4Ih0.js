import{r as l,cv as O,cw as $,j as h,C as p,A as w,cx as z,cy as B}from"./index-BS3PE0d2.js";const W=({maxL:f=500,placeHolder:b,theme:d,h:P="90%",w:A="vh",value:y="",onChange:S=null,clear:C=!1})=>{const[n,r]=l.useState({myString:"",cursorPos:0}),[o,u]=l.useState(!1),[j,a]=l.useState(!0);let g=1;return l.useEffect(()=>{r({myString:y,cursorPos:0})},[y]),l.useEffect(()=>{const i=O.subscribe(s=>{const m=t=>t==="bs"||t==="bsall"||t===`
`?!1:Array.from(t).length===1&&t.length>1;o&&(s===" "?g++:g=1,s==="bs"?r(t=>{const e=Array.from(t.myString);return t.cursorPos===0?t:{myString:[...e.slice(0,t.cursorPos-1),...e.slice(t.cursorPos)].join(""),cursorPos:t.cursorPos-1}}):s==="bsall"?r({myString:"",cursorPos:0}):s===`
`?r(t=>{if(t.myString.length>=f)return t;const e=Array.from(t.myString),c=e.slice(0,t.cursorPos).join(""),x=e.slice(t.cursorPos).join("");return{myString:c+`
`+x,cursorPos:t.cursorPos+1}}):(s.length===1||m(s))&&r(t=>{const e=Array.from(t.myString),c=Math.max(0,Math.min(t.cursorPos,e.length)),x=s.repeat(g).slice(0,Math.max(0,f-e.length)),E=e.slice(0,c).join(""),I=e.slice(c).join(""),M=E+x+I,k=Math.min(c+Array.from(x).length,f);return{myString:M,cursorPos:k}}))});return()=>i.unsubscribe()},[o]),l.useEffect(()=>{if(!o){a(!1);return}a(!0);const i=setInterval(()=>{a(s=>!s)},500);return()=>clearInterval(i)},[o]),l.useEffect(()=>{const i=$.subscribe(s=>{s===!1&&(u(!1),C&&r({myString:"",cursorPos:0}))});return()=>i.unsubscribe()},[]),l.useEffect(()=>{S&&o&&S(n.myString)},[n]),h.jsx("div",{style:{width:A,height:P,borderBottom:`1px solid ${p.get("border",d)}`,display:"flex",alignItems:"flex-end",justifyContent:"flex-start"},onClick:i=>{z(""),u(!0),B(!0),r(s=>({myString:s.myString,cursorPos:H(i,s.myString)}))},children:h.jsx("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflow:"hidden",fontSize:w.prefs[4]===0?"13px":"15px",display:"block",paddingLeft:"8px",textAlign:"left",paddingBottom:"2px",lineHeight:"18px",fontFamily:"Segoe UI",color:n.myString.length===0?p.get("icons",d):p.get("mainText",d)},children:n.myString.length>0||o?h.jsxs(h.Fragment,{children:[n.myString.slice(0,n.cursorPos),j&&h.jsx("span",{style:{color:p.get("iconsHighlited",d),fontSize:w.prefs[4]===0?"13px":"15px",fontWeight:"bold"},children:"|"}),n.myString.slice(n.cursorPos)]}):b})})},H=(f,b)=>{const P=w.prefs[4]===0?13:15,A=18,y=f.nativeEvent.offsetX-8,S=f.nativeEvent.offsetY,n=document.createElement("canvas").getContext("2d");n.font=`${P}px 'Segoe UI', 'Apple Color Emoji', 'Noto Color Emoji', 'Arial'`;const r=b.split(`
`),o=Math.floor(S/A),u=Math.min(o,r.length-1),j=r[u],a=Array.from(j);let g=0;for(let s=0;s<a.length;s++){const m=n.measureText(a[s]).width;if(g+=m,y<g)return r.slice(0,u).reduce((e,c)=>e+Array.from(c).length+1,0)+s}return r.slice(0,u).reduce((s,m)=>s+Array.from(m).length+1,0)+a.length};export{W as M};
