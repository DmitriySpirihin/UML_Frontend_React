import{t as U,l as k,j as t,C as a,m as o,a as B,Q as $,R as P,S as A,A as d,T as R,U as c,V as _,W as M,X as N,Y as z,Z as L,b as j}from"./index-B1g2YpKi.js";import{r as n}from"./recharts-Bg6K2Pzo.js";import{calculateStats as F}from"./UserPanel-rQNbjviz.js";import"./PaymentService-Df9LD58P.js";import"./index-DfQ4PfTt.js";import"./ScrollPicker-o4K3Rvz_.js";function X(){const[e,v]=n.useState("dark"),[m,S]=n.useState(0),[f,h]=n.useState("Guest"),[x,y]=n.useState("images/Ui/Guest.jpg"),[p,b]=n.useState(!0);return n.useEffect(()=>{async function g(){try{await $();const l=typeof window<"u"?!window.Telegram?.WebApp:!0;await P({mock:l});const u=A(),{user:r,languageCode:I,colorScheme:C,start_param:D}=u;if(r){d.isFirstStart&&(d.prefs[0]=I==="ru"?0:1,d.prefs[1]=C==="dark"?0:1,R("dark")),c.Init(r.id,r.username,r.photo_url||"images/Ui/Guest.jpg"),h(r.username),y(Array.isArray(r.photo_url)?r.photo_url[0]:r.photo_url);const s=D;if(s&&!isNaN(s)&&Number(s)!==r.id){const w=`ref_processed_${s}`;if(!localStorage.getItem(w))try{await fetch("/api/record-referral",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referrerId:Number(s),newUserId:r.id})}),localStorage.setItem(w,"1")}catch(T){console.warn("Referral submission failed:",T)}}}else c.Init(0,d.prefs[0]===0?"гость":"guest","images/Ui/Guest.jpg"),h(d.prefs[0]===0?"гость":"guest"),y("images/Ui/Guest.jpg");if(await _(),M(),N(),c.id&&c.id!==0){await z(c.id);const s=F();await NotificationsManager.sendXp(s.level.xp,s.level.current),await L()}b(!1),setTimeout(()=>j("MainMenu"),1200)}catch(l){console.error("Initialization error:",l),b(!1),setTimeout(()=>j("MainMenu"),1200)}}g()},[]),n.useEffect(()=>{const g=U.subscribe(v),l=k.subscribe(u=>S(u==="ru"?0:1));return()=>{g.unsubscribe(),l.unsubscribe()}},[]),t.jsxs("div",{style:i(e).container,children:[t.jsx("div",{style:i(e).bgOverlay}),t.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},style:i(e).content,children:[t.jsx(o.img,{src:e==="dark"?"images/Ui/Main_Dark.png":"images/Ui/Main_Light.png",style:i(e).logo,alt:"UltyMyLife",animate:{scale:[.95,1,.95]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),t.jsx("div",{style:i(e).loaderSection,children:t.jsx(B,{mode:"wait",children:p?t.jsxs(o.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},style:i(e).pulseContainer,children:[t.jsx("div",{style:i(e).ring}),t.jsx("img",{src:x,style:i(e).loadingPhoto,alt:"Loading..."})]},"loader"):t.jsxs(o.div,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15},style:i(e).photoWrapper,children:[t.jsx("img",{src:x,style:i(e).userPhoto,alt:"User"}),t.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},style:i(e).premiumBadge})]},"user")})}),t.jsxs(o.div,{animate:{opacity:[.4,1,.4]},transition:{duration:2,repeat:1/0},style:i(e).textContainer,children:[t.jsx("h2",{style:i(e).mainText,children:p?m===0?"Синхронизация...":"Synchronizing...":m===0?`Рады видеть, ${f}`:`Welcome back, ${f}`}),t.jsx("div",{style:i(e).progressBar,children:t.jsx(o.div,{initial:{width:"0%"},animate:{width:p?"70%":"100%"},style:i(e).progressFill})})]})]}),t.jsx("style",{children:`
        @keyframes custom-pulse {
          0% { transform: scale(0.95); box-shadow: 0 0 0 0 ${a.get("currentDateBorder",e)}44; }
          70% { transform: scale(1); box-shadow: 0 0 0 20px ${a.get("currentDateBorder",e)}00; }
          100% { transform: scale(0.95); box-shadow: 0 0 0 0 ${a.get("currentDateBorder",e)}00; }
        }
      `})]})}const i=e=>({container:{backgroundColor:a.get("background",e),display:"flex",flexDirection:"column",alignItems:"center",height:"100vh",width:"100vw",overflow:"hidden",position:"relative"},bgOverlay:{position:"absolute",inset:0,background:e==="dark"?"radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%)":"radial-gradient(circle at 50% 50%, #fff 0%, #f0f4f8 100%)",opacity:.6,zIndex:1},content:{zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",paddingTop:"20vh"},logo:{width:"220px",filter:`drop-shadow(0 0 20px ${a.get("shadow",e)}88)`,marginBottom:"8vh"},loaderSection:{height:"120px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"4vh"},pulseContainer:{position:"relative",width:"80px",height:"80px",display:"flex",alignItems:"center",justifyContent:"center"},ring:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",border:`2px solid ${a.get("currentDateBorder",e)}`,animation:"custom-pulse 2s infinite ease-in-out"},loadingPhoto:{width:"60px",height:"60px",borderRadius:"50%",opacity:.5,filter:"grayscale(1)"},photoWrapper:{position:"relative"},userPhoto:{border:`3px solid ${a.get("currentDateBorder",e)}`,width:"90px",height:"90px",borderRadius:"50%",objectFit:"cover",boxShadow:`0 10px 30px ${a.get("shadow",e)}`},textContainer:{display:"flex",flexDirection:"column",alignItems:"center",gap:"15px"},mainText:{fontSize:"18px",fontWeight:"600",color:a.get("mainText",e),fontFamily:"Segoe UI, Roboto, sans-serif",textAlign:"center",letterSpacing:"0.5px"},progressBar:{width:"120px",height:"4px",backgroundColor:a.get("border",e),borderRadius:"10px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:a.get("currentDateBorder",e),borderRadius:"10px"}});export{X as default};
