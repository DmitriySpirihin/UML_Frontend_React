import{r as o,G as me,t as Q,l as Z,A as g,y as Ae,z as He,j as t,C as r,B as Fe,D as w,E as de,H as ue,I as pe,J as xe,K as Re,L as ze,M as Be,a as se,O as N}from"./index-D4mo_6VC.js";import{I as _,a as he}from"./HabitsMain-CSG2-LXi.js";import{b as Ye,M as $e,a as Oe}from"./index-CmN1oOZD.js";import"./index-Dae8SzdE.js";var Y=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(Y||{}),$=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))($||{});const Ue=["mousedown","mousemove","mouseup","mouseleave","mouseout"],Ve=["touchstart","touchmove","touchend","touchcancel"],We=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function Ne(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Xe(e){var s;return Ue.includes((s=e?.nativeEvent)==null?void 0:s.type)}function ve(e){var s;return Ve.includes((s=e?.nativeEvent)==null?void 0:s.type)||"touches"in e}function Je(e){const{nativeEvent:s}=e;return s?We.includes(s?.type)||"pointerId"in s:!1}function ee(e){return Xe(e)||ve(e)||Je(e)}function fe(e){var s;const u=ve(e)?(s=e?.touches)==null?void 0:s[0]:e;return Ne(u)?{x:u.pageX,y:u.pageY}:null}function Ke(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function H(e,{threshold:s=400,captureEvent:u=!1,detect:l=Y.Pointer,cancelOnMovement:p=!1,cancelOutsideElement:C=!0,filterEvents:d,onStart:j,onMove:S,onFinish:D,onCancel:T}={}){const R=o.useRef(!1),I=o.useRef(!1),z=o.useRef(),m=o.useRef(),B=o.useRef(e),b=o.useRef(null),E=o.useCallback(a=>c=>{I.current||ee(c)&&(d!==void 0&&!d(c)||(u&&c.persist(),j?.(c,{context:a}),b.current=fe(c),I.current=!0,z.current=c.currentTarget,m.current=setTimeout(()=>{B.current&&(B.current(c,{context:a}),R.current=!0)},s)))},[u,d,j,s]),f=o.useCallback(a=>(c,y)=>{ee(c)&&I.current&&(b.current=null,u&&c.persist(),R.current?D?.(c,{context:a}):I.current&&T?.(c,{context:a,reason:y??$.CancelledByRelease}),R.current=!1,I.current=!1,m.current!==void 0&&clearTimeout(m.current))},[u,D,T]),L=o.useCallback(a=>c=>{if(ee(c)&&(S?.(c,{context:a}),p!==!1&&b.current)){const y=fe(c);if(y){const v=p===!0?25:p,M={x:Math.abs(y.x-b.current.x),y:Math.abs(y.y-b.current.y)};(M.x>v||M.y>v)&&f(a)(c,$.CancelledByMovement)}}},[f,p,S]),O=o.useCallback(a=>{if(e===null)return{};switch(l){case Y.Mouse:{const c={onMouseDown:E(a),onMouseMove:L(a),onMouseUp:f(a)};return C&&(c.onMouseLeave=y=>{f(a)(y,$.CancelledOutsideElement)}),c}case Y.Touch:return{onTouchStart:E(a),onTouchMove:L(a),onTouchEnd:f(a)};case Y.Pointer:{const c={onPointerDown:E(a),onPointerMove:L(a),onPointerUp:f(a)};return C&&(c.onPointerLeave=y=>f(a)(y,$.CancelledOutsideElement)),c}}},[e,f,C,l,L,E]);return o.useEffect(()=>{function a(c){const y=Ke(c);f()(y)}return window.addEventListener("mouseup",a),window.addEventListener("touchend",a),window.addEventListener("pointerup",a),()=>{window.removeEventListener("mouseup",a),window.removeEventListener("touchend",a),window.removeEventListener("pointerup",a)}},[f]),o.useEffect(()=>()=>{m.current!==void 0&&clearTimeout(m.current)},[]),o.useEffect(()=>{B.current=e},[e]),O}function te(e){return me({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function ne(e){return me({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}const x=new Audio("Audio/Click.wav"),F=()=>se.concat((g.CustomHabits||[]).filter(e=>!se.some(s=>s.id===e.id))),ge=new Date,st=()=>{const[e,s]=o.useState(Q.value),[u,l]=o.useState(Z.value),[p,C]=o.useState(!1),[d,j]=o.useState(g.prefs[0]),[S,D]=o.useState(!1),[T,R]=o.useState(""),[I,z]=o.useState(!1),[m,B]=o.useState(""),[b,E]=o.useState(""),[f,L]=o.useState(""),[O,a]=o.useState("default"),[c,y]=o.useState(-1),[v,M]=o.useState(new Date().getFullYear()),[k,X]=o.useState(new Date().getMonth()),[J,K]=o.useState(new Date().getDate()),[ie,re]=o.useState(F()),[Ce,ae]=o.useState(null),[U,le]=o.useState(!1),[we,ce]=o.useState(0),[je,Se]=o.useState("default"),[V,A]=o.useState(!1),[Ie,G]=o.useState({text:d===0?"Добавить":"Add",onClick:()=>oe(!1)}),ke=H(()=>handleDateChange(!1,0),{threshold:1e3}),Pe=H(()=>handleDateChange(!0,0),{threshold:1e3}),De=H(()=>handleDateChange(!1,1),{threshold:700}),Te=H(()=>handleDateChange(!0,1),{threshold:700}),Ee=H(()=>handleDateChange(!1,2),{threshold:500}),Le=H(()=>handleDateChange(!0,2),{threshold:500}),Me=[["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]];o.useEffect(()=>{const i=Q.subscribe(s),P=Z.subscribe(l),q=Ae.subscribe(C);return()=>{i.unsubscribe(),P.unsubscribe(),q.unsubscribe()}},[]),o.useEffect(()=>{const i=Q.subscribe(s),P=Z.subscribe(q=>{j(q==="ru"?0:1)});return()=>{i.unsubscribe(),P.unsubscribe()}},[]),o.useEffect(()=>{re(F())},[]),o.useEffect(()=>{const i=He.subscribe(R);return T==="AddHabitPanel"?setTimeout(()=>ce(1),400):ce(0),()=>{i.unsubscribe()}},[]);const W=(i,P)=>{i.length>0&&(P===0?B(i[0].toUpperCase()+i.toLowerCase().slice(1)):P===1?E(i[0].toUpperCase()+i.toLowerCase().slice(1)):P===2&&L(i[0].toUpperCase()+i.toLowerCase().slice(1)))};return o.useEffect(()=>{m.length>3&&b.length>3?(A(!0),G({text:d===0?"создать и добавить":"create and add",onClick:()=>be(m,b,f,O)})):A(!1)},[m,b,f,O,d]),t.jsxs("div",{style:{...n(e).container,transform:T==="AddHabitPanel"?"translateX(0)":"translateX(-100%)",backgroundColor:we===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:[!S&&t.jsxs("div",{style:n(e,p).panel,children:[t.jsx("div",{style:n(e).headerText,children:d===0?"добавь привычку":"add habit"}),t.jsxs("div",{style:{...n(e).simplePanel,height:p?"66vh":"52vh"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(Fe,{style:{color:r.get("mainText",e),width:"5vw",marginTop:"10px",marginLeft:"10px"}}),t.jsx("input",{type:"text",onFocus:()=>w(!0),onBlur:()=>w(!1),style:{...n(e).input,height:p?"50%":"40%"},onChange:i=>qe(i.target.value,ie,re)})]}),t.jsx("div",{style:n(e).scrollView,children:ie.map(i=>!g.choosenHabits.includes(i.id)&&t.jsx("li",{style:{...n(e).text,borderRadius:"24px",backgroundColor:i.id===Ce?r.get("highlitedPanel",e):"transparent"},onClick:()=>{ae(i.id),y(i.id),A(!0),h(x),G({text:d===0?"Добавить":"Add",onClick:()=>oe(i.id,i.name[d],!1)})},children:t.jsx("p",{style:n(e).text,children:i.name[d]})},i.id))})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{ue(""),pe(0),h(x)},children:t.jsx(de,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!0),A(!1)},children:t.jsx(Ye,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{V&&(z(!0),h(x))},children:t.jsx(xe,{style:{...n(e).miniIcon,color:V?r.get("icons",e):r.get("iconsDisabled",e)}})})]})]}),S&&t.jsxs("div",{style:n(e,p).panel,children:[t.jsx("div",{style:n(e).headerText,children:d===0?"или создай свою":"or create your own"}),t.jsxs("div",{style:{...n(e).simplePanel,height:p?"66vh":"52vh",justifyContent:"center"},children:[t.jsx("textarea",{maxLength:25,placeholder:d===0?"имя":"name",style:n(e).input,onChange:i=>W(i.target.value,0),onFocus:()=>w(!0),onBlur:()=>w(!1)}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("textarea",{maxLength:25,placeholder:b===""?d===0?"категория":"category":b,style:{...n(e).input,width:"48%"},onChange:i=>W(i.target.value,1),onFocus:()=>w(!0),onBlur:()=>w(!1)}),t.jsx("select",{style:{...n(e).input,width:"48%"},onChange:i=>W(i.target.value,1),children:Ge(e,d)})]}),t.jsx("textarea",{maxLength:60,placeholder:d===0?"описание(опционально)":"description(optional)",style:{...n(e).input,height:p?"40%":"25%"},onChange:i=>W(i.target.value,2),onFocus:()=>w(!0),onBlur:()=>w(!1)}),t.jsx("div",{style:n(e).headerText,children:d===0?"выбери иконку(опционально)":"choose icon(optional)"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("div",{style:{width:"80%",marginLeft:"30px",padding:"5px"},children:t.jsxs("div",{style:n(e).button,onClick:()=>le(!U),children:[!U&&t.jsx(Re,{style:n(e).miniIcon}),U&&t.jsx(ze,{style:n(e).miniIcon})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"20%",height:"100%",padding:"8px"},children:_.getIcon(je,{size:48,style:{marginRight:"70px",color:r.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{ue(""),pe(0),h(x)},children:t.jsx(de,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!1),A(!1),ae(null)},children:t.jsx(Be,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{V&&(z(!0),h(x))},children:t.jsx(xe,{style:{...n(e).miniIcon,color:V?r.get("icons",e):r.get("iconsDisabled",e)}})})]})]}),U&&t.jsx("div",{style:n(e).selectPanel,children:Object.entries(_.ic).map(([i])=>t.jsx("div",{style:{width:"15%",padding:"12px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",":hover":{backgroundColor:r.get("highlitedPanel",e)}},onClick:()=>{Se(i),a(i),h(x),le(!1),m.length>3&&b.length>3&&(A(!0),G({text:d===0?"создать и добавить":"create and add",onClick:()=>{be(m,b,f,i),h(x)}}))},children:_.getIcon(i,{size:32,style:{color:r.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})},i))}),I&&t.jsx("div",{style:n(e).container,children:t.jsxs("div",{style:n(e).confirmationPanel,children:[t.jsx("p",{style:n(e).text,children:Qe(d,S,c,m)}),t.jsxs("div",{style:{...n(e).simplePanelRow,flexDirection:"column",alignItems:"center",backgroundColor:r.get("background",e),width:"90%",borderRadius:"24px"},children:[t.jsx("p",{style:n(e).text,children:d===0?"установите дату":"set date"}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ke,onClick:()=>{ge.getFullYear()-2<=v-1&&M(v-1),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{})}),t.jsxs("p",{style:n(e).textDate,children:[" ",v," "]}),t.jsx("div",{...Pe,onClick:()=>{ge.getFullYear()+2>=v+1&&M(v+1),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...De,onClick:()=>{X(k-1>0?k-1:12),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{})}),t.jsxs("p",{style:n(e).textDate,children:[" ",Me[d][k-1]," "]}),t.jsx("div",{...Te,onClick:()=>{X(k+1<12?k+1:1),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Ee,onClick:()=>{K(ye(!1,J,v,k)),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{})}),t.jsxs("p",{style:n(e).textDate,children:[" ",J," "]}),t.jsx("div",{...Le,onClick:()=>{K(ye(!0,J,v,k)),h(x)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{})})]})]}),t.jsxs("div",{style:n(e).simplePanelRow,children:[t.jsx("div",{style:n(e).button,onClick:()=>{z(!1),Ze(K,X,M),h(x)},children:t.jsx($e,{style:n(e).miniIcon})}),t.jsx("div",{style:n(e).button,onClick:()=>{Ie.onClick(),h(x)},children:t.jsx(Oe,{style:n(e).miniIcon})})]})]})})]})},Ge=(e,s)=>Array.from(new Set(se.map(l=>l.category[s]))).map(l=>t.jsx("option",{value:l,style:{...n(e).text},children:l},l)),oe=(e,s,u)=>{if(typeof he!="function"){console.warn("AddHabitPanel: addHabitFn is not set yet. Ensure HabitsMain is mounted."),N(g.prefs[0]===0?"экран привычек ещё не готов":"habits screen not ready yet",2e3,!1);return}if(g.IsHabitInChoosenList(e)){N(g.prefs[0]===0?"привычка уже в списке":"habit already in list",2500,!1);return}he(e);const l=u?g.prefs[0]===0?`привычка: ${s} создана и добавлена`:`habit: ${s} was created and added`:g.prefs[0]===0?"привычка добавлена":"habit added";N(l,2500,!0)},be=(e,s,u,l)=>{const p=F(),d=(p.length>0?Math.max(...p.map(j=>j.id)):0)+1;g.IsCustomHabitExists(d)?N(g.prefs[0]===0?"привычка с таким названием уже существует":"habit with this name already exists",2500,!1):(g.AddCustomHabit(e,s,u,l,d),setTimeout(()=>{oe(d,e,!0)},100))},qe=(e,s,u)=>{if(e.length>0){const l=F().filter(p=>p.name[g.prefs[0]].toLowerCase().startsWith(e.toLowerCase()));u(l)}else{const l=F();s.length!=l.length&&u(l)}},n=(e,s)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9900,padding:"20px"},panel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",overflow:"hidden",boxSizing:"border-box",overflowY:"scroll",border:`1px solid ${r.get("border",e)}`,margin:"5px",backgroundColor:r.get("simplePanel",e),boxShadow:`4px 4px 6px ${r.get("shadow",e)}`,width:"85vw",height:s?"85vh":"65vh"},confirmationPanel:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${r.get("border",e)}`,margin:"5px",backgroundColor:r.get("simplePanel",e),boxShadow:`4px 4px 6px ${r.get("shadow",e)}`,width:"85vw",height:"80vw"},text:{textAlign:"center",fontSize:"12px",color:r.get("mainText",e),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:r.get("mainText",e),marginBottom:"4px"},headerText:{textAlign:"center",margin:"5px",padding:"5px",fontSize:"14px",color:r.get("subText",e)},scrollView:{overflowY:"auto",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"},simplePanel:{marginLeft:"7.5vw",width:"70vw",height:"30vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch",background:"rgba(0, 0, 0, 0.1)",borderRadius:"24px"},input:{width:"65vw",height:s?"6vh":"3vh",borderRadius:"12px",border:`1px solid ${r.get("border",e)}`,margin:"12px",fontSize:"14px",fontFamily:"Segoe UI",color:r.get("subText",e),backgroundColor:r.get("inputField",e)},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around"},select:{width:"20vw",height:"6vw",borderRadius:"12px",border:`1px solid ${r.get("border",e)}`,marginTop:"12px",fontSize:"14px",color:r.get("subText",e),backgroundColor:r.get("habitCard",e)},selectOption:{color:r.get("subText",e),backgroundColor:r.get("habitCard",e),fontSize:"8px"},selectPanel:{backgroundColor:r.get("habitCard",e),borderRadius:"24px",border:`1px solid ${r.get("border",e)}`,position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexWrap:"wrap",width:"77vw",maxHeight:"42vh",overflowY:"auto",padding:"16px",gap:"8px",justifyContent:"center",zIndex:1e3},selectIcon:{flex:"{0,0,33.33%}",width:"20vw",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignContent:"center",justifyContent:"center",width:"15vw",marginTop:"12px",fontSize:"12px"},miniIcon:{userSelect:"none",touchAction:"none",fontSize:"28px",padding:"5px",marginTop:"10px",color:r.get("icons",e),filter:`drop-shadow(0 0px 1px ${r.get("iconsShadow",e)})`}});function h(e){g.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),g.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Qe(e,s,u,l){if(s)return e===0?"добавить привычку "+l+"?":"add habit "+l+"?";{const p=F().find(C=>C.id===u).name[e];return e===0?"добавить привычку "+p+"?":"add habit "+p+"?"}}function ye(e,s,u,l){const p=new Date(u,l,0).getDate();return e?s+1<=p?s+1:1:s-1>0?s-1:p}function Ze(e,s,u){const l=new Date;e(l.getDate()),s(l.getMonth()),u(l.getFullYear())}export{st as default};
