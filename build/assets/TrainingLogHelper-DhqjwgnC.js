import{A as i,aT as T}from"./index-CwFx44xd.js";function x(s){return new Date(s).toISOString().split("T")[0]}function O(s,o,n,e){if(!e||typeof s!="string"||typeof o!="number")return null;const t=n.getTime();let r=null,a=-1/0;for(const[d,l]of Object.entries(e)){const c=new Date(d).getTime();if(!(c>=t))for(const u of l){if(!u.completed)continue;const f=u.exercises?.[s];if(!f||!Array.isArray(f.sets))continue;const m=f.sets[o];!m||typeof m.reps!="number"||typeof m.weight!="number"||c>a&&(a=c,r={type:m.type,reps:m.reps,weight:m.weight,time:m.time})}}return r}async function b(s,o,n){const e=i.programs[o];if(!e||!e.schedule[n])return console.error("Invalid program or dayIndex"),!1;const t={},r=[];e.schedule[n].exercises.forEach(l=>{const g=i.exercises[l.exId];if(!g){console.warn(`Exercise ${l.exId} not found in AppData.exercises`);return}t[l.exId]={mgId:g.mgId,sets:[],totalTonnage:0,completed:!1},r.push(l.exId)});const a=x(s),d={programId:o,dayIndex:n,completed:!1,startTime:Date.now(),endTime:null,duration:0,tonnage:0,exercises:t,exerciseOrder:r};i.trainingLog[a]||(i.trainingLog[a]=[]),i.trainingLog[a].push(d),await T()}async function E(s,o,n,e,t){const r=new Date(s.getFullYear(),s.getMonth(),s.getDate()),a=r.getTime()+e,d=r.getTime()+t,l=d-a,g={},c=[],u=i.programs[o];if(!u||!u.schedule[n]){console.error("Invalid program or dayIndex in addPreviousSession");return}u.schedule[n].exercises.forEach(p=>{const y=i.exercises[p.exId];if(!y){console.warn(`Exercise ${p.exId} not found in AppData.exercises`);return}g[p.exId]={mgId:y.mgId,sets:[],totalTonnage:0,completed:!1},c.push(p.exId)});const f={programId:o,dayIndex:n,completed:!0,startTime:a,endTime:d,duration:l,tonnage:0,exercises:g,exerciseOrder:c},m=x(s);i.trainingLog[m]||(i.trainingLog[m]=[]),i.trainingLog[m].push(f);for(const p in f.exercises){const y=f.exercises[p];let h=i.exercises[p]?.rm||0;for(const D of y.sets){const w=S(D.reps,D.weight);w>h&&(h=w)}h>(i.exercises[p]?.rm||0)&&(i.exercises[p].rm=h,i.exercises[p].rmDate=x(new Date))}await T()}async function K(s,o){const n=x(s),e=i.trainingLog[n];if(!e||o<0||o>=e.length)return!1;e.splice(o,1),e.length===0&&delete i.trainingLog[n],await T()}function v(s,o){const n=x(s),e=i.trainingLog[n]?.[o];if(!e||e.completed)return[];e.endTime=Date.now(),e.duration=e.endTime-e.startTime,e.completed=!0,Object.values(e.exercises).forEach(r=>{r.completed=!0}),e.tonnage=Object.values(e.exercises).reduce((r,a)=>r+(a.totalTonnage||0),0);const t=[];return e.exerciseOrder.forEach(r=>{const a=e.exercises[r],d=Number(r),l=i.exercises[d];if(!a||!l||!a.sets?.length)return;const g=a.sets.reduce((f,m)=>m.weight>f.weight?m:f,{weight:0,reps:1}),c=S(g.reps,g.weight);if(isNaN(c)||c<=0)return;const u=l.rm;if(c>u){l.rm=c,l.rmDate=n;const f=c-u;t.push({exId:d,newRm:c,oldRm:u,improvement:f})}}),t}function A(s,o,n){const e=x(s),t=i.trainingLog[e]?.[o];return!t||t.exercises[n]?!1:(t.exercises[n]={mgId:i.exercises[n]?.mgId||0,sets:[],totalTonnage:0,completed:!1},t.exerciseOrder.push(n),!0)}function M(s,o,n){const e=x(s),t=i.trainingLog[e]?.[o];if(!t||!t.exercises[n])return!1;const r=t.exercises[n];return t.tonnage=Math.max(0,t.tonnage-(r.totalTonnage||0)),delete t.exercises[n],t.exerciseOrder&&(t.exerciseOrder=t.exerciseOrder.filter(a=>a!==n)),!0}function R(s,o,n,e,t,r,a){const d=x(s),l=i.trainingLog[d]?.[o],g=l?.exercises?.[n];if(!g)return!1;const u={type:a?0:1,reps:e,weight:t,time:r};g.sets.push(u);const f=e*t;return g.totalTonnage=(g.totalTonnage||0)+f,l.tonnage=(l.tonnage||0)+f,!0}function j(s,o,n,e,t,r,a,d){const l=x(s),g=i.trainingLog[l]?.[o],c=g?.exercises?.[n];if(!c||e<0||e>=c.sets.length)return!1;const u=c.sets[e],f=d?0:1;if(u.reps===t&&u.weight===r&&a===u.time&&u.type===f)return!0;const m=u.reps*u.weight;c.totalTonnage=Math.max(0,(c.totalTonnage||0)-m),g.tonnage=Math.max(0,(g.tonnage||0)-m),u.reps=t,u.weight=r,u.type=f;const p=t*r;return c.totalTonnage=(c.totalTonnage||0)+p,g.tonnage=(g.tonnage||0)+p,!0}function I(s,o,n){const e=x(s),r=i.trainingLog[e]?.[o]?.exercises?.[n];return r?(r.completed=!0,!0):!1}function N(s,o){const n=x(s);return i.trainingLog[n]?.[o]?.tonnage||0}function k(s,o){const n=x(s),e=i.trainingLog[n]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))for(const a of r.sets)t+=a.reps;return t}function P(s,o){const n=x(s),e=i.trainingLog[n]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))t+=r.sets.length;return t}function S(s,o){if(!s||!o||s<1||o<=0)return 0;if(s===1)return o;const n=o*(36/(37-s)),e=o*(1+.0333*s),t=o*Math.pow(s,.1),r=n+e+t;return Math.round(r/3)}const F=()=>{try{const s=i?.trainingLog||{},o=new Date;let n=0;const e=[];for(let t=0;t<7;t++){const r=new Date(o);r.setDate(o.getDate()-t);const a=r.toISOString().split("T")[0];e.push(a)}for(const t of e){const r=s[t];if(Array.isArray(r)){const a=r.filter(d=>d.completed===!0).length;n+=a}}return Math.min(n,7)}catch(s){return console.warn("Error calculating weekly training amount:",s),0}};export{b as a,E as b,I as c,K as d,R as e,O as f,P as g,N as h,k as i,v as j,M as k,A as l,F as m,j as r};
