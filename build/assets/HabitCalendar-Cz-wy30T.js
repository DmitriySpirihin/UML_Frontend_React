import{i as L,r as y,j as t,K as re,N as se}from"./react-core-DTJfGpvQ.js";import{A as c,t as ae,f as le,l as ce,C as s,s as Z,a as _,b as ee,e as de}from"./index-DSJZFJxf.js";import{I as te}from"./Icons-BSlNG5d7.js";import{aW as fe,aX as ge}from"./vendor-RoreSCww.js";import{m as B,A as ne,u as xe,a as pe,b as oe}from"./framer-motion-QoxkE90y.js";import"./ton-sdk-DGogAMH-.js";const N=e=>{const n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${n}-${o}-${u}`},ue=e=>(e.getDay()+6)%7,E=new Audio("Audio/Click.wav"),he=new Audio("Audio/IsDone.wav"),ye=new Audio("Audio/Skip.wav");function be(){return ee.concat((c.CustomHabits||[]).filter(e=>!ee.some(n=>n.id===e.id)))}const l=(e,n)=>({container:{backgroundColor:s.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"88vh",marginTop:"100px",width:"100vw",fontFamily:"Segoe UI, Roboto, Helvetica, sans-serif",overflow:"hidden",paddingTop:"10px"},panel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"500px",height:"100%",alignItems:"center",justifyContent:"start",backgroundColor:s.get("background",e),position:"relative",overflow:"hidden"},calendarHead:{padding:"15px 20px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:"20px",width:"100%",boxSizing:"border-box",backgroundColor:s.get("background",e),zIndex:2},headerWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minWidth:"150px"},header:{fontFamily:"Segoe UI",fontSize:"20px",margin:0,fontWeight:"700",color:s.get("mainText",e),textTransform:"capitalize",whiteSpace:"nowrap"},navBtn:{padding:"8px",borderRadius:"12px",cursor:"pointer",backgroundColor:e==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",zIndex:10},tableWrapper:{width:"100%",padding:"15px 0px 15px 0px",boxSizing:"border-box",overflow:"hidden"},table:{width:"90%",borderCollapse:"collapse",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"12vw",height:"13vw",maxHeight:"50px",maxWidth:"50px",borderRadius:"14px",fontSize:"16px",fontWeight:"600",fontFamily:"Segoe UI",transition:"all 0.2s ease-in-out",cursor:"pointer",margin:"auto"},infoPanelContainer:{flex:1,width:"100%",borderTop:`1px solid ${e==="light"?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)"}`,padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column",backgroundColor:s.get("background",e)},infoHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},text:{fontFamily:"Segoe UI",fontSize:"17px",color:s.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"14px",color:s.get("subText",e)},scrollView:{flex:1,overflowY:"auto",width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",paddingBottom:"20px"},icon:{width:"22px",height:"22px"}}),me=(e,n)=>{if(e<25)return n==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)";if(e>=100)return n==="light"?"rgba(50, 215, 80, 0.64)":"rgba(36, 151, 57, 0.4)";const o=45,i=110-o,f=(e-25)/75;return`hsla(${o+f*i}, 90%, 40%, 0.3)`},Se=(e,n)=>s.get("mainText",n),we={enter:e=>({x:e>0?50:-50,opacity:0,scale:.95}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:e=>({zIndex:0,x:e<0?50:-50,opacity:0,scale:.95})},je={enter:e=>({y:e>0?-20:20,opacity:0}),center:{y:0,opacity:1},exit:e=>({y:e>0?20:-20,opacity:0})},Me=()=>{const[e,n]=L.useState("dark"),[o,u]=y.useState(c.prefs[0]),[i,f]=y.useState(new Date),[v,I]=y.useState(0),[d,h]=y.useState(i),[C,T]=y.useState(!1),a=new Date().getDate(),O=new Date().getMonth(),[m,k]=y.useState(0);L.useEffect(()=>{const r=ae.subscribe(n),p=le.subscribe(I);return()=>{r.unsubscribe(),p.unsubscribe()}},[]),L.useEffect(()=>{const r=ce.subscribe(p=>{u(p==="ru"?0:1)});return()=>r.unsubscribe()},[]);const z=new Date(i.getFullYear(),i.getMonth(),1),Y=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),H=(z.getDay()+6)%7,P=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],K=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],b=[],D=[];for(let r=0;r<H;r++)b.push(null);for(let r=1;r<=Y;r++)b.push(r);for(let r=0;r<b.length;r+=7)D.push(b.slice(r,r+7));const M=()=>{k(-1),f(new Date(i.getFullYear(),i.getMonth()-1)),j(E)},A=()=>{k(1),f(new Date(i.getFullYear(),i.getMonth()+1)),j(E)},S=[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]],W=r=>{j(E),Z&&Z(r),_&&_(0)};return t.jsx("div",{style:l(e).container,children:t.jsxs("div",{style:l(e).panel,children:[t.jsxs("div",{style:l(e).calendarHead,children:[t.jsx(B.div,{whileTap:{scale:.9},onClick:M,style:l(e).navBtn,children:t.jsx(re,{size:22,color:s.get("mainText",e)})}),t.jsx("div",{style:l(e).headerWrapper,children:t.jsx(ne,{mode:"popLayout",custom:m,children:t.jsxs(B.h1,{variants:je,custom:m,initial:"enter",animate:"center",exit:"exit",transition:{duration:.25},style:l(e).header,children:[S[o][i.getMonth()]," ",i.getFullYear()]},i.toISOString())})}),t.jsx(B.div,{whileTap:{scale:.9},onClick:A,style:l(e).navBtn,children:t.jsx(se,{size:22,color:s.get("mainText",e)})})]}),t.jsx("div",{style:l(e).tableWrapper,children:t.jsx(ne,{mode:"wait",custom:m,children:t.jsx(B.div,{variants:we,custom:m,initial:"enter",animate:"center",exit:"exit",transition:{type:"tween",ease:"easeInOut",duration:.25},style:{width:"100%"},children:t.jsxs("table",{style:l(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:P[o].map((r,p)=>t.jsx("th",{style:{paddingBottom:"15px"},children:t.jsx("p",{style:{textAlign:"center",fontSize:v===0?"13px":"14px",fontWeight:"600",color:p===5||p===6?"#ff5e5e":s.get("subText",e),margin:0,opacity:.8},children:r})},r))})}),t.jsx("tbody",{children:D.map((r,p)=>t.jsx("tr",{children:r.map((g,x)=>{const w=i.getMonth(),$=i.getFullYear(),U=g===d.getDate()&&w===d.getMonth()&&$===d.getFullYear(),G=N(new Date($,w,g));let V="",F=0;if(Object.keys(c.habitsByDate).includes(G)){const q=Array.from(Object.values(c.habitsByDate[G])),Q=q.length;F=Q>0?Math.round(q.filter(ie=>ie>0).length/Q*100):0,V=F+"%"}let X="transparent",J=s.get("mainText",e);return U?(X=s.get("currentDateBorder",e),J="#ffffff"):g>0&&F>0&&(X=me(F,e),J=Se(F,e)),t.jsx("td",{style:{padding:"4px"},children:g?t.jsxs("div",{style:{...l(e).cell,backgroundColor:X,color:J,border:a===g&&O===w?`2px solid ${s.get("currentDateBorder",e)}`:"transparent",boxShadow:U?`0 4px 12px ${s.get("shadow",e)}`:"none"},onClick:()=>{h(new Date($,w,g)),T(c.hasKey(N(new Date($,w,g)))),j(E)},children:[g,g>0&&V&&!U&&t.jsx("div",{style:{fontSize:"9px",marginTop:"2px",opacity:.9,fontWeight:"bold"},children:V})]}):t.jsx("div",{style:{...l(e).cell,pointerEvents:"none"}})},x)})},p))})]})},i.toISOString())})}),t.jsx("div",{style:l(e).infoPanelContainer,children:C?t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:l(e).infoHeader,children:t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:0},children:[d.getDate()," ",S[o][d.getMonth()],", ",K[o][ue(d)]]})}),t.jsx("div",{style:l(e).scrollView,children:t.jsx(ve,{theme:e,langIndex:o,date:d,fSize:v,onHabitClick:W})})]}):t.jsxs("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:.6,flexDirection:"column"},children:[t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:"0 0 10px 0"},children:[d.getDate()," ",S[o][d.getMonth()]]}),t.jsx("p",{style:{color:s.get("subText",e),margin:0,fontSize:"14px"},children:o===0?"Нет привычек на этот день":"No habits for this day"})]})})]})})},ve=({theme:e,langIndex:n,date:o,fSize:u,onHabitClick:i})=>{const f=N(o);return c.hasKey(f)?Object.entries(c.habitsByDate[f]).map(([I,d])=>{const h=Number(I),C=be().find(T=>T.id===h);return C?t.jsx(Ce,{id:h,habitData:C,theme:e,date:o,statusInit:d,langIndex:n,fSize:u,onHabitClick:i},`${f}-${I}`):null}):null},Ce=({id:e,habitData:n,theme:o,date:u,statusInit:i,langIndex:f,fSize:v,onHabitClick:I})=>{const d=n.name[f];let h="";n.category?Array.isArray(n.category)?h=n.category[f]:h=n.category:h=f===0?"Общее":"General";const C=()=>n.isCustom&&n.iconName?te.getIcon(n.iconName,{size:24,style:{color:"inherit"}}):te.getHabitIcon(n.name?n.name[0]:"default",{size:24,style:{color:"inherit"}}),T=c.choosenHabitsTypes[c.choosenHabits.indexOf(e)],[a,O]=y.useState(i),[m,k]=y.useState(a<2&&!T),z=70,R=-70,Y=xe(0),H=pe(Y,[-1,1],[R,z]);y.useEffect(()=>{O(i)},[i,u]);const P=(r,p)=>{const g=p.offset.x;if(Math.abs(g)>z){if(!m)return;let x=a;if(g>0?a===0?x=1:a===-1&&(x=0):a===0?x=-1:a===1&&(x=0),x!==a){const w=N(u);c.changeStatus(w,e,x),O(x),de(),x===1?c.prefs[2]==0&&j(he):x===-1&&c.prefs[2]==0&&j(ye),j(null)}k(!1),oe(H,0,{type:"tween",duration:.2})}},K=()=>{oe(H,0,{type:"tween",duration:.2}),k(!0)};let b=o==="light"?s.get("background",o):"rgba(255,255,255,0.05)",D=o==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",M=s.get("mainText",o),A=s.get("subText",o),S="rgba(255,255,255,0.1)",W=s.get("habitIcon",o);return a===1?(b="rgba(20, 60, 30, 0.85)",D="rgba(46, 151, 65, 0.0)",M="#ffffff",A="rgba(255,255,255,0.7)",S="#4ade80",W="#ffffff"):a===-1&&(b="rgba(60, 20, 20, 0.85)",D="rgba(151, 57, 57, 0.0)",M="#ffffff",A="rgba(255,255,255,0.7)",S="#f87171",W="#ffffff"),t.jsx("div",{style:{width:"100%",marginBottom:"12px",overflow:"hidden",borderRadius:"18px"},children:t.jsxs(B.div,{id:`cal-${e}`,style:{backgroundColor:b,border:`1px solid ${D}`,display:"flex",flexDirection:"row",width:"100%",padding:"16px 20px",alignItems:"center",borderRadius:"18px",boxSizing:"border-box",x:H,cursor:"pointer",position:"relative"},drag:m?"x":!1,dragConstraints:{left:R,right:a===1?0:z},dragElastic:.1,onDrag:P,onDragEnd:K,children:[t.jsx("div",{style:{fontSize:"24px",marginRight:"15px",width:"30px",textAlign:"center",color:W,display:"flex",alignItems:"center",justifyContent:"center"},children:C()}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{fontFamily:"Segoe UI",color:A,fontSize:"11px",marginBottom:"4px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.8px",pointerEvents:"none"},children:h}),t.jsx("p",{style:{fontFamily:"Segoe UI",color:M,margin:0,fontWeight:"600",fontSize:v===0?"16px":"18px",pointerEvents:"none"},children:d})]}),t.jsxs("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:a!==0?S:"transparent",border:a===0?`2px solid ${s.get("subText",o)}`:"none",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"10px"},children:[a===1&&t.jsx(fe,{style:{color:"#fff",fontSize:"18px"}}),a===-1&&t.jsx(ge,{style:{color:"#fff",fontSize:"18px"}})]})]})})};function j(e){c.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),c.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{Me as default};
