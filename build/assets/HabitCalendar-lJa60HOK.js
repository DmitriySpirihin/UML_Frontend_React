import{c as V,j as t,R as O,r as x,A as r,t as X,l as G,C as o,a as W,m as q,e as J}from"./index-B1c8uhiT.js";import{C as Q}from"./Check-3Nfqm0Wl.js";import{u as Z,a as _,b as B}from"./index-CBABgV-K.js";const ee=V(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),D=e=>{const l=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${l}-${i}-${c}`},te=e=>(e.getDay()+6)%7;D(new Date);const $=new Audio("Audio/Click.wav"),ne=new Audio("Audio/IsDone.wav"),se=new Audio("Audio/Skip.wav");function ae(){return W.concat((r.CustomHabits||[]).filter(e=>!W.some(l=>l.id===e.id)))}const ue=()=>{const[e,l]=O.useState("dark"),[i,c]=x.useState(r.prefs[0]),[n,b]=x.useState(new Date),[a,g]=x.useState(n),[f,y]=x.useState(!1);O.useEffect(()=>{const s=X.subscribe(l);return()=>s.unsubscribe()},[]),O.useEffect(()=>{const s=G.subscribe(H=>{c(H==="ru"?0:1)});return()=>s.unsubscribe()},[]);const h=new Date(n.getFullYear(),n.getMonth(),1),T=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),w=(h.getDay()+6)%7,F=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],I=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],j=[],S=[];for(let s=0;s<w;s++)j.push(null);for(let s=1;s<=T;s++)j.push(s);for(let s=0;s<j.length;s+=7)S.push(j.slice(s,s+7));const v=()=>{b(new Date(n.getFullYear(),n.getMonth()-1)),m($)},u=()=>{b(new Date(n.getFullYear(),n.getMonth()+1)),m($)};return t.jsx("div",{style:d(e).container,children:t.jsxs("div",{style:d(e).panel,children:[t.jsxs("div",{style:d(e).calendarHead,children:[t.jsx("h1",{style:d(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:v,children:t.jsx("h1",{style:d(e).header,children:"<"})}),t.jsx("div",{onClick:u,children:t.jsx("h1",{style:d(e).header,children:">"})})]}),t.jsxs("table",{style:d(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:F[i].map(s=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:s==="Вс"||s==="Sun"?"#873535ff":o.get("subText",e)},children:s})},s))})}),t.jsx("tbody",{children:S.map((s,H)=>t.jsx("tr",{children:s.map((p,L)=>{const C=n.getMonth(),k=n.getFullYear(),U=p===a.getDate()&&C===a.getMonth()&&k===a.getFullYear(),z=D(new Date(k,C,p));let R="",A=0;if(Object.keys(r.habitsByDate).includes(z)){const Y=Array.from(Object.values(r.habitsByDate[z])),E=Y.length,N=Y.filter(P=>P===1).length,K=E>0?Math.round(N/E*100):0;R=K+"%",A=K>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...d(e).cell,border:`3px solid ${U?o.get("currentDateBorder",e):o.get("background",e)}`,backgroundColor:p<1?o.get("background",e):A===1?o.get("habitCardDone",e):A===-1?o.get("habitCardSkipped",e):o.get("background",e)},onClick:()=>{g(new Date(k,C,p)),y(r.hasKey(D(new Date(k,C,p)))),m($)},children:[p,p>0&&t.jsx("div",{style:{fontSize:"8px",color:o.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:R})]})},L)})},H))})]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:f&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${o.get("border",e)}`},children:[t.jsx("h1",{style:{...d(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+" "+I[i][te(a)]}),t.jsx("div",{style:{fontSize:"10px",color:o.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:re(a,i)})]}),t.jsx("div",{style:d(e).scrollView,children:t.jsx(oe,{theme:e,langIndex:i,date:a})})]})})]})})},oe=({theme:e,langIndex:l,date:i})=>{const c=D(i);return r.hasKey(c)?Object.entries(r.habitsByDate[c]).map(([b,a])=>{const g=Number(b),f=ae().find(h=>h.id===g),y=f?f.name[l]:"";return t.jsx(ie,{id:g,name:y,theme:e,date:i,statusInit:a,langIndex:l},`${c}-${b}`)}):null},ie=({id:e,name:l,theme:i,date:c,statusInit:n,langIndex:b})=>{const[a,g]=x.useState(n),[f,y]=x.useState(!0),h=100,M=-100,T=Z(0),w=_(T,[-1,1],[M,h]);x.useEffect(()=>{g(n)},[n,c]);const F=(j,S)=>{const v=S.offset.x;if(Math.abs(v)>h){if(!f)return;let u=a;if(v>0?a===0?u=1:a===-1&&(u=0):a===0?u=-1:a===1&&(u=0),u!==a){const s=D(c);r.changeStatus(s,e,u),g(u),J(),u===1?r.prefs[2]==0&&m(ne):u===-1&&r.prefs[2]==0&&m(se),m(null)}y(!1),B(w,0,{type:"tween",duration:.2})}},I=()=>{B(w,0,{type:"tween",duration:.2}),y(!0)};return t.jsxs(q.div,{id:`cal-${e}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:w},drag:f?"x":!1,dragConstraints:{left:M,right:a===1?0:h},dragElastic:0,onDrag:F,onDragEnd:I,children:[t.jsx("p",{style:{...d(i).text,fontSize:"14px",paddingLeft:"30px"},children:l}),a===1?t.jsx(Q,{style:{...d(i).icon,color:"#2e9741ff"}}):a===-1?t.jsx(ee,{style:{...d(i).icon,color:"#973939ff"}}):null]})},d=e=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"160vw",position:"absolute",top:"51%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,margin:"5px",background:o.get("background",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:o.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:o.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:o.get("mainText",e),fontFamily:"Segoe UI"},text:{fontFamily:"Segoe UI",fontSize:"14px",color:o.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:o.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function re(e,l){const i=[["привычка","привычки","привычек"],["habit","habits","habits"]],c=D(e);if(r.hasKey(c)){const n=Object.values(r.habitsByDate[c]).length;return n+" "+i[l][n===1?0:n>1&&n<5?1:2]}return"0 "+i[l][2]}function m(e){r.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),r.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{ue as default};
