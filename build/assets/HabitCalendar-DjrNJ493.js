import{c as ne,j as t,A as f,t as ie,f as re,l as se,C as s,m as W,a as q,s as Q,b as Z,d as _,e as ae}from"./index-6KcX8k11.js";import{R as L,r as y}from"./recharts-Bg6K2Pzo.js";import{u as le,a as ce,b as ee,I as te}from"./Icons-BBxNgLba.js";import{I as de,a as fe}from"./index-CJLYKdT7.js";const ge=ne(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),xe=ne(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),R=e=>{const r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${r}-${n}-${u}`},ue=e=>(e.getDay()+6)%7,E=new Audio("Audio/Click.wav"),pe=new Audio("Audio/IsDone.wav"),he=new Audio("Audio/Skip.wav");function ye(){return _.concat((f.CustomHabits||[]).filter(e=>!_.some(r=>r.id===e.id)))}const d=(e,r)=>({container:{backgroundColor:s.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"88vh",marginTop:"100px",width:"100vw",fontFamily:"Segoe UI, Roboto, Helvetica, sans-serif",overflow:"hidden",paddingTop:"10px"},panel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"500px",height:"100%",alignItems:"center",justifyContent:"start",backgroundColor:s.get("background",e),position:"relative",overflow:"hidden"},calendarHead:{padding:"15px 20px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:"20px",width:"100%",boxSizing:"border-box",backgroundColor:s.get("background",e),zIndex:2},headerWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minWidth:"150px"},header:{fontFamily:"Segoe UI",fontSize:"20px",margin:0,fontWeight:"700",color:s.get("mainText",e),textTransform:"capitalize",whiteSpace:"nowrap"},navBtn:{padding:"8px",borderRadius:"12px",cursor:"pointer",backgroundColor:e==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",zIndex:10},tableWrapper:{width:"100%",padding:"10px 0px 20px 0px",boxSizing:"border-box",overflow:"hidden"},table:{width:"100%",borderCollapse:"collapse",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"13vw",height:"13vw",maxHeight:"50px",maxWidth:"50px",borderRadius:"14px",fontSize:"16px",fontWeight:"600",fontFamily:"Segoe UI",transition:"all 0.2s ease-in-out",cursor:"pointer",margin:"auto"},infoPanelContainer:{flex:1,width:"100%",borderTop:`1px solid ${e==="light"?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)"}`,padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column",backgroundColor:s.get("background",e)},infoHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},text:{fontFamily:"Segoe UI",fontSize:"17px",color:s.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"14px",color:s.get("subText",e)},scrollView:{flex:1,overflowY:"auto",width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",paddingBottom:"20px"},icon:{width:"22px",height:"22px"}}),be=(e,r)=>{if(e<25)return r==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)";if(e>=100)return"rgba(46, 151, 65, 0.4)";const n=45,i=110-n,l=(e-25)/75;return`hsla(${n+l*i}, 90%, 40%, 0.3)`},me=(e,r)=>{if(e<25)return s.get("mainText",r);if(e>=100)return"#4ade80";const n=45,i=110-n,l=(e-25)/75;return`hsl(${n+l*i}, 90%, 60%)`},Se={enter:e=>({x:e>0?50:-50,opacity:0,scale:.95}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:e=>({zIndex:0,x:e<0?50:-50,opacity:0,scale:.95})},we={enter:e=>({y:e>0?-20:20,opacity:0}),center:{y:0,opacity:1},exit:e=>({y:e>0?20:-20,opacity:0})},Te=()=>{const[e,r]=L.useState("dark"),[n,u]=y.useState(f.prefs[0]),[i,l]=y.useState(new Date),[b,C]=y.useState(0),[g,p]=y.useState(i),[j,D]=y.useState(!1),[a,I]=y.useState(0);L.useEffect(()=>{const o=ie.subscribe(r),x=re.subscribe(C);return()=>{o.unsubscribe(),x.unsubscribe()}},[]),L.useEffect(()=>{const o=se.subscribe(x=>{u(x==="ru"?0:1)});return()=>o.unsubscribe()},[]);const B=new Date(i.getFullYear(),i.getMonth(),1),z=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),O=(B.getDay()+6)%7,Y=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],T=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],v=[],$=[];for(let o=0;o<O;o++)v.push(null);for(let o=1;o<=z;o++)v.push(o);for(let o=0;o<v.length;o+=7)$.push(v.slice(o,o+7));const k=()=>{I(-1),l(new Date(i.getFullYear(),i.getMonth()-1)),w(E)},H=()=>{I(1),l(new Date(i.getFullYear(),i.getMonth()+1)),w(E)},m=[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]],M=o=>{w(E),Q&&Q(o),Z&&Z(0)};return t.jsx("div",{style:d(e).container,children:t.jsxs("div",{style:d(e).panel,children:[t.jsxs("div",{style:d(e).calendarHead,children:[t.jsx(W.div,{whileTap:{scale:.9},onClick:k,style:d(e).navBtn,children:t.jsx(de,{size:22,color:s.get("mainText",e)})}),t.jsx("div",{style:d(e).headerWrapper,children:t.jsx(q,{mode:"popLayout",custom:a,children:t.jsxs(W.h1,{variants:we,custom:a,initial:"enter",animate:"center",exit:"exit",transition:{duration:.25},style:d(e).header,children:[m[n][i.getMonth()]," ",i.getFullYear()]},i.toISOString())})}),t.jsx(W.div,{whileTap:{scale:.9},onClick:H,style:d(e).navBtn,children:t.jsx(fe,{size:22,color:s.get("mainText",e)})})]}),t.jsx("div",{style:d(e).tableWrapper,children:t.jsx(q,{mode:"wait",custom:a,children:t.jsx(W.div,{variants:Se,custom:a,initial:"enter",animate:"center",exit:"exit",transition:{type:"tween",ease:"easeInOut",duration:.25},style:{width:"100%"},children:t.jsxs("table",{style:d(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:Y[n].map((o,x)=>t.jsx("th",{style:{paddingBottom:"15px"},children:t.jsx("p",{style:{textAlign:"center",fontSize:b===0?"13px":"14px",fontWeight:"600",color:x===5||x===6?"#ff5e5e":s.get("subText",e),margin:0,opacity:.8},children:o})},o))})}),t.jsx("tbody",{children:$.map((o,x)=>t.jsx("tr",{children:o.map((h,N)=>{const S=i.getMonth(),c=i.getFullYear(),A=h===g.getDate()&&S===g.getMonth()&&c===g.getFullYear(),J=R(new Date(c,S,h));let U="",F=0;if(Object.keys(f.habitsByDate).includes(J)){const X=Array.from(Object.values(f.habitsByDate[J])),G=X.length;F=G>0?Math.round(X.filter(oe=>oe>0).length/G*100):0,U=F+"%"}let K="transparent",V=s.get("mainText",e);return A?(K=s.get("currentDateBorder",e),V="#ffffff"):h>0&&F>0&&(K=be(F,e),V=me(F,e)),t.jsx("td",{style:{padding:"4px"},children:h?t.jsxs("div",{style:{...d(e).cell,backgroundColor:K,color:V,boxShadow:A?`0 4px 12px ${s.get("shadow",e)}`:"none"},onClick:()=>{p(new Date(c,S,h)),D(f.hasKey(R(new Date(c,S,h)))),w(E)},children:[h,h>0&&U&&!A&&t.jsx("div",{style:{fontSize:"9px",marginTop:"2px",opacity:.9,fontWeight:"bold"},children:U})]}):t.jsx("div",{style:{...d(e).cell,pointerEvents:"none"}})},N)})},x))})]})},i.toISOString())})}),t.jsx("div",{style:d(e).infoPanelContainer,children:j?t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:d(e).infoHeader,children:t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:0},children:[g.getDate()," ",m[n][g.getMonth()],", ",T[n][ue(g)]]})}),t.jsx("div",{style:d(e).scrollView,children:t.jsx(je,{theme:e,langIndex:n,date:g,fSize:b,onHabitClick:M})})]}):t.jsxs("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:.6,flexDirection:"column"},children:[t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:"0 0 10px 0"},children:[g.getDate()," ",m[n][g.getMonth()]]}),t.jsx("p",{style:{color:s.get("subText",e),margin:0,fontSize:"14px"},children:n===0?"Нет привычек на этот день":"No habits for this day"})]})})]})})},je=({theme:e,langIndex:r,date:n,fSize:u,onHabitClick:i})=>{const l=R(n);return f.hasKey(l)?Object.entries(f.habitsByDate[l]).map(([C,g])=>{const p=Number(C),j=ye().find(D=>D.id===p);return j?t.jsx(ve,{id:p,habitData:j,theme:e,date:n,statusInit:g,langIndex:r,fSize:u,onHabitClick:i},`${l}-${C}`):null}):null},ve=({id:e,habitData:r,theme:n,date:u,statusInit:i,langIndex:l,fSize:b,onHabitClick:C})=>{const g=r.name[l];let p="";r.category?Array.isArray(r.category)?p=r.category[l]:p=r.category:p=l===0?"Общее":"General";const j=()=>r.isCustom&&r.iconName?te.getIcon(r.iconName,{size:24,style:{color:"inherit"}}):te.getHabitIcon(r.name?r.name[0]:"default",{size:24,style:{color:"inherit"}}),D=f.choosenHabitsTypes[f.choosenHabits.indexOf(e)],[a,I]=y.useState(i),[B,P]=y.useState(a<2&&!D),z=70,O=-70,Y=le(0),T=ce(Y,[-1,1],[O,z]);y.useEffect(()=>{I(i)},[i,u]);const v=(h,N)=>{const S=N.offset.x;if(Math.abs(S)>z){if(!B)return;let c=a;if(S>0?a===0?c=1:a===-1&&(c=0):a===0?c=-1:a===1&&(c=0),c!==a){const A=R(u);f.changeStatus(A,e,c),I(c),ae(),c===1?f.prefs[2]==0&&w(pe):c===-1&&f.prefs[2]==0&&w(he),w(null)}P(!1),ee(T,0,{type:"tween",duration:.2})}},$=()=>{ee(T,0,{type:"tween",duration:.2}),P(!0)};let k=n==="light"?s.get("background",n):"rgba(255,255,255,0.05)",H=n==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",m=s.get("mainText",n),M=s.get("subText",n),o="rgba(255,255,255,0.1)",x=s.get("habitIcon",n);return a===1?(k="rgba(20, 60, 30, 0.85)",H="rgba(46, 151, 65, 0.0)",m="#ffffff",M="rgba(255,255,255,0.7)",o="#4ade80",x="#ffffff"):a===-1&&(k="rgba(60, 20, 20, 0.85)",H="rgba(151, 57, 57, 0.0)",m="#ffffff",M="rgba(255,255,255,0.7)",o="#f87171",x="#ffffff"),t.jsx("div",{style:{width:"100%",marginBottom:"12px",overflow:"hidden",borderRadius:"18px"},children:t.jsxs(W.div,{id:`cal-${e}`,style:{backgroundColor:k,border:`1px solid ${H}`,display:"flex",flexDirection:"row",width:"100%",padding:"16px 20px",alignItems:"center",borderRadius:"18px",boxSizing:"border-box",x:T,cursor:"pointer",position:"relative"},drag:B?"x":!1,dragConstraints:{left:O,right:a===1?0:z},dragElastic:.1,onDrag:v,onDragEnd:$,children:[t.jsx("div",{style:{fontSize:"24px",marginRight:"15px",width:"30px",textAlign:"center",color:x,display:"flex",alignItems:"center",justifyContent:"center"},children:j()}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{fontFamily:"Segoe UI",color:M,fontSize:"11px",marginBottom:"4px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.8px",pointerEvents:"none"},children:p}),t.jsx("p",{style:{fontFamily:"Segoe UI",color:m,margin:0,fontWeight:"600",fontSize:b===0?"16px":"18px",pointerEvents:"none"},children:g})]}),t.jsxs("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:a!==0?o:"transparent",border:a===0?`2px solid ${s.get("subText",n)}`:"none",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"10px"},children:[a===1&&t.jsx(ge,{style:{color:"#fff",fontSize:"18px"}}),a===-1&&t.jsx(xe,{style:{color:"#fff",fontSize:"18px"}})]})]})})};function w(e){f.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),f.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{Te as default};
