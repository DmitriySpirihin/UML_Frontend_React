import{c as ie,j as t,A as c,t as se,f as ae,l as le,C as s,m as B,a as Z,s as _,b as ee,d as te,e as ce}from"./index-DOw99iQ3.js";import{R as X,r as y}from"./recharts-Bg6K2Pzo.js";import{u as de,a as fe,b as ne,I as oe}from"./Icons-cIRMoY2N.js";import{I as ge,a as xe}from"./index-CgMgfPT1.js";const pe=ie(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),ue=ie(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),R=e=>{const n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${n}-${o}-${u}`},he=e=>(e.getDay()+6)%7,E=new Audio("Audio/Click.wav"),ye=new Audio("Audio/IsDone.wav"),be=new Audio("Audio/Skip.wav");function me(){return te.concat((c.CustomHabits||[]).filter(e=>!te.some(n=>n.id===e.id)))}const l=(e,n)=>({container:{backgroundColor:s.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"88vh",marginTop:"100px",width:"100vw",fontFamily:"Segoe UI, Roboto, Helvetica, sans-serif",overflow:"hidden",paddingTop:"10px"},panel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"500px",height:"100%",alignItems:"center",justifyContent:"start",backgroundColor:s.get("background",e),position:"relative",overflow:"hidden"},calendarHead:{padding:"15px 20px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:"20px",width:"100%",boxSizing:"border-box",backgroundColor:s.get("background",e),zIndex:2},headerWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minWidth:"150px"},header:{fontFamily:"Segoe UI",fontSize:"20px",margin:0,fontWeight:"700",color:s.get("mainText",e),textTransform:"capitalize",whiteSpace:"nowrap"},navBtn:{padding:"8px",borderRadius:"12px",cursor:"pointer",backgroundColor:e==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s",zIndex:10},tableWrapper:{width:"100%",padding:"15px 0px 15px 0px",boxSizing:"border-box",overflow:"hidden"},table:{width:"90%",borderCollapse:"collapse",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"12vw",height:"13vw",maxHeight:"50px",maxWidth:"50px",borderRadius:"14px",fontSize:"16px",fontWeight:"600",fontFamily:"Segoe UI",transition:"all 0.2s ease-in-out",cursor:"pointer",margin:"auto"},infoPanelContainer:{flex:1,width:"100%",borderTop:`1px solid ${e==="light"?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)"}`,padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column",backgroundColor:s.get("background",e)},infoHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},text:{fontFamily:"Segoe UI",fontSize:"17px",color:s.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"14px",color:s.get("subText",e)},scrollView:{flex:1,overflowY:"auto",width:"100%",scrollbarWidth:"none",msOverflowStyle:"none",paddingBottom:"20px"},icon:{width:"22px",height:"22px"}}),Se=(e,n)=>{if(e<25)return n==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)";if(e>=100)return n==="light"?"rgba(50, 215, 80, 0.64)":"rgba(36, 151, 57, 0.4)";const o=45,i=110-o,f=(e-25)/75;return`hsla(${o+f*i}, 90%, 40%, 0.3)`},we=(e,n)=>s.get("mainText",n),je={enter:e=>({x:e>0?50:-50,opacity:0,scale:.95}),center:{zIndex:1,x:0,opacity:1,scale:1},exit:e=>({zIndex:0,x:e<0?50:-50,opacity:0,scale:.95})},ve={enter:e=>({y:e>0?-20:20,opacity:0}),center:{y:0,opacity:1},exit:e=>({y:e>0?20:-20,opacity:0})},Me=()=>{const[e,n]=X.useState("dark"),[o,u]=y.useState(c.prefs[0]),[i,f]=y.useState(new Date),[v,I]=y.useState(0),[d,h]=y.useState(i),[C,z]=y.useState(!1),a=new Date().getDate(),O=new Date().getMonth(),[m,T]=y.useState(0);X.useEffect(()=>{const r=se.subscribe(n),p=ae.subscribe(I);return()=>{r.unsubscribe(),p.unsubscribe()}},[]),X.useEffect(()=>{const r=le.subscribe(p=>{u(p==="ru"?0:1)});return()=>r.unsubscribe()},[]);const k=new Date(i.getFullYear(),i.getMonth(),1),N=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),M=(k.getDay()+6)%7,P=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],U=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],b=[],D=[];for(let r=0;r<M;r++)b.push(null);for(let r=1;r<=N;r++)b.push(r);for(let r=0;r<b.length;r+=7)D.push(b.slice(r,r+7));const H=()=>{T(-1),f(new Date(i.getFullYear(),i.getMonth()-1)),j(E)},A=()=>{T(1),f(new Date(i.getFullYear(),i.getMonth()+1)),j(E)},S=[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]],F=r=>{j(E),_&&_(r),ee&&ee(0)};return t.jsx("div",{style:l(e).container,children:t.jsxs("div",{style:l(e).panel,children:[t.jsxs("div",{style:l(e).calendarHead,children:[t.jsx(B.div,{whileTap:{scale:.9},onClick:H,style:l(e).navBtn,children:t.jsx(ge,{size:22,color:s.get("mainText",e)})}),t.jsx("div",{style:l(e).headerWrapper,children:t.jsx(Z,{mode:"popLayout",custom:m,children:t.jsxs(B.h1,{variants:ve,custom:m,initial:"enter",animate:"center",exit:"exit",transition:{duration:.25},style:l(e).header,children:[S[o][i.getMonth()]," ",i.getFullYear()]},i.toISOString())})}),t.jsx(B.div,{whileTap:{scale:.9},onClick:A,style:l(e).navBtn,children:t.jsx(xe,{size:22,color:s.get("mainText",e)})})]}),t.jsx("div",{style:l(e).tableWrapper,children:t.jsx(Z,{mode:"wait",custom:m,children:t.jsx(B.div,{variants:je,custom:m,initial:"enter",animate:"center",exit:"exit",transition:{type:"tween",ease:"easeInOut",duration:.25},style:{width:"100%"},children:t.jsxs("table",{style:l(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:P[o].map((r,p)=>t.jsx("th",{style:{paddingBottom:"15px"},children:t.jsx("p",{style:{textAlign:"center",fontSize:v===0?"13px":"14px",fontWeight:"600",color:p===5||p===6?"#ff5e5e":s.get("subText",e),margin:0,opacity:.8},children:r})},r))})}),t.jsx("tbody",{children:D.map((r,p)=>t.jsx("tr",{children:r.map((g,x)=>{const w=i.getMonth(),$=i.getFullYear(),K=g===d.getDate()&&w===d.getMonth()&&$===d.getFullYear(),G=R(new Date($,w,g));let V="",W=0;if(Object.keys(c.habitsByDate).includes(G)){const q=Array.from(Object.values(c.habitsByDate[G])),Q=q.length;W=Q>0?Math.round(q.filter(re=>re>0).length/Q*100):0,V=W+"%"}let L="transparent",J=s.get("mainText",e);return K?(L=s.get("currentDateBorder",e),J="#ffffff"):g>0&&W>0&&(L=Se(W,e),J=we(W,e)),t.jsx("td",{style:{padding:"4px"},children:g?t.jsxs("div",{style:{...l(e).cell,backgroundColor:L,color:J,border:a===g&&O===w?`2px solid ${s.get("currentDateBorder",e)}`:"transparent",boxShadow:K?`0 4px 12px ${s.get("shadow",e)}`:"none"},onClick:()=>{h(new Date($,w,g)),z(c.hasKey(R(new Date($,w,g)))),j(E)},children:[g,g>0&&V&&!K&&t.jsx("div",{style:{fontSize:"9px",marginTop:"2px",opacity:.9,fontWeight:"bold"},children:V})]}):t.jsx("div",{style:{...l(e).cell,pointerEvents:"none"}})},x)})},p))})]})},i.toISOString())})}),t.jsx("div",{style:l(e).infoPanelContainer,children:C?t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx("div",{style:l(e).infoHeader,children:t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:0},children:[d.getDate()," ",S[o][d.getMonth()],", ",U[o][he(d)]]})}),t.jsx("div",{style:l(e).scrollView,children:t.jsx(Ce,{theme:e,langIndex:o,date:d,fSize:v,onHabitClick:F})})]}):t.jsxs("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:.6,flexDirection:"column"},children:[t.jsxs("h2",{style:{fontSize:"18px",fontWeight:"bold",color:s.get("mainText",e),margin:"0 0 10px 0"},children:[d.getDate()," ",S[o][d.getMonth()]]}),t.jsx("p",{style:{color:s.get("subText",e),margin:0,fontSize:"14px"},children:o===0?"Нет привычек на этот день":"No habits for this day"})]})})]})})},Ce=({theme:e,langIndex:n,date:o,fSize:u,onHabitClick:i})=>{const f=R(o);return c.hasKey(f)?Object.entries(c.habitsByDate[f]).map(([I,d])=>{const h=Number(I),C=me().find(z=>z.id===h);return C?t.jsx(De,{id:h,habitData:C,theme:e,date:o,statusInit:d,langIndex:n,fSize:u,onHabitClick:i},`${f}-${I}`):null}):null},De=({id:e,habitData:n,theme:o,date:u,statusInit:i,langIndex:f,fSize:v,onHabitClick:I})=>{const d=n.name[f];let h="";n.category?Array.isArray(n.category)?h=n.category[f]:h=n.category:h=f===0?"Общее":"General";const C=()=>n.isCustom&&n.iconName?oe.getIcon(n.iconName,{size:24,style:{color:"inherit"}}):oe.getHabitIcon(n.name?n.name[0]:"default",{size:24,style:{color:"inherit"}}),z=c.choosenHabitsTypes[c.choosenHabits.indexOf(e)],[a,O]=y.useState(i),[m,T]=y.useState(a<2&&!z),k=70,Y=-70,N=de(0),M=fe(N,[-1,1],[Y,k]);y.useEffect(()=>{O(i)},[i,u]);const P=(r,p)=>{const g=p.offset.x;if(Math.abs(g)>k){if(!m)return;let x=a;if(g>0?a===0?x=1:a===-1&&(x=0):a===0?x=-1:a===1&&(x=0),x!==a){const w=R(u);c.changeStatus(w,e,x),O(x),ce(),x===1?c.prefs[2]==0&&j(ye):x===-1&&c.prefs[2]==0&&j(be),j(null)}T(!1),ne(M,0,{type:"tween",duration:.2})}},U=()=>{ne(M,0,{type:"tween",duration:.2}),T(!0)};let b=o==="light"?s.get("background",o):"rgba(255,255,255,0.05)",D=o==="light"?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",H=s.get("mainText",o),A=s.get("subText",o),S="rgba(255,255,255,0.1)",F=s.get("habitIcon",o);return a===1?(b="rgba(20, 60, 30, 0.85)",D="rgba(46, 151, 65, 0.0)",H="#ffffff",A="rgba(255,255,255,0.7)",S="#4ade80",F="#ffffff"):a===-1&&(b="rgba(60, 20, 20, 0.85)",D="rgba(151, 57, 57, 0.0)",H="#ffffff",A="rgba(255,255,255,0.7)",S="#f87171",F="#ffffff"),t.jsx("div",{style:{width:"100%",marginBottom:"12px",overflow:"hidden",borderRadius:"18px"},children:t.jsxs(B.div,{id:`cal-${e}`,style:{backgroundColor:b,border:`1px solid ${D}`,display:"flex",flexDirection:"row",width:"100%",padding:"16px 20px",alignItems:"center",borderRadius:"18px",boxSizing:"border-box",x:M,cursor:"pointer",position:"relative"},drag:m?"x":!1,dragConstraints:{left:Y,right:a===1?0:k},dragElastic:.1,onDrag:P,onDragEnd:U,children:[t.jsx("div",{style:{fontSize:"24px",marginRight:"15px",width:"30px",textAlign:"center",color:F,display:"flex",alignItems:"center",justifyContent:"center"},children:C()}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{fontFamily:"Segoe UI",color:A,fontSize:"11px",marginBottom:"4px",textTransform:"uppercase",fontWeight:"700",letterSpacing:"0.8px",pointerEvents:"none"},children:h}),t.jsx("p",{style:{fontFamily:"Segoe UI",color:H,margin:0,fontWeight:"600",fontSize:v===0?"16px":"18px",pointerEvents:"none"},children:d})]}),t.jsxs("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:a!==0?S:"transparent",border:a===0?`2px solid ${s.get("subText",o)}`:"none",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"10px"},children:[a===1&&t.jsx(pe,{style:{color:"#fff",fontSize:"18px"}}),a===-1&&t.jsx(ue,{style:{color:"#fff",fontSize:"18px"}})]})]})})};function j(e){c.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),c.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{Me as default};
