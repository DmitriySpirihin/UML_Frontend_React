import{R as m,r as h,A as d,t as Q,g as Z,l as tt,h as et,j as e,C as i,s as E,a as nt,b as P,m as st,e as it}from"./index-D40ONV6_.js";import{u as at,a as ot,b as K}from"./index-BBio29zq.js";const S=t=>{const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${o}-${r}-${a}`},rt=t=>(t.getDay()+6)%7;S(new Date);const I=new Audio("Audio/SwitchPanel.wav"),lt=new Audio("Audio/Click_Calendar.wav"),ct=new Audio("Audio/IsDone.wav"),W=new Audio("Audio/Skip.wav");function dt(){return P.concat((d.CustomHabits||[]).filter(t=>!P.some(o=>o.id===t.id)))}const bt=()=>{const[t,o]=m.useState("dark"),[r,a]=m.useState("dark"),[l,j]=h.useState(d.prefs[0]),[n,p]=h.useState(new Date),[c,b]=h.useState(n),[f,v]=h.useState(!1),[U,w]=h.useState(0);m.useEffect(()=>{const s=Q.subscribe(o);return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=Z.subscribe(a);return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=tt.subscribe(k=>{j(k==="ru"?0:1)});return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=et.subscribe(()=>w(k=>k+1));return()=>s.unsubscribe()},[]);const T=new Date(n.getFullYear(),n.getMonth(),1),R=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),F=(T.getDay()+6)%7,C=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],u=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],y=[],_=[];for(let s=0;s<F;s++)y.push(null);for(let s=1;s<=R;s++)y.push(s);for(let s=0;s<y.length;s+=7)_.push(y.slice(s,s+7));const V=()=>{p(new Date(n.getFullYear(),n.getMonth()-1)),D(I,50)},N=()=>{p(new Date(n.getFullYear(),n.getMonth()+1)),D(I,50)};return e.jsxs("div",{style:g(t).container,children:[e.jsxs("div",{style:g(t).panel,children:[e.jsxs("div",{style:g(t).calendarHead,children:[e.jsx("h1",{style:g(t).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),e.jsx("div",{onClick:V,children:e.jsx("h1",{style:g(t).header,children:"<"})}),e.jsx("div",{onClick:N,children:e.jsx("h1",{style:g(t).header,children:">"})})]}),e.jsxs("table",{style:g(t).table,children:[e.jsx("thead",{children:e.jsx("tr",{children:C[l].map(s=>e.jsx("th",{children:e.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:s==="Вс"||s==="Sun"?"#873535ff":i.get("subText",t)},children:s})},s))})}),e.jsx("tbody",{children:_.map((s,k)=>e.jsx("tr",{children:s.map((x,X)=>{const A=n.getMonth(),M=n.getFullYear(),G=x===c.getDate()&&A===c.getMonth()&&M===c.getFullYear(),z=S(new Date(M,A,x));let O="",H=0;if(Object.keys(d.habitsByDate).includes(z)){const B=Array.from(Object.values(d.habitsByDate[z])),L=B.length,q=B.filter(J=>J===1).length,Y=L>0?Math.round(q/L*100):0;O=Y+"%",H=Y>=100?1:-1}return e.jsx("td",{children:e.jsxs("div",{style:{...g(t).cell,border:`3px solid ${G?i.get("currentDateBorder",t):i.get("background",t)}`,backgroundColor:x<1?i.get("background",t):H===1?i.get("habitCardDone",t):H===-1?i.get("habitCardSkipped",t):i.get("background",t)},onClick:()=>{b(new Date(M,A,x)),v(d.hasKey(S(new Date(M,A,x)))),D(lt,50)},children:[x,x>0&&e.jsx("div",{style:{fontSize:"8px",color:i.get("subText",t),lineHeight:"5px",paddingBottom:"7px"},children:O})]})},X)})},k))})]}),e.jsxs("div",{style:{position:"fixed",top:"120%",left:"20%",fontSize:"14px",fontFamily:"Segoe UI",color:i.get("simplePanel",t)},children:[" ",l===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]}),e.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:f&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{borderTop:`1px solid ${i.get("border",t)}`},children:[e.jsx("h1",{style:{...g(t).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+u[l][rt(c)]}),e.jsx("div",{style:{fontSize:"10px",color:i.get("subText",t),lineHeight:"1px",paddingRight:"50%"},children:ht(c,l)})]}),e.jsx("div",{style:g(t).scrollView,children:e.jsx(gt,{theme:t,langIndex:l,date:c})})]})})]}),e.jsx(pt,{theme:t,globalTheme:r})]})},gt=({theme:t,langIndex:o,date:r})=>{const a=S(r);return d.hasKey(a)?Object.entries(d.habitsByDate[a]).map(([j,n])=>{const p=Number(j),c=dt().find(f=>f.id===p),b=c?c.name[o]:"";return e.jsx(ut,{id:p,name:b,theme:t,date:r,statusInit:n,langIndex:o},`${a}-${j}`)}):null},ut=({id:t,name:o,theme:r,date:a,statusInit:l,langIndex:j})=>{const[n,p]=h.useState(l),[c,b]=h.useState(!0),f=100,v=-100,U=at(0),w=ot(U,[-1,1],[v,f]);h.useEffect(()=>{p(l)},[l,a]);const T=(R,F)=>{const C=F.offset.x;if(Math.abs(C)>f){if(!c)return;let u=n;if(C>0?n===0?u=1:n===-1&&(u=0):n===0?u=-1:n===1&&(u=0),u!==n){const y=S(a);d.changeStatus(y,t,u),p(u),it(),u===1?d.prefs[2]==0&&ct.play():u===-1&&d.prefs[2]==0&&W.play(),d.prefs[3]==0&&navigator.vibrate?.(50)}b(!1),K(w,0,{type:"tween",duration:.2})}},$=()=>{K(w,0,{type:"tween",duration:.2}),b(!0)};return e.jsxs(st.div,{id:`cal-${t}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:w},drag:c?"x":!1,dragConstraints:{left:v,right:n===1?0:f},dragElastic:0,onDrag:T,onDragEnd:$,children:[e.jsx("p",{style:{...g(r).text,fontSize:"14px",paddingLeft:"30px"},children:o}),n===1?e.jsx("img",{src:"Art/Ui/Done_Icon.png",style:g(r).icon}):n===-1?e.jsx("img",{src:"Art/Ui/Skipped_Icon.png",style:g(r).icon}):null]})};function pt({globalTheme:t,theme:o}){const r={position:"fixed",bottom:"0",left:"0",width:"100vw",height:"10vh",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",backgroundColor:i.get("bottomPanel",o),display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:900,boxShadow:`0px -2px 0px ${i.get("bottomPanelShadow",o)}`},a={width:"35px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"};return e.jsx("div",{style:r,children:e.jsxs("div",{style:r,children:[e.jsx("img",{src:t==="dark"?"Art/Ui/Back_Dark.png":"Art/Ui/Back_Light.png",style:a,onClick:()=>{E("HabitsMain"),D(W,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Metrics_Dark.png":"Art/Ui/Metrics_Light.png",style:a,onClick:()=>{E("HabitMetrics"),D(I,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Add_Dark.png":"Art/Ui/Add_Light.png",style:a,onClick:()=>{}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Setting_Dark.png":"Art/Ui/Metrics_Light.png",style:a,onClick:()=>{nt(!0),D(I,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Calendar_Dark.png":"Art/Ui/Calendar_Light.png",style:a,onClick:()=>{}})]})})}const g=t=>({container:{backgroundColor:i.get("background",t),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:i.get("headGradient",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",t),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:i.get("mainText",t),fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"150vw",position:"absolute",top:"53%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${i.get("border",t)}`,margin:"5px",background:i.get("background",t),boxShadow:`4px 4px 6px ${i.get("shadow",t)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:i.get("mainText",t)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:i.get("subText",t)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",paddingBottom:"5px",width:"25px"}});function ht(t,o){const r=[["привычка","привычки","привычек"],["habit","habits","habits"]],a=S(t);if(d.hasKey(a)){const l=Object.values(d.habitsByDate[a]).length;return l+" "+r[o][l===1?0:l>1&&l<5?1:2]}return"0 "+r[o][2]}function D(t,o){d.prefs[2]==0&&t!==null&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),d.prefs[3]==0&&navigator.vibrate(o)}export{bt as default};
