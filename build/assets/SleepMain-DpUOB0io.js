import{A as m,r as a,t as C,f as H,Q as L,l as _,j as n,C as s,bJ as te,bK as ne,bL as oe,bM as se,bN as ie,i as re,V as N,k as ae,aY as le,aC as ce}from"./index-BQ6JiPKx.js";import{M as ue}from"./MyInput-CqbL2V02.js";import{S as X}from"./Slider-VXd3hU7x.js";const de=(e,t,o,l,r)=>{const c={bedtime:o,duration:t,mood:l,note:r??""};m.sleepingLog={...m.sleepingLog,[e]:c}};new Audio("Audio/Click.wav");const F=(e,t)=>[s.get("difficulty3",e),s.get("difficulty2",e),s.get("difficulty1",e),s.get("difficulty0",e),s.get("difficulty5",e)][t],ge=4,pe=12,he=10,fe=ge*60*60*1e3,xe=480*60*1e3,be=pe*60*60*1e3,K=he*60*1e3,me=({dateString:e})=>{const[t,o]=a.useState(C.value),[l,r]=a.useState(H.value),[c,d]=a.useState(m.prefs[0]),[y,D]=a.useState(L.value),[p,j]=a.useState(0),[u,b]=a.useState(4),[i,g]=a.useState(xe),[h,S]=a.useState(1320*60*1e3),[k,T]=a.useState("");a.useEffect(()=>{const w=C.subscribe(o),A=H.subscribe(r);return()=>{w.unsubscribe(),A.unsubscribe()}},[]),a.useEffect(()=>{const w=C.subscribe(o),A=_.subscribe(Y=>{d(Y==="ru"?0:1)});return()=>{w.unsubscribe(),A.unsubscribe()}},[]),a.useEffect(()=>{const w=L.subscribe(D);return y==="SleepNew"?setTimeout(()=>j(1),400):j(0),()=>{w.unsubscribe()}},[y]);const I=async()=>{de(e,i,h,u,k),await le(),N("")};return n.jsx("div",{style:{...x(t).container,transform:y==="SleepNew"&&ye(e)?"translateX(0)":"translateX(-100%)",backgroundColor:p===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:n.jsxs("div",{style:x(t).panel,children:[n.jsx("p",{style:x(t,l).text,children:c===0?"Во сколько уснул?":"What time did you go to bed?"}),n.jsxs("div",{style:{width:"100%"},children:[n.jsx("p",{style:x(t,l).textDate,children:V(h)}),n.jsx(X,{onChange:w=>S(w.target.value),min:0,max:1440*60*1e3,step:K,value:h,style:x(t).slider})]}),n.jsx("p",{style:x(t,l).text,children:c===0?"Сколько спал сегодня?":"How much did you sleep today?"}),n.jsxs("div",{style:{width:"100%"},children:[n.jsx("p",{style:x(t,l).textDate,children:V(i)}),n.jsx(X,{onChange:w=>g(w.target.value),min:fe,max:be,step:K,value:i,style:x(t).slider})]}),n.jsx("p",{style:x(t,l).text,children:c===0?"Как самочувстие?":"How do you feel?"}),n.jsxs("div",{style:x(t).simplePanelRow,children:[n.jsx(te,{style:{...x(t).icon,color:u===1?F(t,0):s.get("simplePanel",t)},onClick:()=>b(1)}),n.jsx(ne,{style:{...x(t).icon,color:u===2?F(t,1):s.get("simplePanel",t)},onClick:()=>b(2)}),n.jsx(oe,{style:{...x(t).icon,color:u===3?F(t,2):s.get("simplePanel",t)},onClick:()=>b(3)}),n.jsx(se,{style:{...x(t).icon,color:u===4?F(t,3):s.get("simplePanel",t)},onClick:()=>b(4)}),n.jsx(ie,{style:{...x(t).icon,color:u===5?F(t,4):s.get("simplePanel",t)},onClick:()=>b(5)})]}),n.jsx(ue,{maxL:500,h:"20%",w:"90%",placeHolder:c===0?"Заметка(опционально , можешь записать свой сон)":"Notes(optional , can write your dream)",theme:t,onChange:w=>T(w)}),n.jsxs("div",{style:{...x(t).simplePanelRow,marginTop:"55px"},children:[n.jsx(re,{style:{...x(t).icon,fontSize:"38px"},onClick:()=>N("")}),n.jsx(ae,{style:{...x(t).icon,fontSize:"38px"},onClick:()=>I()})]})]})})},x=(e,t)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,width:"100vw"},panel:{alignItems:"center",justifyItems:"center",borderRadius:"24px",border:`1px solid ${s.get("border",e)}`,margin:"5px",backgroundColor:s.get("background",e),boxShadow:`4px 4px 6px ${s.get("shadow",e)}`,width:"95vw",height:"70vh",marginBottom:"16%"},text:{textAlign:"center",fontSize:t?"13px":"15px",color:s.get("mainText",e),marginBottom:"12px"},subtext:{textAlign:"center",fontSize:t?"11px":"13px",color:s.get("subText",e),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:s.get("mainText",e),marginBottom:"4px"},simplePanelRow:{width:"85vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",userSelect:"none",touchAction:"none"},icon:{fontSize:"58px",padding:"5px",marginTop:"10px",color:s.get("icons",e),userSelect:"none",touchAction:"none"},slider:{width:"90%",userSelect:"none",touchAction:"none",color:s.get("icons",e)}}),V=e=>{const t=Math.floor(e/6e4),o=Math.floor(t/60),l=t%60;return`${o.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`};function ye(e){const t=new Date(e),o=new Date;t.setHours(0,0,0,0),o.setHours(0,0,0,0);const l=t<=o;return l||N(""),l}const Se=(e,t)=>{const o=(i,g)=>g,l=i=>Math.round(i/6e4),r=[],c=[],d=m.breathingLog[e]||[];if(d.length>0){const i=d.reduce((h,S)=>h+(S.endTime-S.startTime),0),g=Math.max(...d.map(h=>h.maxHold||0))/1e3;r.push(o(`Вы потратили ${l(i)} мин на дыхательные практики. Максимальная задержка: ${g} сек.`,`You spent ${l(i)} min on breathing exercises. Max breath hold: ${g} sec.`))}else c.push(o("Попробуйте добавить дыхательную практику — даже 5 минут улучшат концентрацию и снизят стресс.","Try adding a breathing session—even 5 minutes can improve focus and reduce stress."));const y=m.meditationLog[e]||[];if(y.length>0){const i=y.reduce((g,h)=>g+(h.endTime-h.startTime),0);r.push(o(`Вы медитировали ${l(i)} мин — отличный способ восстановить нервную систему!`,`You meditated for ${l(i)} min — a great way to restore your nervous system!`))}else c.push(o("Не забывайте про медитацию: она помогает снизить тревожность и улучшить сон.","Don’t skip meditation—it reduces anxiety and improves sleep quality."));const D=m.hardeningLog[e]||[];if(D.length>0){const i=D.reduce((g,h)=>g+(h.timeInColdWater||0),0);r.push(o(`Вы провели ${Math.round(i/1e3)} сек в холодной воде — закалка укрепляет иммунитет!`,`You spent ${Math.round(i/1e3)} sec in cold water — hardening boosts immunity!`))}else c.push(o("Хотите укрепить иммунитет? Попробуйте контрастный душ или кратковременное погружение в прохладную воду.","Want to boost immunity? Try a contrast shower or brief cold-water exposure."));const p=m.sleepingLog[e];if(p){const i=(p.duration/36e5).toFixed(1),g=o(["ужасно","плохо","нормально","хорошо","отлично"][p.mood-1]||"нормально",["terrible","bad","okay","good","great"][p.mood-1]||"okay");r.push(o(`Сон: ${i} ч. Настроение после сна: ${g}.`,`Sleep: ${i} hrs. Mood after waking: ${g}.`)),parseFloat(i)<6.5?c.push(o("Ваш сон короче рекомендуемой нормы (7–9 ч). Постарайтесь лечь пораньше или улучшить гигиену сна.","Your sleep is below the recommended 7–9 hours. Try going to bed earlier or improving sleep hygiene.")):p.mood<=2&&c.push(o("Несмотря на достаточную продолжительность сна, настроение низкое. Возможно, стоит проверить качество сна или уровень стресса.","Despite enough sleep duration, your mood is low. Consider checking sleep quality or stress levels."))}else c.push(o("Не забудьте записать данные сна! Качественный отдых — основа физического и ментального здоровья.","Don’t forget to log your sleep! Quality rest is the foundation of physical and mental health."));const j=m.trainingLog?.[e]||[];if(j.length>0){const i=j.reduce((S,k)=>S+(k.duration||0),0),g=j.reduce((S,k)=>S+(k.tonnage||0),0),h=j.reduce((S,k)=>S+Object.values(k.exercises||{}).filter(T=>T.complited).length,0);r.push(o(`Тренировка: ${l(i)} мин, тоннаж: ${g} кг, упражнений выполнено: ${h}.`,`Workout: ${l(i)} min, tonnage: ${g} kg, ${h} exercises completed.`)),i<10*6e4&&c.push(o("Тренировка была очень короткой. Даже 20-минутная сессия принесёт больше пользы.","Your workout was very short. Even a 20-minute session would be more beneficial."))}else c.push(o("Сегодня не было тренировки. Даже лёгкая разминка поддержит тонус и настроение!","No workout today. Even light movement can boost energy and mood!"));const u=m.habitsByDate?.[e]||[];if(u.length>0){const i=u.filter(S=>S.status===1).length,g=u.length,h=i/g;r.push(o(`Привычки: ${i} из ${g} выполнено сегодня.`,`Habits: ${i} out of ${g} completed today.`)),h<.5&&c.push(o("Меньше половины привычек выполнено. Выберите 1–2 ключевые и сосредоточьтесь на них завтра.","Less than half of your habits were completed. Pick 1–2 key ones and focus on them tomorrow."))}else c.push(o("У вас нет запланированных привычек на сегодня. Создайте пару простых — например, “выпить воду утром” или “сделать 5 минут растяжки”.","You have no habits logged for today. Set up a couple of simple ones—e.g., “drink water in the morning” or “5 min of stretching”."));let b="";if(r.length>0&&(b+=r.join(" ")+" "),c.length>0){const i=o("Рекомендации: ","Recommendations: ");b+=i+c.slice(0,2).join(" ")+(c.length>2?o(" и другие."," and others."):"")}return b===""&&(b=o("Сегодня пока нет данных о вашей активности. Начните с одной полезной привычки!","No activity data recorded for today. Start with one healthy habit!")),b.trim()};new Audio("Audio/Click.wav");const we=({dateString:e})=>{const[t,o]=a.useState(C.value),[l,r]=a.useState(H.value),[c,d]=a.useState(m.prefs[0]),[y,D]=a.useState(L.value),[p,j]=a.useState(0);return a.useEffect(()=>{const u=C.subscribe(o),b=H.subscribe(r);return()=>{u.unsubscribe(),b.unsubscribe()}},[]),a.useEffect(()=>{const u=C.subscribe(o),b=_.subscribe(i=>{d(i==="ru"?0:1)});return()=>{u.unsubscribe(),b.unsubscribe()}},[]),a.useEffect(()=>{const u=L.subscribe(D);return y==="SleepInsight"?setTimeout(()=>j(1),400):j(0),()=>{u.unsubscribe()}},[y]),n.jsx("div",{style:{...q(t).container,transform:y==="SleepInsight"?"translateX(0)":"translateX(-100%)",backgroundColor:p===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:n.jsx("div",{onClick:()=>{N("")},style:q(t).panel,children:Se()})})},q=(e,t)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,width:"100vw"},panel:{alignItems:"center",justifyItems:"center",borderRadius:"24px",border:`1px solid ${s.get("border",e)}`,margin:"5px",backgroundColor:s.get("background",e),boxShadow:`4px 4px 6px ${s.get("shadow",e)}`,width:"95vw",height:"50vh",marginBottom:"16%"},text:{textAlign:"center",fontSize:"15px",color:s.get("mainText",e),marginBottom:"12px"}}),je=e=>(e.getDay()+6)%7,E=e=>{const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${l}`},B=new Audio("Audio/Click.wav"),ve=(e,t)=>[s.get("difficulty3",e),s.get("difficulty2",e),s.get("difficulty1",e),s.get("difficulty0",e),s.get("difficulty5",e)][t]||s.get("background",e),Q=e=>{if(typeof e!="number"||e<0)return"--:--";const t=Math.floor(e/(60*1e3)),o=Math.floor(t/60),l=t%60;return`${o.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`};function O(e){m.prefs[2]===0&&e&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),m.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Me=e=>{if(typeof e!="number"||e<0)return 0;const t=3600*1e3,o=4,l=12,r=o*t,c=l*t;if(e<=r)return 0;if(e>=c)return 100;const d=c-r,y=(e-r)/d;return Math.round(y*100)},$e=()=>{const[e,t]=a.useState("dark"),[o,l]=a.useState(m.prefs[0]),[r,c]=a.useState(new Date),[d,y]=a.useState(new Date),D=a.useRef(d),[p,j]=a.useState(m.prefs[4]),[u,b]=a.useState(null);a.useEffect(()=>{const f=C.subscribe(t),$=_.subscribe(P=>l(P==="ru"?0:1)),v=H.subscribe(j);return()=>{f.unsubscribe(),$.unsubscribe(),v.unsubscribe()}},[]),a.useEffect(()=>{D.current=d},[d]),a.useEffect(()=>{const f=ce.subscribe(()=>{const $=new Date,v=D.current;v>$||(E(v),E($))});return()=>f.unsubscribe()},[]);const i=new Date(r.getFullYear(),r.getMonth(),1),h=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),S=(i.getDay()+6)%7,k=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],T=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],I=Array(S).fill(null);for(let f=1;f<=h;f++)I.push(f);const w=[];for(let f=0;f<I.length;f+=7)w.push(I.slice(f,f+7));const A=()=>{c(new Date(r.getFullYear(),r.getMonth()-1)),O(B)},Y=()=>{c(new Date(r.getFullYear(),r.getMonth()+1)),O(B)},R=r.getMonth(),W=r.getFullYear();return n.jsxs("div",{style:M(e,p).container,children:[n.jsxs("div",{style:M(e,p).panel,children:[n.jsxs("div",{style:M(e,p).calendarHead,children:[n.jsxs("h1",{style:M(e,p).header,children:[r.getFullYear(),"/",String(r.getMonth()+1).padStart(2,"0")]}),n.jsx("div",{onClick:A,style:{cursor:"pointer"},children:n.jsx("h1",{style:M(e,p).header,children:"<"})}),n.jsx("div",{onClick:Y,style:{cursor:"pointer"},children:n.jsx("h1",{style:M(e,p).header,children:">"})})]}),n.jsxs("table",{style:M(e,p).table,children:[n.jsx("thead",{children:n.jsx("tr",{children:k[o].map(f=>n.jsx("th",{children:n.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:f==="Вс"||f==="Sun"?"#873535ff":s.get("subText",e)},children:f})},f))})}),n.jsx("tbody",{children:w.map((f,$)=>n.jsx("tr",{children:f.map((v,P)=>{if(v===null)return n.jsx("td",{},P);const G=new Date(W,R,v),J=E(G),z=m.sleepingLog?.[J],U=v===d.getDate()&&R===d.getMonth()&&W===d.getFullYear();let Z=s.get("background",e);return n.jsx("td",{children:n.jsxs("div",{style:{...M(e,p).cell,backgroundColor:Z,border:`3px solid ${U?s.get("currentDateBorder",e):"transparent"}`,color:U?s.get("textHighlight",e):s.get("mainText",e),display:"flex",alignItems:"flex-end",justifyContent:"center",position:"relative",overflow:"hidden",cursor:"pointer"},onClick:()=>{const ee=new Date(W,R,v);y(ee),O(B),b(z||null)},children:[z&&typeof z.duration=="number"&&n.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:`${Me(z.duration)}%`,backgroundColor:ve(e,z.mood-1),backdropFilter:"blur(2px)",zIndex:0}}),n.jsx("span",{style:{position:"relative",zIndex:1},children:v})]})},P)})},$))})]})]}),n.jsxs("p",{style:{...M(e,p).subtext,fontSize:"18px",textAlign:"center",marginTop:"12px"},children:[d.getDate(),"-",d.getMonth()+1,"-",d.getFullYear()," ",T[o][je(d)]]}),u&&n.jsxs("div",{style:M(e,p).sleepInfoPanel,children:[n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"Время отбоя:":"Bedtime:"})," ",Q(u.bedtime)]}),n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"Продолжительность:":"Duration:"})," ",Q(u.duration)]}),n.jsxs("p",{children:[n.jsx("strong",{children:o===0?"Настроение:":"Mood:"})," ","★".repeat(u.mood),"☆".repeat(5-u.mood)]}),u.note&&n.jsxs("div",{children:[n.jsx("strong",{children:o===0?"Заметка:":"Note:"})," ",u.note]})]}),n.jsx(me,{dateString:E(d)}),n.jsx(we,{dateString:E(d)})]})},M=(e,t)=>({container:{backgroundColor:s.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${s.get("border",e)}`},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:s.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:s.get("subText",e)},table:{borderCollapse:"collapse",width:"90%",textAlign:"center",tableLayout:"fixed"},cell:{boxSizing:"border-box",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",fontFamily:"Segoe UI"},subtext:{textAlign:"left",fontSize:t===0?"11px":"13px",color:s.get("subText",e),marginLeft:"10px",marginBottom:"12px"},sleepInfoPanel:{marginTop:"16px",padding:"12px",backgroundColor:s.get("card",e),borderRadius:"8px",fontSize:t===0?"13px":"15px",color:s.get("text",e),maxWidth:"90vw",width:"100%"}});export{$e as default};
