import{c as q,j as t,R as m,r as h,A as l,t as J,g as Q,l as Z,h as ee,C as a,a as U,m as te,e as ne}from"./index-BzS0-DWf.js";import{C as se}from"./Check-C6PHsKPY.js";import{u as ae,a as oe,b as W}from"./index-D20QNhyj.js";const ie=q(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),S=e=>{const o=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${o}-${u}-${c}`},re=e=>(e.getDay()+6)%7;S(new Date);const L=new Audio("Audio/SwitchPanel.wav"),le=new Audio("Audio/Click_Calendar.wav"),ce=new Audio("Audio/IsDone.wav"),de=new Audio("Audio/Skip.wav");function ue(){return U.concat((l.CustomHabits||[]).filter(e=>!U.some(o=>o.id===e.id)))}const ye=()=>{const[e,o]=m.useState("dark"),[u,c]=m.useState("dark"),[i,w]=h.useState(l.prefs[0]),[n,f]=h.useState(new Date),[r,b]=h.useState(n),[p,v]=h.useState(!1),[H,D]=h.useState(0);m.useEffect(()=>{const s=J.subscribe(o);return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=Q.subscribe(c);return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=Z.subscribe(j=>{w(j==="ru"?0:1)});return()=>s.unsubscribe()},[]),m.useEffect(()=>{const s=ee.subscribe(()=>D(j=>j+1));return()=>s.unsubscribe()},[]);const T=new Date(n.getFullYear(),n.getMonth(),1),z=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),I=(T.getDay()+6)%7,C=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],g=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],y=[],O=[];for(let s=0;s<I;s++)y.push(null);for(let s=1;s<=z;s++)y.push(s);for(let s=0;s<y.length;s+=7)O.push(y.slice(s,s+7));const P=()=>{f(new Date(n.getFullYear(),n.getMonth()-1)),A(L,50)},V=()=>{f(new Date(n.getFullYear(),n.getMonth()+1)),A(L,50)};return t.jsx("div",{style:d(e).container,children:t.jsxs("div",{style:d(e).panel,children:[t.jsxs("div",{style:d(e).calendarHead,children:[t.jsx("h1",{style:d(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:P,children:t.jsx("h1",{style:d(e).header,children:"<"})}),t.jsx("div",{onClick:V,children:t.jsx("h1",{style:d(e).header,children:">"})})]}),t.jsxs("table",{style:d(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:C[i].map(s=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:s==="Вс"||s==="Sun"?"#873535ff":a.get("subText",e)},children:s})},s))})}),t.jsx("tbody",{children:O.map((s,j)=>t.jsx("tr",{children:s.map((x,N)=>{const k=n.getMonth(),M=n.getFullYear(),X=x===r.getDate()&&k===r.getMonth()&&M===r.getFullYear(),R=S(new Date(M,k,x));let Y="",F=0;if(Object.keys(l.habitsByDate).includes(R)){const E=Array.from(Object.values(l.habitsByDate[R])),K=E.length,G=E.filter(_=>_===1).length,B=K>0?Math.round(G/K*100):0;Y=B+"%",F=B>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...d(e).cell,border:`3px solid ${X?a.get("currentDateBorder",e):a.get("background",e)}`,backgroundColor:x<1?a.get("background",e):F===1?a.get("habitCardDone",e):F===-1?a.get("habitCardSkipped",e):a.get("background",e)},onClick:()=>{b(new Date(M,k,x)),v(l.hasKey(S(new Date(M,k,x)))),A(le,50)},children:[x,x>0&&t.jsx("div",{style:{fontSize:"8px",color:a.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:Y})]})},N)})},j))})]}),t.jsxs("div",{style:{position:"fixed",top:"120%",left:"20%",fontSize:"14px",fontFamily:"Segoe UI",color:a.get("simplePanel",e)},children:[" ",i===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:p&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${a.get("border",e)}`},children:[t.jsx("h1",{style:{...d(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear()+" "+g[i][re(r)]}),t.jsx("div",{style:{fontSize:"10px",color:a.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:he(r,i)})]}),t.jsx("div",{style:d(e).scrollView,children:t.jsx(ge,{theme:e,langIndex:i,date:r})})]})})]})})},ge=({theme:e,langIndex:o,date:u})=>{const c=S(u);return l.hasKey(c)?Object.entries(l.habitsByDate[c]).map(([w,n])=>{const f=Number(w),r=ue().find(p=>p.id===f),b=r?r.name[o]:"";return t.jsx(fe,{id:f,name:b,theme:e,date:u,statusInit:n,langIndex:o},`${c}-${w}`)}):null},fe=({id:e,name:o,theme:u,date:c,statusInit:i,langIndex:w})=>{const[n,f]=h.useState(i),[r,b]=h.useState(!0),p=100,v=-100,H=ae(0),D=oe(H,[-1,1],[v,p]);h.useEffect(()=>{f(i)},[i,c]);const T=(z,I)=>{const C=I.offset.x;if(Math.abs(C)>p){if(!r)return;let g=n;if(C>0?n===0?g=1:n===-1&&(g=0):n===0?g=-1:n===1&&(g=0),g!==n){const y=S(c);l.changeStatus(y,e,g),f(g),ne(),g===1?l.prefs[2]==0&&ce.play():g===-1&&l.prefs[2]==0&&de.play(),l.prefs[3]==0&&navigator.vibrate?.(50)}b(!1),W(D,0,{type:"tween",duration:.2})}},$=()=>{W(D,0,{type:"tween",duration:.2}),b(!0)};return t.jsxs(te.div,{id:`cal-${e}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:D},drag:r?"x":!1,dragConstraints:{left:v,right:n===1?0:p},dragElastic:0,onDrag:T,onDragEnd:$,children:[t.jsx("p",{style:{...d(u).text,fontSize:"14px",paddingLeft:"30px"},children:o}),n===1?t.jsx(se,{style:{...d(u).icon,color:"#2e9741ff"}}):n===-1?t.jsx(ie,{style:{...d(u).icon,color:"#973939ff"}}):null]})},d=e=>({container:{backgroundColor:a.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:a.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:a.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:a.get("mainText",e),fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"150vw",position:"absolute",top:"53%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${a.get("border",e)}`,margin:"5px",background:a.get("background",e),boxShadow:`4px 4px 6px ${a.get("shadow",e)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:a.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:a.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function he(e,o){const u=[["привычка","привычки","привычек"],["habit","habits","habits"]],c=S(e);if(l.hasKey(c)){const i=Object.values(l.habitsByDate[c]).length;return i+" "+u[o][i===1?0:i>1&&i<5?1:2]}return"0 "+u[o][2]}function A(e,o){l.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),l.prefs[3]==0&&navigator.vibrate(o)}export{ye as default};
