import{A as a,aT as y}from"./index-DS64HQ_R.js";function p(n){return new Date(n).toISOString().split("T")[0]}function S(n,o,s,e){if(!e||typeof n!="string"||typeof o!="number")return null;const t=s.getTime();let r=null,i=-1/0;for(const[m,l]of Object.entries(e)){const c=new Date(m).getTime();if(!(c>=t))for(const u of l){if(!u.completed)continue;const d=u.exercises?.[n];if(!d||!Array.isArray(d.sets))continue;const f=d.sets[o];!f||typeof f.reps!="number"||typeof f.weight!="number"||c>i&&(i=c,r={type:f.type,reps:f.reps,weight:f.weight,time:f.time})}}return r}async function w(n,o,s){const e=a.programs[o];if(!e||!e.schedule[s])return console.error("Invalid program or dayIndex"),!1;const t={},r=[];e.schedule[s].exercises.forEach(l=>{const g=a.exercises[l.exId];if(!g){console.warn(`Exercise ${l.exId} not found in AppData.exercises`);return}t[l.exId]={mgId:g.mgId,sets:[],totalTonnage:0,completed:!1},r.push(l.exId)});const i=p(n),m={programId:o,dayIndex:s,completed:!1,startTime:Date.now(),endTime:null,duration:0,tonnage:0,exercises:t,exerciseOrder:r};a.trainingLog[i]||(a.trainingLog[i]=[]),a.trainingLog[i].push(m),await y()}async function L(n,o,s,e,t){const r=new Date(n.getFullYear(),n.getMonth(),n.getDate()),i=r.getTime()+e,m=r.getTime()+t,l=m-i,g={},c=[],u=a.programs[o];if(!u||!u.schedule[s]){console.error("Invalid program or dayIndex in addPreviousSession");return}u.schedule[s].exercises.forEach(x=>{const T=a.exercises[x.exId];if(!T){console.warn(`Exercise ${x.exId} not found in AppData.exercises`);return}g[x.exId]={mgId:T.mgId,sets:[],totalTonnage:0,completed:!1},c.push(x.exId)});const d={programId:o,dayIndex:s,completed:!0,startTime:i,endTime:m,duration:l,tonnage:0,exercises:g,exerciseOrder:c},f=p(n);a.trainingLog[f]||(a.trainingLog[f]=[]),a.trainingLog[f].push(d),await y()}async function O(n,o){const s=p(n),e=a.trainingLog[s];if(!e||o<0||o>=e.length)return!1;e.splice(o,1),e.length===0&&delete a.trainingLog[s],await y()}function b(n,o){const s=p(n),e=a.trainingLog[s]?.[o];if(!e||e.completed)return[];e.endTime=Date.now(),e.duration=e.endTime-e.startTime,e.completed=!0,Object.values(e.exercises).forEach(r=>{r.completed=!0}),e.tonnage=Object.values(e.exercises).reduce((r,i)=>r+(i.totalTonnage||0),0);const t=[];return e.exerciseOrder.forEach(r=>{const i=e.exercises[r],m=Number(r),l=a.exercises[m];if(!i||!l||!i.sets?.length)return;const g=i.sets.reduce((d,f)=>f.weight>d.weight?f:d,{weight:0,reps:1}),c=h(g.reps,g.weight);if(isNaN(c)||c<=0)return;const u=l.rm;if(c>u){l.rm=c,l.rmDate=s;const d=c-u;t.push({exId:m,newRm:c,oldRm:u,improvement:d})}}),t}function E(n,o,s){const e=p(n),t=a.trainingLog[e]?.[o];return!t||t.exercises[s]?!1:(t.exercises[s]={mgId:a.exercises[s]?.mgId||0,sets:[],totalTonnage:0,completed:!1},t.exerciseOrder.push(s),!0)}function K(n,o,s){const e=p(n),t=a.trainingLog[e]?.[o];if(!t||!t.exercises[s])return!1;const r=t.exercises[s];return t.tonnage=Math.max(0,t.tonnage-(r.totalTonnage||0)),delete t.exercises[s],t.exerciseOrder&&(t.exerciseOrder=t.exerciseOrder.filter(i=>i!==s)),!0}function v(n,o,s,e,t,r,i){const m=p(n),l=a.trainingLog[m]?.[o],g=l?.exercises?.[s];if(!g)return!1;const u={type:i?0:1,reps:e,weight:t,time:r};g.sets.push(u);const d=e*t;return g.totalTonnage=(g.totalTonnage||0)+d,l.tonnage=(l.tonnage||0)+d,!0}function A(n,o,s,e,t,r,i,m){const l=p(n),g=a.trainingLog[l]?.[o],c=g?.exercises?.[s];if(!c||e<0||e>=c.sets.length)return!1;const u=c.sets[e],d=m?0:1;if(u.reps===t&&u.weight===r&&i===u.time&&u.type===d)return!0;const f=u.reps*u.weight;c.totalTonnage=Math.max(0,(c.totalTonnage||0)-f),g.tonnage=Math.max(0,(g.tonnage||0)-f),u.reps=t,u.weight=r,u.type=d;const x=t*r;return c.totalTonnage=(c.totalTonnage||0)+x,g.tonnage=(g.tonnage||0)+x,!0}function M(n,o,s){const e=p(n),r=a.trainingLog[e]?.[o]?.exercises?.[s];return r?(r.completed=!0,!0):!1}function j(n,o){const s=p(n);return a.trainingLog[s]?.[o]?.tonnage||0}function R(n,o){const s=p(n),e=a.trainingLog[s]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))for(const i of r.sets)t+=i.reps;return t}function N(n,o){const s=p(n),e=a.trainingLog[s]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))t+=r.sets.length;return t}function h(n,o){if(!n||!o||n<1||o<=0)return 0;if(n===1)return o;const s=o*(36/(37-n)),e=o*(1+.0333*n),t=o*Math.pow(n,.1),r=s+e+t;return Math.round(r/3)}const k=()=>{try{const n=a?.trainingLog||{},o=new Date;let s=0;const e=[];for(let t=0;t<7;t++){const r=new Date(o);r.setDate(o.getDate()-t);const i=r.toISOString().split("T")[0];e.push(i)}for(const t of e){const r=n[t];if(Array.isArray(r)){const i=r.filter(m=>m.completed===!0).length;s+=i}}return Math.min(s,7)}catch(n){return console.warn("Error calculating weekly training amount:",n),0}};export{w as a,L as b,M as c,O as d,v as e,S as f,N as g,j as h,R as i,b as j,K as k,E as l,k as m,A as r};
