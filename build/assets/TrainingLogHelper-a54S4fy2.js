import{A as a,y as x}from"./index-CO40VCHR.js";function p(s){return new Date(s).toISOString().split("T")[0]}function D(s,o,n,e){if(!e||typeof s!="string"||typeof o!="number")return null;const t=n.getTime();let r=null,i=-1/0;for(const[d,f]of Object.entries(e)){const c=new Date(d).getTime();if(!(c>=t))for(const u of f){if(!u.completed)continue;const m=u.exercises?.[s];if(!m||!Array.isArray(m.sets))continue;const l=m.sets[o];!l||typeof l.reps!="number"||typeof l.weight!="number"||c>i&&(i=c,r={type:l.type,reps:l.reps,weight:l.weight,time:l.time})}}return r}async function S(s,o,n){const e=a.programs[o];if(!e||!e.schedule[n])return console.error("Invalid program or dayIndex"),!1;const t={},r=[];e.schedule[n].exercises.forEach(f=>{const g=a.exercises[f.exId];if(!g){console.warn(`Exercise ${f.exId} not found in AppData.exercises`);return}t[f.exId]={mgId:g.mgId,sets:[],totalTonnage:0,completed:!1},r.push(f.exId)});const i=p(s),d={programId:o,dayIndex:n,completed:!1,startTime:Date.now(),endTime:null,duration:0,tonnage:0,exercises:t,exerciseOrder:r};a.trainingLog[i]||(a.trainingLog[i]=[]),a.trainingLog[i].push(d),await x()}async function L(s,o,n,e,t){const r=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=r.getTime()+e,d=r.getTime()+t,f=d-i,g={},c=[],u=a.programs[o];if(!u||!u.schedule[n]){console.error("Invalid program or dayIndex in addPreviousSession");return}u.schedule[n].exercises.forEach(y=>{const T=a.exercises[y.exId];if(!T){console.warn(`Exercise ${y.exId} not found in AppData.exercises`);return}g[y.exId]={mgId:T.mgId,sets:[],totalTonnage:0,completed:!0},c.push(y.exId)});const m={programId:o,dayIndex:n,completed:!0,startTime:i,endTime:d,duration:f,tonnage:0,exercises:g,exerciseOrder:c},l=p(s);a.trainingLog[l]||(a.trainingLog[l]=[]),a.trainingLog[l].push(m),await x()}async function O(s,o){const n=p(s),e=a.trainingLog[n];if(!e||o<0||o>=e.length)return!1;e.splice(o,1),e.length===0&&delete a.trainingLog[n],await x()}async function b(s,o){const n=p(s),e=a.trainingLog[n]?.[o];if(!e||e.completed)return[];e.endTime=Date.now(),e.duration=e.endTime-e.startTime,e.completed=!0,Object.values(e.exercises).forEach(r=>{r.completed=!0}),e.tonnage=Object.values(e.exercises).reduce((r,i)=>r+(i.totalTonnage||0),0);const t=[];return e.exerciseOrder.forEach(r=>{const i=e.exercises[r],d=Number(r),f=a.exercises[d];if(!i||!f||!i.sets?.length)return;const g=i.sets.reduce((m,l)=>l.weight>m.weight?l:m,{weight:0,reps:1}),c=h(g.reps,g.weight);if(isNaN(c)||c<=0)return;const u=f.rm;if(c>u){f.rm=c,f.rmDate=n;const m=c-u;t.push({exId:d,newRm:c,oldRm:u,improvement:m})}}),await x(),t}async function E(s,o,n){const e=p(s),t=a.trainingLog[e]?.[o];return!t||t.exercises[n]?!1:(t.exercises[n]={mgId:a.exercises[n]?.mgId||0,sets:[],totalTonnage:0,completed:!1},t.exerciseOrder.push(n),await x(),!0)}async function K(s,o,n){const e=p(s),t=a.trainingLog[e]?.[o];if(!t||!t.exercises[n])return!1;const r=t.exercises[n];return t.tonnage=Math.max(0,t.tonnage-(r.totalTonnage||0)),delete t.exercises[n],t.exerciseOrder&&(t.exerciseOrder=t.exerciseOrder.filter(i=>i!==n)),await x(),!0}async function v(s,o,n,e,t,r,i){const d=p(s),f=a.trainingLog[d]?.[o],g=f?.exercises?.[n];if(!g)return!1;const u={type:i?0:1,reps:e,weight:t,time:r};g.sets.push(u);const m=e*t;if(g.totalTonnage=(g.totalTonnage||0)+m,f.tonnage=(f.tonnage||0)+m,g.completed&&!i&&e>0&&t>0){const l=h(e,t),y=a.exercises[n]?.rm||0;l>y&&(a.exercises[n].rm=l,a.exercises[n].rmDate=p(new Date))}return await x(),!0}async function M(s,o,n,e,t,r,i,d){const f=p(s),g=a.trainingLog[f]?.[o],c=g?.exercises?.[n];if(!c||e<0||e>=c.sets.length)return!1;const u=c.sets[e],m=d?0:1;if(u.reps===t&&u.weight===r&&i===u.time&&u.type===m)return!0;const l=u.reps*u.weight;c.totalTonnage=Math.max(0,(c.totalTonnage||0)-l),g.tonnage=Math.max(0,(g.tonnage||0)-l),u.reps=t,u.weight=r,u.type=m;const y=t*r;return c.totalTonnage=(c.totalTonnage||0)+y,g.tonnage=(g.tonnage||0)+y,await x(),!0}async function A(s,o,n){const e=p(s),r=a.trainingLog[e]?.[o]?.exercises?.[n];return r?(r.completed=!0,await x(),!0):!1}function R(s,o){const n=p(s);return a.trainingLog[n]?.[o]?.tonnage||0}function j(s,o){const n=p(s),e=a.trainingLog[n]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))for(const i of r.sets)t+=i.reps;return t}function N(s,o){const n=p(s),e=a.trainingLog[n]?.[o];if(!e)return 0;let t=0;for(const r of Object.values(e.exercises))t+=r.sets.length;return t}function h(s,o){if(!s||!o||s<1||o<=0)return 0;if(s===1)return o;const n=o*(36/(37-s)),e=o*(1+.0333*s),t=o*Math.pow(s,.1),r=n+e+t;return Math.round(r/3)}const k=()=>{try{const s=a?.trainingLog||{},o=new Date;let n=0;const e=[];for(let t=0;t<7;t++){const r=new Date(o);r.setDate(o.getDate()-t);const i=r.toISOString().split("T")[0];e.push(i)}for(const t of e){const r=s[t];if(Array.isArray(r)){const i=r.filter(d=>d.completed===!0).length;n+=i}}return Math.min(n,7)}catch(s){return console.warn("Error calculating weekly training amount:",s),0}};export{S as a,L as b,A as c,O as d,v as e,D as f,N as g,R as h,j as i,b as j,K as k,E as l,k as m,M as r};
