import{c as N,j as t,R as $,r as f,A as l,t as q,f as J,l as Q,C as o,a as L,m as Z,M as _,e as ee}from"./index-BBNEeK_m.js";import{u as te,a as ne,b as U}from"./index-B2SZuRZC.js";const se=N(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),ae=N(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),m=e=>{const r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${r}-${i}-${d}`},oe=e=>(e.getDay()+6)%7;m(new Date);const R=new Audio("Audio/Click.wav"),ie=new Audio("Audio/IsDone.wav"),re=new Audio("Audio/Skip.wav");function le(){return L.concat((l.CustomHabits||[]).filter(e=>!L.some(r=>r.id===e.id)))}const pe=()=>{const[e,r]=$.useState("dark"),[i,d]=f.useState(l.prefs[0]),[n,C]=f.useState(new Date),[g,D]=f.useState(0),[s,p]=f.useState(n),[x,b]=f.useState(!1);$.useEffect(()=>{const a=q.subscribe(r),v=J.subscribe(D);return()=>{a.unsubscribe(),v.unsubscribe()}},[]),$.useEffect(()=>{const a=Q.subscribe(v=>{d(v==="ru"?0:1)});return()=>a.unsubscribe()},[]);const j=new Date(n.getFullYear(),n.getMonth(),1),I=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),w=(j.getDay()+6)%7,A=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],O=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],S=[],M=[];for(let a=0;a<w;a++)S.push(null);for(let a=1;a<=I;a++)S.push(a);for(let a=0;a<S.length;a+=7)M.push(S.slice(a,a+7));const k=()=>{C(new Date(n.getFullYear(),n.getMonth()-1)),y(R)},u=()=>{C(new Date(n.getFullYear(),n.getMonth()+1)),y(R)};return t.jsx("div",{style:c(e).container,children:t.jsxs("div",{style:c(e).panel,children:[t.jsxs("div",{style:c(e).calendarHead,children:[t.jsx("h1",{style:c(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:k,children:t.jsx("h1",{style:c(e).header,children:"<"})}),t.jsx("div",{onClick:u,children:t.jsx("h1",{style:c(e).header,children:">"})})]}),t.jsxs("table",{style:c(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:A[i].map(a=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:g===0?"11px":"13px",color:a==="Вс"||a==="Sun"?"#873535ff":o.get("subText",e)},children:a})},a))})}),t.jsx("tbody",{children:M.map((a,v)=>t.jsx("tr",{children:a.map((h,P)=>{const T=n.getMonth(),F=n.getFullYear(),V=h===s.getDate()&&T===s.getMonth()&&F===s.getFullYear(),Y=m(new Date(F,T,h));let E="",z=0;if(Object.keys(l.habitsByDate).includes(Y)){const K=Array.from(Object.values(l.habitsByDate[Y])),W=K.length,X=K.filter(G=>G>0).length,B=W>0?Math.round(X/W*100):0;E=B+"%",z=B>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...c(e).cell,border:`3px solid ${V?o.get("currentDateBorder",e):o.get("background",e)}`,backgroundColor:h<1?o.get("background",e):z===1?o.get("done",e):z===-1?o.get("skipped",e):o.get("background",e)},onClick:()=>{p(new Date(F,T,h)),b(l.hasKey(m(new Date(F,T,h)))),y(R)},children:[h,h>0&&t.jsx("div",{style:{fontSize:g===0?"8px":"10px",color:o.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:E})]})},P)})},v))})]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:x&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${o.get("border",e)}`},children:[t.jsx("h1",{style:{...c(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()+" "+O[i][oe(s)]}),t.jsx("div",{style:{fontSize:g===0?"10px":"12px",color:o.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:ue(s,i)})]}),t.jsx("div",{style:c(e).scrollView,children:t.jsx(ce,{theme:e,langIndex:i,date:s,fSize:g})})]})})]})})},ce=({theme:e,langIndex:r,date:i,fSize:d})=>{const n=m(i);return l.hasKey(n)?Object.entries(l.habitsByDate[n]).map(([g,D])=>{const s=Number(g),p=le().find(b=>b.id===s),x=p?p.name[r]:"";return t.jsx(de,{id:s,name:x,theme:e,date:i,statusInit:D,langIndex:r,fSize:d},`${n}-${g}`)}):null},de=({id:e,name:r,theme:i,date:d,statusInit:n,langIndex:C,fSize:g})=>{const D=l.choosenHabitsTypes[l.choosenHabits.indexOf(e)],[s,p]=f.useState(n),[x,b]=f.useState(s<2&&!D),j=100,H=-100,I=te(0),w=ne(I,[-1,1],[H,j]);f.useEffect(()=>{p(n)},[n,d]);const A=(S,M)=>{const k=M.offset.x;if(Math.abs(k)>j){if(!x)return;let u=s;if(k>0?s===0?u=1:s===-1&&(u=0):s===0?u=-1:s===1&&(u=0),u!==s){const a=m(d);l.changeStatus(a,e,u),p(u),ee(),u===1?l.prefs[2]==0&&y(ie):u===-1&&l.prefs[2]==0&&y(re),y(null)}b(!1),U(w,0,{type:"tween",duration:.2})}},O=()=>{U(w,0,{type:"tween",duration:.2}),b(!0)};return t.jsxs(Z.div,{id:`cal-${e}`,style:{backgroundColor:s<2?"transparent":o.get("habitCardEnded",i),display:"flex",flexDirection:"row",width:"95%",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:w},drag:x?"x":!1,dragConstraints:{left:H,right:s===1?0:j},dragElastic:0,onDrag:A,onDragEnd:O,children:[t.jsx("p",{style:{...c(i,g).text,paddingLeft:"30px"},children:r}),s>0?s>1?t.jsx(_,{style:{...c(i).icon,color:"#8e972eff"}}):t.jsx(se,{style:{...c(i).icon,color:"#2e9741ff"}}):s===-1?t.jsx(ae,{style:{...c(i).icon,color:"#973939ff"}}):null]})},c=(e,r)=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"95vw",height:"160vw",position:"absolute",top:"51%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,margin:"5px",background:o.get("background",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:o.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:o.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:o.get("mainText",e),fontFamily:"Segoe UI"},text:{fontFamily:"Segoe UI",fontSize:r===0?"13px":"15px",color:o.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:r===0?"11px":"13px",color:o.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function ue(e,r){const i=[["привычка","привычки","привычек"],["habit","habits","habits"]],d=m(e);if(l.hasKey(d)){const n=Object.values(l.habitsByDate[d]).length;return n+" "+i[r][n===1?0:n>1&&n<5?1:2]}return"0 "+i[r][2]}function y(e){l.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),l.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{pe as default};
