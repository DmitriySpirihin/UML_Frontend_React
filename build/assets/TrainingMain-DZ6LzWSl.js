import{R as Te,r as d,A as x,t as De,l as ke,f as Pe,H as M,ax as Me,j as t,C as o,s as z,ay as Y,_ as ze,i as B,k as E,Y as _}from"./index-Cy8ZjU_c.js";import{d as Ie,a as Re,b as Fe}from"./TrainingLogHelper-D3dCovPW.js";import{b as Ae}from"./index-Bfltmu1f.js";import{F as q,a as J}from"./index-C2WIoVIG.js";const h=e=>{const l=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${l}-${i}-${g}`},$e=e=>(e.getDay()+6)%7;h(new Date);const H=new Audio("Audio/Click.wav"),We=()=>{const[e,l]=Te.useState("dark"),[i,g]=d.useState(x.prefs[0]),[r,b]=d.useState(new Date),[c,ee]=d.useState(r),O=d.useRef(c),[te,ne]=d.useState(0),[m,se]=d.useState(x.prefs[4]),[ie,I]=d.useState(!1),[oe,R]=d.useState(!1),[re,F]=d.useState(!1),[w,W]=d.useState(x.getLastProgramId()),[K,U]=d.useState(x.getLastTrainingDayIndex()),[S,v]=d.useState(16*36e5),[C,T]=d.useState(17*36e5),[G,le]=d.useState({date:"",key:0}),f=600*1e3,p=24*36e5;d.useEffect(()=>{const n=De.subscribe(l),a=ke.subscribe(y=>{g(y==="ru"?0:1)}),u=Pe.subscribe(y=>{se(y)});return()=>{n.unsubscribe(),a.unsubscribe(),u.unsubscribe()}},[]);const ae=new Date(r.getFullYear(),r.getMonth(),1),ce=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),de=(ae.getDay()+6)%7,xe=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],ge=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],ue=M(()=>v(n=>(n-f+p)%p)),pe=M(()=>v(n=>(n+f)%p)),he=M(()=>T(n=>{const a=(n-f+p)%p;return a>=S?a:n})),fe=M(()=>T(n=>(n+f)%p)),D=[],V=[];for(let n=0;n<de;n++)D.push(null);for(let n=1;n<=ce;n++)D.push(n);for(let n=0;n<D.length;n+=7)V.push(D.slice(n,n+7));const me=()=>{b(new Date(r.getFullYear(),r.getMonth()-1)),N(H)},ye=()=>{b(new Date(r.getFullYear(),r.getMonth()+1)),N(H)};d.useEffect(()=>{O.current=c},[c]),d.useEffect(()=>{const n=Me.subscribe(()=>{const a=new Date,u=O.current;if(u>a)return;const y=h(u),j=h(a);y===j?I(!0):R(!0)});return()=>n.unsubscribe()},[]);const be=()=>{Re(new Date,w,K),I(!1),setTimeout(()=>{const a=h(new Date),u=x.trainingLog[a].length-1;Y({mode:"new",dayKey:a,dInd:u}),z("TrainingCurrent")},100)},Se=()=>{if(C<=S){_(i===0?"Время окончания должно быть позже начала":"End time must be after start time",2e3,!1);return}Fe(c,w,K,S,C),R(!1);const n=h(c),a=x.trainingLog[n].length-1;Y({mode:"redact",dayKey:n,dInd:a}),z("TrainingCurrent")},je=(n,a)=>{le({date:n,key:a})},we=()=>{Ie(G.date,G.key),F(!1),_(i===0?"Тренировка удалена":"Session deleted",2e3,!0)};return t.jsxs("div",{style:s(e).container,children:[t.jsxs("div",{style:s(e).panel,children:[t.jsxs("div",{style:s(e).calendarHead,children:[t.jsx("h1",{style:s(e).header,children:r.getFullYear()+"/"+(r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1)}),t.jsx("div",{onClick:me,children:t.jsx("h1",{style:s(e).header,children:"<"})}),t.jsx("div",{onClick:ye,children:t.jsx("h1",{style:s(e).header,children:">"})})]}),t.jsxs("table",{style:s(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:xe[i].map(n=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:n==="Вс"||n==="Sun"?"#873535ff":o.get("subText",e)},children:n})},n))})}),t.jsx("tbody",{children:V.map((n,a)=>t.jsx("tr",{children:n.map((u,y)=>{const j=r.getMonth(),A=r.getFullYear(),ve=u===c.getDate()&&j===c.getMonth()&&A===c.getFullYear(),$=h(new Date(A,j,u)),L=$ in x.trainingLog?x.trainingLog[$].length:0;let k=0,P=0;return L>0&&x.trainingLog[$].forEach(Ce=>{Ce.completed?P++:k++}),t.jsx("td",{children:t.jsxs("div",{style:{...s(e).cell,border:`3px solid ${ve?o.get("currentDateBorder",e):o.get("background",e)}`,backgroundColor:o.get("background",e)},onClick:()=>{ee(new Date(Date.UTC(A,j,u))),ne(L),N(H)},children:[u,L>0&&t.jsxs("div",{style:{display:"flex",flexDirection:"row",marginTop:"10px"},children:[k>0&&t.jsx("div",{style:{fontSize:"10px",color:o.get("done",e),lineHeight:"5px"},children:"⏳"}),k>0&&t.jsx("div",{style:{fontSize:"11px",color:o.get("subText",e),lineHeight:"5px"},children:k}),P>0&&t.jsx("div",{style:{fontSize:"10px",color:o.get("done",e),lineHeight:"5px"},children:"✅"}),P>0&&t.jsx("div",{style:{fontSize:"11px",color:o.get("subText",e),lineHeight:"5px"},children:P})]})]})},y)})},a))})]})]}),t.jsxs("div",{style:{display:"flex",marginLeft:"auto",marginRight:"30px"},children:[t.jsx("div",{style:s(e).text,children:i===0?"все тренировки":"all trainings"}),t.jsx(Ae,{style:{...s(e).icon,marginLeft:"20px"},onClick:()=>z("TrainingList")})]}),t.jsxs("div",{style:{height:"30vh",width:"95%",display:"flex",flexDirection:"column",alignContent:"center"},children:[t.jsx("h1",{style:{...s(e).subtext,fontSize:"18px",textAlign:"center"},children:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+ge[i][$e(c)]+" / "+Le(te,i)}),t.jsx("div",{style:s(e).scrollView,children:x.trainingLog[h(c)]?.map((n,a)=>t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%",borderBottom:`1px solid ${o.get("border",e)}`},children:[t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:a+1}),t.jsx("p",{style:{...s(e).mainText,marginBottom:"10px",fontSize:"16px"},children:n.completed?"✅":"⏳"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("div",{onClick:()=>{Y({mode:n.completed?"redact":"new",dayKey:h(new Date(c)),dInd:n.dayIndex}),z("TrainingCurrent")},style:s(e).mainText,children:x.programs.find(u=>u.id===n.programId).name[i]}),t.jsx("div",{style:s(e).mainText,children:(i===0?"День ":"Day ")+(a+1)+": "+x.programs.find(u=>u.id===n.programId).schedule[n.dayIndex].name[i]}),n.completed&&t.jsx("div",{style:{...s(e).subtext,marginBottom:"10px"},children:`${Math.round(n.duration/6e4)}${i===0?" мин":" min"}  /  ${(n.tonnage*.001).toFixed(2)} ${i===0?" тонн":" tons"}${Ye(n,i)}`})]}),t.jsx(ze,{onClick:()=>{je(h(new Date(c)),n.dayIndex),F(!0)},style:{...s(e).subtext,width:"18px",height:"18px",marginLeft:"auto",marginRight:"10px"}})]},a))})]}),re&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"20%"},children:[t.jsx("div",{style:{...s(e,m).text},children:i===0?"Удалить тренировку?":"Delete session?"}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>F(!1)}),t.jsx(E,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>{we()}})]})]})}),ie&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:i===0?"Начать тренировку?":"Start training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>W(Number(n.target.value)),children:Q(e,i)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(Number(n.target.value)),children:X(e,i,m,w)}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>I(!1)}),t.jsx(E,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>{be()}})]})]})}),oe&&t.jsx("div",{style:s(e).confirmContainer,children:t.jsxs("div",{style:{...s(e).cP,height:"50%"},children:[t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:i===0?"Добавить предыдущую тренировку?":"Add previous training?"}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>W(Number(n.target.value)),children:Q(e,i)}),t.jsx("select",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},onChange:n=>U(Number(n.target.value)),children:X(e,i,m,w)}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:i===0?"Начало тренировки":"Training start time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...ue,onClick:()=>v(n=>(n-f+p)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})}),t.jsx("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:Z(S)}),t.jsxs("div",{...pe,onClick:()=>v(n=>(n+f)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:[t.jsx(J,{})," "]})]}),t.jsx("p",{style:{...s(e,m).mainText,marginBottom:"10px"},children:i===0?"Окончание тренировки":"Training end time"}),t.jsxs("div",{style:{...s(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...he,onClick:()=>{const n=(C-f+p)%p;n>=S&&T(n)},style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(q,{})})," ",t.jsxs("p",{style:{...s(e).text,fontSize:"20px",marginTop:"15px"},children:[" ",Z(C)," "]}),t.jsx("div",{...fe,onClick:()=>T(n=>(n+f)%p),style:{...s(e).icon,fontSize:"20px",marginTop:"15px",userSelect:"none",touchAction:"none"},children:t.jsx(J,{})})]}),t.jsxs("div",{style:{...s(e).simplePanelRow,height:"60px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"12px"},children:[t.jsx(B,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>R(!1)}),t.jsx(E,{style:{fontSize:"38px",color:o.get("icons",e)},onClick:()=>{Se()}})]})]})})]})},Q=(e,l,i)=>x.programs.map(g=>t.jsx("option",{value:g.id,style:{...s(e,!1).text},children:g.name[l]},g.id)),X=(e,l,i,g)=>{const r=x.programs.find(b=>b.id===g);return!r||!r.schedule?[t.jsx("option",{value:"",children:"0"},"none")]:r.schedule.map((b,c)=>t.jsx("option",{value:c,style:{...s(e,!1).text},children:b.name[l]},c))},s=(e,l)=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",overflowY:"scroll",justifyContent:"start",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"start",borderBottom:`1px solid ${o.get("border",e)}`},scrollView:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",height:"100%",overflowY:"scroll",backgroundColor:o.get("trainingGroup",e),borderRadius:"12px"},mainText:{textAlign:"left",fontSize:l===0?"13px":"15px",color:o.get("mainText",e),marginLeft:"10px",marginBottom:"2px"},subtext:{textAlign:"left",fontSize:l===0?"11px":"13px",color:o.get("subText",e),marginLeft:"10px",marginBottom:"12px"},calendarHead:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%",height:"10%",background:o.get("headGradient",e)},header:{fontFamily:"Segoe UI",padding:"2vw",marginLeft:"6vw",marginRight:"6vw",fontSize:"36px",fontWeight:"bold",color:o.get("subText",e)},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"13vw",height:"13vw",borderRadius:"12px",fontSize:"16px",fontWeight:"bold",color:o.get("mainText",e),fontFamily:"Segoe UI"},icon:{fontSize:"26px",color:o.get("icons",e)},cP:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",borderRadius:"24px",backgroundColor:o.get("bottomPanel",e),width:"100%",height:"90vh"},confirmContainer:{position:"fixed",top:0,left:-10,bottom:0,width:"95vw",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2900,padding:"20px"},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}});function N(e){x.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),x.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Le=(e,l)=>e==0?l==0?"нет тренировок":"no trainings":e==1?l==0?"1 тренировка":"1 training":e>1&&e<5?e+(l==0?" тренировки":" trainings"):e+(l==0?" тренировок":" trainings"),Z=e=>{const l=Math.floor(e/6e4),i=Math.floor(l/60)%24,g=l%60;return`${i.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`};function Ye(e,l){if(!e?.exercises)return l===0?"0 упр./ 0 подх.":"0 ex./ 0 sets";let i=0,g=0;for(const r of Object.values(e.exercises))i++,Array.isArray(r.sets)&&(g+=r.sets.length);return l===0?` / ${i} упр. / ${g} подх.`:` / ${i} ex. / ${g} sets`}export{We as default,Ye as getTrainingSummary};
