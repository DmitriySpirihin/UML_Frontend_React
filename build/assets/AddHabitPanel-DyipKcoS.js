import{r as i,G as ve,t as Q,l as Z,A as g,y as He,z as Fe,j as t,C as r,B as Re,D as S,E as pe,H as he,I as fe,J as ge,K as ze,L as Be,M as Ye,a as ie,O as G}from"./index-DzjmTqHl.js";import{I as _,a as be}from"./HabitsMain-rNGfFOjp.js";import{b as $e,M as Oe,a as Ue}from"./index-BU5LoWKr.js";import"./index-Dohnsw5r.js";var $=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))($||{}),O=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(O||{});const Ve=["mousedown","mousemove","mouseup","mouseleave","mouseout"],We=["touchstart","touchmove","touchend","touchcancel"],Ne=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function Xe(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Je(e){var o;return Ve.includes((o=e?.nativeEvent)==null?void 0:o.type)}function we(e){var o;return We.includes((o=e?.nativeEvent)==null?void 0:o.type)||"touches"in e}function Ke(e){const{nativeEvent:o}=e;return o?Ne.includes(o?.type)||"pointerId"in o:!1}function ee(e){return Je(e)||we(e)||Ke(e)}function ye(e){var o;const u=we(e)?(o=e?.touches)==null?void 0:o[0]:e;return Xe(u)?{x:u.pageX,y:u.pageY}:null}function Ge(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function F(e,{threshold:o=400,captureEvent:u=!1,detect:a=$.Pointer,cancelOnMovement:x=!1,cancelOutsideElement:C=!0,filterEvents:d,onStart:I,onMove:k,onFinish:D,onCancel:A}={}){const z=i.useRef(!1),P=i.useRef(!1),B=i.useRef(),m=i.useRef(),Y=i.useRef(e),b=i.useRef(null),T=i.useCallback(l=>c=>{P.current||ee(c)&&(d!==void 0&&!d(c)||(u&&c.persist(),I?.(c,{context:l}),b.current=ye(c),P.current=!0,B.current=c.currentTarget,m.current=setTimeout(()=>{Y.current&&(Y.current(c,{context:l}),z.current=!0)},o)))},[u,d,I,o]),p=i.useCallback(l=>(c,y)=>{ee(c)&&P.current&&(b.current=null,u&&c.persist(),z.current?D?.(c,{context:l}):P.current&&A?.(c,{context:l,reason:y??O.CancelledByRelease}),z.current=!1,P.current=!1,m.current!==void 0&&clearTimeout(m.current))},[u,D,A]),E=i.useCallback(l=>c=>{if(ee(c)&&(k?.(c,{context:l}),x!==!1&&b.current)){const y=ye(c);if(y){const v=x===!0?25:x,L={x:Math.abs(y.x-b.current.x),y:Math.abs(y.y-b.current.y)};(L.x>v||L.y>v)&&p(l)(c,O.CancelledByMovement)}}},[p,x,k]),U=i.useCallback(l=>{if(e===null)return{};switch(a){case $.Mouse:{const c={onMouseDown:T(l),onMouseMove:E(l),onMouseUp:p(l)};return C&&(c.onMouseLeave=y=>{p(l)(y,O.CancelledOutsideElement)}),c}case $.Touch:return{onTouchStart:T(l),onTouchMove:E(l),onTouchEnd:p(l)};case $.Pointer:{const c={onPointerDown:T(l),onPointerMove:E(l),onPointerUp:p(l)};return C&&(c.onPointerLeave=y=>p(l)(y,O.CancelledOutsideElement)),c}}},[e,p,C,a,E,T]);return i.useEffect(()=>{function l(c){const y=Ge(c);p()(y)}return window.addEventListener("mouseup",l),window.addEventListener("touchend",l),window.addEventListener("pointerup",l),()=>{window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l),window.removeEventListener("pointerup",l)}},[p]),i.useEffect(()=>()=>{m.current!==void 0&&clearTimeout(m.current)},[]),i.useEffect(()=>{Y.current=e},[e]),U}function te(e){return ve({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function ne(e){return ve({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}const h=new Audio("Audio/Click.wav"),R=()=>ie.concat((g.CustomHabits||[]).filter(e=>!ie.some(o=>o.id===e.id))),se=new Date,ot=()=>{const[e,o]=i.useState(Q.value),[u,a]=i.useState(Z.value),[x,C]=i.useState(!1),[d,I]=i.useState(g.prefs[0]),[k,D]=i.useState(!1),[A,z]=i.useState(""),[P,B]=i.useState(!1),[m,Y]=i.useState(""),[b,T]=i.useState(""),[p,E]=i.useState(""),[U,l]=i.useState("default"),[c,y]=i.useState(-1),[v,L]=i.useState(new Date().getFullYear()),[V,W]=i.useState(new Date().getMonth()),[le,N]=i.useState(new Date().getDate()),[ae,ce]=i.useState(R()),[Ce,de]=i.useState(null),[X,ue]=i.useState(!1),[je,xe]=i.useState(0),[Se,Ie]=i.useState("default"),[J,M]=i.useState(!1),[ke,q]=i.useState({text:d===0?"Добавить":"Add",onClick:()=>re(!1)}),H=(s,w)=>{w===2&&N(oe(s,le,v,V)),w===1?W(j=>s?j+1<12?j+1:0:j-1>-1?j-1:11):w===0&&L(s&&v+1<=se.getFullYear()+2&&v-1>=se.getFullYear()-2?v+1:v-1)},Pe=F(()=>H(!1,0),{threshold:1e3}),De=F(()=>H(!0,0),{threshold:1e3}),Ae=F(()=>H(!1,1),{threshold:700}),Te=F(()=>H(!0,1),{threshold:700}),Ee=F(()=>H(!1,2),{threshold:500}),Le=F(()=>H(!0,2),{threshold:500}),Me=[["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],["January","February","March","April","May","June","July","August","September","October","November","December"]];i.useEffect(()=>{const s=Q.subscribe(o),w=Z.subscribe(a),j=He.subscribe(C);return()=>{s.unsubscribe(),w.unsubscribe(),j.unsubscribe()}},[]),i.useEffect(()=>{const s=Q.subscribe(o),w=Z.subscribe(j=>{I(j==="ru"?0:1)});return()=>{s.unsubscribe(),w.unsubscribe()}},[]),i.useEffect(()=>{ce(R())},[]),i.useEffect(()=>{const s=Fe.subscribe(z);return A==="AddHabitPanel"?setTimeout(()=>xe(1),400):xe(0),()=>{s.unsubscribe()}},[]);const K=(s,w)=>{s.length>0&&(w===0?Y(s[0].toUpperCase()+s.toLowerCase().slice(1)):w===1?T(s[0].toUpperCase()+s.toLowerCase().slice(1)):w===2&&E(s[0].toUpperCase()+s.toLowerCase().slice(1)))};return i.useEffect(()=>{m.length>3&&b.length>3?(M(!0),q({text:d===0?"создать и добавить":"create and add",onClick:()=>me(m,b,p,U)})):M(!1)},[m,b,p,U,d]),t.jsxs("div",{style:{...n(e).container,transform:A==="AddHabitPanel"?"translateX(0)":"translateX(-100%)",backgroundColor:je===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:[!k&&t.jsxs("div",{style:n(e,x).panel,children:[t.jsx("div",{style:n(e).headerText,children:d===0?"добавь привычку":"add habit"}),t.jsxs("div",{style:{...n(e).simplePanel,height:x?"66vh":"52vh"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(Re,{style:{color:r.get("mainText",e),width:"5vw",marginTop:"10px",marginLeft:"10px"}}),t.jsx("input",{type:"text",onFocus:()=>S(!0),onBlur:()=>S(!1),style:{...n(e).input,height:x?"50%":"40%"},onChange:s=>Qe(s.target.value,ae,ce)})]}),t.jsx("div",{style:n(e).scrollView,children:ae.map(s=>!g.choosenHabits.includes(s.id)&&t.jsx("li",{style:{...n(e).text,borderRadius:"24px",backgroundColor:s.id===Ce?r.get("highlitedPanel",e):"transparent"},onClick:()=>{de(s.id),y(s.id),M(!0),f(h),q({text:d===0?"Добавить":"Add",onClick:()=>re(s.id,s.name[d],!1)})},children:t.jsx("p",{style:n(e).text,children:s.name[d]})},s.id))})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{he(""),fe(0),f(h)},children:t.jsx(pe,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!0),M(!1)},children:t.jsx($e,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{J&&(B(!0),f(h))},children:t.jsx(ge,{style:{...n(e).miniIcon,color:J?r.get("icons",e):r.get("iconsDisabled",e)}})})]})]}),k&&t.jsxs("div",{style:n(e,x).panel,children:[t.jsx("div",{style:n(e).headerText,children:d===0?"или создай свою":"or create your own"}),t.jsxs("div",{style:{...n(e).simplePanel,height:x?"66vh":"52vh",justifyContent:"center"},children:[t.jsx("textarea",{maxLength:25,placeholder:d===0?"имя":"name",style:n(e).input,onChange:s=>K(s.target.value,0),onFocus:()=>S(!0),onBlur:()=>S(!1)}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("textarea",{maxLength:25,placeholder:b===""?d===0?"категория":"category":b,style:{...n(e).input,width:"48%"},onChange:s=>K(s.target.value,1),onFocus:()=>S(!0),onBlur:()=>S(!1)}),t.jsx("select",{style:{...n(e).input,width:"48%"},onChange:s=>K(s.target.value,1),children:qe(e,d)})]}),t.jsx("textarea",{maxLength:60,placeholder:d===0?"описание(опционально)":"description(optional)",style:{...n(e).input,height:x?"40%":"25%"},onChange:s=>K(s.target.value,2),onFocus:()=>S(!0),onBlur:()=>S(!1)}),t.jsx("div",{style:n(e).headerText,children:d===0?"выбери иконку(опционально)":"choose icon(optional)"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("div",{style:{width:"80%",marginLeft:"30px",padding:"5px"},children:t.jsxs("div",{style:n(e).button,onClick:()=>ue(!X),children:[!X&&t.jsx(ze,{style:n(e).miniIcon}),X&&t.jsx(Be,{style:n(e).miniIcon})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"20%",height:"100%",padding:"8px"},children:_.getIcon(Se,{size:48,style:{marginRight:"70px",color:r.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{he(""),fe(0),f(h)},children:t.jsx(pe,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!1),M(!1),de(null)},children:t.jsx(Ye,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{J&&(B(!0),f(h))},children:t.jsx(ge,{style:{...n(e).miniIcon,color:J?r.get("icons",e):r.get("iconsDisabled",e)}})})]})]}),X&&t.jsx("div",{style:n(e).selectPanel,children:Object.entries(_.ic).map(([s])=>t.jsx("div",{style:{width:"15%",padding:"12px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",":hover":{backgroundColor:r.get("highlitedPanel",e)}},onClick:()=>{Ie(s),l(s),f(h),ue(!1),m.length>3&&b.length>3&&(M(!0),q({text:d===0?"создать и добавить":"create and add",onClick:()=>{me(m,b,p,s),f(h)}}))},children:_.getIcon(s,{size:32,style:{color:r.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})},s))}),P&&t.jsx("div",{style:n(e).container,children:t.jsxs("div",{style:n(e).confirmationPanel,children:[t.jsx("p",{style:n(e).text,children:Ze(d,k,c,m)}),t.jsxs("div",{style:{...n(e).simplePanelRow,flexDirection:"column",alignItems:"center",backgroundColor:r.get("background",e),width:"90%",borderRadius:"24px"},children:[t.jsx("p",{style:n(e).text,children:d===0?"установите дату":"set date"}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Pe,style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",v," "]}),t.jsx("div",{...De,onClick:()=>{se.getFullYear()+2>=v+1&&L(s=>s+1),f(h)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{style:{userSelect:"none",touchAction:"none"}})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Ae,onClick:()=>{W(s=>s-1>-1?s-1:11),f(h)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",Me[d][V]," "]}),t.jsx("div",{...Te,onClick:()=>{W(s=>s+1<12?s+1:0),f(h)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{style:{userSelect:"none",touchAction:"none"}})})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx("div",{...Ee,onClick:()=>{N(s=>oe(!1,s,v,V)),f(h)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(te,{style:{userSelect:"none",touchAction:"none"}})}),t.jsxs("p",{style:n(e).textDate,children:[" ",le," "]}),t.jsx("div",{...Le,onClick:()=>{N(s=>oe(!0,s,v,V)),f(h)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"},children:t.jsx(ne,{style:{userSelect:"none",touchAction:"none"}})})]})]}),t.jsxs("div",{style:n(e).simplePanelRow,children:[t.jsx("div",{style:n(e).button,onClick:()=>{B(!1),_e(N,W,L),f(h)},children:t.jsx(Oe,{style:n(e).miniIcon})}),t.jsx("div",{style:n(e).button,onClick:()=>{ke.onClick(),f(h)},children:t.jsx(Ue,{style:n(e).miniIcon})})]})]})})]})},qe=(e,o)=>Array.from(new Set(ie.map(a=>a.category[o]))).map(a=>t.jsx("option",{value:a,style:{...n(e).text},children:a},a)),re=(e,o,u)=>{if(typeof be!="function"){console.warn("AddHabitPanel: addHabitFn is not set yet. Ensure HabitsMain is mounted."),G(g.prefs[0]===0?"экран привычек ещё не готов":"habits screen not ready yet",2e3,!1);return}if(g.IsHabitInChoosenList(e)){G(g.prefs[0]===0?"привычка уже в списке":"habit already in list",2500,!1);return}be(e);const a=u?g.prefs[0]===0?`привычка: ${o} создана и добавлена`:`habit: ${o} was created and added`:g.prefs[0]===0?"привычка добавлена":"habit added";G(a,2500,!0)},me=(e,o,u,a)=>{const x=R(),d=(x.length>0?Math.max(...x.map(I=>I.id)):0)+1;g.IsCustomHabitExists(d)?G(g.prefs[0]===0?"привычка с таким названием уже существует":"habit with this name already exists",2500,!1):(g.AddCustomHabit(e,o,u,a,d),setTimeout(()=>{re(d,e,!0)},100))},Qe=(e,o,u)=>{if(e.length>0){const a=R().filter(x=>x.name[g.prefs[0]].toLowerCase().startsWith(e.toLowerCase()));u(a)}else{const a=R();o.length!=a.length&&u(a)}},n=(e,o)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9900,padding:"20px"},panel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",overflow:"hidden",boxSizing:"border-box",overflowY:"scroll",border:`1px solid ${r.get("border",e)}`,margin:"5px",backgroundColor:r.get("simplePanel",e),boxShadow:`4px 4px 6px ${r.get("shadow",e)}`,width:"85vw",height:o?"85vh":"65vh"},confirmationPanel:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${r.get("border",e)}`,margin:"5px",backgroundColor:r.get("simplePanel",e),boxShadow:`4px 4px 6px ${r.get("shadow",e)}`,width:"85vw",height:"80vw"},text:{textAlign:"center",fontSize:"12px",color:r.get("mainText",e),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:r.get("mainText",e),marginBottom:"4px"},headerText:{textAlign:"center",margin:"5px",padding:"5px",fontSize:"14px",color:r.get("subText",e)},scrollView:{overflowY:"auto",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"},simplePanel:{marginLeft:"7.5vw",width:"70vw",height:"30vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch",background:"rgba(0, 0, 0, 0.1)",borderRadius:"24px"},input:{width:"65vw",height:o?"6vh":"3vh",borderRadius:"12px",border:`1px solid ${r.get("border",e)}`,margin:"12px",fontSize:"14px",fontFamily:"Segoe UI",color:r.get("subText",e),backgroundColor:r.get("inputField",e)},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",userSelect:"none",touchAction:"none"},select:{width:"20vw",height:"6vw",borderRadius:"12px",border:`1px solid ${r.get("border",e)}`,marginTop:"12px",fontSize:"14px",color:r.get("subText",e),backgroundColor:r.get("habitCard",e)},selectOption:{color:r.get("subText",e),backgroundColor:r.get("habitCard",e),fontSize:"8px"},selectPanel:{backgroundColor:r.get("habitCard",e),borderRadius:"24px",border:`1px solid ${r.get("border",e)}`,position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexWrap:"wrap",width:"77vw",maxHeight:"42vh",overflowY:"auto",padding:"16px",gap:"8px",justifyContent:"center",zIndex:1e3},selectIcon:{flex:"{0,0,33.33%}",width:"20vw",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignContent:"center",justifyContent:"center",width:"15vw",marginTop:"12px",fontSize:"12px"},miniIcon:{fontSize:"28px",padding:"5px",marginTop:"10px",color:r.get("icons",e),userSelect:"none",touchAction:"none",filter:`drop-shadow(0 0px 1px ${r.get("iconsShadow",e)})`}});function f(e){g.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),g.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Ze(e,o,u,a){if(o)return e===0?"добавить привычку "+a+"?":"add habit "+a+"?";{const x=R().find(C=>C.id===u).name[e];return e===0?"добавить привычку "+x+"?":"add habit "+x+"?"}}function oe(e,o,u,a){const x=new Date(u,a,0).getDate();return e?o+1<=x?o+1:1:o-1>0?o-1:x}function _e(e,o,u){const a=new Date;e(a.getDate()),o(a.getMonth()),u(a.getFullYear())}export{ot as default};
