import{r as x,A as m,t as J,l as Q,f as V,j as t,C as o}from"./index-BMUoLOux.js";import{b as X,c as Z}from"./index-BTh6Xgpz.js";const ee=(p,v)=>{const s=new Date(p),b={weekday:"long"},r=v===0?"ru-RU":"en-US";return s.toLocaleDateString(r,b)},te=p=>`${Math.floor(p/6e4)} min`,D=["#00c6ff","#0072ff","#ff416c","#ff4b2b","#38ef7d","#11998e","#f09819","#edde5d","#834d9b","#d04ed6","#1d976c","#93f9b9","#5d29c3","#a968f2","#ff7e5f","#feb47b","#2af598","#009efd","#ff6b6b","#ffa500","#114357","#f29492","#43e97b","#38f9d7","#92fe9d","#00c9ff","#2c3e50","#3498db","#c33764","#1d2671","#ff9a9e","#fecfef","#a8ff78","#78ffd6","#b993d6","#8ca6db","#ff758c","#ff7eb3","#4facfe","#00f2fe"],ie=({needToAdd:p,setEx:v})=>{const[s,b]=x.useState("dark"),[r,B]=x.useState(m.prefs[0]==="ru"?0:1),[c,M]=x.useState(m.prefs[1]),[W,k]=x.useState(null),[d,N]=x.useState(0),[u,L]=x.useState(0),[C,w]=x.useState(0);x.useEffect(()=>{const e=J.subscribe(b),n=Q.subscribe(i=>B(i==="ru"?0:1));return()=>{n.unsubscribe(),e.unsubscribe()}},[]),x.useEffect(()=>{const e=V.subscribe(M);return()=>e.unsubscribe()},[]);const{allTrainings:z,sessionColorMap:P}=x.useMemo(()=>{const e=[],n=new Map;let i=0;for(const[l,f]of Object.entries(m.trainingLog||{}))f.forEach((I,S)=>e.push({date:l,idx:S,session:I}));e.sort((l,f)=>(f.session.startTime||0)-(l.session.startTime||0)),e.forEach(({session:l})=>{const f=`${l.programId||0}-${l.dayIndex||0}`;n.has(f)||(n.set(f,D[i%D.length]),i++)});let a=e;return d===1?a=e.filter(l=>l.session.programId===u):d===2&&(a=e.filter(l=>l.session.programId===u&&l.session.dayIndex===C)),{allTrainings:a,sessionColorMap:n}},[m.trainingLog,d,u,C]),$=x.useMemo(()=>{const e=new Set;return Object.values(m.trainingLog||{}).forEach(n=>n.forEach(i=>e.add(i.programId||0))),Array.from(e).map(n=>{const i=m.programs.find(a=>a.id===n);return{id:n,name:i?.name?.[r]||`Program ${n}`}}).sort((n,i)=>n.name.localeCompare(i.name))},[r]),j=x.useMemo(()=>{if(d!==2||u==null)return[];const n=m.programs.find(i=>i.id===u)?.schedule||[];return n.map((i,a)=>({index:a,name:n[a]?.name?.[r]||`Day ${a+1}`}))},[d,u,r]),F=r===0?"все":"all",R=r===0?"программа":"program",U=r===0?"день":"day";return t.jsxs("div",{style:g(s).container,children:[t.jsxs("div",{style:g(s).filterContainer,children:[t.jsx("div",{style:g(s).textToggles,children:[{key:0,label:F},{key:1,label:R},{key:2,label:U}].map(({key:e,label:n})=>t.jsxs("span",{onClick:()=>{N(e),e!==0&&($.length>0&&u===0&&L($[0].id),e===2&&j.length>0&&w(j[0]?.index||0))},style:{padding:"6px 8px",cursor:"pointer",fontSize:d===e?c===0?"14px":"16px":c===0?"13px":"14px",fontWeight:d===e?"600":"400",color:d===e?o.get("mainText",s):o.get("subText",s),opacity:d===e?1:.8,transition:"all 0.2s ease"},children:[n,e<2&&t.jsx("span",{style:{margin:"0 10px",color:o.get("border",s),fontSize:c===0?"13px":"15px"},children:"|"})]},e))}),(d===1||d===2)&&t.jsx("select",{value:u,onChange:e=>{const n=Number(e.target.value);L(n),d===2&&j.length>0&&w(j[0]?.index||0)},style:g(s).select,children:$.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),d===2&&t.jsx("select",{value:C,onChange:e=>w(Number(e.target.value)),style:g(s).select,children:j.map(e=>t.jsx("option",{value:e.index,children:e.name},e.index))})]}),z.length>0?z.map(e=>{const{date:n,idx:i,session:a}=e,l=`${n}-${i}`,f=W===l,I=a.programId||0,S=a.dayIndex||0,O=`${I}-${S}`,G=P.get(O)||D[0],E=m.programs.find(y=>y.id===I),K=E?.name?.[r]||`Program ${I}`,Y=E?.schedule?.[S]?.name?.[r]||`Day ${S+1}`;return t.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{...g(s,!1,!1,c).sessionPanel,borderTop:`3px ridge ${G}`,backgroundColor:f?o.get("trainingGroupSelected",s):o.get("bottomPanel",s),paddingLeft:"12px",paddingRight:"12px",cursor:"pointer"},onClick:()=>k(f?null:l),children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:g(s,!1,!1,c).text,children:[n," • ",ee(n,r)]}),t.jsxs("div",{style:g(s,!1,!1,c).subtext,children:[K," • ",Y]})]}),f?t.jsx(X,{size:20,color:o.get("icons",s),style:{marginRight:"20px"}}):t.jsx(Z,{size:20,color:o.get("icons",s),style:{marginRight:"20px"}})]}),f&&t.jsxs("div",{style:{width:"100%",paddingLeft:"12px",paddingRight:"12px",paddingBottom:"12px"},children:[t.jsxs("div",{style:g(s,!1,!1,c).subtext,children:[te(a.duration||0)," • ",(a.tonnage/1e3).toFixed(2)," ",r===0?"тонн":"tons"]}),Object.entries(a.exercises||{}).filter(([y,T])=>T?.sets?.length>0).map(([y,T])=>{const _=parseInt(y,10),q=m.exercises.find(h=>h.id===_)?.name?.[r]||`Exercise ${y}`;return t.jsxs("div",{style:{...g(s,!1,!1,c).exercisesPanel,backgroundColor:o.get("background",s),borderBottom:`1px solid ${o.get("border",s)}`,width:"100%"},children:[t.jsxs("div",{style:{fontSize:c===0?"13px":"15px",color:o.get("mainText",s),marginBottom:"6px"},children:[q,t.jsxs("span",{style:{...g(s,!1,!1,c).subtext,marginLeft:"20px"},children:[(T.totalTonnage/1e3).toFixed(2)," ",r===0?"тонн":"tons"]})]}),T.sets.map((h,A)=>{const H=h.type===0?o.get("trainingIsolatedFont",s):o.get("trainingBaseFont",s);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:c===0?"13px":"15px",color:H,fontWeight:"500",borderBottom:`1px solid ${o.get("border",s)}`,marginTop:"4px"},children:[t.jsxs("span",{children:[A+1,":"]}),t.jsx("span",{children:h.weight}),t.jsx("span",{children:r===0?"кг":"kg"}),t.jsx("span",{children:"×"}),t.jsx("span",{children:h.reps}),h.time!=null&&h.time>0&&t.jsxs("span",{children:["(",Math.round(h.time/1e3),"s)"]})]},A)})]},y)})]})]},l)}):t.jsx("div",{style:{padding:"32px 20px",color:o.get("subText",s),fontSize:c===0?"13px":"15px",textAlign:"center"},children:r===0?"Тренировки не найдены":"No trainings found"})]})},g=(p,v,s,b)=>({container:{backgroundColor:o.get("background",p),display:"flex",flexDirection:"column",overflowY:"auto",alignItems:"center",height:"78vh",paddingTop:"5vh",width:"100vw",fontFamily:"Segoe UI",boxSizing:"border-box",padding:"0 8px"},filterContainer:{display:"flex",gap:"12px",paddingTop:"12px",width:"95%",maxWidth:"800px",flexWrap:"wrap",justifyContent:"center",marginBottom:"16px"},textToggles:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",padding:"8px 0",width:"100%",maxWidth:"400px",userSelect:"none"},select:{borderBottom:`1px solid ${o.get("border",p)}`,backgroundColor:o.get("background",p),color:o.get("subText",p),fontSize:b===0?"11px":"13px",width:"80%",borderTop:"none",borderLeft:"none",borderRight:"none",outline:"none"},sessionPanel:{display:"flex",flexDirection:"row",width:"100%",maxWidth:"800px",height:"6vh",alignItems:"center",justifyContent:"center"},exercisesPanel:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"800px",alignItems:"flex-start",justifyContent:"flex-start"},text:{textAlign:"left",fontSize:b===0?"13px":"15px",color:o.get("mainText",p),marginBottom:"4px"},subtext:{textAlign:"left",fontSize:b===0?"11px":"13px",color:o.get("subText",p),marginBottom:"4px"}});export{ie as default};
