import{bk as J,A as O,t as re,l as ie,f as le,ab as S,a as q,j as e,C as de,m as z,bl as ce,bm as pe,d as xe}from"./index-BZVXE0o6.js";import{r as s}from"./recharts-k8ghPecL.js";import{m as ue,u as ge,n as me,o as he}from"./TrainingLogHelper-CxxaY6kw.js";import{b as fe,c as ye,d as be,e as ve,f as je,g as Se,h as we}from"./index-B9xXHnIa.js";import{S as L}from"./ScrollPicker-Bz_uVKSf.js";const Ce=new J("RUNNING"),Ie=new J({mode:"new",dayKey:"",dInd:null}),B=({value:r,onChange:N,min:t,max:f,step:W=1,color:y,marks:g=[],label:w})=>{const m=s.useRef(null),[h,b]=s.useState(!1),D=s.useRef(0),x=s.useRef(r);s.useEffect(()=>{x.current=r},[r]),s.useEffect(()=>()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",u,{passive:!1}),document.removeEventListener("touchend",l),document.removeEventListener("touchcancel",l)},[]);const C=i=>{if(!m.current)return r;const d=m.current.getBoundingClientRect(),c=i-d.left,E=Math.max(0,Math.min(100,c/d.width*100)),k=t+E/100*(f-t),F=Math.round(k/W)*W;return Math.max(t,Math.min(f,F))},v=i=>{i.preventDefault(),b(!0);const d=i.clientX||i.touches?.[0]?.clientX;D.current=d,x.current=C(d),N(x.current),document.addEventListener("mousemove",u),document.addEventListener("mouseup",l),document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",l),document.addEventListener("touchcancel",l)},u=i=>{if(!h||!m.current)return;i.preventDefault();const d=i.clientX||i.touches?.[0]?.clientX,c=C(d);c!==x.current&&(x.current=c,N(c))},l=()=>{b(!1),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",l),document.removeEventListener("touchcancel",l)},I=(r-t)/(f-t)*100;return e.jsxs("div",{style:{width:"100%",marginTop:"12px"},children:[e.jsxs("div",{ref:m,style:{position:"relative",height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",cursor:h?"grabbing":"pointer",overflow:"hidden",touchAction:"none"},onMouseDown:v,onTouchStart:v,children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${I}%`,background:`linear-gradient(90deg, ${y}88, ${y})`,borderRadius:"4px",transition:h?"none":"width 0.15s cubic-bezier(0.165, 0.84, 0.44, 1)"}}),e.jsx("div",{style:{position:"absolute",left:`${I}%`,top:"50%",transform:"translate(-50%, -50%)",width:"28px",height:"28px",borderRadius:"50%",background:"#fff",border:`3px solid ${y}`,boxShadow:h?`0 0 0 8px ${y}30, 0 4px 15px rgba(0,0,0,0.3)`:"0 4px 12px rgba(0,0,0,0.25)",transition:"all 0.15s ease",pointerEvents:"none",zIndex:2}}),g.map((i,d)=>{const c=(i.value-t)/(f-t)*100;return e.jsx("div",{style:{position:"absolute",left:`${c}%`,top:"50%",transform:"translateX(-50%)",width:"3px",height:"10px",background:"rgba(255,255,255,0.7)",borderRadius:"1px"}},d)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"14px",color:"rgba(255,255,255,0.85)",userSelect:"none"},children:[e.jsx("span",{children:t}),e.jsxs("span",{style:{fontWeight:"700",color:"#fff",background:`${y}20`,padding:"2px 8px",borderRadius:"12px"},children:[r,w]}),e.jsx("span",{children:f})]})]})},Fe=()=>{const[r,N]=s.useState("dark"),[t,f]=s.useState(O.prefs[0]),[W,y]=s.useState(O.prefs[4]),[g,w]=s.useState("RUNNING"),[m,h]=s.useState(new Date),[b,D]=s.useState(5),[x,C]=s.useState(0),[v,u]=s.useState(0),[l,I]=s.useState(30),[i,d]=s.useState(0),[c,E]=s.useState(140),[k,F]=s.useState(170),[M,A]=s.useState(7),[$,H]=s.useState(""),[j,G]=s.useState("new"),[R,V]=s.useState(null),[Q,_]=s.useState(!1),K=s.useRef(!0);s.useEffect(()=>{const n=[re.subscribe(N),ie.subscribe(a=>f(a==="ru"?0:1)),le.subscribe(y),Ie.subscribe(a=>{a.mode==="edit"&&a.dayKey&&a.dInd!==null&&a.dInd!==void 0?(G("edit"),se(a.dayKey,a.dInd)):a.mode==="new"&&a.dayKey?(G("new"),h(U(a.dayKey)),X()):(G("new"),T())}),Ce.subscribe(a=>{K.current&&(w(a),K.current=!1),w(a)})];return()=>n.forEach(a=>a.unsubscribe())},[]);const U=n=>{const[a,o,P]=n.split("-").map(Number);return new Date(a,o-1,P+1)},Y=s.useMemo(()=>({RUNNING:{label:t===0?"Бег":"Running",color:"#917237",gradient:"linear-gradient(120deg, #8b5325, #a52c00)"},CYCLING:{label:t===0?"Велосипед":"Cycling",color:"#468932",gradient:"linear-gradient(120deg, #368a36, #00842a)"},SWIMMING:{label:t===0?"Плавание":"Swimming",color:"#407a97",gradient:"linear-gradient(120deg, #2f3d7d, #201c70)"},GYM:{label:t===0?"Силовая":"Strength",color:"#9D4EDD",gradient:"linear-gradient(120deg, #9d4edd, #7209b7)"}}),[t]),p=Y[g]||Y.RUNNING,Z=s.useMemo(()=>Array.from({length:51},(n,a)=>a),[]),ee=s.useMemo(()=>Array.from({length:10},(n,a)=>a*100),[]),te=s.useMemo(()=>Array.from({length:6},(n,a)=>a),[]),ne=s.useMemo(()=>Array.from({length:60},(n,a)=>a),[]),se=s.useCallback(async(n,a)=>{try{_(!0);const o=await ue(n,a);o&&(V(`${n}_${a}`),h(U(n)),w(o.type||"RUNNING"),D(Math.floor(o.distance)),C(Math.round(o.distance%1*1e3)),u(Math.floor(o.duration/60)),I(o.duration%60),d(o.elevationGain||0),E(o.avgHeartRate||140),F(o.avgCadence||170),A(o.rpe||7),H(o.notes||""))}catch(o){console.error("Load error:",o),S(t===0?"Ошибка загрузки":"Load error",2e3,!1)}finally{_(!1)}},[t]),X=s.useCallback(()=>{D(5),C(0),u(0),I(30),d(0),E(140),F(170),A(7),H("")},[]),T=s.useCallback(()=>{X(),w("RUNNING"),h(U(new Date().toISOString().split("T")[0])),V(null)},[X]),ae=s.useCallback(()=>{const n=b+x/1e3,a=v*60+l;if(a<=0||n<=0){S(t===0?"Дистанция и длительность > 0":"Distance & duration > 0",2e3,!1);return}const o={type:g,distance:n,duration:a,elevationGain:i,avgCadence:k,avgHeartRate:c,rpe:M,notes:$,startTime:16*36e5};try{j==="edit"&&R?(ge(R,o),S(t===0?"✅ Обновлено!":"✅ Updated!",1500,!0)):(me(m,g,n,a,o.startTime,o),S(t===0?"✅ Добавлено!":"✅ Added!",1500,!0)),setTimeout(()=>{T(),q("TrainingMain")},400)}catch(P){console.error("Save error:",P),S(t===0?"❌ Ошибка сохранения":"❌ Save error",2e3,!1)}},[b,x,v,l,i,c,k,M,$,g,m,j,R,t,T]),oe=s.useCallback(()=>{if(!(j!=="edit"||!R)&&window.confirm(t===0?"Вы уверены, что хотите удалить эту тренировку?":"Are you sure you want to delete this session?"))try{he(R),S(t===0?"✅ Удалено!":"✅ Deleted!",1500,!0),setTimeout(()=>{T(),q("TrainingMain")},400)}catch(n){console.error("Delete error:",n),S(t===0?"❌ Ошибка удаления":"❌ Delete error",2e3,!1)}},[j,R,t,T]);return e.jsxs("div",{style:{backgroundColor:de.get("background",r),display:"flex",flexDirection:"column",alignItems:"center",height:"90vh",marginTop:"100px",width:"100vw",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",overflowY:"scroll",paddingTop:"10px",overflowX:"hidden"},children:[e.jsx(z.header,{style:{background:p.gradient,width:"100vw",height:"100px",top:0,zIndex:100,boxShadow:"0 10px 30px rgba(0,0,0,0.25)",borderBottomLeftRadius:"32px",borderBottomRightRadius:"32px"},initial:{y:-30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.4},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",gap:"16px"},children:[e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"15px",color:"rgba(255,255,255,0.85)",fontWeight:"500",margin:"9px"},children:m.toLocaleDateString(t===0?"ru-RU":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("h1",{style:{fontSize:"18px",fontWeight:"800",color:"#fff",margin:5,textShadow:"0 2px 6px rgba(0,0,0,0.3)"},children:j==="edit"?t===0?"Редактировать тренировку: "+p.label:"Edit Session: "+p.label:t===0?"Новая тренировка: "+p.label:"New Session: "+p.label})]}),j==="edit"&&e.jsx(z.button,{whileTap:{scale:.9},onClick:oe,style:{width:"52px",height:"52px",borderRadius:"18px",background:"rgba(255,255,255,0.15)",border:"none",cursor:"pointer",backdropFilter:"blur(8px)"},children:e.jsx(ce,{size:26,color:"#ff5252"})})]})}),e.jsx("div",{style:{minWidth:"85vw",maxWidth:"600px",margin:"24px auto 0",padding:"0 24px",display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs(z.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"800",marginBottom:"24px",color:r==="dark"?"#e6e6ff":"#1a1a2e",textAlign:"center"},children:t===0?"Параметры тренировки":"Session Metrics"}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(fe,{size:18,color:p.color}),t===0?"Дистанция":"Distance"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:p.color},children:[b," km ",x," m"]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(L,{items:Z.map(n=>n.toString()),value:b.toString(),onChange:n=>D(parseInt(n)),theme:r,width:"100%",itemHeight:44})}),e.jsx("div",{style:{flex:1},children:e.jsx(L,{items:ee.map(n=>n.toString()),value:x.toString(),onChange:n=>C(parseInt(n)),theme:r,width:"100%",itemHeight:44})})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ye,{size:18,color:p.color}),t===0?"Длительность":"Duration"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:p.color},children:[v,"h ",l.toString().padStart(2,"0"),"m"]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(L,{items:te.map(n=>n.toString()),value:v.toString(),onChange:n=>u(parseInt(n)),theme:r,width:"100%",itemHeight:44})}),e.jsx("div",{style:{flex:1},children:e.jsx(L,{items:ne.map(n=>n.toString()),value:l.toString(),onChange:n=>I(parseInt(n)),theme:r,width:"100%",itemHeight:44})})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(be,{size:18,color:"#FF9E6D"}),t===0?"Набор высоты":"Elevation"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:"#FF9E6D"},children:[i," m"]})]}),e.jsx(B,{value:i,onChange:d,min:0,max:500,step:5,color:"#FF9E6D",marks:[{value:0},{value:250},{value:500}]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ve,{size:18,color:"#FF6B9D"}),t===0?"Пульс":"Heart Rate"]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:"#FF6B9D"},children:[c," bpm"]})]}),e.jsx(B,{value:c,onChange:E,min:60,max:180,step:1,color:"#FF6B9D",marks:[{value:60},{value:120},{value:180}]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(je,{size:18,color:"#4CC9F0"}),t===0?"Каденс":"Cadence",e.jsx("span",{style:{fontSize:"12px",fontWeight:"500",color:"#888",background:"rgba(0,0,0,0.03)",padding:"1px 6px",borderRadius:"10px",marginLeft:"6px"},children:g==="RUNNING"?"spm":g==="CYCLING"?"rpm":"spm"})]}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"700",color:"#4CC9F0"},children:k})]}),e.jsx(B,{value:k,onChange:F,min:50,max:200,step:1,color:"#4CC9F0",marks:[{value:50},{value:125},{value:200}]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Se,{size:18,color:"#FFA500"}),t===0?"Воспр. (RPE)":"Effort (RPE)"]}),e.jsxs("span",{style:{fontSize:"20px",fontWeight:"800",color:"#FFA500",background:"rgba(255, 165, 0, 0.15)",padding:"3px 12px",borderRadius:"16px"},children:[M,"/10"]})]}),e.jsx(B,{value:M,onChange:A,min:1,max:10,step:1,color:"#FFA500",marks:[{value:1},{value:5},{value:10}]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"13px",color:r==="dark"?"#aaa":"#666"},children:[e.jsx("span",{children:t===0?"Легко":"Easy"}),e.jsx("span",{children:t===0?"Тяжело":"Hard"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx(we,{size:18,color:"#A0A0A0"}),t===0?"Заметки":"Notes"]}),e.jsx("textarea",{value:$,onChange:n=>H(n.target.value),placeholder:t===0?"Как прошла тренировка? Погода, ощущения...":"How was your session? Weather, feelings...",style:{width:"90%",minHeight:"90px",padding:"16px",borderRadius:"20px",border:`2px solid ${r==="dark"?"rgba(100,100,150,0.4)":"rgba(0,0,0,0.08)"}`,background:r==="dark"?"rgba(40,40,70,0.7)":"rgba(255,255,255,0.9)",color:r==="dark"?"#e6e6ff":"#1a1a2e",fontSize:"16px",fontFamily:"inherit",resize:"vertical",transition:"all 0.25s ease"}})]})]})}),e.jsx(z.footer,{style:{bottom:0,width:"100%",padding:"16px 24px 32px",display:"flex",justifyContent:"center",background:"transparent",zIndex:90},initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.4,delay:.2},children:e.jsxs(z.button,{whileTap:{scale:.97},whileHover:{scale:1.02},onClick:ae,style:{background:p.gradient,color:"#fff",border:"none",borderRadius:"28px",width:"90%",maxWidth:"560px",height:"68px",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",fontSize:"18px",fontWeight:"700",cursor:"pointer",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",backdropFilter:"blur(12px)"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(pe,{size:22,style:{transform:"rotate(180deg)"}})}),j==="edit"?t===0?"Сохранить изменения":"Save Changes":t===0?"Добавить тренировку":"Add Session"]})}),e.jsx("div",{style:{marginBottom:"150px"}}),e.jsx(xe,{children:Q&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:r==="dark"?"rgba(15,15,27,0.95)":"rgba(248,249,255,0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,backdropFilter:"blur(10px)"},children:e.jsx("div",{style:{width:"50px",height:"50px",border:"3px solid rgba(255,255,255,0.2)",borderTopColor:p.color,borderRadius:"50%",animation:"spin 0.9s linear infinite"}})})})]})};export{Ce as cardioType$,Fe as default,Ie as trainInfo$};
