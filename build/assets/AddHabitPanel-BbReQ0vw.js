import{r as a,t as P,l as A,A as c,R as oe,y as re,z as le,j as t,C as i,B as ce,D as u,E as M,G as K,H as Y,I as X,J as de,K as pe,L as ue,a as L,M as v}from"./index-B1c8uhiT.js";import{I as T,a as q}from"./HabitsMain-26oO7sX2.js";import{b as xe}from"./index-Bi1rtS3K.js";import"./index-CBABgV-K.js";const g=new Audio("Audio/Click.wav"),m=()=>L.concat((c.CustomHabits||[]).filter(e=>!L.some(r=>r.id===e.id))),we=()=>{const[e,r]=a.useState(P.value),[p,l]=a.useState(A.value),[d,z]=a.useState(!1),[o,S]=a.useState(c.prefs[0]),[B,D]=a.useState(!1),[E,J]=a.useState(""),[y,Q]=a.useState(""),[x,Z]=a.useState(""),[I,_]=a.useState(""),[R,ee]=a.useState("default"),[fe,te]=a.useState(-1),[$,V]=a.useState(m()),[se,N]=a.useState(null),[C,O]=a.useState(!1),[ne,U]=a.useState(0),[ie,ae]=a.useState("default"),[w,h]=a.useState(!1),[W,k]=a.useState({text:o===0?"Добавить":"Add",onClick:()=>F(!1)});oe.useEffect(()=>{const s=P.subscribe(r),b=A.subscribe(l),H=re.subscribe(z);return()=>{s.unsubscribe(),b.unsubscribe(),H.unsubscribe()}},[]),a.useEffect(()=>{const s=P.subscribe(r),b=A.subscribe(H=>{S(H==="ru"?0:1)});return()=>{s.unsubscribe(),b.unsubscribe()}},[]),a.useEffect(()=>{V(m())},[]),a.useEffect(()=>{const s=le.subscribe(J);return E==="AddHabitPanel"?setTimeout(()=>U(1),400):U(0),()=>{s.unsubscribe()}},[]);const j=(s,b)=>{s.length>0&&(b===0?Q(s[0].toUpperCase()+s.toLowerCase().slice(1)):b===1?Z(s[0].toUpperCase()+s.toLowerCase().slice(1)):b===2&&_(s[0].toUpperCase()+s.toLowerCase().slice(1)))};return a.useEffect(()=>{y.length>3&&x.length>3?(h(!0),k({text:o===0?"создать и добавить":"create and add",onClick:()=>G(y,x,I,R)})):h(!1)},[y,x,I,R,o]),t.jsxs("div",{style:{...n(e).container,transform:E==="AddHabitPanel"?"translateX(0)":"translateX(-100%)",backgroundColor:ne===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:[!B&&t.jsxs("div",{style:n(e,d).panel,children:[t.jsx("div",{style:n(e).headerText,children:o===0?"добавь привычку":"add habit"}),t.jsxs("div",{style:{...n(e).simplePanel,height:d?"66vh":"52vh"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(ce,{style:{color:i.get("mainText",e),width:"5vw",marginTop:"10px",marginLeft:"10px"}}),t.jsx("input",{type:"text",onFocus:()=>u(!0),onBlur:()=>u(!1),style:{...n(e).input,height:d?"50%":"40%"},onChange:s=>ge(s.target.value,$,V)})]}),t.jsx("div",{style:n(e).scrollView,children:$.map(s=>t.jsx("li",{style:{...n(e).text,borderRadius:"24px",backgroundColor:s.id===se?i.get("highlitedPanel",e):"transparent"},onClick:()=>{N(s.id),te(s.id),h(!0),f(g),k({text:o===0?"Добавить":"Add",onClick:()=>F(s.id,s.name[o],!1)})},children:t.jsx("p",{style:n(e).text,children:s.name[o]})},s.id))})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{K(""),Y(0),f(g)},children:t.jsx(M,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!0),h(!1)},children:t.jsx(xe,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{w&&(W.onClick(),f(g))},children:t.jsx(X,{style:{...n(e).miniIcon,color:w?i.get("icons",e):i.get("iconsDisabled",e)}})})]})]}),B&&t.jsxs("div",{style:n(e,d).panel,children:[t.jsx("div",{style:n(e).headerText,children:o===0?"или создай свою":"or create your own"}),t.jsxs("div",{style:{...n(e).simplePanel,height:d?"66vh":"52vh",justifyContent:"center"},children:[t.jsx("textarea",{maxLength:25,placeholder:o===0?"имя":"name",style:n(e).input,onChange:s=>j(s.target.value,0),onFocus:()=>u(!0),onBlur:()=>u(!1)}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("textarea",{maxLength:25,placeholder:x===""?o===0?"категория":"category":x,style:{...n(e).input,width:"48%"},onChange:s=>j(s.target.value,1),onFocus:()=>u(!0),onBlur:()=>u(!1)}),t.jsx("select",{style:{...n(e).input,width:"48%"},onChange:s=>j(s.target.value,1),children:be(e,o)})]}),t.jsx("textarea",{maxLength:60,placeholder:o===0?"описание(опционально)":"description(optional)",style:{...n(e).input,height:d?"40%":"25%"},onChange:s=>j(s.target.value,2),onFocus:()=>u(!0),onBlur:()=>u(!1)}),t.jsx("div",{style:n(e).headerText,children:o===0?"выбери иконку(опционально)":"choose icon(optional)"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("div",{style:{width:"80%",marginLeft:"30px",padding:"5px"},children:t.jsxs("div",{style:n(e).button,onClick:()=>O(!C),children:[!C&&t.jsx(de,{style:n(e).miniIcon}),C&&t.jsx(pe,{style:n(e).miniIcon})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"20%",height:"100%",padding:"8px"},children:T.getIcon(ie,{size:48,style:{marginRight:"70px",color:i.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{K(""),Y(0),f(g)},children:t.jsx(M,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{D(!1),h(!1),N(null)},children:t.jsx(ue,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{w&&(W.onClick(),f(g))},children:t.jsx(X,{style:{...n(e).miniIcon,color:w?i.get("icons",e):i.get("iconsDisabled",e)}})})]})]}),C&&t.jsx("div",{style:n(e).selectPanel,children:Object.entries(T.ic).map(([s])=>t.jsx("div",{style:{width:"15%",padding:"12px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",":hover":{backgroundColor:i.get("highlitedPanel",e)}},onClick:()=>{ae(s),ee(s),f(g),O(!1),y.length>3&&x.length>3&&(h(!0),k({text:o===0?"создать и добавить":"create and add",onClick:()=>{G(y,x,I,s),f(g)}}))},children:T.getIcon(s,{size:32,style:{color:i.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})},s))})]})},be=(e,r)=>Array.from(new Set(L.map(l=>l.category[r]))).map(l=>t.jsx("option",{value:l,style:{...n(e).text},children:l},l)),F=(e,r,p)=>{if(typeof q!="function"){console.warn("AddHabitPanel: addHabitFn is not set yet. Ensure HabitsMain is mounted."),v(c.prefs[0]===0?"экран привычек ещё не готов":"habits screen not ready yet",2e3,!1);return}if(c.IsHabitInChoosenList(e)){v(c.prefs[0]===0?"привычка уже в списке":"habit already in list",2500,!1);return}q(e);const l=p?c.prefs[0]===0?`привычка: ${r} создана и добавлена`:`habit: ${r} was created and added`:c.prefs[0]===0?"привычка добавлена":"habit added";v(l,2500,!0)},G=(e,r,p,l)=>{const d=m(),o=(d.length>0?Math.max(...d.map(S=>S.id)):0)+1;c.IsCustomHabitExists(o)?v(c.prefs[0]===0?"привычка с таким названием уже существует":"habit with this name already exists",2500,!1):(c.AddCustomHabit(e,r,p,l,o),setTimeout(()=>{F(o,e,!0)},100))},ge=(e,r,p)=>{if(e.length>0){const l=m().filter(d=>d.name[c.prefs[0]].toLowerCase().startsWith(e.toLowerCase()));p(l)}else{const l=m();r.length!=l.length&&p(l)}},n=(e,r)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},panel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",overflow:"hidden",boxSizing:"border-box",overflowY:"scroll",border:`1px solid ${i.get("border",e)}`,margin:"5px",backgroundColor:i.get("simplePanel",e),boxShadow:`4px 4px 6px ${i.get("shadow",e)}`,width:"85vw",height:r?"85vh":"65vh"},text:{textAlign:"center",fontSize:"12px",color:i.get("mainText",e),marginBottom:"12px"},headerText:{textAlign:"center",margin:"5px",padding:"5px",fontSize:"14px",color:i.get("subText",e)},scrollView:{overflowY:"auto",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"},simplePanel:{marginLeft:"7.5vw",width:"70vw",height:"30vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch",background:"rgba(0, 0, 0, 0.1)",borderRadius:"24px"},input:{width:"65vw",height:r?"6vh":"3vh",borderRadius:"12px",border:`1px solid ${i.get("border",e)}`,margin:"12px",fontSize:"14px",fontFamily:"Segoe UI",color:i.get("subText",e),backgroundColor:i.get("inputField",e)},simplePanelRow:{display:"flex",flexDirection:"row",alignItems:"stretch"},select:{width:"20vw",height:"6vw",borderRadius:"12px",border:`1px solid ${i.get("border",e)}`,marginTop:"12px",fontSize:"14px",color:i.get("subText",e),backgroundColor:i.get("habitCard",e)},selectOption:{color:i.get("subText",e),backgroundColor:i.get("habitCard",e),fontSize:"8px"},selectPanel:{backgroundColor:i.get("habitCard",e),borderRadius:"24px",border:`1px solid ${i.get("border",e)}`,position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexWrap:"wrap",width:"77vw",maxHeight:"42vh",overflowY:"auto",padding:"16px",gap:"8px",justifyContent:"center",zIndex:1e3},selectIcon:{flex:"{0,0,33.33%}",width:"20vw",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignContent:"center",justifyContent:"center",width:"15vw",marginTop:"12px",fontSize:"12px"},miniIcon:{fontSize:"28px",padding:"5px",marginTop:"10px",color:i.get("icons",e),filter:`drop-shadow(0 0px 1px ${i.get("iconsShadow",e)})`}});function f(e){c.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),c.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{we as default};
