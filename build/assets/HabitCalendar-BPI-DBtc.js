import{R as S,r as x,A as g,t as Q,g as Z,l as tt,h as et,j as e,C as i,s as E,a as nt,b as P,m as st,e as it}from"./index-C99Y-XVh.js";import{u as at,a as ot,b as K}from"./index-DZyOZW-A.js";const w=t=>{const r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${r}-${a}-${o}`},rt=t=>(t.getDay()+6)%7;w(new Date);const I=new Audio("Audio/SwitchPanel.wav"),lt=new Audio("Audio/Click_Calendar.wav"),ct=new Audio("Audio/IsDone.wav"),W=new Audio("Audio/Skip.wav");function dt(){return P.concat((g.CustomHabits||[]).filter(t=>!P.some(r=>r.id===t.id)))}const bt=()=>{const[t,r]=S.useState("dark"),[a,o]=S.useState("dark"),[c,h]=x.useState(g.prefs[0]),[n,p]=x.useState(new Date),[d,y]=x.useState(n),[f,v]=x.useState(!1),[U,j]=x.useState(0);S.useEffect(()=>{const s=Q.subscribe(r);return()=>s.unsubscribe()},[]),S.useEffect(()=>{const s=Z.subscribe(o);return()=>s.unsubscribe()},[]),S.useEffect(()=>{const s=tt.subscribe(k=>{h(k==="ru"?0:1)});return()=>s.unsubscribe()},[]),S.useEffect(()=>{const s=et.subscribe(()=>j(k=>k+1));return()=>s.unsubscribe()},[]);const T=new Date(n.getFullYear(),n.getMonth(),1),R=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),H=(T.getDay()+6)%7,C=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],u=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],m=[],$=[];for(let s=0;s<H;s++)m.push(null);for(let s=1;s<=R;s++)m.push(s);for(let s=0;s<m.length;s+=7)$.push(m.slice(s,s+7));const V=()=>{p(new Date(n.getFullYear(),n.getMonth()-1)),D(I,50)},N=()=>{p(new Date(n.getFullYear(),n.getMonth()+1)),D(I,50)};return e.jsxs("div",{style:l(t).container,children:[e.jsxs("div",{style:l(t).panel,children:[e.jsxs("div",{style:l(t).calendarHead,children:[e.jsx("h1",{style:l(t).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),e.jsx("div",{onClick:V,children:e.jsx("h1",{style:l(t).header,children:"<"})}),e.jsx("div",{onClick:N,children:e.jsx("h1",{style:l(t).header,children:">"})})]}),e.jsxs("table",{style:l(t).table,children:[e.jsx("thead",{children:e.jsx("tr",{children:C[c].map(s=>e.jsx("th",{children:e.jsx("p",{style:{textAlign:"center",fontSize:"14px",color:s==="Вс"||s==="Sun"?"#873535ff":i.get("subText",t)},children:s})},s))})}),e.jsx("tbody",{children:$.map((s,k)=>e.jsx("tr",{children:s.map((b,X)=>{const A=n.getMonth(),M=n.getFullYear(),G=b===d.getDate()&&A===d.getMonth()&&M===d.getFullYear(),_=w(new Date(M,A,b));let L="",F=0;if(Object.keys(g.habitsByDate).includes(_)){const O=Array.from(Object.values(g.habitsByDate[_])),Y=O.length,q=O.filter(J=>J===1).length,B=Y>0?Math.round(q/Y*100):0;L=B+"%",F=B>=100?1:-1}return e.jsx("td",{children:e.jsxs("div",{style:{...l(t).cell,border:`3px solid ${G?i.get("currentDateBorder",t):i.get("background",t)}`,backgroundColor:b<1?i.get("background",t):F===1?i.get("habitCardDone",t):F===-1?i.get("habitCardSkipped",t):i.get("background",t)},onClick:()=>{y(new Date(M,A,b)),v(g.hasKey(w(new Date(M,A,b)))),D(lt,50)},children:[b,b>0&&e.jsx("div",{style:{fontSize:"8px",color:i.get("subText",t),lineHeight:"5px",padding:"5px"},children:L})]})},X)})},k))})]}),e.jsxs("div",{style:{position:"fixed",top:"120%",padding:"10%",fontSize:"14px",fontFamily:"Segoe UI",color:i.get("simplePanel",t)},children:[" ",c===0?"Выберите дату для просмотра привычек":"Choose the date to see habits"]})]}),f&&e.jsxs("div",{style:{...l(t).panel,height:"30vh",width:"75vw",position:"fixed",top:"74%",left:"50%"},children:[e.jsxs("div",{style:{...l(t).calendarHead,display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",paddingTop:"5px"},children:[e.jsx("h1",{style:{...l(t).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"1px"},children:d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+" "+u[c][rt(d)]}),e.jsx("div",{style:{fontSize:"10px",color:i.get("subText",t),lineHeight:"1px",paddingRight:"50%"},children:xt(d,c)})]}),e.jsx("div",{style:l(t).scrollView,children:e.jsx(gt,{theme:t,langIndex:c,date:d})})]}),e.jsx(pt,{theme:t,globalTheme:a})]})},gt=({theme:t,langIndex:r,date:a})=>{const o=w(a);return g.hasKey(o)?Object.entries(g.habitsByDate[o]).map(([h,n])=>{const p=Number(h),d=dt().find(f=>f.id===p),y=d?d.name[r]:"";return e.jsx(ut,{id:p,name:y,theme:t,date:a,statusInit:n,langIndex:r},`${o}-${h}`)}):null},ut=({id:t,name:r,theme:a,date:o,statusInit:c,langIndex:h})=>{const[n,p]=x.useState(c),[d,y]=x.useState(!0),f=100,v=-100,U=at(0),j=ot(U,[-1,1],[v,f]);x.useEffect(()=>{p(c)},[c,o]);const T=(R,H)=>{const C=H.offset.x;if(Math.abs(C)>f){if(!d)return;let u=n;if(C>0?n===0?u=1:n===-1&&(u=0):n===0?u=-1:n===1&&(u=0),u!==n){const m=w(o);g.changeStatus(m,t,u),p(u),it(),u===1?g.prefs[2]==0&&ct.play():u===-1&&g.prefs[2]==0&&W.play(),g.prefs[3]==0&&navigator.vibrate?.(50)}y(!1),K(j,0,{type:"tween",duration:.2})}},z=()=>{K(j,0,{type:"tween",duration:.2}),y(!0)};return e.jsxs(st.div,{id:`cal-${t}`,style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:j},drag:d?"x":!1,dragConstraints:{left:v,right:n===1?0:f},dragElastic:0,onDrag:T,onDragEnd:z,children:[e.jsx("p",{style:{...l(a).text,fontSize:"14px",paddingLeft:"30px"},children:r}),n===1?e.jsx("img",{src:"Art/Ui/Done_Icon.png",style:l(a).icon}):n===-1?e.jsx("img",{src:"Art/Ui/Skipped_Icon.png",style:l(a).icon}):null,e.jsx("span",{style:{...l(a).subText,marginLeft:"6px",color:n===1?i.get("habitCardDone",a):n===-1?i.get("habitCardSkipped",a):i.get("subText",a)},children:n===1?h===0?"Выполнено":"Done":n===-1?h===0?"Пропущено":"Skipped":""})]})};function pt({globalTheme:t,theme:r}){const a={position:"fixed",bottom:"0",left:"0",width:"100vw",height:"10vh",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",backgroundColor:i.get("bottomPanel",r),display:"flex",justifyContent:"space-around",alignItems:"center",zIndex:900,boxShadow:`0px -2px 0px ${i.get("bottomPanelShadow",r)}`},o={width:"35px",border:"none",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent"};return e.jsx("div",{style:a,children:e.jsxs("div",{style:a,children:[e.jsx("img",{src:t==="dark"?"Art/Ui/Back_Dark.png":"Art/Ui/Back_Light.png",style:o,onClick:()=>{E("HabitsMain"),D(W,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Metrics_Dark.png":"Art/Ui/Metrics_Light.png",style:o,onClick:()=>{E("HabitMetrics"),D(I,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Add_Dark.png":"Art/Ui/Add_Light.png",style:o,onClick:()=>{}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Setting_Dark.png":"Art/Ui/Metrics_Light.png",style:o,onClick:()=>{nt(!0),D(I,50)}}),e.jsx("img",{src:t==="dark"?"Art/Ui/Calendar_Dark.png":"Art/Ui/Calendar_Light.png",style:o,onClick:()=>{}})]})})}const l=t=>({container:{backgroundColor:i.get("background",t),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:i.get("headGradient",t),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:i.get("subText",t),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"100%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"11vw",height:"11vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:i.get("mainText",t),fontFamily:"Segoe UI"},panel:{width:"90vw",height:"105vw",position:"absolute",top:"36%",left:"50%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${i.get("border",t)}`,margin:"5px",background:i.get("background",t),boxShadow:`4px 4px 6px ${i.get("shadow",t)}`},text:{fontFamily:"Segoe UI",fontSize:"18px",color:i.get("mainText",t)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:i.get("subText",t)},scrollView:{margin:"15px",overflowY:"scroll",width:"90%",height:"70%",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"start",borderRadius:"24px"},icon:{paddingLeft:"25px",paddingBottom:"5px",width:"25px"}});function xt(t,r){const a=[["привычка","привычки","привычек"],["habit","habits","habits"]],o=w(t);if(g.hasKey(o)){const c=Object.values(g.habitsByDate[o]).length;return c+" "+a[r][c===1?0:c>1&&c<5?1:2]}return"0 "+a[r][2]}function D(t,r){g.prefs[2]==0&&t!==null&&(t.paused||(t.pause(),t.currentTime=0),t.volume=.5,t.play()),g.prefs[3]==0&&navigator.vibrate(r)}export{bt as default};
