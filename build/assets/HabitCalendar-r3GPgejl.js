import{c as L,j as t,R as O,r as x,A as l,t as X,l as G,C as o,a as W,m as q,M as J,e as Q}from"./index-1gwYXWtw.js";import{u as Z,a as _,b as B}from"./index-DX_C48QX.js";const ee=L(t.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),te=L(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),D=e=>{const c=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${c}-${i}-${d}`},ne=e=>(e.getDay()+6)%7;D(new Date);const z=new Audio("Audio/Click.wav"),se=new Audio("Audio/IsDone.wav"),ae=new Audio("Audio/Skip.wav");function oe(){return W.concat((l.CustomHabits||[]).filter(e=>!W.some(c=>c.id===e.id)))}const ue=()=>{const[e,c]=O.useState("dark"),[i,d]=x.useState(l.prefs[0]),[n,b]=x.useState(new Date),[s,g]=x.useState(n),[f,y]=x.useState(!1);O.useEffect(()=>{const a=X.subscribe(c);return()=>a.unsubscribe()},[]),O.useEffect(()=>{const a=G.subscribe(H=>{d(H==="ru"?0:1)});return()=>a.unsubscribe()},[]);const h=new Date(n.getFullYear(),n.getMonth(),1),T=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),j=(h.getDay()+6)%7,F=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],I=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],w=[],S=[];for(let a=0;a<j;a++)w.push(null);for(let a=1;a<=T;a++)w.push(a);for(let a=0;a<w.length;a+=7)S.push(w.slice(a,a+7));const v=()=>{b(new Date(n.getFullYear(),n.getMonth()-1)),m(z)},u=()=>{b(new Date(n.getFullYear(),n.getMonth()+1)),m(z)};return t.jsx("div",{style:r(e).container,children:t.jsxs("div",{style:r(e).panel,children:[t.jsxs("div",{style:r(e).calendarHead,children:[t.jsx("h1",{style:r(e).header,children:n.getFullYear()+"/"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)}),t.jsx("div",{onClick:v,children:t.jsx("h1",{style:r(e).header,children:"<"})}),t.jsx("div",{onClick:u,children:t.jsx("h1",{style:r(e).header,children:">"})})]}),t.jsxs("table",{style:r(e).table,children:[t.jsx("thead",{children:t.jsx("tr",{children:F[i].map(a=>t.jsx("th",{children:t.jsx("p",{style:{textAlign:"center",fontSize:"12px",color:a==="Вс"||a==="Sun"?"#873535ff":o.get("subText",e)},children:a})},a))})}),t.jsx("tbody",{children:S.map((a,H)=>t.jsx("tr",{children:a.map((p,U)=>{const C=n.getMonth(),M=n.getFullYear(),N=p===s.getDate()&&C===s.getMonth()&&M===s.getFullYear(),$=D(new Date(M,C,p));let R="",A=0;if(Object.keys(l.habitsByDate).includes($)){const Y=Array.from(Object.values(l.habitsByDate[$])),E=Y.length,P=Y.filter(V=>V>0).length,K=E>0?Math.round(P/E*100):0;R=K+"%",A=K>=100?1:-1}return t.jsx("td",{children:t.jsxs("div",{style:{...r(e).cell,border:`3px solid ${N?o.get("currentDateBorder",e):o.get("background",e)}`,backgroundColor:p<1?o.get("background",e):A===1?o.get("habitCardDone",e):A===-1?o.get("habitCardSkipped",e):o.get("background",e)},onClick:()=>{g(new Date(M,C,p)),y(l.hasKey(D(new Date(M,C,p)))),m(z)},children:[p,p>0&&t.jsx("div",{style:{fontSize:"8px",color:o.get("subText",e),lineHeight:"5px",paddingBottom:"7px"},children:R})]})},U)})},H))})]}),t.jsx("div",{style:{height:"60%",width:"100%",paddingTop:"15px"},children:f&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{borderTop:`1px solid ${o.get("border",e)}`},children:[t.jsx("h1",{style:{...r(e).header,fontSize:"22px",paddingTop:"1px",paddingBottom:"5px"},children:s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear()+" "+I[i][ne(s)]}),t.jsx("div",{style:{fontSize:"10px",color:o.get("subText",e),lineHeight:"1px",paddingRight:"50%"},children:le(s,i)})]}),t.jsx("div",{style:r(e).scrollView,children:t.jsx(ie,{theme:e,langIndex:i,date:s})})]})})]})})},ie=({theme:e,langIndex:c,date:i})=>{const d=D(i);return l.hasKey(d)?Object.entries(l.habitsByDate[d]).map(([b,s])=>{const g=Number(b),f=oe().find(h=>h.id===g),y=f?f.name[c]:"";return t.jsx(re,{id:g,name:y,theme:e,date:i,statusInit:s,langIndex:c},`${d}-${b}`)}):null},re=({id:e,name:c,theme:i,date:d,statusInit:n,langIndex:b})=>{const[s,g]=x.useState(n),[f,y]=x.useState(s<2),h=100,k=-100,T=Z(0),j=_(T,[-1,1],[k,h]);x.useEffect(()=>{g(n)},[n,d]);const F=(w,S)=>{const v=S.offset.x;if(Math.abs(v)>h){if(!f)return;let u=s;if(v>0?s===0?u=1:s===-1&&(u=0):s===0?u=-1:s===1&&(u=0),u!==s){const a=D(d);l.changeStatus(a,e,u),g(u),Q(),u===1?l.prefs[2]==0&&m(se):u===-1&&l.prefs[2]==0&&m(ae),m(null)}y(!1),B(j,0,{type:"tween",duration:.2})}},I=()=>{B(j,0,{type:"tween",duration:.2}),y(!0)};return t.jsxs(q.div,{id:`cal-${e}`,style:{backgroundColor:s<2?"transparent":o.get("habitCardEnded",i),display:"flex",flexDirection:"row",width:"95%",justifyContent:"space-around",alignItems:"center",lineHeight:"2px",x:j},drag:f?"x":!1,dragConstraints:{left:k,right:s===1?0:h},dragElastic:0,onDrag:F,onDragEnd:I,children:[t.jsx("p",{style:{...r(i).text,fontSize:"14px",paddingLeft:"30px"},children:c}),s>0?s>1?t.jsx(J,{style:{...r(i).icon,color:"#8e972eff"}}):t.jsx(ee,{style:{...r(i).icon,color:"#2e9741ff"}}):s===-1?t.jsx(te,{style:{...r(i).icon,color:"#973939ff"}}):null]})},r=e=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",height:"100vh",width:"100vw",fontFamily:"Segoe UI"},panel:{display:"flex",flexDirection:"column",width:"90vw",height:"160vw",position:"absolute",top:"51%",left:"49%",transform:"translate(-50%,-50%)",alignItems:"center",justifyContent:"start",borderRadius:"24px",border:`1px solid ${o.get("border",e)}`,margin:"5px",background:o.get("background",e),boxShadow:`4px 4px 6px ${o.get("shadow",e)}`},calendarHead:{margin:"2px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"98%",height:"20%",background:o.get("headGradient",e),borderTopLeftRadius:"24px",borderTopRightRadius:"24px"},header:{fontFamily:"Segoe UI",padding:"5vw",marginLeft:"3vw",fontSize:"36px",fontWeight:"bold",color:o.get("subText",e),top:"36%",left:"50%",margin:"5px"},table:{border:"5",cellPadding:"5",borderCollapse:"collapse",width:"90%",textAlign:"center"},cell:{boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"9vw",height:"9vw",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",color:o.get("mainText",e),fontFamily:"Segoe UI"},text:{fontFamily:"Segoe UI",fontSize:"14px",color:o.get("mainText",e)},subText:{fontFamily:"Segoe UI",fontSize:"10px",color:o.get("subText",e)},scrollView:{margin:"15px",overflowY:"scroll",width:"65vw",height:"20vh",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"24px",backgroundColor:"rgba(0,0,0,0.1)"},icon:{paddingLeft:"8px",width:"25px"}});function le(e,c){const i=[["привычка","привычки","привычек"],["habit","habits","habits"]],d=D(e);if(l.hasKey(d)){const n=Object.values(l.habitsByDate[d]).length;return n+" "+i[c][n===1?0:n>1&&n<5?1:2]}return"0 "+i[c][2]}function m(e){l.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),l.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}export{ue as default};
