import{A as f,t as G,f as _,a1 as K,l as te,c2 as P,j as t,a as ne,m as u,bV as oe,G as ie,C as o,cq as se,cr as le,cs as ce,ct as de,cu as pe,cv as xe,b_ as ge,M as ue,cw as fe,y as ye,h as be,i as he,bv as X,cx as me}from"./index-CZXxbQX1.js";import{r as p}from"./recharts-Bg6K2Pzo.js";import{M as Se}from"./MyInput-BcwhDM3U.js";import{S as je}from"./Slider-BiU80pes.js";const ve=(e,n,i,r,s)=>{const d={bedtime:i,duration:n,mood:r,note:s??""};f.sleepingLog={...f.sleepingLog,[e]:d}},we=new Audio("Audio/Click.wav"),Ce=[le,ce,de,pe,xe],Te=3,Me=14,De=10,ke=Te*60*60*1e3,Be=Me*60*60*1e3,Ie=De*60*1e3,q=e=>{const n=Math.floor(e/6e4),i=Math.floor(n/60),r=n%60;return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},ze=(e,n)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][n];function J(e){f.prefs[2]===0&&e&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),f.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Fe(e){const n=new Date(e),i=new Date;return n.setHours(0,0,0,0),i.setHours(0,0,0,0),n<=i}const Re=({dateString:e})=>{const[n,i]=p.useState(G.value),[r,s]=p.useState(_.value),[d,x]=p.useState(f.prefs[0]),[y,I]=p.useState(K.value),[z,F]=p.useState(4),[g,M]=p.useState(480*60*1e3),[v,R]=p.useState(1380*60*1e3),[D,U]=p.useState("");p.useEffect(()=>{const w=G.subscribe(i),m=_.subscribe(s),S=te.subscribe(j=>x(j==="ru"?0:1)),h=K.subscribe(I);return()=>{w.unsubscribe(),m.unsubscribe(),S.unsubscribe(),h.unsubscribe()}},[]),p.useEffect(()=>{y==="SleepNew"&&!Fe(e)&&P("")},[y,e]);const $=async()=>{J(we),ve(e,g,v,z,D),await ye(),P("")},W=y==="SleepNew";return t.jsx(ne,{children:W&&t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:c(n).backdrop,children:t.jsxs(u.div,{initial:{y:"100%",opacity:0,scale:.95},animate:{y:"0%",opacity:1,scale:1},exit:{y:"100%",opacity:0,scale:.95},transition:{type:"spring",damping:25,stiffness:300},style:c(n).panel,children:[t.jsxs("div",{style:c(n).header,children:[t.jsxs("div",{style:c(n).iconContainer,children:[t.jsx(oe,{size:24,color:"#fff"}),t.jsx("div",{style:c(n).iconGlow})]}),t.jsxs("div",{style:c(n).headerTextContainer,children:[t.jsx("h2",{style:c(n,r).title,children:d===0?"Сон":"Sleep Log"}),t.jsx("span",{style:c(n).dateBadge,children:e})]})]}),t.jsxs("div",{style:c(n).body,children:[t.jsxs("div",{style:{...c(n).sectionCard,height:"300px"},children:[t.jsxs("div",{style:c(n).labelRow,children:[t.jsx(ie,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Время отбоя":"Bedtime"})]}),t.jsx("div",{style:c(n).heroValue,children:q(v)}),t.jsx("div",{style:{padding:"0 10px"},children:t.jsx(Q,{value:v,onChange:R,min:0,max:1440*60*1e3-1,theme:n,accentColor:o.get("difficulty5",n)})}),t.jsxs("div",{style:c(n).labelRow,children:[t.jsx(se,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Длительность":"Duration"})]}),t.jsx("div",{style:c(n).heroValue,children:q(g)}),t.jsx("div",{style:{padding:"0 10px"},children:t.jsx(Q,{value:g,onChange:M,min:ke,max:Be,theme:n,accentColor:o.get("difficulty",n)})})]}),t.jsxs("div",{style:c(n).sectionCard,children:[t.jsx("div",{style:c(n).labelRow,children:t.jsx("span",{children:d===0?"Самочувствие":"How do you feel?"})}),t.jsx("div",{style:c(n).moodContainer,children:Ce.map((w,m)=>{const S=m+1,h=z===S,j=ze(n,m);return t.jsx(u.div,{whileTap:{scale:.8},animate:{scale:h?1.2:1,opacity:h?1:.4},onClick:()=>{J(null),F(S)},style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:t.jsx(w,{size:42,color:h?j:o.get("subText",n),style:{filter:h?`drop-shadow(0 0 8px ${j})`:"none"}})},m)})})]}),t.jsxs("div",{style:c(n).sectionCard,children:[t.jsxs("div",{style:c(n).labelRow,children:[t.jsx(ge,{style:{marginRight:8,opacity:.7}}),t.jsx("span",{children:d===0?"Заметка":"Note"})]}),t.jsx(Se,{maxL:500,h:"60px",w:"100%",placeHolder:d===0?"Сны, мысли...":"Dreams, thoughts...",theme:n,value:D,onChange:U})]}),t.jsx("div",{style:{marginBottom:"180px"}})," "]}),t.jsxs("div",{style:c(n).footer,children:[t.jsx(u.button,{whileTap:{scale:.95},onClick:()=>P(""),style:c(n).cancelButton,children:t.jsx(ue,{size:34,color:o.get("mainText",n)})}),t.jsxs(u.button,{whileTap:{scale:.95},onClick:$,style:c(n).saveButton,children:[t.jsx(fe,{size:24,color:"#fff"}),t.jsx("span",{style:{marginLeft:8},children:d===0?"Сохранить":"Save Sleep"})]})]})]})})})},Q=({value:e,onChange:n,min:i,max:r,theme:s,accentColor:d})=>t.jsx(je,{value:e,onChange:(x,y)=>n(y),min:i,max:r,step:Ie,sx:{color:d,height:6,"& .MuiSlider-thumb":{width:24,height:24,backgroundColor:o.get("simplePanel",s),border:`2px solid ${d}`,"&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:`0 0 0 8px ${d}30`}},"& .MuiSlider-track":{border:"none"},"& .MuiSlider-rail":{opacity:.2,backgroundColor:o.get("subText",s)}}}),c=(e,n)=>{const i=e==="dark";return{backdrop:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(6px)",zIndex:2900,display:"flex",alignItems:"flex-end",justifyContent:"center"},panel:{width:"100%",maxWidth:"500px",height:"95vh",backgroundColor:i?"rgba(16, 16, 17, 0.91)":"#ffffff",borderTopLeftRadius:"32px",borderTopRightRadius:"32px",display:"flex",flexDirection:"column",boxShadow:"0 -10px 40px rgba(0,0,0,0.3)",overflow:"hidden"},header:{padding:"24px",display:"flex",alignItems:"center",gap:"16px",borderBottom:`1px solid ${o.get("border",e)}50`},iconContainer:{width:"48px",height:"48px",borderRadius:"16px",backgroundColor:"#3F51B5",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxShadow:"0 4px 12px rgba(63, 81, 181, 0.4)"},iconGlow:{position:"absolute",inset:0,borderRadius:"16px",background:"inherit",filter:"blur(10px)",opacity:.5,zIndex:-1},headerTextContainer:{display:"flex",flexDirection:"column"},title:{margin:0,fontSize:n===0?"22px":"24px",fontWeight:"800",color:o.get("mainText",e),fontFamily:"Segoe UI, sans-serif"},dateBadge:{fontSize:"12px",color:o.get("subText",e),marginTop:"2px",fontWeight:"500"},body:{flex:1,overflowY:"auto",padding:"24px",display:"flex",flexDirection:"column",gap:"20px"},sectionCard:{backgroundColor:o.get("simplePanel",e),height:"96px",borderRadius:"20px",padding:"16px",border:`1px solid ${o.get("border",e)}50`},labelRow:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"600",color:o.get("subText",e),textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"10px"},heroValue:{fontSize:"32px",fontWeight:"800",color:o.get("mainText",e),textAlign:"center",marginBottom:"4px",fontVariantNumeric:"tabular-nums"},moodContainer:{display:"flex",justifyContent:"space-between",padding:"10px 0"},footer:{padding:"20px 24px 30px 24px",borderTop:`1px solid ${o.get("border",e)}50`,display:"flex",alignItems:"center",gap:"12px",backgroundColor:i?"rgba(16, 16, 17, 0.91)":"#ffffff"},cancelButton:{width:"56px",height:"56px",borderRadius:"18px",border:"none",backgroundColor:o.get("skipped",e),display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},saveButton:{flex:1,height:"56px",borderRadius:"18px",border:"none",background:o.get("done",e),color:"#fff",fontSize:"16px",fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 8px 20px rgba(63, 81, 181, 0.3)"}}},$e=e=>(e.getDay()+6)%7,E=e=>{const n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${n}-${i}-${r}`},O=new Audio("Audio/Click.wav"),V=(e,n)=>[o.get("veryBad",e),o.get("bad",e),o.get("normal",e),o.get("good",e),o.get("perfect",e)][n]||o.get("accent",e),Z=e=>{if(typeof e!="number"||e<0)return"--:--";const n=Math.floor(e/(60*1e3)),i=Math.floor(n/60),r=n%60;return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},We=e=>{if(typeof e!="number"||e<0)return 0;const n=3600*1e3,i=4,r=10,s=i*n,d=r*n;if(e<=s)return 15;if(e>=d)return 100;const x=d-s,y=(e-s)/x;return 15+Math.round(y*85)};function Y(e){f.prefs[2]===0&&e&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),f.prefs[3]===0&&window.Telegram?.WebApp?.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}const Pe=()=>{const[e,n]=p.useState("dark"),[i,r]=p.useState(f.prefs[0]),[s,d]=p.useState(new Date),[x,y]=p.useState(new Date),I=p.useRef(x),[z,F]=p.useState(f.prefs[4]),[g,M]=p.useState(null),v=new Date().getDate(),R=new Date().getMonth();p.useEffect(()=>{const l=G.subscribe(n),b=te.subscribe(A=>r(A==="ru"?0:1)),L=_.subscribe(F);return()=>{l.unsubscribe(),b.unsubscribe(),L.unsubscribe()}},[]),p.useEffect(()=>{I.current=x;const l=E(x),b=f.sleepingLog?.[l];M(b||null)},[x]);const D=new Date(s.getFullYear(),s.getMonth(),1),$=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),W=(D.getDay()+6)%7,w=[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]],m=[["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]],S=Array(W).fill(null);for(let l=1;l<=$;l++)S.push(l);const h=()=>{d(new Date(s.getFullYear(),s.getMonth()-1)),Y(O)},j=()=>{d(new Date(s.getFullYear(),s.getMonth()+1)),Y(O)},C=s.getMonth(),k=s.getFullYear();return t.jsxs("div",{style:a(e).container,children:[t.jsxs("div",{style:a(e).headerContainer,children:[t.jsx(u.button,{whileTap:{scale:.9},onClick:h,style:a(e).navBtn,children:t.jsx(be,{})}),t.jsxs("div",{style:a(e).monthTitle,children:[s.toLocaleString(i===0?"ru":"en",{month:"long"}),t.jsx("span",{style:{opacity:.5,marginLeft:"6px"},children:s.getFullYear()})]}),t.jsx(u.button,{whileTap:{scale:.9},onClick:j,style:a(e).navBtn,children:t.jsx(he,{})})]}),t.jsxs("div",{style:a(e).gridWrapper,children:[t.jsx("div",{style:a(e).weekRow,children:w[i].map((l,b)=>t.jsx("div",{style:{...a(e).weekDay,color:b===6||b===5?o.get("skipped",e):o.get("subText",e)},children:l},b))}),t.jsx("div",{style:a(e).daysGrid,children:S.map((l,b)=>{if(l===null)return t.jsx("div",{},`empty-${b}`);const L=new Date(k,C,l),A=E(L),B=f.sleepingLog?.[A],H=l===x.getDate()&&C===x.getMonth()&&k===x.getFullYear(),ae=l===new Date().getDate()&&C===new Date().getMonth()&&k===new Date().getFullYear(),T=!!B,N=T?V(e,B.mood-1):"transparent",re=T?We(B.duration):0;return t.jsxs(u.div,{whileTap:{scale:.95},onClick:()=>{y(new Date(k,C,l)),Y(O),M(B||null)},style:{...a(e).dayCell(H,ae),border:v===l&&R===C?`2px solid ${o.get("currentDateBorder",e)}`:"transparent"},children:[T&&t.jsx(u.div,{initial:{height:0},animate:{height:`${re}%`},transition:{type:"spring",stiffness:100},style:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:N,opacity:H?.4:.25,zIndex:0}}),H&&t.jsx(u.div,{layoutId:"selInd",style:{position:"absolute",top:0,left:0,right:0,height:"3px",backgroundColor:T?N:o.get("mainText",e),boxShadow:`0 2px 8px ${T?N:o.get("mainText",e)}`}}),t.jsx("span",{style:{zIndex:1,position:"relative"},children:l})]},l)})})]}),t.jsxs("div",{style:a(e).detailsContainer,children:[t.jsxs("div",{style:a(e).dateLabel,children:[x.getDate()," ",m[i][$e(x)]]}),t.jsx(ne,{mode:"wait",children:g?t.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:a(e).card,children:[t.jsx("div",{style:a(e).cardGlow(V(e,g.mood-1))}),t.jsxs("div",{style:{position:"relative",zIndex:2},children:[t.jsxs("div",{style:a(e).metricsGrid,children:[t.jsx(ee,{icon:t.jsx(oe,{}),label:i===0?"Отбой":"Bedtime",value:Z(g.bedtime),theme:e,color:o.get("accent",e)}),t.jsx(ee,{icon:t.jsx(se,{}),label:i===0?"Длительность":"Duration",value:Z(g.duration),theme:e,color:V(e,g.mood-1)}),t.jsxs("div",{style:a(e).metricBox,children:[t.jsx("div",{style:{...a(e).iconBox,color:o.get("difficulty3",e)},children:t.jsx(X,{})}),t.jsx("div",{style:a(e).metricLabel,children:i===0?"Настроение":"Mood"}),t.jsx("div",{style:{display:"flex",gap:"2px",marginTop:"4px"},children:[1,2,3,4,5].map(l=>t.jsx(X,{size:10,color:l<=g.mood?o.get("difficulty3",e):o.get("subText",e),style:{opacity:l<=g.mood?1:.2}},l))})]})]}),g.note&&t.jsxs("div",{style:a(e).noteBox,children:[t.jsx(me,{size:14,style:{minWidth:"16px",marginTop:"2px",opacity:.7}}),t.jsx("span",{style:{fontSize:"13px",fontStyle:"italic",opacity:.9},children:g.note})]})]})]},"entry"):t.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},style:a(e).emptyState,children:[t.jsx(ie,{size:32,color:o.get("subText",e),style:{opacity:.3,marginBottom:"10px"}}),t.jsx("span",{children:i===0?"Нет данных о сне":"No sleep data"})]},"empty")})]}),t.jsx(Re,{dateString:E(x)})]})},ee=({icon:e,label:n,value:i,theme:r,color:s})=>t.jsxs("div",{style:a(r).metricBox,children:[t.jsx("div",{style:{...a(r).iconBox,color:s},children:e}),t.jsx("div",{style:a(r).metricLabel,children:n}),t.jsx("div",{style:a(r).metricValue,children:i})]}),a=(e,n)=>({container:{backgroundColor:o.get("background",e),display:"flex",flexDirection:"column",alignItems:"center",height:"85vh",paddingTop:"80px",marginTop:"70px",width:"100vw",fontFamily:"Segoe UI, sans-serif",overflow:"hidden"},headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"90%",marginBottom:"20px"},navBtn:{background:"transparent",border:"none",color:o.get("mainText",e),fontSize:"20px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},monthTitle:{fontSize:"22px",fontWeight:"700",color:o.get("mainText",e),textTransform:"capitalize"},gridWrapper:{width:"94%",padding:"0 10px"},weekRow:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",marginBottom:"10px",textAlign:"center"},weekDay:{fontSize:"12px",fontWeight:"600",textTransform:"uppercase"},daysGrid:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"6px",width:"100%"},dayCell:(i,r)=>({aspectRatio:"1/1",borderRadius:"12px",backgroundColor:i?o.get("simplePanel",e):"transparent",border:r?`1px solid ${o.get("accent",e)}`:`1px solid ${o.get("border",e)}30`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:i||r?"700":"500",color:o.get("mainText",e),position:"relative",overflow:"hidden",cursor:"pointer",boxShadow:i?"0 4px 12px rgba(0,0,0,0.1)":"none"}),detailsContainer:{width:"90%",marginTop:"55px",marginBottom:"40px",display:"flex",flexDirection:"column",gap:"12px"},dateLabel:{fontSize:"16px",fontWeight:"bold",color:o.get("subText",e),paddingLeft:"4px"},card:{position:"relative",backgroundColor:o.get("simplePanel",e),borderRadius:"24px",padding:"20px",boxShadow:"0 8px 30px rgba(0,0,0,0.2)",border:`1px solid ${o.get("border",e)}50`,overflow:"hidden"},cardGlow:i=>({position:"absolute",top:"-50%",right:"-50%",width:"200px",height:"200px",background:`radial-gradient(circle, ${i}30 0%, transparent 70%)`,filter:"blur(30px)",pointerEvents:"none"}),metricsGrid:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",marginBottom:"15px"},metricBox:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:e==="dark"?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.03)",borderRadius:"16px",padding:"12px 5px"},iconBox:{fontSize:"18px",marginBottom:"6px"},metricLabel:{fontSize:"10px",textTransform:"uppercase",color:o.get("subText",e),marginBottom:"2px"},metricValue:{fontSize:"14px",fontWeight:"700",color:o.get("mainText",e)},noteBox:{display:"flex",gap:"10px",backgroundColor:e==="dark"?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",padding:"12px",borderRadius:"12px",color:o.get("mainText",e),lineHeight:"1.4"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"30px",backgroundColor:o.get("simplePanel",e),borderRadius:"24px",border:`1px dashed ${o.get("border",e)}`,color:o.get("subText",e),fontSize:"14px"}});export{Pe as default};
