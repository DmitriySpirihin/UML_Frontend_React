import{G as ce,r as o,t as Y,l as O,A as p,y as Se,z as Ie,j as t,C as i,B as ke,D as b,E as se,H as ie,I as oe,J as ae,K as Pe,L as De,M as He,a as K,O as L}from"./index-D1r-3hKh.js";import{I as W,a as re}from"./HabitsMain-DsGWbIYz.js";import{b as Ae,M as Fe,a as Te}from"./index-CYc57j5m.js";import"./index-9KQYzthb.js";function V(e){return ce({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}function N(e){return ce({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(e)}const d=new Audio("Audio/Click.wav"),v=()=>K.concat((p.CustomHabits||[]).filter(e=>!K.some(a=>a.id===e.id))),z=new Date,Ye=()=>{const[e,a]=o.useState(Y.value),[x,r]=o.useState(O.value),[c,I]=o.useState(!1),[l,R]=o.useState(p.prefs[0]),[B,X]=o.useState(!1),[q,de]=o.useState(""),[ue,M]=o.useState(!1),[m,xe]=o.useState(""),[y,pe]=o.useState(""),[$,ge]=o.useState(""),[Q,fe]=o.useState("default"),[he,be]=o.useState(-1),[g,k]=o.useState(new Date().getFullYear()),[f,P]=o.useState(new Date().getMonth()),[D,H]=o.useState(new Date().getDate()),S=o.useRef(null),[Z,_]=o.useState(v()),[ye,ee]=o.useState(null),[A,te]=o.useState(!1),[me,ne]=o.useState(0),[we,Ce]=o.useState("default"),[F,w]=o.useState(!1),[je,E]=o.useState({text:l===0?"Добавить":"Add",onClick:()=>G(!1)}),C=(s,h)=>{S.current=setInterval(()=>{h===2?H(J(s,D,g,f)):h===1?P(s?f+1<12?f+1:1:f-1>0?f-1:12):h===0&&k(s&&g+1<=z.getFullYear()+2&&g-1>=z.getFullYear()-2?g+1:g-1)},100)},j=()=>{clearInterval(S.current),S.current&&(clearInterval(S.current),S.current=null)},ve=[["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],["January","February","March","April","May","June","July","August","September","October","November","December"]];o.useEffect(()=>{const s=Y.subscribe(a),h=O.subscribe(r),U=Se.subscribe(I);return()=>{s.unsubscribe(),h.unsubscribe(),U.unsubscribe()}},[]),o.useEffect(()=>{const s=Y.subscribe(a),h=O.subscribe(U=>{R(U==="ru"?0:1)});return()=>{s.unsubscribe(),h.unsubscribe()}},[]),o.useEffect(()=>{_(v())},[]),o.useEffect(()=>{const s=Ie.subscribe(de);return q==="AddHabitPanel"?setTimeout(()=>ne(1),400):ne(0),()=>{s.unsubscribe()}},[]);const T=(s,h)=>{s.length>0&&(h===0?xe(s[0].toUpperCase()+s.toLowerCase().slice(1)):h===1?pe(s[0].toUpperCase()+s.toLowerCase().slice(1)):h===2&&ge(s[0].toUpperCase()+s.toLowerCase().slice(1)))};return o.useEffect(()=>{m.length>3&&y.length>3?(w(!0),E({text:l===0?"создать и добавить":"create and add",onClick:()=>le(m,y,$,Q)})):w(!1)},[m,y,$,Q,l]),t.jsxs("div",{style:{...n(e).container,transform:q==="AddHabitPanel"?"translateX(0)":"translateX(-100%)",backgroundColor:me===1?"rgba(0, 0, 0, 0.5)":"transparent",transition:"transform 0.3s ease-in-out, background-color 0.1s ease-in-out"},children:[!B&&t.jsxs("div",{style:n(e,c).panel,children:[t.jsx("div",{style:n(e).headerText,children:l===0?"добавь привычку":"add habit"}),t.jsxs("div",{style:{...n(e).simplePanel,height:c?"66vh":"52vh"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(ke,{style:{color:i.get("mainText",e),width:"5vw",marginTop:"10px",marginLeft:"10px"}}),t.jsx("input",{type:"text",onFocus:()=>b(!0),onBlur:()=>b(!1),style:{...n(e).input,height:c?"50%":"40%"},onChange:s=>Le(s.target.value,Z,_)})]}),t.jsx("div",{style:n(e).scrollView,children:Z.map(s=>!p.choosenHabits.includes(s.id)&&t.jsx("li",{style:{...n(e).text,borderRadius:"24px",backgroundColor:s.id===ye?i.get("highlitedPanel",e):"transparent"},onClick:()=>{ee(s.id),be(s.id),w(!0),u(d),E({text:l===0?"Добавить":"Add",onClick:()=>G(s.id,s.name[l],!1)})},children:t.jsx("p",{style:n(e).text,children:s.name[l]})},s.id))})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{ie(""),oe(0),u(d)},children:t.jsx(se,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{X(!0),w(!1)},children:t.jsx(Ae,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{F&&(M(!0),u(d))},children:t.jsx(ae,{style:{...n(e).miniIcon,color:F?i.get("icons",e):i.get("iconsDisabled",e)}})})]})]}),B&&t.jsxs("div",{style:n(e,c).panel,children:[t.jsx("div",{style:n(e).headerText,children:l===0?"или создай свою":"or create your own"}),t.jsxs("div",{style:{...n(e).simplePanel,height:c?"66vh":"52vh",justifyContent:"center"},children:[t.jsx("textarea",{maxLength:25,placeholder:l===0?"имя":"name",style:n(e).input,onChange:s=>T(s.target.value,0),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("textarea",{maxLength:25,placeholder:y===""?l===0?"категория":"category":y,style:{...n(e).input,width:"48%"},onChange:s=>T(s.target.value,1),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsx("select",{style:{...n(e).input,width:"48%"},onChange:s=>T(s.target.value,1),children:ze(e,l)})]}),t.jsx("textarea",{maxLength:60,placeholder:l===0?"описание(опционально)":"description(optional)",style:{...n(e).input,height:c?"40%":"25%"},onChange:s=>T(s.target.value,2),onFocus:()=>b(!0),onBlur:()=>b(!1)}),t.jsx("div",{style:n(e).headerText,children:l===0?"выбери иконку(опционально)":"choose icon(optional)"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("div",{style:{width:"80%",marginLeft:"30px",padding:"5px"},children:t.jsxs("div",{style:n(e).button,onClick:()=>te(!A),children:[!A&&t.jsx(Pe,{style:n(e).miniIcon}),A&&t.jsx(De,{style:n(e).miniIcon})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"20%",height:"100%",padding:"8px"},children:W.getIcon(we,{size:48,style:{marginRight:"70px",color:i.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignContent:"center"},children:[t.jsx("div",{style:{...n(e).button},onClick:()=>{ie(""),oe(0),u(d)},children:t.jsx(se,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{X(!1),w(!1),ee(null)},children:t.jsx(He,{style:n(e).miniIcon})}),t.jsx("div",{style:{...n(e).button},onClick:()=>{F&&(M(!0),u(d))},children:t.jsx(ae,{style:{...n(e).miniIcon,color:F?i.get("icons",e):i.get("iconsDisabled",e)}})})]})]}),A&&t.jsx("div",{style:n(e).selectPanel,children:Object.entries(W.ic).map(([s])=>t.jsx("div",{style:{width:"15%",padding:"12px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderRadius:"8px",transition:"background-color 0.2s",":hover":{backgroundColor:i.get("highlitedPanel",e)}},onClick:()=>{Ce(s),fe(s),u(d),te(!1),m.length>3&&y.length>3&&(w(!0),E({text:l===0?"создать и добавить":"create and add",onClick:()=>{le(m,y,$,s),u(d)}}))},children:W.getIcon(s,{size:32,style:{color:i.get("habitIcon",e),filter:"drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5))"}})},s))}),ue&&t.jsx("div",{style:n(e).container,children:t.jsxs("div",{style:n(e).confirmationPanel,children:[t.jsx("p",{style:n(e).text,children:Re(l,B,he,m)}),t.jsxs("div",{style:{...n(e).simplePanelRow,flexDirection:"column",alignItems:"center",backgroundColor:i.get("background",e),width:"90%",borderRadius:"24px"},children:[t.jsx("p",{style:n(e).text,children:l===0?"установите дату":"set date"}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx(V,{onPointerDown:()=>C(!1,0),onPointerUp:j,onClick:()=>{z.getFullYear()-2<=g-1&&k(g-1),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}}),t.jsxs("p",{style:n(e).textDate,children:[" ",g," "]}),t.jsx(N,{onPointerDown:()=>C(!0,0),onPointerUp:j,onClick:()=>{z.getFullYear()+2>=g+1&&k(g+1),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx(V,{onPointerDown:()=>C(!1,1),onPointerUp:j,onClick:()=>{P(f-1>0?f-1:12),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}}),t.jsxs("p",{style:n(e).textDate,children:[" ",ve[l][f-1]," "]}),t.jsx(N,{onPointerDown:()=>C(!0,1),onPointerUp:j,onClick:()=>{P(f+1<12?f+1:1),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}})]}),t.jsxs("div",{style:{...n(e).simplePanelRow,width:"70%"},children:[t.jsx(V,{onPointerDown:()=>C(!1,2),onPointerUp:j,onClick:()=>{H(J(!1,D,g,f)),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}}),t.jsxs("p",{style:n(e).textDate,children:[" ",D," "]}),t.jsx(N,{onPointerDown:()=>C(!0,2),onPointerUp:j,onClick:()=>{H(J(!0,D,g,f)),u(d)},style:{...n(e).miniIcon,fontSize:"20px",marginTop:"15px"}})]})]}),t.jsxs("div",{style:n(e).simplePanelRow,children:[t.jsx("div",{style:n(e).button,onClick:()=>{M(!1),Be(H,P,k),u(d)},children:t.jsx(Fe,{style:n(e).miniIcon})}),t.jsx("div",{style:n(e).button,onClick:()=>{je.onClick(),u(d)},children:t.jsx(Te,{style:n(e).miniIcon})})]})]})})]})},ze=(e,a)=>Array.from(new Set(K.map(r=>r.category[a]))).map(r=>t.jsx("option",{value:r,style:{...n(e).text},children:r},r)),G=(e,a,x)=>{if(typeof re!="function"){console.warn("AddHabitPanel: addHabitFn is not set yet. Ensure HabitsMain is mounted."),L(p.prefs[0]===0?"экран привычек ещё не готов":"habits screen not ready yet",2e3,!1);return}if(p.IsHabitInChoosenList(e)){L(p.prefs[0]===0?"привычка уже в списке":"habit already in list",2500,!1);return}re(e);const r=x?p.prefs[0]===0?`привычка: ${a} создана и добавлена`:`habit: ${a} was created and added`:p.prefs[0]===0?"привычка добавлена":"habit added";L(r,2500,!0)},le=(e,a,x,r)=>{const c=v(),l=(c.length>0?Math.max(...c.map(R=>R.id)):0)+1;p.IsCustomHabitExists(l)?L(p.prefs[0]===0?"привычка с таким названием уже существует":"habit with this name already exists",2500,!1):(p.AddCustomHabit(e,a,x,r,l),setTimeout(()=>{G(l,e,!0)},100))},Le=(e,a,x)=>{if(e.length>0){const r=v().filter(c=>c.name[p.prefs[0]].toLowerCase().startsWith(e.toLowerCase()));x(r)}else{const r=v();a.length!=r.length&&x(r)}},n=(e,a)=>({container:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9900,padding:"20px"},panel:{alignItems:"center",justifyContent:"center",borderRadius:"24px",overflow:"hidden",boxSizing:"border-box",overflowY:"scroll",border:`1px solid ${i.get("border",e)}`,margin:"5px",backgroundColor:i.get("simplePanel",e),boxShadow:`4px 4px 6px ${i.get("shadow",e)}`,width:"85vw",height:a?"85vh":"65vh"},confirmationPanel:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"24px",border:`1px solid ${i.get("border",e)}`,margin:"5px",backgroundColor:i.get("simplePanel",e),boxShadow:`4px 4px 6px ${i.get("shadow",e)}`,width:"85vw",height:"80vw"},text:{textAlign:"center",fontSize:"12px",color:i.get("mainText",e),marginBottom:"12px"},textDate:{textAlign:"center",fontSize:"18px",color:i.get("mainText",e),marginBottom:"4px"},headerText:{textAlign:"center",margin:"5px",padding:"5px",fontSize:"14px",color:i.get("subText",e)},scrollView:{overflowY:"auto",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch"},simplePanel:{marginLeft:"7.5vw",width:"70vw",height:"30vh",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"stretch",background:"rgba(0, 0, 0, 0.1)",borderRadius:"24px"},input:{width:"65vw",height:a?"6vh":"3vh",borderRadius:"12px",border:`1px solid ${i.get("border",e)}`,margin:"12px",fontSize:"14px",fontFamily:"Segoe UI",color:i.get("subText",e),backgroundColor:i.get("inputField",e)},simplePanelRow:{width:"75vw",display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"space-around"},select:{width:"20vw",height:"6vw",borderRadius:"12px",border:`1px solid ${i.get("border",e)}`,marginTop:"12px",fontSize:"14px",color:i.get("subText",e),backgroundColor:i.get("habitCard",e)},selectOption:{color:i.get("subText",e),backgroundColor:i.get("habitCard",e),fontSize:"8px"},selectPanel:{backgroundColor:i.get("habitCard",e),borderRadius:"24px",border:`1px solid ${i.get("border",e)}`,position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexWrap:"wrap",width:"77vw",maxHeight:"42vh",overflowY:"auto",padding:"16px",gap:"8px",justifyContent:"center",zIndex:1e3},selectIcon:{flex:"{0,0,33.33%}",width:"20vw",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignContent:"center",justifyContent:"center",width:"15vw",marginTop:"12px",fontSize:"12px"},miniIcon:{fontSize:"28px",padding:"5px",marginTop:"10px",color:i.get("icons",e),filter:`drop-shadow(0 0px 1px ${i.get("iconsShadow",e)})`}});function u(e){p.prefs[2]==0&&e!==null&&(e.paused||(e.pause(),e.currentTime=0),e.volume=.5,e.play()),p.prefs[3]==0&&Telegram.WebApp.HapticFeedback&&Telegram.WebApp.HapticFeedback.impactOccurred("light")}function Re(e,a,x,r){if(a)return e===0?"добавить привычку "+r+"?":"add habit "+r+"?";{const c=v().find(I=>I.id===x).name[e];return e===0?"добавить привычку "+c+"?":"add habit "+c+"?"}}function J(e,a,x,r){const c=new Date(x,r,0).getDate();return e?a+1<=c?a+1:1:a-1>0?a-1:c}function Be(e,a,x){const r=new Date;e(r.getDate()),a(r.getMonth()),x(r.getFullYear())}export{Ye as default};
