import{A as i,y as T}from"./index-B8u---WT.js";function p(t){return new Date(t).toISOString().split("T")[0]}function S(t,e,n,o){if(!o||typeof t!="string"||typeof e!="number")return null;const r=n.getTime();let s=null,a=-1/0;for(const[c,l]of Object.entries(o)){const g=new Date(c).getTime();if(!(g>=r))for(const u of l){if(!u.completed)continue;const m=u.exercises?.[t];if(!m||!Array.isArray(m.sets))continue;const f=m.sets[e];!f||typeof f.reps!="number"||typeof f.weight!="number"||g>a&&(a=g,s={type:f.type,reps:f.reps,weight:f.weight,time:f.time})}}return s}async function L(t,e,n){const o=i.programs[e];if(!o||!o.schedule[n])return console.error("Invalid program or dayIndex"),!1;const r={},s=[];o.schedule[n].exercises.forEach(l=>{const d=i.exercises[l.exId];if(!d){console.warn(`Exercise ${l.exId} not found in AppData.exercises`);return}r[l.exId]={mgId:d.mgId,sets:[],totalTonnage:0,completed:!1},s.push(l.exId)});const a=p(t),c={type:"GYM",programId:e,dayIndex:n,completed:!1,startTime:Date.now(),endTime:null,duration:0,tonnage:0,exercises:r,RPE:null,note:"",exerciseOrder:s};i.trainingLog[a]||(i.trainingLog[a]=[]),i.trainingLog[a].push(c),await T()}async function b(t,e,n,o){const r=p(t),s=i.trainingLog[r]?.[e];return s.RPE=n,s.note=o.trim(),await T(),!0}async function E(t,e,n,o,r){const s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=s.getTime()+o,c=s.getTime()+r,l=c-a,d={},g=[],u=i.programs[e];if(!u||!u.schedule[n]){console.error("Invalid program or dayIndex in addPreviousSession");return}u.schedule[n].exercises.forEach(y=>{const h=i.exercises[y.exId];if(!h){console.warn(`Exercise ${y.exId} not found in AppData.exercises`);return}d[y.exId]={mgId:h.mgId,sets:[],totalTonnage:0,completed:!0},g.push(y.exId)});const m={type:"GYM",programId:e,dayIndex:n,completed:!0,startTime:a,endTime:c,duration:l,tonnage:0,exercises:d,exerciseOrder:g},f=p(t);i.trainingLog[f]||(i.trainingLog[f]=[]),i.trainingLog[f].push(m),await T()}async function w(t,e){const n=p(t),o=i.trainingLog[n];if(!o||e<0||e>=o.length)return!1;o.splice(e,1),o.length===0&&delete i.trainingLog[n],await T()}async function R(t,e,n=null,o=""){const r=p(t),s=i.trainingLog[r]?.[e];if(!s||s.completed)return[];s.endTime=Date.now(),s.duration=s.endTime-s.startTime,s.completed=!0,n!==null&&(s.RPE=n),s.note=o.trim(),Object.values(s.exercises).forEach(c=>{c.completed=!0}),s.tonnage=Object.values(s.exercises).reduce((c,l)=>c+(l.totalTonnage||0),0);const a=[];return s.exerciseOrder.forEach(c=>{const l=s.exercises[c],d=Number(c),g=i.exercises[d];if(!l||!g||!l.sets?.length)return;const u=l.sets.reduce((y,h)=>h.weight>y.weight?h:y,{weight:0,reps:1}),m=x(u.reps,u.weight);if(isNaN(m)||m<=0)return;const f=g.rm;if(m>f){g.rm=m,g.rmDate=r;const y=m-f;a.push({exId:d,newRm:m,oldRm:f,improvement:y})}}),await T(),a}async function M(t,e,n){const o=p(t),r=i.trainingLog[o]?.[e];return!r||r.exercises[n]?!1:(r.exercises[n]={mgId:i.exercises[n]?.mgId||0,sets:[],totalTonnage:0,completed:!1},r.exerciseOrder.push(n),await T(),!0)}async function O(t,e,n){const o=p(t),r=i.trainingLog[o]?.[e];if(!r||!r.exercises[n])return!1;const s=r.exercises[n];return r.tonnage=Math.max(0,r.tonnage-(s.totalTonnage||0)),delete r.exercises[n],r.exerciseOrder&&(r.exerciseOrder=r.exerciseOrder.filter(a=>a!==n)),await T(),!0}async function N(t,e,n,o,r,s,a){const c=p(t),l=i.trainingLog[c]?.[e],d=l?.exercises?.[n];if(!d)return!1;const u={type:a?0:1,reps:o,weight:r,time:s};d.sets.push(u);const m=o*r;if(d.totalTonnage=(d.totalTonnage||0)+m,l.tonnage=(l.tonnage||0)+m,d.completed&&!a&&o>0&&r>0){const f=x(o,r),y=i.exercises[n]?.rm||0;f>y&&(i.exercises[n].rm=f,i.exercises[n].rmDate=p(new Date))}return await T(),!0}async function A(t,e,n,o,r,s,a,c){const l=p(t),d=i.trainingLog[l]?.[e],g=d?.exercises?.[n];if(!g||o<0||o>=g.sets.length)return!1;const u=g.sets[o],m=c?0:1;if(u.reps===r&&u.weight===s&&a===u.time&&u.type===m)return!0;const f=u.reps*u.weight;g.totalTonnage=Math.max(0,(g.totalTonnage||0)-f),d.tonnage=Math.max(0,(d.tonnage||0)-f),u.reps=r,u.weight=s,u.type=m;const y=r*s;return g.totalTonnage=(g.totalTonnage||0)+y,d.tonnage=(d.tonnage||0)+y,await T(),!0}async function C(t,e,n){const o=p(t),s=i.trainingLog[o]?.[e]?.exercises?.[n];return s?(s.completed=!0,await T(),!0):!1}function D(t,e){const n=p(t);return i.trainingLog[n]?.[e]?.tonnage||0}function G(t,e){const n=p(t),o=i.trainingLog[n]?.[e];if(!o)return 0;let r=0;for(const s of Object.values(o.exercises))for(const a of s.sets)r+=a.reps;return r}function K(t,e){const n=p(t),o=i.trainingLog[n]?.[e];if(!o)return 0;let r=0;for(const s of Object.values(o.exercises))r+=s.sets.length;return r}function x(t,e){if(!t||!e||t<1||e<=0)return 0;if(t===1)return e;const n=e*(36/(37-t)),o=e*(1+.0333*t),r=e*Math.pow(t,.1),s=n+o+r;return Math.round(s/3)}const H=()=>{try{const t=i?.trainingLog||{},e=new Date;let n=0;const o=[];for(let r=0;r<7;r++){const s=new Date(e);s.setDate(e.getDate()-r);const a=s.toISOString().split("T")[0];o.push(a)}for(const r of o){const s=t[r];if(Array.isArray(s)){const a=s.filter(c=>c.completed===!0).length;n+=a}}return Math.min(n,7)}catch(t){return console.warn("Error calculating weekly training amount:",t),0}};async function P(t,e,n,o,r,s={}){const a=o*6e4,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()+r,d=l+a,g={type:e,startTime:l,endTime:d,duration:a,distance:n,elevationGain:s.elevationGain||0,avgCadence:s.avgCadence||null,avgHeartRate:s.avgHeartRate||null,rpe:s.rpe||5,notes:s.notes||"",completed:!0},u=p(t);return i.trainingLog[u]||(i.trainingLog[u]=[]),i.trainingLog[u].push(g),await T(),g}async function $(t,e){try{const[n,o]=t.split("_"),r=parseInt(o,10);if(!n||isNaN(r)||r<0)return console.error("Invalid sessionId format:",t),!1;if(!i.trainingLog[n]||!i.trainingLog[n][r])return console.error(`Session not found: ${t}`),!1;const s=i.trainingLog[n][r];if(s.type==="GYM"||!s.type)return console.warn("Cannot update GYM session with updateCardioSession"),!1;const a=[];if(e.distance!==void 0&&(typeof e.distance!="number"||e.distance<0)&&a.push("Invalid distance"),e.duration!==void 0&&(typeof e.duration!="number"||e.duration<=0)&&a.push("Invalid duration"),e.rpe!==void 0&&(e.rpe<1||e.rpe>10)&&a.push("RPE must be between 1 and 10"),e.avgHeartRate!==void 0&&(typeof e.avgHeartRate!="number"||e.avgHeartRate<30||e.avgHeartRate>250)&&a.push("Invalid heart rate"),a.length>0)return console.error("Validation errors:",a.join(", ")),!1;const c={...s,...e,type:e.type||s.type,date:e.date||s.date,completed:e.completed!==void 0?e.completed:s.completed!==!1};return(e.startTime!==void 0||e.endTime!==void 0)&&c.endTime&&c.startTime&&(c.duration=(c.endTime-c.startTime)/6e4),i.trainingLog[n][r]=c,await T(),!0}catch(n){return console.error("Error updating cardio session:",n),!1}}async function j(t,e){return await w(t,e)}const I=(t,e)=>{try{if(!t||typeof t!="string"||e===void 0||e<0)return console.warn("Invalid parameters for getCardioSession:",{dayKey:t,index:e}),null;if(!i.trainingLog[t])return console.warn(`No training sessions found for date: ${t}`),null;const n=i.trainingLog[t];if(!n[e])return console.warn(`Session not found at index ${e} for date ${t}`),null;const o=n[e];return{id:`${t}_${e}`,date:t,type:o.type||"RUNNING",distance:o.distance||0,duration:o.duration||0,elevationGain:o.elevationGain||0,avgCadence:o.avgCadence||0,avgHeartRate:o.avgHeartRate||0,rpe:o.rpe||0,notes:o.notes||"",startTime:o.startTime||16*36e5,completed:o.completed!==!1}}catch(n){return console.error("Error retrieving cardio session:",n),null}};export{E as a,L as b,C as c,w as d,N as e,S as f,K as g,D as h,G as i,R as j,A as k,O as l,M as m,I as n,P as o,j as p,H as q,b as r,$ as u};
