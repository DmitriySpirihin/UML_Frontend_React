import{t as T,l as U,j as t,C as a,m as o,d as k,Q as B,R as $,S as P,A as c,T as A,U as d,V as R,W as _,X as z,Y as N,Z as F,_ as L,a as j}from"./index-CFssqZtW.js";import{r as n}from"./recharts-k8ghPecL.js";import{calculateStats as M}from"./UserPanel-DDlDk9n7.js";import"./PaymentService-ho8acUWw.js";import"./index-DlKPMVLE.js";import"./ScrollPicker-DnSlNQU3.js";function J(){const[e,v]=n.useState("dark"),[m,S]=n.useState(0),[h,f]=n.useState("Guest"),[x,y]=n.useState("images/Ui/Guest.jpg"),[p,b]=n.useState(!0);return n.useEffect(()=>{async function u(){try{await B();const l=typeof window<"u"?!window.Telegram?.WebApp:!0;await $({mock:l});const g=P(),{user:r,languageCode:O,colorScheme:I,start_param:C}=g;if(r){c.isFirstStart&&(c.prefs[1]=I==="dark"?0:1,A("dark")),d.Init(r.id,r.username,r.photo_url||"images/Ui/Guest.jpg"),f(r.username),y(Array.isArray(r.photo_url)?r.photo_url[0]:r.photo_url);const s=C;if(s&&!isNaN(s)&&Number(s)!==r.id){const w=`ref_processed_${s}`;if(!localStorage.getItem(w))try{await fetch("/api/record-referral",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referrerId:Number(s),newUserId:r.id})}),localStorage.setItem(w,"1")}catch(D){console.warn("Referral submission failed:",D)}}}else d.Init(0,c.prefs[0]===0?"гость":"guest","images/Ui/Guest.jpg"),f(c.prefs[0]===0?"гость":"guest"),y("images/Ui/Guest.jpg");if(await R(),_(),z(),d.id&&d.id!==0){await N(d.id);const s=M();await F(s.level.xp,s.level.current),await L()}b(!1),setTimeout(()=>j("MainMenu"),1200)}catch(l){console.error("Initialization error:",l),b(!1),setTimeout(()=>j("MainMenu"),1200)}}u()},[]),n.useEffect(()=>{const u=T.subscribe(v),l=U.subscribe(g=>S(g==="ru"?0:1));return()=>{u.unsubscribe(),l.unsubscribe()}},[]),t.jsxs("div",{style:i(e).container,children:[t.jsx("div",{style:i(e).bgOverlay}),t.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},style:i(e).content,children:[t.jsx(o.img,{src:"images/Ui/Main_Dark.png",style:i(e).logo,alt:"UltyMyLife",animate:{scale:[.95,1,.95]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),t.jsx("div",{style:i(e).loaderSection,children:t.jsx(k,{mode:"wait",children:p?t.jsxs(o.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},style:i(e).pulseContainer,children:[t.jsx("div",{style:i(e).ring}),t.jsx("img",{src:x,style:i(e).loadingPhoto,alt:"Loading..."})]},"loader"):t.jsxs(o.div,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15},style:i(e).photoWrapper,children:[t.jsx("img",{src:x,style:i(e).userPhoto,alt:"User"}),t.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},style:i(e).premiumBadge})]},"user")})}),t.jsxs(o.div,{animate:{opacity:[.4,1,.4]},transition:{duration:2,repeat:1/0},style:i(e).textContainer,children:[t.jsx("h2",{style:i(e).mainText,children:p?m===0?"Синхронизация...":"Synchronizing...":m===0?`Рады видеть, ${h}`:`Welcome back, ${h}`}),t.jsx("div",{style:i(e).progressBar,children:t.jsx(o.div,{initial:{width:"0%"},animate:{width:p?"70%":"100%"},style:i(e).progressFill})})]})]}),t.jsx("style",{children:`
        @keyframes custom-pulse {
          0% { transform: scale(0.95); box-shadow: 0 0 0 0 ${a.get("currentDateBorder",e)}44; }
          70% { transform: scale(1); box-shadow: 0 0 0 20px ${a.get("currentDateBorder",e)}00; }
          100% { transform: scale(0.95); box-shadow: 0 0 0 0 ${a.get("currentDateBorder",e)}00; }
        }
      `})]})}const i=e=>({container:{backgroundColor:a.get("background",e),display:"flex",flexDirection:"column",alignItems:"center",height:"100vh",width:"100vw",overflow:"hidden",position:"relative"},bgOverlay:{position:"absolute",inset:0,background:e==="dark"?"radial-gradient(circle at 50% 50%, #373e4b 0%, #0c0c10 100%)":"radial-gradient(circle at 50% 50%, #fff 0%, #6f6f6f 100%)",opacity:.6,zIndex:1},content:{zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",paddingTop:"20vh"},logo:{width:"220px",filter:`drop-shadow(0 0 20px ${a.get("shadow",e)}88)`,marginBottom:"8vh"},loaderSection:{height:"120px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"4vh"},pulseContainer:{position:"relative",width:"80px",height:"80px",display:"flex",alignItems:"center",justifyContent:"center"},ring:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",border:`2px solid ${a.get("currentDateBorder",e)}`,animation:"custom-pulse 2s infinite ease-in-out"},loadingPhoto:{width:"60px",height:"60px",borderRadius:"50%",opacity:.5,filter:"grayscale(1)"},photoWrapper:{position:"relative"},userPhoto:{border:`3px solid ${a.get("currentDateBorder",e)}`,width:"90px",height:"90px",borderRadius:"50%",objectFit:"cover",boxShadow:`0 10px 30px ${a.get("shadow",e)}`},textContainer:{display:"flex",flexDirection:"column",alignItems:"center",gap:"15px"},mainText:{fontSize:"18px",fontWeight:"600",color:a.get("mainText",e),fontFamily:"Segoe UI, Roboto, sans-serif",textAlign:"center",letterSpacing:"0.5px"},progressBar:{width:"120px",height:"4px",backgroundColor:a.get("border",e),borderRadius:"10px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:a.get("currentDateBorder",e),borderRadius:"10px"}});export{J as default};
